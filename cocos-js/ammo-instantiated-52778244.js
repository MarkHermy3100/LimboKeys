System.register([],(function(e,t){"use strict";return{execute:async function(){e({A:void 0,E:void 0,F:void 0,G:void 0,H:void 0,I:void 0,J:void 0,L:void 0,M:void 0,O:void 0,Q:void 0,S:void 0,T:void 0,aH:void 0,aN:Sc,aO:Ec,aP:Tc,aQ:Cc,aR:wc,b:void 0,b$:function(e){return V_(q_({formerlySerializedAs:e}))},bA:function(){},bF:V,bG:G,bH:function(){},bQ:he,bR:ue,bS:se,bU:Mc,bW:function(e,t,n,i,o){void 0===n&&(n=Ma.R32F),void 0===i&&(i=0),void 0===o&&(o=0);var r=mc[n];o||(o=r.size);for(var a="set"+cI(r),s=r.size/r.count,c=Math.floor(t.length/r.count),l=jx.isLittleEndian,u=0;u<c;++u)for(var h=i+o*u,_=0;_<r.count;++_){var f=h+s*_;e[a](f,t[r.count*u+_],l)}},bX:eN,bY:lI,b_:ct,bb:nL,bc:iL,bf:_L,bl:ie,bm:te,bn:N,bo:x,bq:le,bs:void 0,bu:void 0,bw:P,bx:y,bz:function(e,t,n,i,o,r){void 0===t&&(t=Ma.R32F),void 0===n&&(n=0),void 0===i&&(i=e.byteLength-n),void 0===o&&(o=0),void 0===r&&(r=[]);var a=mc[t];o||(o=a.size);for(var s="get"+cI(a),c=a.size/a.count,l=Math.floor(i/o),u=jx.isLittleEndian,h=0;h<l;++h)for(var _=n+o*h,f=0;f<a.count;++f){var d=_+c*f;r[a.count*h+f]=e[s](d,u)}return r},c:void 0,c1:pf,c3:void 0,cA:ZF,cB:QF,cD:void 0,cF:void 0,cL:void 0,cM:void 0,cT:Re,cU:it,cW:Bi,cX:Ge,ce:void 0,cf:void 0,ci:void 0,ct:fn,cu:ld,cv:function(e,t,n){for(jn.identity(n);e!==t;)jn.fromRTS(oz,e.rotation,e.position,e.scale),jn.multiply(n,oz,n),e=e.parent;return n},cz:JF,d:void 0,d$:vn,d0:void 0,d2:ht,dA:void 0,dE:_n,dH:St,dM:hn,dT:dn,dW:void 0,dX:En,dY:gn,d_:mn,db:un,dd:ne,di:void 0,dk:void 0,dq:void 0,dt:Ct,du:He,dv:b,dx:void 0,e:void 0,e$:ax,e0:H,e2:Tn,e4:Lv,e6:cn,e8:Ti,eE:Jn,eF:Dn,eG:ei,eH:Vn,eK:ii,eL:ri,eM:Pn,eO:ln,eP:yn,eQ:xn,eR:Sn,eS:An,eT:Cn,eU:st,e_:function(e){e>0&&(Z=e)},eb:wn,ec:de,ed:ae,ee:pe,ef:V_,eh:wt,ei:bt,ej:L,el:Vi,en:g,eo:Xn,et:pi,ex:tn,ez:$e,f:void 0,f$:lz,f0:sx,f3:Gd,fg:S,fh:M,fi:F,fj:z,fk:void 0,fu:Rw,g:void 0,g0:uz,g1:hz,g2:OL,g3:UL,g7:kL,g8:VL,gb:function(e,t){for(var n=e,i="";null!==n&&n!==t;)i=n.name+"/"+i,n=n.parent;return i.slice(0,-1)},gd:yz,h:void 0,i:void 0,j:void 0,k:void 0,l:void 0,m:void 0,n:void 0,o:void 0,p:void 0,q:void 0,r:void 0,s:void 0,t:void 0,u:void 0,v:void 0,w:void 0,x:void 0,y:void 0,z:void 0});const n=e("bv",!1),i=e("dV",!1),o=e("dL",!1),r=e("dJ",!1),a=e("dK",!1);var s="undefined"==typeof window?global:window,c=e("by",{_global:s});c.internal={},s.CC_BUILD=!0,s.CC_TEST=!1,s.CC_EDITOR=i,s.CC_PREVIEW=!1,s.CC_DEV=!1,s.CC_DEBUG=!1,s.CC_JSB=a,s.CC_BYTEDANCE=!1,s.CC_WECHAT=n,s.CC_ALIPAY=!1,s.CC_XIAOMI=!1,s.CC_BAIDU=!1,s.CC_COCOSPLAY=!1,s.CC_HUAWEI=!1,s.CC_OPPO=!1,s.CC_VIVO=!1,s.CC_MINIGAME=r,s.CC_RUNTIME_BASED=o,s.CC_SUPPORT_JIT=!0;var l=e("eq","3.1.2");s.CocosEngine=c.ENGINE_VERSION=l,s.cc=c;var u="https://github.com/cocos-creator/engine/blob/3d/EngineErrorMap.md",h=null,_=console.log.bind(console),f=_,d=_,p=function(e,t){if(!e){for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];console.log("ASSERT: "+v.apply(void 0,[t].concat(i)))}},m=_;function v(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return c.js.formatStr.apply(null,[e].concat(n))}function g(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return _.apply(void 0,[e].concat(n))}function y(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return f.apply(void 0,[e].concat(n))}function x(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return d.apply(void 0,[e].concat(n))}function S(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return p.apply(void 0,[e,t].concat(i))}function E(){return m.apply(void 0,arguments)}function T(e){if(_=f=d=p=m=function(){},e!==O.NONE){if(e>O.ERROR){var t=function(e){if(c.game.canvas){if(!h){var t=document.createElement("Div");t.setAttribute("id","logInfoDiv"),t.setAttribute("width","200"),t.setAttribute("height",c.game.canvas.height);var n=t.style;n.zIndex="99999",n.position="absolute",n.top=n.left="0",(h=document.createElement("textarea")).setAttribute("rows","20"),h.setAttribute("cols","30"),h.setAttribute("disabled","true");var i=h.style;i.backgroundColor="transparent",i.borderBottom="1px solid #cccccc",i.borderTopWidth=i.borderLeftWidth=i.borderRightWidth="0px",i.borderTopStyle=i.borderLeftStyle=i.borderRightStyle="none",i.padding="0px",i.margin="0px",t.appendChild(h),c.game.canvas.parentNode.appendChild(t)}h.value=h.value+e+"\r\n",h.scrollTop=h.scrollHeight}};d=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];t("ERROR :  "+v.apply(void 0,[e].concat(i)))},p=function(e,n){if(!e){for(var i=arguments.length,o=new Array(i>2?i-2:0),r=2;r<i;r++)o[r-2]=arguments[r];t("ASSERT: "+v.apply(void 0,[n].concat(o)))}},e!==O.ERROR_FOR_WEB_PAGE&&(f=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];t("WARN :  "+v.apply(void 0,[e].concat(i)))}),e===O.INFO_FOR_WEB_PAGE&&(_=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];t(v.apply(void 0,[e].concat(i)))})}else console&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),d=console.error.bind?console.error.bind(console):function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return console.error.apply(console,[e].concat(n))},p=function(e,t){if(!e){for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];var r=v.apply(void 0,[t].concat(i));throw new Error(r)}});if(e!==O.ERROR&&(f=console.warn.bind?console.warn.bind(console):function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return console.warn.apply(console,[e].concat(n))}),e===O.INFO&&(_=console.log.bind?console.log.bind(console):function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return console.log.apply(console,[e].concat(n))}),e<=O.VERBOSE&&"function"==typeof console.debug){var n=console.debug;m=function(){return n.apply(void 0,arguments)}}}}function A(e){x(e.stack||e)}function C(e){return function(t){for(var n=e+" "+t+", please go to "+u+"#"+t+" to see details.",i=arguments.length,o=new Array(i>1?i-1:0),r=1;r<i;r++)o[r-1]=arguments[r];return 0===o.length?n:n+" Arguments: "+o.join(", ")}}var w=C("Log");function b(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];g(w.apply(void 0,[e].concat(n)))}var I=C("Warning");function P(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];y(I.apply(void 0,[e].concat(n)))}var R=C("Error");function N(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];x(R.apply(void 0,[e].concat(n)))}var O,D=C("Assert");function M(e,t){if(!e){for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];S(!1,D.apply(void 0,[t].concat(i)))}}function L(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return R.apply(void 0,[e].concat(n))}function F(){return!!c.profiler&&c.profiler.isShowingStats()}function z(e){c.profiler&&(e?c.profiler.showStats():c.profiler.hideStats(),c.game.config.showFPS=!!e)}!function(e){e[e.NONE=0]="NONE",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.INFO_FOR_WEB_PAGE=5]="INFO_FOR_WEB_PAGE",e[e.WARN_FOR_WEB_PAGE=6]="WARN_FOR_WEB_PAGE",e[e.ERROR_FOR_WEB_PAGE=7]="ERROR_FOR_WEB_PAGE"}(O||(O=e("fk",{})));var B=Object.freeze({__proto__:null,log:g,warn:y,error:x,assert:S,debug:E,_resetDebugSetting:T,_throw:A,logID:b,warnID:P,errorID:N,assertID:M,get DebugMode(){return O},getError:L,isDisplayStats:F,setDisplayStats:z}),U=e("e3",2147483647);function H(e){return(e>0)-(e<0)}function G(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function k(e){var t=32;return(e&=-e)&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}function V(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,1+(e|=e>>>16)}var W=new Array(256);!function(e){for(var t=0;t<256;++t){var n=t,i=t,o=7;for(n>>>=1;n;n>>>=1)i<<=1,i|=1&n,--o;e[t]=i<<o&255}}(W);var j=Object.freeze({__proto__:null,INT_BITS:32,INT_MAX:U,INT_MIN:-2147483648,sign:H,abs:function(e){var t=e>>31;return(e^t)-t},min:function(e,t){return t^(e^t)&-(e<t)},max:function(e,t){return e^(e^t)&-(e<t)},isPow2:function(e){return!(e&e-1||!e)},log2:G,log10:function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},popCount:function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},countTrailingZeros:k,nextPow2:V,prevPow2:function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},parity:function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1},reverse:function(e){return W[255&e]<<24|W[e>>>8&255]<<16|W[e>>>16&255]<<8|W[e>>>24&255]},interleave2:function(e,t){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},deinterleave2:function(e,t){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>t&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},interleave3:function(e,t,n){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},deinterleave3:function(e,t){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>t&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},nextCombination:function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>k(e)+1}});e("eD",j);var q,Y,X,K,Q,Z=10,J=0,$=new Map;function ee(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function te(e,t,n){return t&&ee(e.prototype,t),n&&ee(e,n),e}function ne(){return(ne=e("dd",Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e})).apply(this,arguments)}function ie(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,oe(e,t)}function oe(e,t){return(oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function re(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function ae(t,n,i){return(ae=re()?e("ed",Reflect.construct):e("ed",(function(e,t,n){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return n&&oe(o,n.prototype),o}))).apply(null,arguments)}function se(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function le(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ce(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function ue(e,t,n,i){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function he(e,t,n,i,o){var r={};return Object.keys(i).forEach((function(e){r[e]=i[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=n.slice().reverse().reduce((function(n,i){return i(e,t,n)||n}),r),o&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(o):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}X=function(e,t,n,i,o,r,a){var s=$.get(r);s&&s.logTimes>s.count&&(o("'%s' is deprecated, please use '%s' instead. "+a,e+"."+t,n+"."+i),s.count++)},q=e("ce",(function(e,t,n){null!=e&&n.forEach((function(n){var i=J++;$.set(i,{id:i,count:0,logTimes:void 0!==n.logTimes?n.logTimes:Z});var o=null!=n.target?n.target:e,r=null!=n.newName?n.newName:n.name,a=null!=n.targetName?n.targetName:t,s=o===e,c=n.suggest?"("+n.suggest+")":"";if(null!=n.customFunction)e[n.name]=function(){var e;return X(t,n.name,a,r,y,i,c),(e=n.customFunction).call.apply(e,[this].concat(Array.prototype.slice.call(arguments)))};else if(null!=n.customSetter||null!=n.customGetter){var l=null!=n.customSetter,u=null!=n.customGetter;l&&u?Object.defineProperty(e,n.name,{get:function(){return X(t,n.name,a,r,y,i,c),n.customGetter.call(this)},set:function(e){X(t,n.name,a,r,y,i,c),n.customSetter.call(this,e)},enumerable:!1}):l?Object.defineProperty(e,n.name,{set:function(e){X(t,n.name,a,r,y,i,c),n.customSetter.call(this,e)},enumerable:!1}):u&&Object.defineProperty(e,n.name,{get:function(){return X(t,n.name,a,r,y,i,c),n.customGetter.call(this)},enumerable:!1})}else Object.defineProperty(e,n.name,{get:function(){return X(t,n.name,a,r,y,i,c),s?this[r]:o[r]},set:function(e){X(t,n.name,a,r,y,i,c),s?this[r]=e:o[r]=e},enumerable:!1})}))})),Q=function(e,t,n,i,o){var r=$.get(i);r&&r.logTimes>r.count&&(n("'%s' has been removed. "+o,e+"."+t),r.count++)},Y=e("cf",(function(e,t,n){null!=e&&n.forEach((function(n){var i=J++;$.set(i,{id:i,count:0,logTimes:void 0!==n.logTimes?n.logTimes:Z});var o=n.suggest?"("+n.suggest+")":"";Object.defineProperty(e,n.name,{get:function(){return Q(t,n.name,x,i,o)},set:function(){Q(t,n.name,x,i,o)},enumerable:!1})}))})),K=function(e,t,n,i,o){var r=$.get(i);r&&r.logTimes>r.count&&(n("'%s' is deprecated. "+o,e+"."+t),r.count++)},e("di",(function(e,t,n){if(null!=e){var i=function(t,n,i,o,r,a){if(t.get){var s=t.get;t.get=function(){return K(n,i,o,r,a),s.call(this)}}if(t.set){var c=t.set;t.set=function(e){K(n,i,o,r,a),c.call(this,e)}}Object.defineProperty(e,i,t)};n.forEach((function(n){var o=n.name,r=Object.getOwnPropertyDescriptor(e,o);if(r&&r.configurable){var a=J++;$.set(a,{id:a,count:0,logTimes:void 0!==n.logTimes?n.logTimes:Z});var s=n.suggest?"("+n.suggest+")":"";if(null!=r.value)if("function"==typeof r.value){var c=r.value;e[o]=function(){return K(t,o,y,a,s),c.call.apply(c,[this].concat(Array.prototype.slice.call(arguments)))}}else i(r,t,o,y,a,s);else i(r,t,o,y,a,s);Object.defineProperty(e,o,{enumerable:!1})}}))}}));var _e=function(){function e(e){this.i=0,this.array=e}var t=e.prototype;return t.remove=function(e){var t=this.array.indexOf(e);t>=0&&this.removeAt(t)},t.removeAt=function(e){this.array.splice(e,1),e<=this.i&&--this.i},t.fastRemove=function(e){var t=this.array.indexOf(e);t>=0&&this.fastRemoveAt(t)},t.fastRemoveAt=function(e){var t=this.array;t[e]=t[t.length-1],--t.length,e<=this.i&&--this.i},t.push=function(e){this.array.push(e)},te(e,[{key:"length",get:function(){return this.array.length},set:function(e){this.array.length=e,this.i>=e&&(this.i=e-1)}}]),e}();function fe(e,t){e.splice(t,1)}function de(e,t){var n=e.length;t<0||t>=n||(e[t]=e[n-1],e.length=n-1)}function pe(e,t){var n=e.indexOf(t);return n>=0&&(fe(e,n),!0)}function me(e,t){return e.indexOf(t)>=0}var ve=Object.freeze({__proto__:null,removeAt:fe,fastRemoveAt:de,remove:pe,fastRemove:function(e,t){var n=e.indexOf(t);n>=0&&(e[n]=e[e.length-1],--e.length)},removeIf:function(e,t){var n=e.findIndex(t);if(n>=0){var i=e[n];return fe(e,n),i}},verifyType:function(e,t){if(e&&e.length>0)for(var n,i=le(e);!(n=i()).done;)if(!(n.value instanceof t))return b(1300),!1;return!0},removeArray:function(e,t){for(var n=0,i=t.length;n<i;n++)pe(e,t[n])},appendObjectsAt:function(e,t,n){return e.splice.apply(e,[n,0].concat(t)),e},contains:me,copy:function(e){for(var t=e.length,n=new Array(t),i=0;i<t;i+=1)n[i]=e[i];return n},MutableForwardIterator:_e}),ge=function(){function e(e){this.id=void 0,this.prefix=void 0,this.id=0|998*Math.random(),this.prefix=e?e+".":""}return e.prototype.getNewId=function(){return this.prefix+ ++this.id},e}();ge.global=new ge("global");var ye=new ge("TmpCId."),xe="undefined"==typeof Symbol?"__aliases__":Symbol("[[Aliases]]"),Se="__cid__";function Ee(e){return"number"==typeof e||e instanceof Number}function Te(e){return"string"==typeof e||e instanceof String}function Ae(e){for(var t in e)return!1;return!0}var Ce,we=(Ce={value:void 0,enumerable:!1,writable:!1,configurable:!0},function(e,t,n,i,o){Ce.value=n,Ce.writable=i,Ce.enumerable=o,Object.defineProperty(e,t,Ce),Ce.value=void 0}),be=function(){var e={get:void 0,set:void 0,enumerable:!1};return function(t,n,i,o,r,a){void 0===r&&(r=!1),void 0===a&&(a=!1),"boolean"==typeof o&&(r=o,o=void 0),e.get=i,e.set=o,e.enumerable=r,e.configurable=a,Object.defineProperty(t,n,e),e.get=void 0,e.set=void 0}}(),Ie=function(){var e={get:void 0,enumerable:!1,configurable:!1};return function(t,n,i,o,r){e.get=i,e.enumerable=o,e.configurable=r,Object.defineProperty(t,n,e),e.get=void 0}}(),Pe=function(){var e={set:void 0,enumerable:!1,configurable:!1};return function(t,n,i,o,r){e.set=i,e.enumerable=o,e.configurable=r,Object.defineProperty(t,n,e),e.set=void 0}}();function Re(e){var t=Object.create(null);return e&&(t["."]=1,t["/"]=1,delete t["."],delete t["/"]),t}function Ne(e){if("function"==typeof e){var t=e.prototype;if(t&&t.hasOwnProperty("__classname__")&&t.__classname__)return t.__classname__;var n="";if(e.name&&(n=e.name),e.toString){var i,o=e.toString();(i="["===o.charAt(0)?o.match(/\[\w+\s*(\w+)\]/):o.match(/function\s*(\w+)/))&&2===i.length&&(n=i[1])}return"Object"!==n?n:""}return e&&e.constructor?Ne(e.constructor):""}function Oe(e,t,n,i){var o=/([^.]+)$/,r=o.exec(t)[0],a=o.exec(n)[0];function s(){return this[a]}i?be(e,r,s,(function(e){this[a]=e})):Ie(e,r,s)}function De(e,t,n,i){for(var o in n)Oe(e,t+"."+o,n[o],i)}var Me=/(%d)|(%s)/,Le=/%s/;function Fe(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(0===arguments.length)return"";if(0===n.length)return""+e;var o="string"==typeof e&&Me.test(e);if(o)for(var r,a=le(n);!(r=a()).done;){var s=r.value,c="number"==typeof s?Me:Le;if(c.test(e)){var l=""+s;e=e.replace(c,l)}else e+=" "+s}else for(var u,h=le(n);!(u=h()).done;){var _=u.value;e+=" "+_}return e}function ze(){for(var e=arguments.length-1,t=new Array(e),n=0;n<e;++n)t[n]=arguments[n+1];return t}function Be(e,t){for(;e;){var n=Object.getOwnPropertyDescriptor(e,t);if(n)return n;e=Object.getPrototypeOf(e)}return null}function Ue(e,t,n){var i=Be(t,e);i&&Object.defineProperty(n,e,i)}function He(e){e=e||{};for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var o=0,r=n;o<r.length;o++){var a=r[o];if(a){if("object"!=typeof a){N(5402,a);continue}for(var s in a)s in e||Ue(s,a,e)}}return e}function Ge(e){e=e||{};for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var o=0,r=n;o<r.length;o++){var a=r[o];if(a){if("object"!=typeof a){N(5403,a);continue}for(var s in a)Ue(s,a,e)}}return e}function ke(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e.prototype=Object.create(t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),e}function Ve(e){var t=e.prototype,n=t&&Object.getPrototypeOf(t);return n&&n.constructor}function We(e,t){if(e&&t){if("function"!=typeof e)return!1;if("function"!=typeof t)return!1;if(e===t)return!0;for(;;){if(!(e=Ve(e)))return!1;if(e===t)return!0}}return!1}function je(e){for(var t=0,n=Object.keys(e);t<n.length;t++)delete e[n[t]]}function qe(e){return"string"!=typeof e||e.startsWith(ye.prefix)}var Ye=Re(!0),Xe=Re(!0);function Ke(e,t){return function(n,i){if(i.prototype.hasOwnProperty(e)&&delete t[i.prototype[e]],we(i.prototype,e,n),n){var o=t[n];o&&o!==i?x("A Class already exists with the same "+e+' : "'+n+'".'):t[n]=i}}}var Qe=Ke("__cid__",Ye),Ze=Ke("__classname__",Xe);function Je(e,t){if(Ze(e,t),!t.prototype.hasOwnProperty(Se)){var n=e||ye.getNewId();n&&Qe(n,t)}}function $e(e,t){var n=Xe[t],i=Ye[t],o=!0;if(n&&n!==e&&(x('"'+t+'" has already been set as name or alias of another class.'),o=!1),i&&i!==e&&(x('"'+t+'" has already been set as id or alias of another class.'),o=!1),o){var r=e[xe];r||(r=[],e[xe]=r),r.push(t),Xe[t]=e,Ye[t]=e}}function et(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i=0,o=t;i<o.length;i++){var r=o[i],a=r.prototype,s=a.__cid__;s&&delete Ye[s];var c=a.__classname__;c&&delete Xe[c];var l=a[xe];if(l)for(var u=0;u<l.length;++u){var h=l[u];delete Xe[h],delete Ye[h]}}}function tt(e){return Ye[e]}function nt(e){return Xe[e]}function it(e,t){var n;if(t=void 0===t||t,"function"==typeof e&&e.prototype.hasOwnProperty(Se))return n=e.prototype.__cid__,!t&&i&&qe(n)?"":n;if(e&&e.constructor){var o=e.constructor.prototype;if(o&&o.hasOwnProperty(Se))return n=e.__cid__,!t&&i&&qe(n)?"":n}return""}var ot=e("cY",function(){var e=t.prototype;function t(e,t){this.count=void 0,this._pool=void 0,this._cleanup=void 0;var n=void 0===t?e:t,i=void 0===t?null:e;this.count=0,this._pool=new Array(n),this._cleanup=i}return e.get=function(){return this._get()},e._get=function(){if(this.count>0){--this.count;var e=this._pool[this.count];return this._pool[this.count]=null,e}return null},e.put=function(e){var t=this._pool;if(this.count<t.length){if(this._cleanup&&!1===this._cleanup(e))return;t[this.count]=e,++this.count}},e.resize=function(e){e>=0&&(this._pool.length=e,this.count>e&&(this.count=e))},t}()),rt=e("dR",ve),at=e("ch",{IDGenerator:ge,Pool:ot,array:ve,isNumber:Ee,isString:Te,isEmptyObject:Ae,getPropertyDescriptor:Be,addon:He,mixin:Ge,extend:ke,getSuper:Ve,isChildClassOf:We,clear:je,value:we,getset:be,get:Ie,set:Pe,unregisterClass:et,getClassName:Ne,setClassName:Je,setClassAlias:$e,getClassByName:nt,get _registeredClassNames(){return ne({},Xe)},set _registeredClassNames(e){je(Xe),Object.assign(Xe,e)},get _registeredClassIds(){return ne({},Ye)},set _registeredClassIds(e){je(Ye),Object.assign(Ye,e)},_getClassId:it,_setClassId:Qe,_getClassById:tt,obsolete:Oe,obsoletes:De,formatStr:Fe,shiftArguments:ze,createMap:Re});function st(e){if("__bitmask__"in e)return e;we(e,"__bitmask__",null,!0);for(var t=-1,n=Object.keys(e),i=0;i<n.length;i++){var o=n[i],r=e[o];if(-1===r)r=++t,e[o]=r;else if("number"==typeof r)t=r;else if("string"==typeof r&&Number.isInteger(parseFloat(o)))continue;var a=""+r;o!==a&&we(e,a,o)}return e}function ct(e){return"__enums__"in e?e:(we(e,"__enums__",null,!0),ct.update(e))}function lt(e){e.hasOwnProperty("__enums__")}function ut(e){lt(e);var t=e.__enums__||[];for(var n in t.length=0,e){var i=e[n];Number.isInteger(i)&&t.push({name:n,value:i})}return t.sort((function(e,t){return e.value-t.value})),e.__enums__=t,t}function ht(e){"__enums__"in e||we(e,"__enums__",null,!0)}c.js=at,e("eW",Object.freeze({__proto__:null,array:rt,js:at,IDGenerator:ge,Pool:ot,isNumber:Ee,isString:Te,isEmptyObject:Ae,value:we,getset:be,get:Ie,set:Pe,createMap:Re,getClassName:Ne,obsolete:Oe,obsoletes:De,formatStr:Fe,shiftArguments:ze,getPropertyDescriptor:Be,addon:He,mixin:Ge,extend:ke,getSuper:Ve,isChildClassOf:We,clear:je,_idToClass:Ye,_nameToClass:Xe,_setClassId:Qe,setClassName:Je,setClassAlias:$e,unregisterClass:et,_getClassById:tt,getClassByName:nt,_getClassId:it})),st.isBitMask=function(e){return e&&e.hasOwnProperty("__bitmask__")},st.getList=function(e){if(e.__bitmask__)return e.__bitmask__;var t=e.__bitmask__=[];for(var n in e){var i=e[n];Number.isInteger(i)&&t.push({name:n,value:i})}return t.sort((function(e,t){return e.value-t.value})),t},c.BitMask=st,ct.update=function(e){for(var t=-1,n=Object.keys(e),i=0;i<n.length;i++){var o=n[i],r=e[o];if(-1===r)r=++t,e[o]=r;else if("number"==typeof r)t=r;else if("string"==typeof r&&Number.isInteger(parseFloat(o)))continue;var a=""+r;o!==a&&we(e,a,o)}return Array.isArray(e.__enums__)&&ut(e),e},ct||(ct=e("b_",{})),ct.isEnum=function(e){return e&&e.hasOwnProperty("__enums__")},ct.getList=function(e){return lt(e),e.__enums__?e.__enums__:ut(e)},c.Enum=ct;var _t=e("eV",function(){function e(){}var t=e.prototype;return t.clone=function(){return N(100,Ne(this)+".clone"),this},t.equals=function(){return!1},t.set=function(){N(100,Ne(this)+".set")},t.toString=function(){return""+{}},e}());Je("cc.ValueType",_t),c.ValueType=_t;var ft=e("bp",{SUPPORT_TEXTURE_FORMATS:[".astc",".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"],KEY:{none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,ENABLE_TILEDMAP_CULLING:!0,TOUCH_TIMEOUT:5e3,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!0,CLEANUP_IMAGE_CACHE:!1,ENABLE_MULTI_TOUCH:!0,MAX_LABEL_CANVAS_POOL_SIZE:20});c.macro=ft;for(var dt=/^(?:cc|dragonBones|sp|ccsg)\..+/,pt=new Array(123),mt=0;mt<123;++mt)pt[mt]=64;for(var vt=0;vt<64;++vt)pt["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(vt)]=vt;var gt=pt;function yt(e,t,n){function i(e,t,n,i){var o=Object.getOwnPropertyDescriptor(e,t);if(o)o.get&&(e[n]=o.get),o.set&&i&&(e[i]=o.set);else{var r=e[n];be(e,t,r,e[i])}}for(var o,r=e.prototype,a=0;a<t.length;a++){var s=(o=t[a])[0].toUpperCase()+o.slice(1);i(r,o,"get"+s,"set"+s)}for(o in n){var c=n[o];i(r,o,c[0],c[1])}}function xt(e,t,n,i){var o=e[t];o?Array.isArray(o)?i?(o.push(o[0]),o[0]=n):o.push(n):e[t]=i?[n,o]:[o,n]:e[t]=n}function St(e,t){if("function"==typeof e.contains)return e.contains(t);if("function"==typeof e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(t));var n=t.parentNode;if(n)do{if(n===e)return!0;n=n.parentNode}while(null!==n);return!1}function Et(e){return"object"==typeof window&&"function"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName}function Tt(e,t,n){e&&setTimeout((function(){e(t,n)}),0)}function At(e){return!(!e||e.constructor!==Object)&&Ae(e)}function Ct(e,t,n){if(t>n){var i=t;t=n,n=i}return e<t?t:e<n?e:n}function wt(e){return e*ft.RAD}function bt(e){return e*ft.DEG}c.misc={BUILTIN_CLASSID_RE:dt,BASE64_VALUES:gt,propertyDefine:yt,pushToMap:xt,contains:St,isDomNode:Et,callInNextTick:Tt,isPlainEmptyObj_DEV:At,clampf:Ct,degreesToRadians:wt,radiansToDegrees:bt},e("eX",Object.freeze({__proto__:null,BUILTIN_CLASSID_RE:dt,BASE64_VALUES:gt,propertyDefine:yt,pushToMap:xt,contains:St,isDomNode:Et,callInNextTick:Tt,tryCatchFunctor_EDITOR:function(e){return Function("target","try {\n  target."+e+"();\n}\ncatch (e) {\n  cc._throw(e);\n}")},isPlainEmptyObj_DEV:At,clampf:Ct,degreesToRadians:wt,radiansToDegrees:bt}));var It="$_$";function Pt(e,t){var n=t?Object.create(t):{};return we(e,"__attrs__",n),n}function Rt(e){if("function"!=typeof e)return Pt(e,Ot(e.constructor));for(var t,n=c.Class.getInheritanceChain(e),i=n.length-1;i>=0;i--){var o=n[i];o.hasOwnProperty("__attrs__")&&o.__attrs__||Pt(o,(t=n[i+1])&&t.__attrs__)}return Pt(e,(t=n[0])&&t.__attrs__),e.__attrs__}function Nt(e,t){var n=Ot(e),i=t+It,o={};for(var r in n)r.startsWith(i)&&(o[r.slice(i.length)]=n[r]);return o}function Ot(e){return e.hasOwnProperty("__attrs__")&&e.__attrs__||Rt(e)}function Dt(e,t,n,i){Ot(e)[t+It+n]=i}var Mt=function(){function e(e,t){this.name=void 0,this.default=void 0,this.name=e,this.default=t}return e.prototype.toString=function(){return this.name},e}(),Lt=e("ev",new Mt("Integer",0));c.Integer=Lt,c.CCInteger=Lt;var Ft=e("f5",new Mt("Float",0));c.Float=Ft,c.CCFloat=Ft;var zt=e("es",new Mt("Boolean",!1));c.Boolean=zt,c.CCBoolean=zt;var Bt=e("cg",new Mt("String",""));function Ut(e,t){return function(n,i){var o='"'+Ne(n)+"."+i+'"',r=Nt(n,i),a=r.type;if(a===Lt||a===Ft?a="Number":a!==Bt&&a!==zt||(a=""+a),a===e){if(r.hasOwnProperty("default")){var s=r.default;if(void 0!==s&&!Array.isArray(s)&&!At(s)){var c=typeof s,l=e.toLowerCase();if(c===l)if("object"===l){if(!s||s instanceof r.ctor)return;P(3605,o,Ne(r.ctor))}else"Number"!==e&&P(3606,t,o,e);else{if("function"===c)return;e===Bt.default&&null==s?P(3607,o):P(3611,t,o,c)}delete r.type}}}else P(3604,o)}}c.String=Bt,c.CCString=Bt;var Ht=Object.freeze({__proto__:null,DELIMETER:It,createAttrsSingle:Pt,createAttrs:Rt,attr:Nt,getClassAttrs:Ot,setClassAttr:Dt,PrimitiveType:Mt,CCInteger:Lt,CCFloat:Ft,CCBoolean:zt,CCString:Bt,getTypeChecker_ET:Ut,getObjTypeChecker_ET:function(e){return function(t,n){Ut("Object","type")(t,n);var i=Ot(t)[n+It+"default"],o=c.Class.getDefault(i);if(!Array.isArray(o)&&We(e,c.ValueType)){var r=Ne(e),a=Fe('No need to specify the "type" of "%s.%s" because %s is a child class of ValueType.',Ne(t),n,r);i?g(a):P(3612,a,r,Ne(t),n,r)}}}}),Gt={default:{},serializable:{},editorOnly:{},formerlySerializedAs:{}};function kt(e,t,n,i){if(!e.get&&!e.set&&e.hasOwnProperty("default")){var o="_N$"+t;e.get=function(){return this[o]},e.set=function(e){var t=this[o];this[o]=e,n.call(this,t)};var r={};for(var a in i[o]=r,Gt){var s=Gt[a];e.hasOwnProperty(a)&&(r[a]=e[a],s.canUsedInGet||delete e[a])}}}function Vt(e,t,n,i){if(Array.isArray(t)){if(!(t.length>0))return N(5508,n,i);e.type=t=t[0]}"function"==typeof t&&(t===String?e.type=c.String:t===Boolean?e.type=c.Boolean:t===Number&&(e.type=c.Float))}function Wt(e,t,n){var i=e?{_short:!0}:{_short:!0,default:t};return n&&(i.type=n),i}function jt(e,t){if(!e||e.constructor!==Object){if(Array.isArray(e)&&e.length>0)return Wt(t,[],e);if("function"==typeof e){var n=e;return Wt(t,We(n,c.ValueType)?new n:null,n)}return Wt(t,e instanceof Mt?e.default:e)}return null}var qt=[];function Yt(){return qt[qt.length-1]}c._RF={push:function(e,t,n,i){void 0===n&&(n=t,t=""),qt.push({uuid:t,script:n,module:e,exports:e.exports,beh:null,importMeta:i})},pop:function(){var e=qt.pop(),t=e.module,n=t.exports;if(n===e.exports){for(var i in n)return;t.exports=n=e.cls}},peek:Yt};var Xt=It,Kt={datas:null,push:function(e){if(this.datas)this.datas.push(e);else{this.datas=[e];var t=this;setTimeout((function(){t.init()}),0)}},init:function(){var e=this.datas;if(e){for(var t=0;t<e.length;++t){var n=e[t],i=n.cls,o=n.props;"function"==typeof o&&(o=o());var r=Ne(i);o?en(i,r,o,i.$super,n.mixins):N(3633,r)}this.datas=null}}};function Qt(e,t,n,i){!function(e,t){!function(e,t){e.indexOf(t)<0&&e.push(t)}(e.__props__,t)}(e,n),on(e,i,t,n)}function Zt(e,t,n,i){var o=i.get;i.set,o&&(on(e,i,t,n),Dt(e,n,"serializable",!1))}function Jt(e){return"function"==typeof e?e():e}function $t(e,t,n){for(var i in t)e.hasOwnProperty(i)||n&&!n(i)||Object.defineProperty(e,i,Be(t,i))}function en(e,t,n,i,o){if(e.__props__=[],i&&i.__props__&&(e.__props__=i.__props__.slice()),o)for(var r=0;r<o.length;++r){var a=o[r];a.__props__&&(e.__props__=e.__props__.concat(a.__props__.filter((function(t){return e.__props__.indexOf(t)<0}))))}if(n)for(var s in function(e,t){for(var n in e){var i=e[n],o=jt(i,!1);if(o&&(i=e[n]=o),i){var r=i.notify;r&&kt(i,n,r,e),"type"in i&&Vt(i,i.type,t,n)}}}(n,t),n){var c=n[s];c.get||c.set?Zt(e,t,s,c):Qt(e,t,s,c)}var l=Ot(e);e.__values__=e.__props__.filter((function(e){return!1!==l[e+Xt+"serializable"]}))}function tn(e){var t=e.name,n=e.extends,i=e.mixins,o=function(e,t,n,i){var o=c.Component,r=Yt();if(r&&We(t,o)){if(We(r.cls,o))return N(3615),null;e=e||r.script}var a=function(e,t,n,i){var o=i.ctor,r=[o],a=o;we(a,"__ctors__",r.length>0?r:null,!0);var s=a.prototype;if(t&&(a.$super=t),n){for(var c=n.length-1;c>=0;c--){var l=n[c];$t(s,l.prototype),tn._isCCClass(l)&&$t(Ot(a),Ot(l))}s.constructor=a}return Je(e,a),a}(e,t,n,i);if(r)if(We(t,o)){var s=r.uuid;s&&Qe(s,a),r.cls=a}else We(r.cls,o)||(r.cls=a);return a}(t,n,i,e);t||(t=c.js.getClassName(o)),o._sealed=!0,n&&(n._sealed=!1);var r=e.properties;"function"==typeof r||n&&null===n.__props__||i&&i.some((function(e){return null===e.__props__}))?(Kt.push({cls:o,props:r,mixins:i}),o.__props__=o.__values__=null):en(o,t,r,n,e.mixins);var a=e.editor;return a&&We(n,c.Component)&&c.Component._registerEditorProps(o,a),o}tn._isCCClass=function(e){var t;return null==e||null===(t=e.hasOwnProperty)||void 0===t?void 0:t.call(e,"__ctors__")},tn.fastDefine=function(e,t,n){Je(e,t);for(var i=t.__props__=t.__values__=Object.keys(n),o=Ot(t),r=0;r<i.length;r++){var a=i[r];o[a+Xt+"visible"]=!1,o[a+Xt+"default"]=n[a]}},tn.Attr=Ht,tn.attr=Nt,tn.getInheritanceChain=function(e){for(var t=[];e=Ve(e);)e!==Object&&t.push(e);return t};var nn={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"};function on(e,t,n,i){var o=null,r="";function a(){return r=i+Xt,o=Ot(e)}"type"in t&&void 0===t.type&&P(3660,i,n);var s=t.type;s&&(nn[s]?(o||a())[r+"type"]=s:"Object"===s||("object"==typeof s?ct.isEnum(s)?((o||a())[r+"type"]="Enum",o[r+"enumList"]=ct.getList(s)):st.isBitMask(s)&&((o||a())[r+"type"]="BitMask",o[r+"bitmaskList"]=st.getList(s)):"function"==typeof s&&((o||a())[r+"type"]="Object",o[r+"ctor"]=s))),"default"in t&&((o||a())[r+"default"]=t.default);var c,l=function(e,n){if(e in t){var i=t[e];typeof i===n&&((o||a())[r+e]=i)}};t.editorOnly&&((o||a())[r+"editorOnly"]=!0),t.__noImplicit?(o||a())[r+"serializable"]=null!==(c=t.serializable)&&void 0!==c&&c:!1===t.serializable&&((o||a())[r+"serializable"]=!1),l("formerlySerializedAs","string");var u=t.range;u&&Array.isArray(u)&&u.length>=2&&((o||a())[r+"min"]=u[0],o[r+"max"]=u[1],u.length>2&&(o[r+"step"]=u[2])),l("min","number"),l("max","number"),l("step","number")}tn.isArray=function(e){return e=Jt(e),Array.isArray(e)},tn.getDefault=Jt,tn.escapeForJS=function(e){return JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},tn.IDENTIFIER_RE=/^[A-Za-z_$][0-9A-Za-z_$]*$/,tn.getNewValueTypeCode=function(e){for(var t=Ne(e),n=e.constructor,i="new "+t+"(",o=0;o<n.__props__.length;o++)i+=e[n.__props__[o]],o<n.__props__.length-1&&(i+=",");return i+")"},c.Class=tn;var rn=Math.PI/180,an=180/Math.PI,sn=e("eN",1e-6);function cn(e,t){return Math.abs(e-t)<=sn*Math.max(1,Math.abs(e),Math.abs(t))}function ln(e,t,n){return n=n||sn,Math.abs(e-t)<=n}function un(e,t,n){if(t>n){var i=t;t=n,n=i}return e<t?t:e>n?n:e}function hn(e){return e<0?0:e>1?1:e}function _n(e,t,n){return e+(t-e)*n}function fn(e){return e*rn}function dn(e){return e*an}var pn=e("dZ",Math.random);function mn(e,t){return Math.random()*(t-e)+e}function vn(e,t){return Math.floor(mn(e,t))}function gn(e){return(e=(9301*e+49297)%233280)/233280}function yn(e,t,n){return gn(e)*(n-t)+t}function xn(e,t,n){return Math.floor(yn(e,t,n))}function Sn(e){return--e,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function En(e,t){return e-Math.floor(e/t)*t}function Tn(e,t){return e=En(e,2*t),t-Math.abs(e-t)}function An(e,t,n){return(n-e)/(t-e)}function Cn(e){return Math.abs(e.x)>Math.abs(e.y)?Math.abs(e.x)>Math.abs(e.z)?e.x:e.z:Math.abs(e.y)>Math.abs(e.z)?e.y:e.z}function wn(e,t){return Math.abs(e)>Math.abs(t)?e:t}var bn=1/255,In=e("cn",function(e){function t(t,n,i,o){var r;return(r=e.call(this)||this)._val=0,"string"==typeof t?r.fromHEX(t):void 0!==n?r.set(t,n,i,o):r.set(t),r}ie(t,e),t.clone=function(e){var n=new t;return e._val?n._val=e._val:n._val=(e.a<<24>>>0)+(e.b<<16)+(e.g<<8)+e.r,n},t.copy=function(e,t){return e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a,e},t.set=function(e,t,n,i,o){return e.r=t,e.g=n,e.b=i,e.a=o,e},t.fromHEX=function(e,t){return t=0===t.indexOf("#")?t.substring(1):t,e.r=parseInt(t.substr(0,2),16)||0,e.g=parseInt(t.substr(2,2),16)||0,e.b=parseInt(t.substr(4,2),16)||0,e.a=parseInt(t.substr(6,2),16)||255,e._val=(e.a<<24>>>0)+(e.b<<16)+(e.g<<8)+e.r,e},t.add=function(e,t,n){return e.r=t.r+n.r,e.g=t.g+n.g,e.b=t.b+n.b,e.a=t.a+n.a,e},t.subtract=function(e,t,n){return e.r=t.r-n.r,e.g=t.g-n.g,e.b=t.b-n.b,e.a=t.a-n.a,e},t.multiply=function(e,t,n){return e.r=t.r*n.r,e.g=t.g*n.g,e.b=t.b*n.b,e.a=t.a*n.a,e},t.divide=function(e,t,n){return e.r=t.r/n.r,e.g=t.g/n.g,e.b=t.b/n.b,e.a=t.a/n.a,e},t.scale=function(e,t,n){return e.r=t.r*n,e.g=t.g*n,e.b=t.b*n,e.a=t.a*n,e},t.lerp=function(e,t,n,i){var o=t.r,r=t.g,a=t.b,s=t.a;return o+=(n.r-o)*i,r+=(n.g-r)*i,a+=(n.b-a)*i,s+=(n.a-s)*i,e._val=Math.floor((s<<24>>>0)+(a<<16)+(r<<8)+o),e},t.toArray=function(e,n,i){void 0===i&&(i=0);var o=n instanceof t||n.a>1?1/255:1;return e[i+0]=n.r*o,e[i+1]=n.g*o,e[i+2]=n.b*o,e[i+3]=n.a*o,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),t.r=255*e[n+0],t.g=255*e[n+1],t.b=255*e[n+2],t.a=255*e[n+3],t},t.strictEquals=function(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a},t.equals=function(e,t,n){return void 0===n&&(n=sn),Math.abs(e.r-t.r)<=n*Math.max(1,Math.abs(e.r),Math.abs(t.r))&&Math.abs(e.g-t.g)<=n*Math.max(1,Math.abs(e.g),Math.abs(t.g))&&Math.abs(e.b-t.b)<=n*Math.max(1,Math.abs(e.b),Math.abs(t.b))&&Math.abs(e.a-t.a)<=n*Math.max(1,Math.abs(e.a),Math.abs(t.a))},t.hex=function(e){return(255*e.r<<24|255*e.g<<16|255*e.b<<8|255*e.a)>>>0};var n=t.prototype;return n.clone=function(){var e=new t;return e._val=this._val,e},n.equals=function(e){return e&&this._val===e._val},n.lerp=function(e,t){var n=this.r,i=this.g,o=this.b,r=this.a;return n+=(e.r-n)*t,i+=(e.g-i)*t,o+=(e.b-o)*t,r+=(e.a-r)*t,this._val=Math.floor((r<<24>>>0)+(o<<16)+(i<<8)+n),this},n.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},n.toCSS=function(e){return void 0===e&&(e="rgba"),"rgba"===e?"rgba("+this.r+","+this.g+","+this.b+","+(this.a*bn).toFixed(2)+")":"rgb"===e?"rgb("+this.r+","+this.g+","+this.b+")":"#"+this.toHEX(e)},n.fromHEX=function(e){e=0===e.indexOf("#")?e.substring(1):e;var t=parseInt(e.substr(0,2),16)||0,n=parseInt(e.substr(2,2),16)||0,i=parseInt(e.substr(4,2),16)||0,o=parseInt(e.substr(6,2),16)||255;return this._val=(o<<24>>>0)+(i<<16)+(n<<8)+(0|t),this},n.toHEX=function(e){void 0===e&&(e="#rrggbb");var t="0",n=[(this.r<16?t:"")+this.r.toString(16),(this.g<16?t:"")+this.g.toString(16),(this.b<16?t:"")+this.b.toString(16)];return"#rgb"===e?(n[0]=n[0][0],n[1]=n[1][0],n[2]=n[2][0]):"#rrggbbaa"===e&&n.push((this.a<16?t:"")+this.a.toString(16)),n.join("")},n.toRGBValue=function(){return 16777215&this._val},n.fromHSV=function(e,t,n){var i=0,o=0,r=0;if(0===t)i=o=r=n;else if(0===n)i=o=r=0;else{1===e&&(e=0),e*=6;var a=Math.floor(e),s=e-a,c=n*(1-t),l=n*(1-t*s),u=n*(1-t*(1-s));switch(a){case 0:i=n,o=u,r=c;break;case 1:i=l,o=n,r=c;break;case 2:i=c,o=n,r=u;break;case 3:i=c,o=l,r=n;break;case 4:i=u,o=c,r=n;break;case 5:i=n,o=c,r=l}}return i*=255,o*=255,r*=255,this._val=(this.a<<24>>>0)+(r<<16)+(o<<8)+(0|i),this},n.toHSV=function(){var e=this.r*bn,t=this.g*bn,n=this.b*bn,i={h:0,s:0,v:0},o=Math.max(e,t,n),r=Math.min(e,t,n),a=0;return i.v=o,i.s=o?(o-r)/o:0,i.s?(a=o-r,i.h=e===o?(t-n)/a:t===o?2+(n-e)/a:4+(e-t)/a,i.h/=6,i.h<0&&(i.h+=1)):i.h=0,i},n.set=function(e,t,n,i){return"object"==typeof e?null!=e._val?this._val=e._val:(t=e.g||0,n=e.b||0,i="number"==typeof e.a?e.a:255,e=e.r||0,this._val=(i<<24>>>0)+(n<<16)+(t<<8)+(0|e)):(e=e||0,t=t||0,n=n||0,i="number"==typeof i?i:255,this._val=(i<<24>>>0)+(n<<16)+(t<<8)+(0|e)),this},n.multiply=function(e){var t=(255&this._val)*e.r>>8,n=(65280&this._val)*e.g>>8,i=(16711680&this._val)*e.b>>8,o=((4278190080&this._val)>>>8)*e.a;return this._val=4278190080&o|16711680&i|65280&n|255&t,this},n._set_r_unsafe=function(e){return this._val=(4294967040&this._val|e)>>>0,this},n._set_g_unsafe=function(e){return this._val=(4294902015&this._val|e<<8)>>>0,this},n._set_b_unsafe=function(e){return this._val=(4278255615&this._val|e<<16)>>>0,this},n._set_a_unsafe=function(e){return this._val=(16777215&this._val|e<<24)>>>0,this},te(t,[{key:"r",get:function(){return 255&this._val},set:function(e){e=~~un(e,0,255),this._val=(4294967040&this._val|e)>>>0}},{key:"g",get:function(){return(65280&this._val)>>8},set:function(e){e=~~un(e,0,255),this._val=(4294902015&this._val|e<<8)>>>0}},{key:"b",get:function(){return(16711680&this._val)>>16},set:function(e){e=~~un(e,0,255),this._val=(4278255615&this._val|e<<16)>>>0}},{key:"a",get:function(){return(4278190080&this._val)>>>24},set:function(e){e=~~un(e,0,255),this._val=(16777215&this._val|e<<24)>>>0}},{key:"x",get:function(){return this.r*bn},set:function(e){this.r=255*e}},{key:"y",get:function(){return this.g*bn},set:function(e){this.g=255*e}},{key:"z",get:function(){return this.b*bn},set:function(e){this.b=255*e}},{key:"w",get:function(){return this.a*bn},set:function(e){this.a=255*e}}]),t}(_t));function Pn(e,t,n,i){return new In(e,t,n,i)}In.WHITE=Object.freeze(new In(255,255,255,255)),In.GRAY=Object.freeze(new In(127,127,127,255)),In.BLACK=Object.freeze(new In(0,0,0,255)),In.TRANSPARENT=Object.freeze(new In(0,0,0,0)),In.RED=Object.freeze(new In(255,0,0,255)),In.GREEN=Object.freeze(new In(0,255,0,255)),In.BLUE=Object.freeze(new In(0,0,255,255)),In.CYAN=Object.freeze(new In(0,255,255,255)),In.MAGENTA=Object.freeze(new In(255,0,255,255)),In.YELLOW=Object.freeze(new In(255,255,0,255)),tn.fastDefine("cc.Color",In,{r:0,g:0,b:0,a:255}),c.Color=In,c.color=Pn;var Rn=e("bL",function(e){function t(t,n,i){var o;return o=e.call(this)||this,t&&"object"==typeof t?(o.x=t.x,o.y=t.y,o.z=t.z):(o.x=t||0,o.y=n||0,o.z=i||0),o}ie(t,e),t.zero=function(e){return e.x=0,e.y=0,e.z=0,e},t.clone=function(e){return new t(e.x,e.y,e.z)},t.copy=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e},t.set=function(e,t,n,i){return e.x=t,e.y=n,e.z=i,e},t.add=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e.z=t.z+n.z,e},t.subtract=function(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e.z=t.z-n.z,e},t.multiply=function(e,t,n){return e.x=t.x*n.x,e.y=t.y*n.y,e.z=t.z*n.z,e},t.divide=function(e,t,n){return e.x=t.x/n.x,e.y=t.y/n.y,e.z=t.z/n.z,e},t.ceil=function(e,t){return e.x=Math.ceil(t.x),e.y=Math.ceil(t.y),e.z=Math.ceil(t.z),e},t.floor=function(e,t){return e.x=Math.floor(t.x),e.y=Math.floor(t.y),e.z=Math.floor(t.z),e},t.min=function(e,t,n){return e.x=Math.min(t.x,n.x),e.y=Math.min(t.y,n.y),e.z=Math.min(t.z,n.z),e},t.max=function(e,t,n){return e.x=Math.max(t.x,n.x),e.y=Math.max(t.y,n.y),e.z=Math.max(t.z,n.z),e},t.round=function(e,t){return e.x=Math.round(t.x),e.y=Math.round(t.y),e.z=Math.round(t.z),e},t.multiplyScalar=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e},t.scaleAndAdd=function(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e.z=t.z+n.z*i,e},t.distance=function(e,t){var n=t.x-e.x,i=t.y-e.y,o=t.z-e.z;return Math.sqrt(n*n+i*i+o*o)},t.squaredDistance=function(e,t){var n=t.x-e.x,i=t.y-e.y,o=t.z-e.z;return n*n+i*i+o*o},t.len=function(e){var t=e.x,n=e.y,i=e.z;return Math.sqrt(t*t+n*n+i*i)},t.lengthSqr=function(e){var t=e.x,n=e.y,i=e.z;return t*t+n*n+i*i},t.negate=function(e,t){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e},t.invert=function(e,t){return e.x=1/t.x,e.y=1/t.y,e.z=1/t.z,e},t.invertSafe=function(e,t){var n=t.x,i=t.y,o=t.z;return Math.abs(n)<sn?e.x=0:e.x=1/n,Math.abs(i)<sn?e.y=0:e.y=1/i,Math.abs(o)<sn?e.z=0:e.z=1/o,e},t.normalize=function(e,t){var n=t.x,i=t.y,o=t.z,r=n*n+i*i+o*o;return r>0&&(r=1/Math.sqrt(r),e.x=n*r,e.y=i*r,e.z=o*r),e},t.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},t.cross=function(e,t,n){var i=t.x,o=t.y,r=t.z,a=n.x,s=n.y,c=n.z;return e.x=o*c-r*s,e.y=r*a-i*c,e.z=i*s-o*a,e},t.lerp=function(e,t,n,i){return e.x=t.x+i*(n.x-t.x),e.y=t.y+i*(n.y-t.y),e.z=t.z+i*(n.z-t.z),e},t.random=function(e,t){t=t||1;var n=2*pn()*Math.PI,i=2*pn()-1,o=Math.sqrt(1-i*i);return e.x=o*Math.cos(n)*t,e.y=o*Math.sin(n)*t,e.z=i*t,e},t.transformMat4=function(e,t,n){var i=t.x,o=t.y,r=t.z,a=n.m03*i+n.m07*o+n.m11*r+n.m15;return a=a?Math.abs(1/a):1,e.x=(n.m00*i+n.m04*o+n.m08*r+n.m12)*a,e.y=(n.m01*i+n.m05*o+n.m09*r+n.m13)*a,e.z=(n.m02*i+n.m06*o+n.m10*r+n.m14)*a,e},t.transformMat4Normal=function(e,t,n){var i=t.x,o=t.y,r=t.z,a=n.m03*i+n.m07*o+n.m11*r;return a=a?Math.abs(1/a):1,e.x=(n.m00*i+n.m04*o+n.m08*r)*a,e.y=(n.m01*i+n.m05*o+n.m09*r)*a,e.z=(n.m02*i+n.m06*o+n.m10*r)*a,e},t.transformMat3=function(e,t,n){var i=t.x,o=t.y,r=t.z;return e.x=i*n.m00+o*n.m03+r*n.m06,e.y=i*n.m01+o*n.m04+r*n.m07,e.z=i*n.m02+o*n.m05+r*n.m08,e},t.transformAffine=function(e,t,n){var i=t.x,o=t.y,r=t.z;return e.x=n.m00*i+n.m04*o+n.m08*r+n.m12,e.y=n.m01*i+n.m05*o+n.m09*r+n.m13,e.x=n.m02*i+n.m06*o+n.m10*r+n.m14,e},t.transformQuat=function(e,t,n){var i=n.w*t.x+n.y*t.z-n.z*t.y,o=n.w*t.y+n.z*t.x-n.x*t.z,r=n.w*t.z+n.x*t.y-n.y*t.x,a=-n.x*t.x-n.y*t.y-n.z*t.z;return e.x=i*n.w+a*-n.x+o*-n.z-r*-n.y,e.y=o*n.w+a*-n.y+r*-n.x-i*-n.z,e.z=r*n.w+a*-n.z+i*-n.y-o*-n.x,e},t.transformRTS=function(e,t,n,i,o){var r=t.x*o.x,a=t.y*o.y,s=t.z*o.z,c=n.w*r+n.y*s-n.z*a,l=n.w*a+n.z*r-n.x*s,u=n.w*s+n.x*a-n.y*r,h=-n.x*r-n.y*a-n.z*s;return e.x=c*n.w+h*-n.x+l*-n.z-u*-n.y+i.x,e.y=l*n.w+h*-n.y+u*-n.x-c*-n.z+i.y,e.z=u*n.w+h*-n.z+c*-n.y-l*-n.x+i.z,e},t.transformInverseRTS=function(e,t,n,i,o){var r=t.x-i.x,a=t.y-i.y,s=t.z-i.z,c=n.w*r-n.y*s+n.z*a,l=n.w*a-n.z*r+n.x*s,u=n.w*s-n.x*a+n.y*r,h=n.x*r+n.y*a+n.z*s;return e.x=(c*n.w+h*n.x+l*n.z-u*n.y)/o.x,e.y=(l*n.w+h*n.y+u*n.x-c*n.z)/o.y,e.z=(u*n.w+h*n.z+c*n.y-l*n.x)/o.z,e},t.rotateX=function(e,t,n,i){var o=t.x-n.x,r=t.y-n.y,a=t.z-n.z,s=Math.cos(i),c=Math.sin(i),l=o,u=r*s-a*c,h=r*c+a*s;return e.x=l+n.x,e.y=u+n.y,e.z=h+n.z,e},t.rotateY=function(e,t,n,i){var o=t.x-n.x,r=t.y-n.y,a=t.z-n.z,s=Math.cos(i),c=Math.sin(i),l=a*c+o*s,u=r,h=a*s-o*c;return e.x=l+n.x,e.y=u+n.y,e.z=h+n.z,e},t.rotateZ=function(e,t,n,i){var o=t.x-n.x,r=t.y-n.y,a=t.z-n.z,s=Math.cos(i),c=Math.sin(i),l=o*s-r*c,u=o*c+r*s,h=a;return e.x=l+n.x,e.y=u+n.y,e.z=h+n.z,e},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.x,e[n+1]=t.y,e[n+2]=t.z,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.x=t[n+0],e.y=t[n+1],e.z=t[n+2],e},t.strictEquals=function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z},t.equals=function(e,t,n){void 0===n&&(n=sn);var i=e.x,o=e.y,r=e.z,a=t.x,s=t.y,c=t.z;return Math.abs(i-a)<=n*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(o-s)<=n*Math.max(1,Math.abs(o),Math.abs(s))&&Math.abs(r-c)<=n*Math.max(1,Math.abs(r),Math.abs(c))},t.angle=function(e,n){t.normalize(Nn,e),t.normalize(On,n);var i=t.dot(Nn,On);return i>1?0:i<-1?Math.PI:Math.acos(i)},t.projectOnPlane=function(e,n,i){return t.subtract(e,n,t.project(e,n,i))},t.project=function(e,n,i){var o=t.lengthSqr(i);return o<1e-6?t.set(e,0,0,0):t.multiplyScalar(e,i,t.dot(n,i)/o)};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y,this.z)},n.set=function(e,t,n){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z):(this.x=e||0,this.y=t||0,this.z=n||0),this},n.equals=function(e,t){return void 0===t&&(t=sn),Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))&&Math.abs(this.z-e.z)<=t*Math.max(1,Math.abs(this.z),Math.abs(e.z))},n.equals3f=function(e,t,n,i){return void 0===i&&(i=sn),Math.abs(this.x-e)<=i*Math.max(1,Math.abs(this.x),Math.abs(e))&&Math.abs(this.y-t)<=i*Math.max(1,Math.abs(this.y),Math.abs(t))&&Math.abs(this.z-n)<=i*Math.max(1,Math.abs(this.z),Math.abs(n))},n.strictEquals=function(e){return this.x===e.x&&this.y===e.y&&this.z===e.z},n.strictEquals3f=function(e,t,n){return this.x===e&&this.y===t&&this.z===n},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+")"},n.lerp=function(e,t){return this.x+=t*(e.x-this.x),this.y+=t*(e.y-this.y),this.z+=t*(e.z-this.z),this},n.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},n.add3f=function(e,t,n){return this.x+=e,this.y+=t,this.z+=n,this},n.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},n.subtract3f=function(e,t,n){return this.x-=e,this.y-=t,this.z-=n,this},n.multiplyScalar=function(e){return"object"==typeof e&&console.warn("should use Vec3.multiply for vector * vector operation"),this.x*=e,this.y*=e,this.z*=e,this},n.multiply=function(e){return"object"!=typeof e&&console.warn("should use Vec3.scale for vector * scalar operation"),this.x*=e.x,this.y*=e.y,this.z*=e.z,this},n.multiply3f=function(e,t,n){return this.x*=e,this.y*=t,this.z*=n,this},n.divide=function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},n.divide3f=function(e,t,n){return this.x/=e,this.y/=t,this.z/=n,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},n.clampf=function(e,t){return this.x=un(this.x,e.x,t.x),this.y=un(this.y,e.y,t.y),this.z=un(this.z,e.z,t.z),this},n.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},n.cross=function(e){var t=this.x,n=this.y,i=this.z,o=e.x,r=e.y,a=e.z;return this.x=n*a-i*r,this.y=i*o-t*a,this.z=t*r-n*o,this},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z},n.normalize=function(){var e=this.x,t=this.y,n=this.z,i=e*e+t*t+n*n;return i>0&&(i=1/Math.sqrt(i),this.x=e*i,this.y=t*i,this.z=n*i),this},n.transformMat4=function(e){var t=this.x,n=this.y,i=this.z,o=e.m03*t+e.m07*n+e.m11*i+e.m15;return o=o?1/o:1,this.x=(e.m00*t+e.m04*n+e.m08*i+e.m12)*o,this.y=(e.m01*t+e.m05*n+e.m09*i+e.m13)*o,this.z=(e.m02*t+e.m06*n+e.m10*i+e.m14)*o,this},t}(_t));Rn.UNIT_X=Object.freeze(new Rn(1,0,0)),Rn.UNIT_Y=Object.freeze(new Rn(0,1,0)),Rn.UNIT_Z=Object.freeze(new Rn(0,0,1)),Rn.RIGHT=Object.freeze(new Rn(1,0,0)),Rn.UP=Object.freeze(new Rn(0,1,0)),Rn.FORWARD=Object.freeze(new Rn(0,0,-1)),Rn.ZERO=Object.freeze(new Rn(0,0,0)),Rn.ONE=Object.freeze(new Rn(1,1,1)),Rn.NEG_ONE=Object.freeze(new Rn(-1,-1,-1));var Nn=new Rn,On=new Rn;function Dn(e,t,n){return new Rn(e,t,n)}tn.fastDefine("cc.Vec3",Rn,{x:0,y:0,z:0}),c.Vec3=Rn,c.v3=Dn;var Mn=e("eI",function(e){function t(t,n,i,o,r,a,s,c,l){var u;return void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===r&&(r=1),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=1),u=e.call(this)||this,"object"==typeof t?(u.m00=t.m00,u.m01=t.m01,u.m02=t.m02,u.m03=t.m03,u.m04=t.m04,u.m05=t.m05,u.m06=t.m06,u.m07=t.m07,u.m08=t.m08):(u.m00=t,u.m01=n,u.m02=i,u.m03=o,u.m04=r,u.m05=a,u.m06=s,u.m07=c,u.m08=l),u}ie(t,e),t.clone=function(e){return new t(e.m00,e.m01,e.m02,e.m03,e.m04,e.m05,e.m06,e.m07,e.m08)},t.copy=function(e,t){return e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e},t.set=function(e,t,n,i,o,r,a,s,c,l){return e.m00=t,e.m01=n,e.m02=i,e.m03=o,e.m04=r,e.m05=a,e.m06=s,e.m07=c,e.m08=l,e},t.identity=function(e){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=1,e.m05=0,e.m06=0,e.m07=0,e.m08=1,e},t.transpose=function(e,t){if(e===t){var n=t.m01,i=t.m02,o=t.m05;e.m01=t.m03,e.m02=t.m06,e.m03=n,e.m05=t.m07,e.m06=i,e.m07=o}else e.m00=t.m00,e.m01=t.m03,e.m02=t.m06,e.m03=t.m01,e.m04=t.m04,e.m05=t.m07,e.m06=t.m02,e.m07=t.m05,e.m08=t.m08;return e},t.invert=function(e,t){var n=t.m00,i=t.m01,o=t.m02,r=t.m03,a=t.m04,s=t.m05,c=t.m06,l=t.m07,u=t.m08,h=u*a-s*l,_=-u*r+s*c,f=l*r-a*c,d=n*h+i*_+o*f;return 0===d?(e.m00=0,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=0,e.m06=0,e.m07=0,e.m08=0,e):(d=1/d,e.m00=h*d,e.m01=(-u*i+o*l)*d,e.m02=(s*i-o*a)*d,e.m03=_*d,e.m04=(u*n-o*c)*d,e.m05=(-s*n+o*r)*d,e.m06=f*d,e.m07=(-l*n+i*c)*d,e.m08=(a*n-i*r)*d,e)},t.determinant=function(e){var t=e.m00,n=e.m01,i=e.m02,o=e.m03,r=e.m04,a=e.m05,s=e.m06,c=e.m07,l=e.m08;return t*(l*r-a*c)+n*(-l*o+a*s)+i*(c*o-r*s)},t.multiply=function(e,t,n){var i=t.m00,o=t.m01,r=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=n.m00,f=n.m01,d=n.m02,p=n.m03,m=n.m04,v=n.m05,g=n.m06,y=n.m07,x=n.m08;return e.m00=_*i+f*a+d*l,e.m01=_*o+f*s+d*u,e.m02=_*r+f*c+d*h,e.m03=p*i+m*a+v*l,e.m04=p*o+m*s+v*u,e.m05=p*r+m*c+v*h,e.m06=g*i+y*a+x*l,e.m07=g*o+y*s+x*u,e.m08=g*r+y*c+x*h,e},t.multiplyMat4=function(e,t,n){var i=t.m00,o=t.m01,r=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=n.m00,f=n.m01,d=n.m02,p=n.m04,m=n.m05,v=n.m06,g=n.m08,y=n.m09,x=n.m10;return e.m00=_*i+f*a+d*l,e.m01=_*o+f*s+d*u,e.m02=_*r+f*c+d*h,e.m03=p*i+m*a+v*l,e.m04=p*o+m*s+v*u,e.m05=p*r+m*c+v*h,e.m06=g*i+y*a+x*l,e.m07=g*o+y*s+x*u,e.m08=g*r+y*c+x*h,e},t.transform=function(e,t,n){var i=t.m00,o=t.m01,r=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=n.x,f=n.y;return e.m00=i,e.m01=o,e.m02=r,e.m03=a,e.m04=s,e.m05=c,e.m06=_*i+f*a+l,e.m07=_*o+f*s+u,e.m08=_*r+f*c+h,e},t.scale=function(e,t,n){var i=n.x,o=n.y;return e.m00=i*t.m00,e.m01=i*t.m01,e.m02=i*t.m02,e.m03=o*t.m03,e.m04=o*t.m04,e.m05=o*t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e},t.rotate=function(e,t,n){var i=t.m00,o=t.m01,r=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=Math.sin(n),f=Math.cos(n);return e.m00=f*i+_*a,e.m01=f*o+_*s,e.m02=f*r+_*c,e.m03=f*a-_*i,e.m04=f*s-_*o,e.m05=f*c-_*r,e.m06=l,e.m07=u,e.m08=h,e},t.fromMat4=function(e,t){return e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m04,e.m04=t.m05,e.m05=t.m06,e.m06=t.m08,e.m07=t.m09,e.m08=t.m10,e},t.fromViewUp=function(e,n,i){return Rn.lengthSqr(n)<sn*sn?(t.identity(e),e):(i=i||Rn.UNIT_Y,Rn.normalize(Ln,Rn.cross(Ln,i,n)),Rn.lengthSqr(Ln)<sn*sn?(t.identity(e),e):(Rn.cross(Fn,n,Ln),t.set(e,Ln.x,Ln.y,Ln.z,Fn.x,Fn.y,Fn.z,n.x,n.y,n.z),e))},t.fromTranslation=function(e,t){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=1,e.m05=0,e.m06=t.x,e.m07=t.y,e.m08=1,e},t.fromScaling=function(e,t){return e.m00=t.x,e.m01=0,e.m02=0,e.m03=0,e.m04=t.y,e.m05=0,e.m06=0,e.m07=0,e.m08=1,e},t.fromRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e.m00=i,e.m01=n,e.m02=0,e.m03=-n,e.m04=i,e.m05=0,e.m06=0,e.m07=0,e.m08=1,e},t.fromQuat=function(e,t){var n=t.x,i=t.y,o=t.z,r=t.w,a=n+n,s=i+i,c=o+o,l=n*a,u=i*a,h=i*s,_=o*a,f=o*s,d=o*c,p=r*a,m=r*s,v=r*c;return e.m00=1-h-d,e.m03=u-v,e.m06=_+m,e.m01=u+v,e.m04=1-l-d,e.m07=f-p,e.m02=_-m,e.m05=f+p,e.m08=1-l-h,e},t.inverseTransposeMat4=function(e,t){var n=t.m00,i=t.m01,o=t.m02,r=t.m03,a=t.m04,s=t.m05,c=t.m06,l=t.m07,u=t.m08,h=t.m09,_=t.m10,f=t.m11,d=t.m12,p=t.m13,m=t.m14,v=t.m15,g=n*s-i*a,y=n*c-o*a,x=n*l-r*a,S=i*c-o*s,E=i*l-r*s,T=o*l-r*c,A=u*p-h*d,C=u*m-_*d,w=u*v-f*d,b=h*m-_*p,I=h*v-f*p,P=_*v-f*m,R=g*P-y*I+x*b+S*w-E*C+T*A;return R?(R=1/R,e.m00=(s*P-c*I+l*b)*R,e.m01=(c*w-a*P-l*C)*R,e.m02=(a*I-s*w+l*A)*R,e.m03=(o*I-i*P-r*b)*R,e.m04=(n*P-o*w+r*C)*R,e.m05=(i*w-n*I-r*A)*R,e.m06=(p*T-m*E+v*S)*R,e.m07=(m*x-d*T-v*y)*R,e.m08=(d*E-p*x+v*g)*R,e):null},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.m00,e[n+1]=t.m01,e[n+2]=t.m02,e[n+3]=t.m03,e[n+4]=t.m04,e[n+5]=t.m05,e[n+6]=t.m06,e[n+7]=t.m07,e[n+8]=t.m08,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.m00=t[n+0],e.m01=t[n+1],e.m02=t[n+2],e.m03=t[n+3],e.m04=t[n+4],e.m05=t[n+5],e.m06=t[n+6],e.m07=t[n+7],e.m08=t[n+8],e},t.add=function(e,t,n){return e.m00=t.m00+n.m00,e.m01=t.m01+n.m01,e.m02=t.m02+n.m02,e.m03=t.m03+n.m03,e.m04=t.m04+n.m04,e.m05=t.m05+n.m05,e.m06=t.m06+n.m06,e.m07=t.m07+n.m07,e.m08=t.m08+n.m08,e},t.subtract=function(e,t,n){return e.m00=t.m00-n.m00,e.m01=t.m01-n.m01,e.m02=t.m02-n.m02,e.m03=t.m03-n.m03,e.m04=t.m04-n.m04,e.m05=t.m05-n.m05,e.m06=t.m06-n.m06,e.m07=t.m07-n.m07,e.m08=t.m08-n.m08,e},t.multiplyScalar=function(e,t,n){return e.m00=t.m00*n,e.m01=t.m01*n,e.m02=t.m02*n,e.m03=t.m03*n,e.m04=t.m04*n,e.m05=t.m05*n,e.m06=t.m06*n,e.m07=t.m07*n,e.m08=t.m08*n,e},t.multiplyScalarAndAdd=function(e,t,n,i){return e.m00=n.m00*i+t.m00,e.m01=n.m01*i+t.m01,e.m02=n.m02*i+t.m02,e.m03=n.m03*i+t.m03,e.m04=n.m04*i+t.m04,e.m05=n.m05*i+t.m05,e.m06=n.m06*i+t.m06,e.m07=n.m07*i+t.m07,e.m08=n.m08*i+t.m08,e},t.strictEquals=function(e,t){return e.m00===t.m00&&e.m01===t.m01&&e.m02===t.m02&&e.m03===t.m03&&e.m04===t.m04&&e.m05===t.m05&&e.m06===t.m06&&e.m07===t.m07&&e.m08===t.m08},t.equals=function(e,t,n){return void 0===n&&(n=sn),Math.abs(e.m00-t.m00)<=n*Math.max(1,Math.abs(e.m00),Math.abs(t.m00))&&Math.abs(e.m01-t.m01)<=n*Math.max(1,Math.abs(e.m01),Math.abs(t.m01))&&Math.abs(e.m02-t.m02)<=n*Math.max(1,Math.abs(e.m02),Math.abs(t.m02))&&Math.abs(e.m03-t.m03)<=n*Math.max(1,Math.abs(e.m03),Math.abs(t.m03))&&Math.abs(e.m04-t.m04)<=n*Math.max(1,Math.abs(e.m04),Math.abs(t.m04))&&Math.abs(e.m05-t.m05)<=n*Math.max(1,Math.abs(e.m05),Math.abs(t.m05))&&Math.abs(e.m06-t.m06)<=n*Math.max(1,Math.abs(e.m06),Math.abs(t.m06))&&Math.abs(e.m07-t.m07)<=n*Math.max(1,Math.abs(e.m07),Math.abs(t.m07))&&Math.abs(e.m08-t.m08)<=n*Math.max(1,Math.abs(e.m08),Math.abs(t.m08))};var n=t.prototype;return n.clone=function(){var e=this;return new t(e.m00,e.m01,e.m02,e.m03,e.m04,e.m05,e.m06,e.m07,e.m08)},n.set=function(e,t,n,i,o,r,a,s,c){return void 0===e&&(e=1),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=1),void 0===r&&(r=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=1),"object"==typeof e?(this.m00=e.m00,this.m01=e.m01,this.m02=e.m02,this.m03=e.m03,this.m04=e.m04,this.m05=e.m05,this.m06=e.m06,this.m07=e.m07,this.m08=e.m08):(this.m00=e,this.m01=t,this.m02=n,this.m03=i,this.m04=o,this.m05=r,this.m06=a,this.m07=s,this.m08=c),this},n.equals=function(e,t){return void 0===t&&(t=sn),Math.abs(this.m00-e.m00)<=t*Math.max(1,Math.abs(this.m00),Math.abs(e.m00))&&Math.abs(this.m01-e.m01)<=t*Math.max(1,Math.abs(this.m01),Math.abs(e.m01))&&Math.abs(this.m02-e.m02)<=t*Math.max(1,Math.abs(this.m02),Math.abs(e.m02))&&Math.abs(this.m03-e.m03)<=t*Math.max(1,Math.abs(this.m03),Math.abs(e.m03))&&Math.abs(this.m04-e.m04)<=t*Math.max(1,Math.abs(this.m04),Math.abs(e.m04))&&Math.abs(this.m05-e.m05)<=t*Math.max(1,Math.abs(this.m05),Math.abs(e.m05))&&Math.abs(this.m06-e.m06)<=t*Math.max(1,Math.abs(this.m06),Math.abs(e.m06))&&Math.abs(this.m07-e.m07)<=t*Math.max(1,Math.abs(this.m07),Math.abs(e.m07))&&Math.abs(this.m08-e.m08)<=t*Math.max(1,Math.abs(this.m08),Math.abs(e.m08))},n.strictEquals=function(e){return this.m00===e.m00&&this.m01===e.m01&&this.m02===e.m02&&this.m03===e.m03&&this.m04===e.m04&&this.m05===e.m05&&this.m06===e.m06&&this.m07===e.m07&&this.m08===e.m08},n.toString=function(){var e=this;return"[\n"+e.m00+", "+e.m01+", "+e.m02+",\n"+e.m03+",\n"+e.m04+", "+e.m05+",\n"+e.m06+", "+e.m07+",\n"+e.m08+"\n]"},n.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=1,this.m05=0,this.m06=0,this.m07=0,this.m08=1,this},n.transpose=function(){var e=this.m01,t=this.m02,n=this.m05;return this.m01=this.m03,this.m02=this.m06,this.m03=e,this.m05=this.m07,this.m06=t,this.m07=n,this},n.invert=function(){var e=this.m00,t=this.m01,n=this.m02,i=this.m03,o=this.m04,r=this.m05,a=this.m06,s=this.m07,c=this.m08,l=c*o-r*s,u=-c*i+r*a,h=s*i-o*a,_=e*l+t*u+n*h;return 0===_?(this.set(0,0,0,0,0,0,0,0,0),this):(_=1/_,this.m00=l*_,this.m01=(-c*t+n*s)*_,this.m02=(r*t-n*o)*_,this.m03=u*_,this.m04=(c*e-n*a)*_,this.m05=(-r*e+n*i)*_,this.m06=h*_,this.m07=(-s*e+t*a)*_,this.m08=(o*e-t*i)*_,this)},n.determinant=function(){var e=this.m00,t=this.m01,n=this.m02,i=this.m03,o=this.m04,r=this.m05,a=this.m06,s=this.m07,c=this.m08;return e*(c*o-r*s)+t*(-c*i+r*a)+n*(s*i-o*a)},n.add=function(e){return this.m00+=e.m00,this.m01+=e.m01,this.m02+=e.m02,this.m03+=e.m03,this.m04+=e.m04,this.m05+=e.m05,this.m06+=e.m06,this.m07+=e.m07,this.m08+=e.m08,this},n.subtract=function(e){return this.m00-=e.m00,this.m01-=e.m01,this.m02-=e.m02,this.m03-=e.m03,this.m04-=e.m04,this.m05-=e.m05,this.m06-=e.m06,this.m07-=e.m07,this.m08-=e.m08,this},n.multiply=function(e){var t=this.m00,n=this.m01,i=this.m02,o=this.m03,r=this.m04,a=this.m05,s=this.m06,c=this.m07,l=this.m08,u=e.m00,h=e.m01,_=e.m02,f=e.m03,d=e.m04,p=e.m05,m=e.m06,v=e.m07,g=e.m08;return this.m00=u*t+h*o+_*s,this.m01=u*n+h*r+_*c,this.m02=u*i+h*a+_*l,this.m03=f*t+d*o+p*s,this.m04=f*n+d*r+p*c,this.m05=f*i+d*a+p*l,this.m06=m*t+v*o+g*s,this.m07=m*n+v*r+g*c,this.m08=m*i+v*a+g*l,this},n.multiplyScalar=function(e){return this.m00*=e,this.m01*=e,this.m02*=e,this.m03*=e,this.m04*=e,this.m05*=e,this.m06*=e,this.m07*=e,this.m08*=e,this},n.scale=function(e){var t=e.x,n=e.y;return this.m00=t*this.m00,this.m01=t*this.m01,this.m02=t*this.m02,this.m03=n*this.m03,this.m04=n*this.m04,this.m05=n*this.m05,this.m06=this.m06,this.m07=this.m07,this.m08=this.m08,this},n.rotate=function(e){var t=this.m00,n=this.m01,i=this.m02,o=this.m03,r=this.m04,a=this.m05,s=this.m06,c=this.m07,l=this.m08,u=Math.sin(e),h=Math.cos(e);return this.m00=h*t+u*o,this.m01=h*n+u*r,this.m02=h*i+u*a,this.m03=h*o-u*t,this.m04=h*r-u*n,this.m05=h*a-u*i,this.m06=s,this.m07=c,this.m08=l,this},n.fromQuat=function(e){var t=e.x,n=e.y,i=e.z,o=e.w,r=t+t,a=n+n,s=i+i,c=t*r,l=n*r,u=n*a,h=i*r,_=i*a,f=i*s,d=o*r,p=o*a,m=o*s;return this.m00=1-u-f,this.m03=l-m,this.m06=h+p,this.m01=l+m,this.m04=1-c-f,this.m07=_-d,this.m02=h-p,this.m05=_+d,this.m08=1-c-u,this},t}(_t));Mn.IDENTITY=Object.freeze(new Mn);var Ln=new Rn,Fn=new Rn;tn.fastDefine("cc.Mat3",Mn,{m00:1,m01:0,m02:0,m03:0,m04:1,m05:0,m06:0,m07:0,m08:1}),c.Mat3=Mn;var zn=e("bO",function(e){function t(t,n,i,o){var r;return r=e.call(this)||this,t&&"object"==typeof t?(r.x=t.x,r.y=t.y,r.z=t.z,r.w=t.w):(r.x=t||0,r.y=n||0,r.z=i||0,r.w=null!=o?o:1),r}ie(t,e),t.clone=function(e){return new t(e.x,e.y,e.z,e.w)},t.copy=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e},t.set=function(e,t,n,i,o){return e.x=t,e.y=n,e.z=i,e.w=o,e},t.identity=function(e){return e.x=0,e.y=0,e.z=0,e.w=1,e},t.rotationTo=function(e,n,i){var o=Rn.dot(n,i);return o<-.999999?(Rn.cross(Hn,Rn.UNIT_X,n),Hn.length()<1e-6&&Rn.cross(Hn,Rn.UNIT_Y,n),Rn.normalize(Hn,Hn),t.fromAxisAngle(e,Hn,Math.PI),e):o>.999999?(e.x=0,e.y=0,e.z=0,e.w=1,e):(Rn.cross(Hn,n,i),e.x=Hn.x,e.y=Hn.y,e.z=Hn.z,e.w=1+o,t.normalize(e,e))},t.getAxisAngle=function(e,t){var n=2*Math.acos(t.w),i=Math.sin(n/2);return 0!==i?(e.x=t.x/i,e.y=t.y/i,e.z=t.z/i):(e.x=1,e.y=0,e.z=0),n},t.multiply=function(e,t,n){var i=t.x*n.w+t.w*n.x+t.y*n.z-t.z*n.y,o=t.y*n.w+t.w*n.y+t.z*n.x-t.x*n.z,r=t.z*n.w+t.w*n.z+t.x*n.y-t.y*n.x,a=t.w*n.w-t.x*n.x-t.y*n.y-t.z*n.z;return e.x=i,e.y=o,e.z=r,e.w=a,e},t.multiplyScalar=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e.w=t.w*n,e},t.scaleAndAdd=function(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e.z=t.z+n.z*i,e.w=t.w+n.w*i,e},t.rotateX=function(e,t,n){n*=.5;var i=Math.sin(n),o=Math.cos(n),r=t.x,a=t.y,s=t.z,c=t.w;return e.x=r*o+c*i,e.y=a*o+s*i,e.z=s*o-a*i,e.w=c*o-r*i,e},t.rotateY=function(e,t,n){n*=.5;var i=Math.sin(n),o=Math.cos(n),r=t.x,a=t.y,s=t.z,c=t.w;return e.x=r*o-s*i,e.y=a*o+c*i,e.z=s*o+r*i,e.w=c*o-a*i,e},t.rotateZ=function(e,t,n){n*=.5;var i=Math.sin(n),o=Math.cos(n),r=t.x,a=t.y,s=t.z,c=t.w;return e.x=r*o+a*i,e.y=a*o-r*i,e.z=s*o+c*i,e.w=c*o-s*i,e},t.rotateAround=function(e,n,i,o){return t.invert(Bn,n),Rn.transformQuat(Hn,i,Bn),t.fromAxisAngle(Bn,Hn,o),t.multiply(e,n,Bn),e},t.rotateAroundLocal=function(e,n,i,o){return t.fromAxisAngle(Bn,i,o),t.multiply(e,n,Bn),e},t.calculateW=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=Math.sqrt(Math.abs(1-t.x*t.x-t.y*t.y-t.z*t.z)),e},t.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},t.lerp=function(e,t,n,i){return e.x=t.x+i*(n.x-t.x),e.y=t.y+i*(n.y-t.y),e.z=t.z+i*(n.z-t.z),e.w=t.w+i*(n.w-t.w),e},t.slerp=function(e,t,n,i){var o=0,r=0,a=n.x,s=n.y,c=n.z,l=n.w,u=t.x*n.x+t.y*n.y+t.z*n.z+t.w*n.w;if(u<0&&(u=-u,a=-a,s=-s,c=-c,l=-l),1-u>1e-6){var h=Math.acos(u),_=Math.sin(h);o=Math.sin((1-i)*h)/_,r=Math.sin(i*h)/_}else o=1-i,r=i;return e.x=o*t.x+r*a,e.y=o*t.y+r*s,e.z=o*t.z+r*c,e.w=o*t.w+r*l,e},t.sqlerp=function(e,n,i,o,r,a){return t.slerp(Bn,n,r,a),t.slerp(Un,i,o,a),t.slerp(e,Bn,Un,2*a*(1-a)),e},t.invert=function(e,t){var n=t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w,i=n?1/n:0;return e.x=-t.x*i,e.y=-t.y*i,e.z=-t.z*i,e.w=t.w*i,e},t.conjugate=function(e,t){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e.w=t.w,e},t.len=function(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w)},t.lengthSqr=function(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},t.normalize=function(e,t){var n=t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w;return n>0&&(n=1/Math.sqrt(n),e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e.w=t.w*n),e},t.fromAxes=function(e,n,i,o){return Mn.set(Gn,n.x,n.y,n.z,i.x,i.y,i.z,o.x,o.y,o.z),t.normalize(e,t.fromMat3(e,Gn))},t.fromViewUp=function(e,n,i){return Mn.fromViewUp(Gn,n,i),t.normalize(e,t.fromMat3(e,Gn))},t.fromAxisAngle=function(e,t,n){n*=.5;var i=Math.sin(n);return e.x=i*t.x,e.y=i*t.y,e.z=i*t.z,e.w=Math.cos(n),e},t.fromMat3=function(e,t){var n=t.m00,i=t.m03,o=t.m06,r=t.m01,a=t.m04,s=t.m07,c=t.m02,l=t.m05,u=t.m08,h=n+a+u;if(h>0){var _=.5/Math.sqrt(h+1);e.w=.25/_,e.x=(l-s)*_,e.y=(o-c)*_,e.z=(r-i)*_}else if(n>a&&n>u){var f=2*Math.sqrt(1+n-a-u);e.w=(l-s)/f,e.x=.25*f,e.y=(i+r)/f,e.z=(o+c)/f}else if(a>u){var d=2*Math.sqrt(1+a-n-u);e.w=(o-c)/d,e.x=(i+r)/d,e.y=.25*d,e.z=(s+l)/d}else{var p=2*Math.sqrt(1+u-n-a);e.w=(r-i)/p,e.x=(o+c)/p,e.y=(s+l)/p,e.z=.25*p}return e},t.fromEuler=function(e,t,n,i){t*=kn,n*=kn,i*=kn;var o=Math.sin(t),r=Math.cos(t),a=Math.sin(n),s=Math.cos(n),c=Math.sin(i),l=Math.cos(i);return e.x=o*s*l+r*a*c,e.y=r*a*l+o*s*c,e.z=r*s*c-o*a*l,e.w=r*s*l-o*a*c,e},t.fromAngleZ=function(e,t){return t*=kn,e.x=e.y=0,e.z=Math.sin(t),e.w=Math.cos(t),e},t.toAxisX=function(e,t){var n=2*t.y,i=2*t.z;return e.x=1-n*t.y-i*t.z,e.y=n*t.x+i*t.w,e.z=i*t.x+n*t.w,e},t.toAxisY=function(e,t){var n=2*t.x,i=2*t.y,o=2*t.z;return e.x=i*t.x-o*t.w,e.y=1-n*t.x-o*t.z,e.z=o*t.y+n*t.w,e},t.toAxisZ=function(e,t){var n=2*t.x,i=2*t.y,o=2*t.z;return e.x=o*t.x-i*t.w,e.y=o*t.y-n*t.w,e.z=1-n*t.x-i*t.y,e},t.toEuler=function(e,t,n){var i=t.x,o=t.y,r=t.z,a=t.w,s=0,c=0,l=0,u=i*o+r*a;if(u>.499999)s=0,c=dn(2*Math.atan2(i,a)),l=90;else if(u<-.499999)s=0,c=-dn(2*Math.atan2(i,a)),l=-90;else{var h=i*i,_=o*o,f=r*r;s=dn(Math.atan2(2*i*a-2*o*r,1-2*h-2*f)),c=dn(Math.atan2(2*o*a-2*i*r,1-2*_-2*f)),l=dn(Math.asin(2*u)),n&&(s=-180*Math.sign(s+1e-6)+s,c=-180*Math.sign(c+1e-6)+c,l=180*Math.sign(l+1e-6)-l)}return e.x=s,e.y=c,e.z=l,e},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.x,e[n+1]=t.y,e[n+2]=t.z,e[n+3]=t.w,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.x=t[n+0],e.y=t[n+1],e.z=t[n+2],e.w=t[n+3],e},t.strictEquals=function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},t.equals=function(e,t,n){return void 0===n&&(n=sn),Math.abs(e.x-t.x)<=n*Math.max(1,Math.abs(e.x),Math.abs(t.x))&&Math.abs(e.y-t.y)<=n*Math.max(1,Math.abs(e.y),Math.abs(t.y))&&Math.abs(e.z-t.z)<=n*Math.max(1,Math.abs(e.z),Math.abs(t.z))&&Math.abs(e.w-t.w)<=n*Math.max(1,Math.abs(e.w),Math.abs(t.w))};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y,this.z,this.w)},n.set=function(e,t,n,i){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w):(this.x=e||0,this.y=t||0,this.z=n||0,this.w=null!=i?i:1),this},n.equals=function(e,t){return void 0===t&&(t=sn),Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))&&Math.abs(this.z-e.z)<=t*Math.max(1,Math.abs(this.z),Math.abs(e.z))&&Math.abs(this.w-e.w)<=t*Math.max(1,Math.abs(this.w),Math.abs(e.w))},n.strictEquals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},n.getEulerAngles=function(e){return t.toEuler(e,this)},n.lerp=function(e,t){return this.x+=t*(e.x-this.x),this.y+=t*(e.y-this.y),this.z+=t*(e.z-this.z),this.w+=t*(e.w-this.w),this},n.slerp=function(e,n){return t.slerp(this,this,e,n)},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},t}(_t));zn.IDENTITY=Object.freeze(new zn);var Bn=new zn,Un=new zn,Hn=new Rn,Gn=new Mn,kn=.5*Math.PI/180;function Vn(e,t,n,i){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),new zn(e,t,n,i)}tn.fastDefine("cc.Quat",zn,{x:0,y:0,z:0,w:1}),c.Quat=zn,c.quat=Vn;var Wn=e("eg",Object.freeze([Object.freeze([1,0,0,1]),Object.freeze([0,1,-1,0]),Object.freeze([-1,0,0,-1]),Object.freeze([0,-1,1,0])])),jn=e("cd",function(e){function t(t,n,i,o,r,a,s,c,l,u,h,_,f,d,p,m){var v;return void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===r&&(r=0),void 0===a&&(a=1),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=0),void 0===h&&(h=1),void 0===_&&(_=0),void 0===f&&(f=0),void 0===d&&(d=0),void 0===p&&(p=0),void 0===m&&(m=1),(v=e.call(this)||this).m00=void 0,v.m01=void 0,v.m02=void 0,v.m03=void 0,v.m04=void 0,v.m05=void 0,v.m06=void 0,v.m07=void 0,v.m08=void 0,v.m09=void 0,v.m10=void 0,v.m11=void 0,v.m12=void 0,v.m13=void 0,v.m14=void 0,v.m15=void 0,"object"==typeof t?(v.m00=t.m00,v.m01=t.m01,v.m02=t.m02,v.m03=t.m03,v.m04=t.m04,v.m05=t.m05,v.m06=t.m06,v.m07=t.m07,v.m08=t.m08,v.m09=t.m09,v.m10=t.m10,v.m11=t.m11,v.m12=t.m12,v.m13=t.m13,v.m14=t.m14,v.m15=t.m15):(v.m00=t,v.m01=n,v.m02=i,v.m03=o,v.m04=r,v.m05=a,v.m06=s,v.m07=c,v.m08=l,v.m09=u,v.m10=h,v.m11=_,v.m12=f,v.m13=d,v.m14=p,v.m15=m),v}ie(t,e),t.clone=function(e){return new t(e.m00,e.m01,e.m02,e.m03,e.m04,e.m05,e.m06,e.m07,e.m08,e.m09,e.m10,e.m11,e.m12,e.m13,e.m14,e.m15)},t.copy=function(e,t){return e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e.m09=t.m09,e.m10=t.m10,e.m11=t.m11,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15,e},t.set=function(e,t,n,i,o,r,a,s,c,l,u,h,_,f,d,p,m){return e.m00=t,e.m01=n,e.m02=i,e.m03=o,e.m04=r,e.m05=a,e.m06=s,e.m07=c,e.m08=l,e.m09=u,e.m10=h,e.m11=_,e.m12=f,e.m13=d,e.m14=p,e.m15=m,e},t.identity=function(e){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=1,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=1,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.transpose=function(e,t){if(e===t){var n=t.m01,i=t.m02,o=t.m03,r=t.m06,a=t.m07,s=t.m11;e.m01=t.m04,e.m02=t.m08,e.m03=t.m12,e.m04=n,e.m06=t.m09,e.m07=t.m13,e.m08=i,e.m09=r,e.m11=t.m14,e.m12=o,e.m13=a,e.m14=s}else e.m00=t.m00,e.m01=t.m04,e.m02=t.m08,e.m03=t.m12,e.m04=t.m01,e.m05=t.m05,e.m06=t.m09,e.m07=t.m13,e.m08=t.m02,e.m09=t.m06,e.m10=t.m10,e.m11=t.m14,e.m12=t.m03,e.m13=t.m07,e.m14=t.m11,e.m15=t.m15;return e},t.invert=function(e,t){var n=t.m00,i=t.m01,o=t.m02,r=t.m03,a=t.m04,s=t.m05,c=t.m06,l=t.m07,u=t.m08,h=t.m09,_=t.m10,f=t.m11,d=t.m12,p=t.m13,m=t.m14,v=t.m15,g=n*s-i*a,y=n*c-o*a,x=n*l-r*a,S=i*c-o*s,E=i*l-r*s,T=o*l-r*c,A=u*p-h*d,C=u*m-_*d,w=u*v-f*d,b=h*m-_*p,I=h*v-f*p,P=_*v-f*m,R=g*P-y*I+x*b+S*w-E*C+T*A;return 0===R?(e.m00=0,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=0,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=0,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=0,e):(R=1/R,e.m00=(s*P-c*I+l*b)*R,e.m01=(o*I-i*P-r*b)*R,e.m02=(p*T-m*E+v*S)*R,e.m03=(_*E-h*T-f*S)*R,e.m04=(c*w-a*P-l*C)*R,e.m05=(n*P-o*w+r*C)*R,e.m06=(m*x-d*T-v*y)*R,e.m07=(u*T-_*x+f*y)*R,e.m08=(a*I-s*w+l*A)*R,e.m09=(i*w-n*I-r*A)*R,e.m10=(d*E-p*x+v*g)*R,e.m11=(h*x-u*E-f*g)*R,e.m12=(s*C-a*b-c*A)*R,e.m13=(n*b-i*C+o*A)*R,e.m14=(p*y-d*S-m*g)*R,e.m15=(u*S-h*y+_*g)*R,e)},t.determinant=function(e){var t=e.m00,n=e.m01,i=e.m02,o=e.m03,r=e.m04,a=e.m05,s=e.m06,c=e.m07,l=e.m08,u=e.m09,h=e.m10,_=e.m11,f=e.m12,d=e.m13,p=e.m14,m=e.m15;return(t*a-n*r)*(h*m-_*p)-(t*s-i*r)*(u*m-_*d)+(t*c-o*r)*(u*p-h*d)+(n*s-i*a)*(l*m-_*f)-(n*c-o*a)*(l*p-h*f)+(i*c-o*s)*(l*d-u*f)},t.multiply=function(e,t,n){var i=t.m00,o=t.m01,r=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=t.m09,f=t.m10,d=t.m11,p=t.m12,m=t.m13,v=t.m14,g=t.m15,y=n.m00,x=n.m01,S=n.m02,E=n.m03;return e.m00=y*i+x*s+S*h+E*p,e.m01=y*o+x*c+S*_+E*m,e.m02=y*r+x*l+S*f+E*v,e.m03=y*a+x*u+S*d+E*g,y=n.m04,x=n.m05,S=n.m06,E=n.m07,e.m04=y*i+x*s+S*h+E*p,e.m05=y*o+x*c+S*_+E*m,e.m06=y*r+x*l+S*f+E*v,e.m07=y*a+x*u+S*d+E*g,y=n.m08,x=n.m09,S=n.m10,E=n.m11,e.m08=y*i+x*s+S*h+E*p,e.m09=y*o+x*c+S*_+E*m,e.m10=y*r+x*l+S*f+E*v,e.m11=y*a+x*u+S*d+E*g,y=n.m12,x=n.m13,S=n.m14,E=n.m15,e.m12=y*i+x*s+S*h+E*p,e.m13=y*o+x*c+S*_+E*m,e.m14=y*r+x*l+S*f+E*v,e.m15=y*a+x*u+S*d+E*g,e},t.transform=function(e,t,n){var i=n.x,o=n.y,r=n.z;if(t===e)e.m12=t.m00*i+t.m04*o+t.m08*r+t.m12,e.m13=t.m01*i+t.m05*o+t.m09*r+t.m13,e.m14=t.m02*i+t.m06*o+t.m10*r+t.m14,e.m15=t.m03*i+t.m07*o+t.m11*r+t.m15;else{var a=t.m00,s=t.m01,c=t.m02,l=t.m03,u=t.m04,h=t.m05,_=t.m06,f=t.m07,d=t.m08,p=t.m09,m=t.m10,v=t.m11;t.m12,t.m13,t.m14,t.m15,e.m00=a,e.m01=s,e.m02=c,e.m03=l,e.m04=u,e.m05=h,e.m06=_,e.m07=f,e.m08=d,e.m09=p,e.m10=m,e.m11=v,e.m12=a*i+u*o+d*r+t.m12,e.m13=s*i+h*o+p*r+t.m13,e.m14=c*i+_*o+m*r+t.m14,e.m15=l*i+f*o+v*r+t.m15}return e},t.translate=function(e,t,n){return console.warn("function changed"),t===e?(e.m12+=n.x,e.m13+=n.y,e.m14+=n.z):(e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e.m09=t.m09,e.m10=t.m10,e.m11=t.m11,e.m12+=n.x,e.m13+=n.y,e.m14+=n.z,e.m15=t.m15),e},t.scale=function(e,t,n){var i=n.x,o=n.y,r=n.z;return e.m00=t.m00*i,e.m01=t.m01*i,e.m02=t.m02*i,e.m03=t.m03*i,e.m04=t.m04*o,e.m05=t.m05*o,e.m06=t.m06*o,e.m07=t.m07*o,e.m08=t.m08*r,e.m09=t.m09*r,e.m10=t.m10*r,e.m11=t.m11*r,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15,e},t.rotate=function(e,t,n,i){var o=i.x,r=i.y,a=i.z,s=Math.sqrt(o*o+r*r+a*a);if(Math.abs(s)<sn)return null;o*=s=1/s,r*=s,a*=s;var c=Math.sin(n),l=Math.cos(n),u=1-l,h=t.m00,_=t.m01,f=t.m02,d=t.m03,p=t.m04,m=t.m05,v=t.m06,g=t.m07,y=t.m08,x=t.m09,S=t.m10,E=t.m11,T=o*o*u+l,A=r*o*u+a*c,C=a*o*u-r*c,w=o*r*u-a*c,b=r*r*u+l,I=a*r*u+o*c,P=o*a*u+r*c,R=r*a*u-o*c,N=a*a*u+l;return e.m00=h*T+p*A+y*C,e.m01=_*T+m*A+x*C,e.m02=f*T+v*A+S*C,e.m03=d*T+g*A+E*C,e.m04=h*w+p*b+y*I,e.m05=_*w+m*b+x*I,e.m06=f*w+v*b+S*I,e.m07=d*w+g*b+E*I,e.m08=h*P+p*R+y*N,e.m09=_*P+m*R+x*N,e.m10=f*P+v*R+S*N,e.m11=d*P+g*R+E*N,t!==e&&(e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e},t.rotateX=function(e,t,n){var i=Math.sin(n),o=Math.cos(n),r=t.m04,a=t.m05,s=t.m06,c=t.m07,l=t.m08,u=t.m09,h=t.m10,_=t.m11;return t!==e&&(e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e.m04=r*o+l*i,e.m05=a*o+u*i,e.m06=s*o+h*i,e.m07=c*o+_*i,e.m08=l*o-r*i,e.m09=u*o-a*i,e.m10=h*o-s*i,e.m11=_*o-c*i,e},t.rotateY=function(e,t,n){var i=Math.sin(n),o=Math.cos(n),r=t.m00,a=t.m01,s=t.m02,c=t.m03,l=t.m08,u=t.m09,h=t.m10,_=t.m11;return t!==e&&(e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e.m00=r*o-l*i,e.m01=a*o-u*i,e.m02=s*o-h*i,e.m03=c*o-_*i,e.m08=r*i+l*o,e.m09=a*i+u*o,e.m10=s*i+h*o,e.m11=c*i+_*o,e},t.rotateZ=function(e,t,n){var i=Math.sin(n),o=Math.cos(n),r=t.m00,a=t.m01,s=t.m02,c=t.m03,l=t.m04,u=t.m05,h=t.m06,_=t.m07;return t!==e&&(e.m08=t.m08,e.m09=t.m09,e.m10=t.m10,e.m11=t.m11,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e.m00=r*o+l*i,e.m01=a*o+u*i,e.m02=s*o+h*i,e.m03=c*o+_*i,e.m04=l*o-r*i,e.m05=u*o-a*i,e.m06=h*o-s*i,e.m07=_*o-c*i,e},t.fromTranslation=function(e,t){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=1,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=1,e.m11=0,e.m12=t.x,e.m13=t.y,e.m14=t.z,e.m15=1,e},t.fromScaling=function(e,t){return e.m00=t.x,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=t.y,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=t.z,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromRotation=function(e,t,n){var i=n.x,o=n.y,r=n.z,a=Math.sqrt(i*i+o*o+r*r);if(Math.abs(a)<sn)return null;i*=a=1/a,o*=a,r*=a;var s=Math.sin(t),c=Math.cos(t),l=1-c;return e.m00=i*i*l+c,e.m01=o*i*l+r*s,e.m02=r*i*l-o*s,e.m03=0,e.m04=i*o*l-r*s,e.m05=o*o*l+c,e.m06=r*o*l+i*s,e.m07=0,e.m08=i*r*l+o*s,e.m09=o*r*l-i*s,e.m10=r*r*l+c,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromXRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=i,e.m06=n,e.m07=0,e.m08=0,e.m09=-n,e.m10=i,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromYRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e.m00=i,e.m01=0,e.m02=-n,e.m03=0,e.m04=0,e.m05=1,e.m06=0,e.m07=0,e.m08=n,e.m09=0,e.m10=i,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromZRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e.m00=i,e.m01=n,e.m02=0,e.m03=0,e.m04=-n,e.m05=i,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=1,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromRT=function(e,t,n){var i=t.x,o=t.y,r=t.z,a=t.w,s=i+i,c=o+o,l=r+r,u=i*s,h=i*c,_=i*l,f=o*c,d=o*l,p=r*l,m=a*s,v=a*c,g=a*l;return e.m00=1-(f+p),e.m01=h+g,e.m02=_-v,e.m03=0,e.m04=h-g,e.m05=1-(u+p),e.m06=d+m,e.m07=0,e.m08=_+v,e.m09=d-m,e.m10=1-(u+f),e.m11=0,e.m12=n.x,e.m13=n.y,e.m14=n.z,e.m15=1,e},t.getTranslation=function(e,t){return e.x=t.m12,e.y=t.m13,e.z=t.m14,e},t.getScaling=function(e,t){var n=Yn.m00=t.m00,i=Yn.m01=t.m01,o=Yn.m02=t.m02,r=Yn.m03=t.m04,a=Yn.m04=t.m05,s=Yn.m05=t.m06,c=Yn.m06=t.m08,l=Yn.m07=t.m09,u=Yn.m08=t.m10;return e.x=Math.sqrt(n*n+i*i+o*o),e.y=Math.sqrt(r*r+a*a+s*s),e.z=Math.sqrt(c*c+l*l+u*u),Mn.determinant(Yn)<0&&(e.x*=-1),e},t.getRotation=function(e,t){var n=t.m00+t.m05+t.m10,i=0;return n>0?(i=2*Math.sqrt(n+1),e.w=.25*i,e.x=(t.m06-t.m09)/i,e.y=(t.m08-t.m02)/i,e.z=(t.m01-t.m04)/i):t.m00>t.m05&&t.m00>t.m10?(i=2*Math.sqrt(1+t.m00-t.m05-t.m10),e.w=(t.m06-t.m09)/i,e.x=.25*i,e.y=(t.m01+t.m04)/i,e.z=(t.m08+t.m02)/i):t.m05>t.m10?(i=2*Math.sqrt(1+t.m05-t.m00-t.m10),e.w=(t.m08-t.m02)/i,e.x=(t.m01+t.m04)/i,e.y=.25*i,e.z=(t.m06+t.m09)/i):(i=2*Math.sqrt(1+t.m10-t.m00-t.m05),e.w=(t.m01-t.m04)/i,e.x=(t.m08+t.m02)/i,e.y=(t.m06+t.m09)/i,e.z=.25*i),e},t.toRTS=function(e,t,n,i){i.x=Rn.set(qn,e.m00,e.m01,e.m02).length(),Yn.m00=e.m00/i.x,Yn.m01=e.m01/i.x,Yn.m02=e.m02/i.x,i.y=Rn.set(qn,e.m04,e.m05,e.m06).length(),Yn.m03=e.m04/i.y,Yn.m04=e.m05/i.y,Yn.m05=e.m06/i.y,i.z=Rn.set(qn,e.m08,e.m09,e.m10).length(),Yn.m06=e.m08/i.z,Yn.m07=e.m09/i.z,Yn.m08=e.m10/i.z,Mn.determinant(Yn)<0&&(i.x*=-1,Yn.m00*=-1,Yn.m01*=-1,Yn.m02*=-1),zn.fromMat3(t,Yn),Rn.set(n,e.m12,e.m13,e.m14)},t.fromRTS=function(e,t,n,i){var o=t.x,r=t.y,a=t.z,s=t.w,c=o+o,l=r+r,u=a+a,h=o*c,_=o*l,f=o*u,d=r*l,p=r*u,m=a*u,v=s*c,g=s*l,y=s*u,x=i.x,S=i.y,E=i.z;return e.m00=(1-(d+m))*x,e.m01=(_+y)*x,e.m02=(f-g)*x,e.m03=0,e.m04=(_-y)*S,e.m05=(1-(h+m))*S,e.m06=(p+v)*S,e.m07=0,e.m08=(f+g)*E,e.m09=(p-v)*E,e.m10=(1-(h+d))*E,e.m11=0,e.m12=n.x,e.m13=n.y,e.m14=n.z,e.m15=1,e},t.fromRTSOrigin=function(e,t,n,i,o){var r=t.x,a=t.y,s=t.z,c=t.w,l=r+r,u=a+a,h=s+s,_=r*l,f=r*u,d=r*h,p=a*u,m=a*h,v=s*h,g=c*l,y=c*u,x=c*h,S=i.x,E=i.y,T=i.z,A=o.x,C=o.y,w=o.z;return e.m00=(1-(p+v))*S,e.m01=(f+x)*S,e.m02=(d-y)*S,e.m03=0,e.m04=(f-x)*E,e.m05=(1-(_+v))*E,e.m06=(m+g)*E,e.m07=0,e.m08=(d+y)*T,e.m09=(m-g)*T,e.m10=(1-(_+p))*T,e.m11=0,e.m12=n.x+A-(e.m00*A+e.m04*C+e.m08*w),e.m13=n.y+C-(e.m01*A+e.m05*C+e.m09*w),e.m14=n.z+w-(e.m02*A+e.m06*C+e.m10*w),e.m15=1,e},t.fromQuat=function(e,t){var n=t.x,i=t.y,o=t.z,r=t.w,a=n+n,s=i+i,c=o+o,l=n*a,u=i*a,h=i*s,_=o*a,f=o*s,d=o*c,p=r*a,m=r*s,v=r*c;return e.m00=1-h-d,e.m01=u+v,e.m02=_-m,e.m03=0,e.m04=u-v,e.m05=1-l-d,e.m06=f+p,e.m07=0,e.m08=_+m,e.m09=f-p,e.m10=1-l-h,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.frustum=function(e,t,n,i,o,r,a){var s=1/(n-t),c=1/(o-i),l=1/(r-a);return e.m00=2*r*s,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=2*r*c,e.m06=0,e.m07=0,e.m08=(n+t)*s,e.m09=(o+i)*c,e.m10=(a+r)*l,e.m11=-1,e.m12=0,e.m13=0,e.m14=a*r*2*l,e.m15=0,e},t.perspective=function(e,t,n,i,o,r,a,s,c){void 0===r&&(r=!0),void 0===a&&(a=-1),void 0===s&&(s=1),void 0===c&&(c=0);var l=1/Math.tan(t/2),u=1/(i-o),h=r?l/n:l,_=(r?l:l*n)*s,f=Wn[c];return e.m00=h*f[0],e.m01=h*f[1],e.m02=0,e.m03=0,e.m04=_*f[2],e.m05=_*f[3],e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=(o-a*i)*u,e.m11=-1,e.m12=0,e.m13=0,e.m14=o*i*u*(1-a),e.m15=0,e},t.ortho=function(e,t,n,i,o,r,a,s,c,l){void 0===s&&(s=-1),void 0===c&&(c=1),void 0===l&&(l=0);var u=1/(t-n),h=1/(i-o)*c,_=1/(r-a),f=-2*u,d=-2*h,p=(t+n)*u,m=(o+i)*h,v=Wn[l];return e.m00=f*v[0],e.m01=f*v[1],e.m02=0,e.m03=0,e.m04=d*v[2],e.m05=d*v[3],e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=_*(1-s),e.m11=0,e.m12=p*v[0]+m*v[2],e.m13=p*v[1]+m*v[3],e.m14=(r-s*a)*_,e.m15=1,e},t.lookAt=function(e,t,n,i){var o=t.x,r=t.y,a=t.z,s=i.x,c=i.y,l=i.z,u=o-n.x,h=r-n.y,_=a-n.z,f=1/Math.sqrt(u*u+h*h+_*_),d=c*(_*=f)-l*(h*=f),p=l*(u*=f)-s*_,m=s*h-c*u,v=h*(m*=f=1/Math.sqrt(d*d+p*p+m*m))-_*(p*=f),g=_*(d*=f)-u*m,y=u*p-h*d;return e.m00=d,e.m01=v,e.m02=u,e.m03=0,e.m04=p,e.m05=g,e.m06=h,e.m07=0,e.m08=m,e.m09=y,e.m10=_,e.m11=0,e.m12=-(d*o+p*r+m*a),e.m13=-(v*o+g*r+y*a),e.m14=-(u*o+h*r+_*a),e.m15=1,e},t.inverseTranspose=function(e,t){var n=t.m00,i=t.m01,o=t.m02,r=t.m03,a=t.m04,s=t.m05,c=t.m06,l=t.m07,u=t.m08,h=t.m09,_=t.m10,f=t.m11,d=t.m12,p=t.m13,m=t.m14,v=t.m15,g=n*s-i*a,y=n*c-o*a,x=n*l-r*a,S=i*c-o*s,E=i*l-r*s,T=o*l-r*c,A=u*p-h*d,C=u*m-_*d,w=u*v-f*d,b=h*m-_*p,I=h*v-f*p,P=_*v-f*m,R=g*P-y*I+x*b+S*w-E*C+T*A;return R?(R=1/R,e.m00=(s*P-c*I+l*b)*R,e.m01=(c*w-a*P-l*C)*R,e.m02=(a*I-s*w+l*A)*R,e.m03=0,e.m04=(o*I-i*P-r*b)*R,e.m05=(n*P-o*w+r*C)*R,e.m06=(i*w-n*I-r*A)*R,e.m07=0,e.m08=(p*T-m*E+v*S)*R,e.m09=(m*x-d*T-v*y)*R,e.m10=(d*E-p*x+v*g)*R,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e):null},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.m00,e[n+1]=t.m01,e[n+2]=t.m02,e[n+3]=t.m03,e[n+4]=t.m04,e[n+5]=t.m05,e[n+6]=t.m06,e[n+7]=t.m07,e[n+8]=t.m08,e[n+9]=t.m09,e[n+10]=t.m10,e[n+11]=t.m11,e[n+12]=t.m12,e[n+13]=t.m13,e[n+14]=t.m14,e[n+15]=t.m15,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.m00=t[n+0],e.m01=t[n+1],e.m02=t[n+2],e.m03=t[n+3],e.m04=t[n+4],e.m05=t[n+5],e.m06=t[n+6],e.m07=t[n+7],e.m08=t[n+8],e.m09=t[n+9],e.m10=t[n+10],e.m11=t[n+11],e.m12=t[n+12],e.m13=t[n+13],e.m14=t[n+14],e.m15=t[n+15],e},t.add=function(e,t,n){return e.m00=t.m00+n.m00,e.m01=t.m01+n.m01,e.m02=t.m02+n.m02,e.m03=t.m03+n.m03,e.m04=t.m04+n.m04,e.m05=t.m05+n.m05,e.m06=t.m06+n.m06,e.m07=t.m07+n.m07,e.m08=t.m08+n.m08,e.m09=t.m09+n.m09,e.m10=t.m10+n.m10,e.m11=t.m11+n.m11,e.m12=t.m12+n.m12,e.m13=t.m13+n.m13,e.m14=t.m14+n.m14,e.m15=t.m15+n.m15,e},t.subtract=function(e,t,n){return e.m00=t.m00-n.m00,e.m01=t.m01-n.m01,e.m02=t.m02-n.m02,e.m03=t.m03-n.m03,e.m04=t.m04-n.m04,e.m05=t.m05-n.m05,e.m06=t.m06-n.m06,e.m07=t.m07-n.m07,e.m08=t.m08-n.m08,e.m09=t.m09-n.m09,e.m10=t.m10-n.m10,e.m11=t.m11-n.m11,e.m12=t.m12-n.m12,e.m13=t.m13-n.m13,e.m14=t.m14-n.m14,e.m15=t.m15-n.m15,e},t.multiplyScalar=function(e,t,n){return e.m00=t.m00*n,e.m01=t.m01*n,e.m02=t.m02*n,e.m03=t.m03*n,e.m04=t.m04*n,e.m05=t.m05*n,e.m06=t.m06*n,e.m07=t.m07*n,e.m08=t.m08*n,e.m09=t.m09*n,e.m10=t.m10*n,e.m11=t.m11*n,e.m12=t.m12*n,e.m13=t.m13*n,e.m14=t.m14*n,e.m15=t.m15*n,e},t.multiplyScalarAndAdd=function(e,t,n,i){return e.m00=t.m00+n.m00*i,e.m01=t.m01+n.m01*i,e.m02=t.m02+n.m02*i,e.m03=t.m03+n.m03*i,e.m04=t.m04+n.m04*i,e.m05=t.m05+n.m05*i,e.m06=t.m06+n.m06*i,e.m07=t.m07+n.m07*i,e.m08=t.m08+n.m08*i,e.m09=t.m09+n.m09*i,e.m10=t.m10+n.m10*i,e.m11=t.m11+n.m11*i,e.m12=t.m12+n.m12*i,e.m13=t.m13+n.m13*i,e.m14=t.m14+n.m14*i,e.m15=t.m15+n.m15*i,e},t.strictEquals=function(e,t){return e.m00===t.m00&&e.m01===t.m01&&e.m02===t.m02&&e.m03===t.m03&&e.m04===t.m04&&e.m05===t.m05&&e.m06===t.m06&&e.m07===t.m07&&e.m08===t.m08&&e.m09===t.m09&&e.m10===t.m10&&e.m11===t.m11&&e.m12===t.m12&&e.m13===t.m13&&e.m14===t.m14&&e.m15===t.m15},t.equals=function(e,t,n){return void 0===n&&(n=sn),Math.abs(e.m00-t.m00)<=n*Math.max(1,Math.abs(e.m00),Math.abs(t.m00))&&Math.abs(e.m01-t.m01)<=n*Math.max(1,Math.abs(e.m01),Math.abs(t.m01))&&Math.abs(e.m02-t.m02)<=n*Math.max(1,Math.abs(e.m02),Math.abs(t.m02))&&Math.abs(e.m03-t.m03)<=n*Math.max(1,Math.abs(e.m03),Math.abs(t.m03))&&Math.abs(e.m04-t.m04)<=n*Math.max(1,Math.abs(e.m04),Math.abs(t.m04))&&Math.abs(e.m05-t.m05)<=n*Math.max(1,Math.abs(e.m05),Math.abs(t.m05))&&Math.abs(e.m06-t.m06)<=n*Math.max(1,Math.abs(e.m06),Math.abs(t.m06))&&Math.abs(e.m07-t.m07)<=n*Math.max(1,Math.abs(e.m07),Math.abs(t.m07))&&Math.abs(e.m08-t.m08)<=n*Math.max(1,Math.abs(e.m08),Math.abs(t.m08))&&Math.abs(e.m09-t.m09)<=n*Math.max(1,Math.abs(e.m09),Math.abs(t.m09))&&Math.abs(e.m10-t.m10)<=n*Math.max(1,Math.abs(e.m10),Math.abs(t.m10))&&Math.abs(e.m11-t.m11)<=n*Math.max(1,Math.abs(e.m11),Math.abs(t.m11))&&Math.abs(e.m12-t.m12)<=n*Math.max(1,Math.abs(e.m12),Math.abs(t.m12))&&Math.abs(e.m13-t.m13)<=n*Math.max(1,Math.abs(e.m13),Math.abs(t.m13))&&Math.abs(e.m14-t.m14)<=n*Math.max(1,Math.abs(e.m14),Math.abs(t.m14))&&Math.abs(e.m15-t.m15)<=n*Math.max(1,Math.abs(e.m15),Math.abs(t.m15))};var n=t.prototype;return n.clone=function(){return new t(this.m00,this.m01,this.m02,this.m03,this.m04,this.m05,this.m06,this.m07,this.m08,this.m09,this.m10,this.m11,this.m12,this.m13,this.m14,this.m15)},n.set=function(e,t,n,i,o,r,a,s,c,l,u,h,_,f,d,p){return void 0===e&&(e=1),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===r&&(r=1),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=1),void 0===h&&(h=0),void 0===_&&(_=0),void 0===f&&(f=0),void 0===d&&(d=0),void 0===p&&(p=1),"object"==typeof e?(this.m01=e.m01,this.m02=e.m02,this.m03=e.m03,this.m04=e.m04,this.m05=e.m05,this.m06=e.m06,this.m07=e.m07,this.m08=e.m08,this.m09=e.m09,this.m10=e.m10,this.m11=e.m11,this.m12=e.m12,this.m13=e.m13,this.m14=e.m14,this.m15=e.m15,this.m00=e.m00):(this.m01=t,this.m02=n,this.m03=i,this.m04=o,this.m05=r,this.m06=a,this.m07=s,this.m08=c,this.m09=l,this.m10=u,this.m11=h,this.m12=_,this.m13=f,this.m14=d,this.m15=p,this.m00=e),this},n.equals=function(e,t){return void 0===t&&(t=sn),Math.abs(this.m00-e.m00)<=t*Math.max(1,Math.abs(this.m00),Math.abs(e.m00))&&Math.abs(this.m01-e.m01)<=t*Math.max(1,Math.abs(this.m01),Math.abs(e.m01))&&Math.abs(this.m02-e.m02)<=t*Math.max(1,Math.abs(this.m02),Math.abs(e.m02))&&Math.abs(this.m03-e.m03)<=t*Math.max(1,Math.abs(this.m03),Math.abs(e.m03))&&Math.abs(this.m04-e.m04)<=t*Math.max(1,Math.abs(this.m04),Math.abs(e.m04))&&Math.abs(this.m05-e.m05)<=t*Math.max(1,Math.abs(this.m05),Math.abs(e.m05))&&Math.abs(this.m06-e.m06)<=t*Math.max(1,Math.abs(this.m06),Math.abs(e.m06))&&Math.abs(this.m07-e.m07)<=t*Math.max(1,Math.abs(this.m07),Math.abs(e.m07))&&Math.abs(this.m08-e.m08)<=t*Math.max(1,Math.abs(this.m08),Math.abs(e.m08))&&Math.abs(this.m09-e.m09)<=t*Math.max(1,Math.abs(this.m09),Math.abs(e.m09))&&Math.abs(this.m10-e.m10)<=t*Math.max(1,Math.abs(this.m10),Math.abs(e.m10))&&Math.abs(this.m11-e.m11)<=t*Math.max(1,Math.abs(this.m11),Math.abs(e.m11))&&Math.abs(this.m12-e.m12)<=t*Math.max(1,Math.abs(this.m12),Math.abs(e.m12))&&Math.abs(this.m13-e.m13)<=t*Math.max(1,Math.abs(this.m13),Math.abs(e.m13))&&Math.abs(this.m14-e.m14)<=t*Math.max(1,Math.abs(this.m14),Math.abs(e.m14))&&Math.abs(this.m15-e.m15)<=t*Math.max(1,Math.abs(this.m15),Math.abs(e.m15))},n.strictEquals=function(e){return this.m00===e.m00&&this.m01===e.m01&&this.m02===e.m02&&this.m03===e.m03&&this.m04===e.m04&&this.m05===e.m05&&this.m06===e.m06&&this.m07===e.m07&&this.m08===e.m08&&this.m09===e.m09&&this.m10===e.m10&&this.m11===e.m11&&this.m12===e.m12&&this.m13===e.m13&&this.m14===e.m14&&this.m15===e.m15},n.toString=function(){return"[\n"+this.m00+", "+this.m01+", "+this.m02+", "+this.m03+",\n"+this.m04+", "+this.m05+", "+this.m06+", "+this.m07+",\n"+this.m08+", "+this.m09+", "+this.m10+", "+this.m11+",\n"+this.m12+", "+this.m13+", "+this.m14+", "+this.m15+"\n]"},n.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=1,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=1,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},n.zero=function(){return this.m00=0,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=0,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=0,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=0,this},n.transpose=function(){var e=this.m01,t=this.m02,n=this.m03,i=this.m06,o=this.m07,r=this.m11;return this.m01=this.m04,this.m02=this.m08,this.m03=this.m12,this.m04=e,this.m06=this.m09,this.m07=this.m13,this.m08=t,this.m09=i,this.m11=this.m14,this.m12=n,this.m13=o,this.m14=r,this},n.invert=function(){var e=this.m00,t=this.m01,n=this.m02,i=this.m03,o=this.m04,r=this.m05,a=this.m06,s=this.m07,c=this.m08,l=this.m09,u=this.m10,h=this.m11,_=this.m12,f=this.m13,d=this.m14,p=this.m15,m=e*r-t*o,v=e*a-n*o,g=e*s-i*o,y=t*a-n*r,x=t*s-i*r,S=n*s-i*a,E=c*f-l*_,T=c*d-u*_,A=c*p-h*_,C=l*d-u*f,w=l*p-h*f,b=u*p-h*d,I=m*b-v*w+g*C+y*A-x*T+S*E;return 0===I?(this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this):(I=1/I,this.m00=(r*b-a*w+s*C)*I,this.m01=(n*w-t*b-i*C)*I,this.m02=(f*S-d*x+p*y)*I,this.m03=(u*x-l*S-h*y)*I,this.m04=(a*A-o*b-s*T)*I,this.m05=(e*b-n*A+i*T)*I,this.m06=(d*g-_*S-p*v)*I,this.m07=(c*S-u*g+h*v)*I,this.m08=(o*w-r*A+s*E)*I,this.m09=(t*A-e*w-i*E)*I,this.m10=(_*x-f*g+p*m)*I,this.m11=(l*g-c*x-h*m)*I,this.m12=(r*T-o*C-a*E)*I,this.m13=(e*C-t*T+n*E)*I,this.m14=(f*v-_*y-d*m)*I,this.m15=(c*y-l*v+u*m)*I,this)},n.determinant=function(){var e=this.m00,t=this.m01,n=this.m02,i=this.m03,o=this.m04,r=this.m05,a=this.m06,s=this.m07,c=this.m08,l=this.m09,u=this.m10,h=this.m11,_=this.m12,f=this.m13,d=this.m14,p=this.m15;return(e*r-t*o)*(u*p-h*d)-(e*a-n*o)*(l*p-h*f)+(e*s-i*o)*(l*d-u*f)+(t*a-n*r)*(c*p-h*_)-(t*s-i*r)*(c*d-u*_)+(n*s-i*a)*(c*f-l*_)},n.add=function(e){return this.m00+=e.m00,this.m01+=e.m01,this.m02+=e.m02,this.m03+=e.m03,this.m04+=e.m04,this.m05+=e.m05,this.m06+=e.m06,this.m07+=e.m07,this.m08+=e.m08,this.m09+=e.m09,this.m10+=e.m10,this.m11+=e.m11,this.m12+=e.m12,this.m13+=e.m13,this.m14+=e.m14,this.m15+=e.m15,this},n.subtract=function(e){return this.m00-=e.m00,this.m01-=e.m01,this.m02-=e.m02,this.m03-=e.m03,this.m04-=e.m04,this.m05-=e.m05,this.m06-=e.m06,this.m07-=e.m07,this.m08-=e.m08,this.m09-=e.m09,this.m10-=e.m10,this.m11-=e.m11,this.m12-=e.m12,this.m13-=e.m13,this.m14-=e.m14,this.m15-=e.m15,this},n.multiply=function(e){var t=this.m00,n=this.m01,i=this.m02,o=this.m03,r=this.m04,a=this.m05,s=this.m06,c=this.m07,l=this.m08,u=this.m09,h=this.m10,_=this.m11,f=this.m12,d=this.m13,p=this.m14,m=this.m15,v=e.m00,g=e.m01,y=e.m02,x=e.m03;return this.m00=v*t+g*r+y*l+x*f,this.m01=v*n+g*a+y*u+x*d,this.m02=v*i+g*s+y*h+x*p,this.m03=v*o+g*c+y*_+x*m,v=e.m04,g=e.m05,y=e.m06,x=e.m07,this.m04=v*t+g*r+y*l+x*f,this.m05=v*n+g*a+y*u+x*d,this.m06=v*i+g*s+y*h+x*p,this.m07=v*o+g*c+y*_+x*m,v=e.m08,g=e.m09,y=e.m10,x=e.m11,this.m08=v*t+g*r+y*l+x*f,this.m09=v*n+g*a+y*u+x*d,this.m10=v*i+g*s+y*h+x*p,this.m11=v*o+g*c+y*_+x*m,v=e.m12,g=e.m13,y=e.m14,x=e.m15,this.m12=v*t+g*r+y*l+x*f,this.m13=v*n+g*a+y*u+x*d,this.m14=v*i+g*s+y*h+x*p,this.m15=v*o+g*c+y*_+x*m,this},n.multiplyScalar=function(e){return this.m00*=e,this.m01*=e,this.m02*=e,this.m03*=e,this.m04*=e,this.m05*=e,this.m06*=e,this.m07*=e,this.m08*=e,this.m09*=e,this.m10*=e,this.m11*=e,this.m12*=e,this.m13*=e,this.m14*=e,this.m15*=e,this},n.translate=function(e){return console.warn("function changed"),this.m12+=e.x,this.m13+=e.y,this.m14+=e.z,this},n.scale=function(e){var t=e.x,n=e.y,i=e.z;return this.m00*=t,this.m01*=t,this.m02*=t,this.m03*=t,this.m04*=n,this.m05*=n,this.m06*=n,this.m07*=n,this.m08*=i,this.m09*=i,this.m10*=i,this.m11*=i,this},n.rotate=function(e,t){var n=t.x,i=t.y,o=t.z,r=Math.sqrt(n*n+i*i+o*o);if(Math.abs(r)<sn)return null;n*=r=1/r,i*=r,o*=r;var a=Math.sin(e),s=Math.cos(e),c=1-s,l=this.m00,u=this.m01,h=this.m02,_=this.m03,f=this.m04,d=this.m05,p=this.m06,m=this.m07,v=this.m08,g=this.m09,y=this.m10,x=this.m11,S=n*n*c+s,E=i*n*c+o*a,T=o*n*c-i*a,A=n*i*c-o*a,C=i*i*c+s,w=o*i*c+n*a,b=n*o*c+i*a,I=i*o*c-n*a,P=o*o*c+s;return this.m00=l*S+f*E+v*T,this.m01=u*S+d*E+g*T,this.m02=h*S+p*E+y*T,this.m03=_*S+m*E+x*T,this.m04=l*A+f*C+v*w,this.m05=u*A+d*C+g*w,this.m06=h*A+p*C+y*w,this.m07=_*A+m*C+x*w,this.m08=l*b+f*I+v*P,this.m09=u*b+d*I+g*P,this.m10=h*b+p*I+y*P,this.m11=_*b+m*I+x*P,this},n.getTranslation=function(e){return e.x=this.m12,e.y=this.m13,e.z=this.m14,e},n.getScale=function(e){var t=Yn.m00=this.m00,n=Yn.m01=this.m01,i=Yn.m02=this.m02,o=Yn.m03=this.m04,r=Yn.m04=this.m05,a=Yn.m05=this.m06,s=Yn.m06=this.m08,c=Yn.m07=this.m09,l=Yn.m08=this.m10;return e.x=Math.sqrt(t*t+n*n+i*i),e.y=Math.sqrt(o*o+r*r+a*a),e.z=Math.sqrt(s*s+c*c+l*l),Mn.determinant(Yn)<0&&(e.x*=-1),e},n.getRotation=function(e){var t=this.m00+this.m05+this.m10,n=0;return t>0?(n=2*Math.sqrt(t+1),e.w=.25*n,e.x=(this.m06-this.m09)/n,e.y=(this.m08-this.m02)/n,e.z=(this.m01-this.m04)/n):this.m00>this.m05&&this.m00>this.m10?(n=2*Math.sqrt(1+this.m00-this.m05-this.m10),e.w=(this.m06-this.m09)/n,e.x=.25*n,e.y=(this.m01+this.m04)/n,e.z=(this.m08+this.m02)/n):this.m05>this.m10?(n=2*Math.sqrt(1+this.m05-this.m00-this.m10),e.w=(this.m08-this.m02)/n,e.x=(this.m01+this.m04)/n,e.y=.25*n,e.z=(this.m06+this.m09)/n):(n=2*Math.sqrt(1+this.m10-this.m00-this.m05),e.w=(this.m01-this.m04)/n,e.x=(this.m08+this.m02)/n,e.y=(this.m06+this.m09)/n,e.z=.25*n),e},n.fromRTS=function(e,t,n){var i=e.x,o=e.y,r=e.z,a=e.w,s=i+i,c=o+o,l=r+r,u=i*s,h=i*c,_=i*l,f=o*c,d=o*l,p=r*l,m=a*s,v=a*c,g=a*l,y=n.x,x=n.y,S=n.z;return this.m00=(1-(f+p))*y,this.m01=(h+g)*y,this.m02=(_-v)*y,this.m03=0,this.m04=(h-g)*x,this.m05=(1-(u+p))*x,this.m06=(d+m)*x,this.m07=0,this.m08=(_+v)*S,this.m09=(d-m)*S,this.m10=(1-(u+f))*S,this.m11=0,this.m12=t.x,this.m13=t.y,this.m14=t.z,this.m15=1,this},n.fromQuat=function(e){var t=e.x,n=e.y,i=e.z,o=e.w,r=t+t,a=n+n,s=i+i,c=t*r,l=n*r,u=n*a,h=i*r,_=i*a,f=i*s,d=o*r,p=o*a,m=o*s;return this.m00=1-u-f,this.m01=l+m,this.m02=h-p,this.m03=0,this.m04=l-m,this.m05=1-c-f,this.m06=_+d,this.m07=0,this.m08=h+p,this.m09=_-d,this.m10=1-c-u,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},t}(_t));jn.IDENTITY=Object.freeze(new jn);var qn=new Rn,Yn=new Mn;function Xn(e,t,n,i,o,r,a,s,c,l,u,h,_,f,d,p){return new jn(e,t,n,i,o,r,a,s,c,l,u,h,_,f,d,p)}tn.fastDefine("cc.Mat4",jn,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1}),c.Mat4=jn,c.mat4=Xn;var Kn=e("cO",function(e){function t(t,n){var i;return i=e.call(this)||this,t&&"object"==typeof t?(i.x=t.x,i.y=t.y):(i.x=t||0,i.y=n||0),i}ie(t,e),t.clone=function(e){return new t(e.x,e.y)},t.copy=function(e,t){return e.x=t.x,e.y=t.y,e},t.set=function(e,t,n){return e.x=t,e.y=n,e},t.add=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e},t.subtract=function(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e},t.multiply=function(e,t,n){return e.x=t.x*n.x,e.y=t.y*n.y,e},t.divide=function(e,t,n){return e.x=t.x/n.x,e.y=t.y/n.y,e},t.ceil=function(e,t){return e.x=Math.ceil(t.x),e.y=Math.ceil(t.y),e},t.floor=function(e,t){return e.x=Math.floor(t.x),e.y=Math.floor(t.y),e},t.min=function(e,t,n){return e.x=Math.min(t.x,n.x),e.y=Math.min(t.y,n.y),e},t.max=function(e,t,n){return e.x=Math.max(t.x,n.x),e.y=Math.max(t.y,n.y),e},t.round=function(e,t){return e.x=Math.round(t.x),e.y=Math.round(t.y),e},t.multiplyScalar=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e},t.scaleAndAdd=function(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e},t.distance=function(e,t){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)},t.squaredDistance=function(e,t){var n=t.x-e.x,i=t.y-e.y;return n*n+i*i},t.len=function(e){var t=e.x,n=e.y;return Math.sqrt(t*t+n*n)},t.lengthSqr=function(e){var t=e.x,n=e.y;return t*t+n*n},t.negate=function(e,t){return e.x=-t.x,e.y=-t.y,e},t.inverse=function(e,t){return e.x=1/t.x,e.y=1/t.y,e},t.inverseSafe=function(e,t){var n=t.x,i=t.y;return Math.abs(n)<sn?e.x=0:e.x=1/n,Math.abs(i)<sn?e.y=0:e.y=1/i,e},t.normalize=function(e,t){var n=t.x,i=t.y,o=n*n+i*i;return o>0&&(o=1/Math.sqrt(o),e.x=n*o,e.y=i*o),e},t.dot=function(e,t){return e.x*t.x+e.y*t.y},t.cross=function(e,t,n){return e.x=e.y=0,e.z=t.x*n.y-t.y*n.x,e},t.lerp=function(e,t,n,i){var o=t.x,r=t.y;return e.x=o+i*(n.x-o),e.y=r+i*(n.y-r),e},t.random=function(e,t){t=t||1;var n=2*pn()*Math.PI;return e.x=Math.cos(n)*t,e.y=Math.sin(n)*t,e},t.transformMat3=function(e,t,n){var i=t.x,o=t.y;return e.x=n.m00*i+n.m03*o+n.m06,e.y=n.m01*i+n.m04*o+n.m07,e},t.transformMat4=function(e,t,n){var i=t.x,o=t.y;return e.x=n.m00*i+n.m04*o+n.m12,e.y=n.m01*i+n.m05*o+n.m13,e},t.str=function(e){return"Vec2("+e.x+", "+e.y+")"},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.x,e[n+1]=t.y,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.x=t[n+0],e.y=t[n+1],e},t.strictEquals=function(e,t){return e.x===t.x&&e.y===t.y},t.equals=function(e,t,n){return void 0===n&&(n=sn),Math.abs(e.x-t.x)<=n*Math.max(1,Math.abs(e.x),Math.abs(t.x))&&Math.abs(e.y-t.y)<=n*Math.max(1,Math.abs(e.y),Math.abs(t.y))},t.angle=function(e,n){t.normalize(Qn,e),t.normalize(Zn,n);var i=t.dot(Qn,Zn);return i>1?0:i<-1?Math.PI:Math.acos(i)};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y)},n.set=function(e,t){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y):(this.x=e||0,this.y=t||0),this},n.equals=function(e,t){return void 0===t&&(t=sn),Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))},n.equals2f=function(e,t,n){return void 0===n&&(n=sn),Math.abs(this.x-e)<=n*Math.max(1,Math.abs(this.x),Math.abs(e))&&Math.abs(this.y-t)<=n*Math.max(1,Math.abs(this.y),Math.abs(t))},n.strictEquals=function(e){return e&&this.x===e.x&&this.y===e.y},n.strictEquals2f=function(e,t){return this.x===e&&this.y===t},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},n.lerp=function(e,t){var n=this.x,i=this.y;return this.x=n+t*(e.x-n),this.y=i+t*(e.y-i),this},n.clampf=function(e,t){return this.x=un(this.x,e.x,t.x),this.y=un(this.y,e.y,t.y),this},n.add=function(e){return this.x+=e.x,this.y+=e.y,this},n.add2f=function(e,t){return this.x+=e,this.y+=t,this},n.subtract=function(e){return this.x-=e.x,this.y-=e.y,this},n.subtract2f=function(e,t){return this.x-=e,this.y-=t,this},n.multiplyScalar=function(e){return"object"==typeof e&&console.warn("should use Vec2.multiply for vector * vector operation"),this.x*=e,this.y*=e,this},n.multiply=function(e){return"object"!=typeof e&&console.warn("should use Vec2.scale for vector * scalar operation"),this.x*=e.x,this.y*=e.y,this},n.multiply2f=function(e,t){return this.x*=e,this.y*=t,this},n.divide=function(e){return this.x/=e.x,this.y/=e.y,this},n.divide2f=function(e,t){return this.x/=e,this.y/=t,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this},n.dot=function(e){return this.x*e.x+this.y*e.y},n.cross=function(e){return this.x*e.y-this.y*e.x},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y},n.normalize=function(){var e=this.x,t=this.y,n=e*e+t*t;return n>0&&(n=1/Math.sqrt(n),this.x*=n,this.y*=n),this},n.angle=function(e){var t=this.lengthSqr(),n=e.lengthSqr();if(0===t||0===n)return console.warn("Can't get angle between zero vector"),0;var i=this.dot(e)/Math.sqrt(t*n);return i=un(i,-1,1),Math.acos(i)},n.signAngle=function(e){var t=this.angle(e);return this.cross(e)<0?-t:t},n.rotate=function(e){var t=this.x,n=this.y,i=Math.sin(e),o=Math.cos(e);return this.x=o*t-i*n,this.y=i*t+o*n,this},n.project=function(e){var t=this.dot(e)/e.dot(e);return this.x=e.x*t,this.y=e.y*t,this},n.transformMat4=function(e){var t=this.x,n=this.y;return this.x=e.m00*t+e.m04*n+e.m12,this.y=e.m01*t+e.m05*n+e.m13,this},t}(_t));Kn.ZERO=Object.freeze(new Kn(0,0)),Kn.ONE=Object.freeze(new Kn(1,1)),Kn.NEG_ONE=Object.freeze(new Kn(-1,-1)),Kn.UNIT_X=Object.freeze(new Kn(1,0)),Kn.UNIT_Y=Object.freeze(new Kn(0,1));var Qn=new Kn,Zn=new Kn;function Jn(e,t){return new Kn(e,t)}tn.fastDefine("cc.Vec2",Kn,{x:0,y:0}),c.Vec2=Kn,c.v2=Jn;var $n=e("c6",function(e){function t(t,n,i,o){var r;return r=e.call(this)||this,t&&"object"==typeof t?(r.x=t.x,r.y=t.y,r.z=t.z,r.w=t.w):(r.x=t||0,r.y=n||0,r.z=i||0,r.w=o||0),r}ie(t,e),t.clone=function(e){return new t(e.x,e.y,e.z,e.w)},t.copy=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e},t.set=function(e,t,n,i,o){return e.x=t,e.y=n,e.z=i,e.w=o,e},t.add=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e.z=t.z+n.z,e.w=t.w+n.w,e},t.subtract=function(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e.z=t.z-n.z,e.w=t.w-n.w,e},t.multiply=function(e,t,n){return e.x=t.x*n.x,e.y=t.y*n.y,e.z=t.z*n.z,e.w=t.w*n.w,e},t.divide=function(e,t,n){return e.x=t.x/n.x,e.y=t.y/n.y,e.z=t.z/n.z,e.w=t.w/n.w,e},t.ceil=function(e,t){return e.x=Math.ceil(t.x),e.y=Math.ceil(t.y),e.z=Math.ceil(t.z),e.w=Math.ceil(t.w),e},t.floor=function(e,t){return e.x=Math.floor(t.x),e.y=Math.floor(t.y),e.z=Math.floor(t.z),e.w=Math.floor(t.w),e},t.min=function(e,t,n){return e.x=Math.min(t.x,n.x),e.y=Math.min(t.y,n.y),e.z=Math.min(t.z,n.z),e.w=Math.min(t.w,n.w),e},t.max=function(e,t,n){return e.x=Math.max(t.x,n.x),e.y=Math.max(t.y,n.y),e.z=Math.max(t.z,n.z),e.w=Math.max(t.w,n.w),e},t.round=function(e,t){return e.x=Math.round(t.x),e.y=Math.round(t.y),e.z=Math.round(t.z),e.w=Math.round(t.w),e},t.multiplyScalar=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e.w=t.w*n,e},t.scaleAndAdd=function(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e.z=t.z+n.z*i,e.w=t.w+n.w*i,e},t.distance=function(e,t){var n=t.x-e.x,i=t.y-e.y,o=t.z-e.z,r=t.w-e.w;return Math.sqrt(n*n+i*i+o*o+r*r)},t.squaredDistance=function(e,t){var n=t.x-e.x,i=t.y-e.y,o=t.z-e.z,r=t.w-e.w;return n*n+i*i+o*o+r*r},t.len=function(e){var t=e.x,n=e.y,i=e.z,o=e.w;return Math.sqrt(t*t+n*n+i*i+o*o)},t.lengthSqr=function(e){var t=e.x,n=e.y,i=e.z,o=e.w;return t*t+n*n+i*i+o*o},t.negate=function(e,t){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e.w=-t.w,e},t.inverse=function(e,t){return e.x=1/t.x,e.y=1/t.y,e.z=1/t.z,e.w=1/t.w,e},t.inverseSafe=function(e,t){var n=t.x,i=t.y,o=t.z,r=t.w;return Math.abs(n)<sn?e.x=0:e.x=1/n,Math.abs(i)<sn?e.y=0:e.y=1/i,Math.abs(o)<sn?e.z=0:e.z=1/o,Math.abs(r)<sn?e.w=0:e.w=1/r,e},t.normalize=function(e,t){var n=t.x,i=t.y,o=t.z,r=t.w,a=n*n+i*i+o*o+r*r;return a>0&&(a=1/Math.sqrt(a),e.x=n*a,e.y=i*a,e.z=o*a,e.w=r*a),e},t.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},t.lerp=function(e,t,n,i){return e.x=t.x+i*(n.x-t.x),e.y=t.y+i*(n.y-t.y),e.z=t.z+i*(n.z-t.z),e.w=t.w+i*(n.w-t.w),e},t.random=function(e,t){t=t||1;var n=2*pn()*Math.PI,i=2*pn()-1,o=Math.sqrt(1-i*i);return e.x=o*Math.cos(n)*t,e.y=o*Math.sin(n)*t,e.z=i*t,e.w=0,e},t.transformMat4=function(e,t,n){var i=t.x,o=t.y,r=t.z,a=t.w;return e.x=n.m00*i+n.m04*o+n.m08*r+n.m12*a,e.y=n.m01*i+n.m05*o+n.m09*r+n.m13*a,e.z=n.m02*i+n.m06*o+n.m10*r+n.m14*a,e.w=n.m03*i+n.m07*o+n.m11*r+n.m15*a,e},t.transformAffine=function(e,t,n){var i=t.x,o=t.y,r=t.z,a=t.w;return e.x=n.m00*i+n.m01*o+n.m02*r+n.m03*a,e.y=n.m04*i+n.m05*o+n.m06*r+n.m07*a,e.x=n.m08*i+n.m09*o+n.m10*r+n.m11*a,e.w=t.w,e},t.transformQuat=function(e,t,n){var i=t.x,o=t.y,r=t.z,a=n.x,s=n.y,c=n.z,l=n.w,u=l*i+s*r-c*o,h=l*o+c*i-a*r,_=l*r+a*o-s*i,f=-a*i-s*o-c*r;return e.x=u*l+f*-a+h*-c-_*-s,e.y=h*l+f*-s+_*-a-u*-c,e.z=_*l+f*-c+u*-s-h*-a,e.w=t.w,e},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.x,e[n+1]=t.y,e[n+2]=t.z,e[n+3]=t.w,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.x=t[n+0],e.y=t[n+1],e.z=t[n+2],e.w=t[n+3],e},t.strictEquals=function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},t.equals=function(e,t,n){return void 0===n&&(n=sn),Math.abs(e.x-t.x)<=n*Math.max(1,Math.abs(e.x),Math.abs(t.x))&&Math.abs(e.y-t.y)<=n*Math.max(1,Math.abs(e.y),Math.abs(t.y))&&Math.abs(e.z-t.z)<=n*Math.max(1,Math.abs(e.z),Math.abs(t.z))&&Math.abs(e.w-t.w)<=n*Math.max(1,Math.abs(e.w),Math.abs(t.w))};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y,this.z,this.w)},n.set=function(e,t,n,i){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w):(this.x=e||0,this.y=t||0,this.z=n||0,this.w=i||0),this},n.equals=function(e,t){return void 0===t&&(t=sn),Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))&&Math.abs(this.z-e.z)<=t*Math.max(1,Math.abs(this.z),Math.abs(e.z))&&Math.abs(this.w-e.w)<=t*Math.max(1,Math.abs(this.w),Math.abs(e.w))},n.equals4f=function(e,t,n,i,o){return void 0===o&&(o=sn),Math.abs(this.x-e)<=o*Math.max(1,Math.abs(this.x),Math.abs(e))&&Math.abs(this.y-t)<=o*Math.max(1,Math.abs(this.y),Math.abs(t))&&Math.abs(this.z-n)<=o*Math.max(1,Math.abs(this.z),Math.abs(n))&&Math.abs(this.w-i)<=o*Math.max(1,Math.abs(this.w),Math.abs(i))},n.strictEquals=function(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},n.strictEquals4f=function(e,t,n,i){return this.x===e&&this.y===t&&this.z===n&&this.w===i},n.lerp=function(e,t){var n=this.x,i=this.y,o=this.z,r=this.w;return this.x=n+t*(e.x-n),this.y=i+t*(e.y-i),this.z=o+t*(e.z-o),this.w=r+t*(e.w-r),this},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+", "+this.w.toFixed(2)+")"},n.clampf=function(e,t){return this.x=un(this.x,e.x,t.x),this.y=un(this.y,e.y,t.y),this.z=un(this.z,e.z,t.z),this.w=un(this.w,e.w,t.w),this},n.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},n.add4f=function(e,t,n,i){return this.x+=e,this.y+=t,this.z+=n,this.w+=i,this},n.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},n.subtract4f=function(e,t,n,i){return this.x-=e,this.y-=t,this.z-=n,this.w-=i,this},n.multiplyScalar=function(e){return"object"==typeof e&&console.warn("should use Vec4.multiply for vector * vector operation"),this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},n.multiply=function(e){return"object"!=typeof e&&console.warn("should use Vec4.scale for vector * scalar operation"),this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},n.multiply4f=function(e,t,n,i){return this.x*=e,this.y*=t,this.z*=n,this.w*=i,this},n.divide=function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this},n.divide4f=function(e,t,n,i){return this.x/=e,this.y/=t,this.z/=n,this.w/=i,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},n.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},n.cross=function(e){var t=this.x,n=this.y,i=this.z,o=e.x,r=e.y,a=e.z;return this.x=n*a-i*r,this.y=i*o-t*a,this.z=t*r-n*o,this},n.length=function(){var e=this.x,t=this.y,n=this.z,i=this.w;return Math.sqrt(e*e+t*t+n*n+i*i)},n.lengthSqr=function(){var e=this.x,t=this.y,n=this.z,i=this.w;return e*e+t*t+n*n+i*i},n.normalize=function(){var e=this.x,t=this.y,n=this.z,i=this.w,o=e*e+t*t+n*n+i*i;return o>0&&(o=1/Math.sqrt(o),this.x=e*o,this.y=t*o,this.z=n*o,this.w=i*o),this},n.transformMat4=function(e){var t=this.x,n=this.y,i=this.z,o=this.w;return this.x=e.m00*t+e.m04*n+e.m08*i+e.m12*o,this.y=e.m01*t+e.m05*n+e.m09*i+e.m13*o,this.z=e.m02*t+e.m06*n+e.m10*i+e.m14*o,this.w=e.m03*t+e.m07*n+e.m11*i+e.m15*o,this},t}(_t));function ei(e,t,n,i){return new $n(e,t,n,i)}$n.ZERO=Object.freeze(new $n(0,0,0,0)),$n.ONE=Object.freeze(new $n(1,1,1,1)),$n.NEG_ONE=Object.freeze(new $n(-1,-1,-1,-1)),tn.fastDefine("cc.Vec4",$n,{x:0,y:0,z:0,w:0}),c.Vec4=$n,c.v4=ei,q(Kn,"Vec2",[{name:"sub",newName:"subtract",target:Kn,targetName:"Vec2"},{name:"mul",newName:"multiply",target:Kn,targetName:"Vec2"},{name:"div",newName:"divide",target:Kn,targetName:"Vec2"},{name:"dist",newName:"distance",target:Kn,targetName:"Vec2"},{name:"sqrDist",newName:"squaredDistance",target:Kn,targetName:"Vec2"},{name:"mag",newName:"len",target:Kn,targetName:"Vec2"},{name:"sqrMag",newName:"lengthSqr",target:Kn,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:Kn,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:Kn,targetName:"Vec2"}]),q(Kn.prototype,"Vec2",[{name:"mag",newName:"length",target:Kn.prototype,targetName:"Vec2"},{name:"magSqr",newName:"lengthSqr",target:Kn.prototype,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:Kn.prototype,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:Kn.prototype,targetName:"Vec2"}]),q(Rn,"Vec3",[{name:"sub",newName:"subtract",target:Rn,targetName:"Vec3"},{name:"mul",newName:"multiply",target:Rn,targetName:"Vec3"},{name:"div",newName:"divide",target:Rn,targetName:"Vec3"},{name:"dist",newName:"distance",target:Rn,targetName:"Vec3"},{name:"sqrDist",newName:"squaredDistance",target:Rn,targetName:"Vec3"},{name:"mag",newName:"len",target:Rn,targetName:"Vec3"},{name:"sqrMag",newName:"lengthSqr",target:Rn,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:Rn,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:Rn,targetName:"Vec3"}]),q(Rn.prototype,"Vec3",[{name:"mag",newName:"length",target:Rn.prototype,targetName:"Vec3"},{name:"magSqr",newName:"lengthSqr",target:Rn.prototype,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:Rn.prototype,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:Rn.prototype,targetName:"Vec3"}]),q($n,"Vec4",[{name:"sub",newName:"subtract",target:$n,targetName:"Vec4"},{name:"mul",newName:"multiply",target:$n,targetName:"Vec4"},{name:"div",newName:"divide",target:$n,targetName:"Vec4"},{name:"dist",newName:"distance",target:$n,targetName:"Vec4"},{name:"sqrDist",newName:"squaredDistance",target:$n,targetName:"Vec4"},{name:"mag",newName:"len",target:$n,targetName:"Vec4"},{name:"sqrMag",newName:"lengthSqr",target:$n,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:$n,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:$n,targetName:"Vec4"}]),q($n.prototype,"Vec4",[{name:"mag",newName:"length",target:$n.prototype,targetName:"Vec4"},{name:"magSqr",newName:"lengthSqr",target:$n.prototype,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:$n.prototype,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:$n.prototype,targetName:"Vec4"}]),q(zn,"Quat",[{name:"mag",newName:"len",target:zn,targetName:"Quat"},{name:"mul",newName:"multiply",target:zn,targetName:"Quat"},{name:"sqrMag",newName:"lengthSqr",target:zn,targetName:"Quat"},{name:"scale",newName:"multiplyScalar",target:zn,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:zn,targetName:"Quat"}]),q(zn.prototype,"Quat",[{name:"scale",newName:"multiplyScalar",target:zn.prototype,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:zn.prototype,targetName:"Quat"}]),q(In,"Color",[{name:"sub",newName:"subtract",target:In,targetName:"Color"},{name:"mul",newName:"multiply",target:In,targetName:"Color"},{name:"div",newName:"divide",target:In,targetName:"Color"},{name:"exactEquals",newName:"strictEquals",target:In,targetName:"Color"},{name:"fromHex",newName:"fromHEX",customFunction:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[1].toString(16);return c.Color.fromHEX(t[0],i)}}]),q(Mn,"Mat3",[{name:"sub",newName:"subtract",target:Mn,targetName:"Mat3"},{name:"mul",newName:"multiply",target:Mn,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:Mn,targetName:"Mat3"},{name:"transfrom",newName:"transform",target:Mn,targetName:"Mat3"}]),q(Mn.prototype,"Mat3",[{name:"sub",newName:"subtract",target:Mn.prototype,targetName:"Mat3"},{name:"mul",newName:"multiply",target:Mn.prototype,targetName:"Mat3"},{name:"mulScalar",newName:"multiplyScalar",target:Mn.prototype,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:Mn.prototype,targetName:"Mat3"}]),q(jn,"Mat4",[{name:"sub",newName:"subtract",target:jn,targetName:"Mat4"},{name:"mul",newName:"multiply",target:jn,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:jn,targetName:"Mat4"}]),q(jn.prototype,"Mat4",[{name:"sub",newName:"subtract",target:jn.prototype,targetName:"Mat4"},{name:"mul",newName:"multiply",target:jn.prototype,targetName:"Mat4"},{name:"mulScalar",newName:"multiplyScalar",target:jn.prototype,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:jn.prototype,targetName:"Mat4"}]);var ti=e("eJ",function(){function e(e,t,n,i,o,r){void 0===e&&(e=1),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===o&&(o=0),void 0===r&&(r=0),this.a=e,this.b=t,this.c=n,this.d=i,this.tx=o,this.ty=r}return e.identity=function(){return new e},e.clone=function(t){return new e(t.a,t.b,t.c,t.d,t.tx,t.ty)},e.concat=function(e,t,n){var i=t.a,o=t.b,r=t.c,a=t.d,s=t.tx,c=t.ty;e.a=i*n.a+o*n.c,e.b=i*n.b+o*n.d,e.c=r*n.a+a*n.c,e.d=r*n.b+a*n.d,e.tx=s*n.a+c*n.c+n.tx,e.ty=s*n.b+c*n.d+n.ty},e.invert=function(e,t){var n=1/(t.a*t.d-t.b*t.c);e.a=n*t.d,e.b=-n*t.b,e.c=-n*t.c,e.d=n*t.a,e.tx=n*(t.c*t.ty-t.d*t.tx),e.ty=n*(t.b*t.tx-t.a*t.ty)},e.fromMat4=function(e,t){e.a=t.m00,e.b=t.m01,e.c=t.m04,e.d=t.m05,e.tx=t.m12,e.ty=t.m13},e.transformVec2=function(e,t,n,i){var o,r;void 0===i?(i=n,o=t.x,r=t.y):(o=t,r=n),e.x=i.a*o+i.c*r+i.tx,e.y=i.b*o+i.d*r+i.ty},e.transformSize=function(e,t,n){e.width=n.a*t.width+n.c*t.height,e.height=n.b*t.width+n.d*t.height},e.transformRect=function(e,t,n){var i=t.x+t.width,o=t.y+t.height,r=n.a*t.x+n.c*t.y+n.tx,a=n.b*t.x+n.d*t.y+n.ty,s=n.a*i+n.c*t.y+n.tx,c=n.b*i+n.d*t.y+n.ty,l=n.a*t.x+n.c*o+n.tx,u=n.b*t.x+n.d*o+n.ty,h=n.a*i+n.c*o+n.tx,_=n.b*i+n.d*o+n.ty,f=Math.min(r,s,l,h),d=Math.max(r,s,l,h),p=Math.min(a,c,u,_),m=Math.max(a,c,u,_);e.x=f,e.y=p,e.width=d-f,e.height=m-p},e.transformObb=function(e,t,n,i,o,r){var a=r.a*o.x+r.c*o.y+r.tx,s=r.b*o.x+r.d*o.y+r.ty,c=r.a*o.width,l=r.b*o.width,u=r.c*o.height,h=r.d*o.height;t.x=a,t.y=s,n.x=c+a,n.y=l+s,e.x=u+a,e.y=h+s,i.x=c+u+a,i.y=l+h+s},e}());c.AffineTransform=ti;var ni=e("cS",function(e){function t(t,n){var i;return i=e.call(this)||this,t&&"object"==typeof t?(i.width=t.width,i.height=t.height):(i.width=t||0,i.height=n||0),i}ie(t,e),t.lerp=function(e,t,n,i){return e.width=t.width+(n.width-t.width)*i,e.height=t.height+(n.height-t.height)*i,e};var n=t.prototype;return n.clone=function(){return new t(this.width,this.height)},n.set=function(e,t){return e&&"object"==typeof e?(this.height=e.height,this.width=e.width):(this.width=e||0,this.height=t||0),this},n.equals=function(e){return this.width===e.width&&this.height===e.height},n.lerp=function(e,t){return this.width+=(e.width-this.width)*t,this.height+=(e.height-this.height)*t,this},n.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},te(t,[{key:"x",get:function(){return this.width},set:function(e){this.width=e}},{key:"y",get:function(){return this.height},set:function(e){this.height=e}}]),t}(_t));function ii(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),new ni(e,t)}ni.ZERO=Object.freeze(new ni(0,0)),ni.ONE=Object.freeze(new ni(1,1)),tn.fastDefine("cc.Size",ni,{width:0,height:0}),c.size=ii,c.Size=ni;var oi=e("cR",function(e){function t(t,n,i,o){var r;return r=e.call(this)||this,t&&"object"==typeof t?(r.y=t.y,r.width=t.width,r.height=t.height,r.x=t.x):(r.x=t||0,r.y=n||0,r.width=i||0,r.height=o||0),r}ie(t,e),t.fromMinMax=function(e,t,n){var i=Math.min(t.x,n.x),o=Math.min(t.y,n.y),r=Math.max(t.x,n.x),a=Math.max(t.y,n.y);return e.x=i,e.y=o,e.width=r-i,e.height=a-o,e},t.lerp=function(e,t,n,i){var o=t.x,r=t.y,a=t.width,s=t.height;return e.x=o+(n.x-o)*i,e.y=r+(n.y-r)*i,e.width=a+(n.width-a)*i,e.height=s+(n.height-s)*i,e},t.intersection=function(e,t,n){var i=t.x,o=t.y,r=t.x+t.width,a=t.y+t.height,s=n.x,c=n.y,l=n.x+n.width,u=n.y+n.height;return e.x=Math.max(i,s),e.y=Math.max(o,c),e.width=Math.min(r,l)-e.x,e.height=Math.min(a,u)-e.y,e},t.union=function(e,t,n){var i=t.x,o=t.y,r=t.width,a=t.height,s=n.x,c=n.y,l=n.width,u=n.height;return e.x=Math.min(i,s),e.y=Math.min(o,c),e.width=Math.max(i+r,s+l)-e.x,e.height=Math.max(o+a,c+u)-e.y,e};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y,this.width,this.height)},n.set=function(e,t,n,i){return e&&"object"==typeof e?(this.y=e.y,this.width=e.width,this.height=e.height,this.x=e.x):(this.x=e||0,this.y=t||0,this.width=n||0,this.height=i||0),this},n.equals=function(e){return this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height},n.lerp=function(e,t){var n=this.x,i=this.y,o=this.width,r=this.height;return this.x=n+(e.x-n)*t,this.y=i+(e.y-i)*t,this.width=o+(e.width-o)*t,this.height=r+(e.height-r)*t,this},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},n.intersects=function(e){var t=this.x+this.width,n=this.y+this.height,i=e.x+e.width,o=e.y+e.height;return!(t<e.x||i<this.x||n<e.y||o<this.y)},n.contains=function(e){return this.x<=e.x&&this.x+this.width>=e.x&&this.y<=e.y&&this.y+this.height>=e.y},n.containsRect=function(e){return this.x<=e.x&&this.x+this.width>=e.x+e.width&&this.y<=e.y&&this.y+this.height>=e.y+e.height},n.transformMat4=function(e){var t=this.x,n=this.y,i=t+this.width,o=n+this.height,r=e.m00*t+e.m04*n+e.m12,a=e.m01*t+e.m05*n+e.m13,s=e.m00*i+e.m04*n+e.m12,c=e.m01*i+e.m05*n+e.m13,l=e.m00*t+e.m04*o+e.m12,u=e.m01*t+e.m05*o+e.m13,h=e.m00*i+e.m04*o+e.m12,_=e.m01*i+e.m05*o+e.m13,f=Math.min(r,s,l,h),d=Math.max(r,s,l,h),p=Math.min(a,c,u,_),m=Math.max(a,c,u,_);return this.x=f,this.y=p,this.width=d-f,this.height=m-p,this},n.transformMat4ToPoints=function(e,t,n,i,o){var r=this.x,a=this.y,s=r+this.width,c=a+this.height;t.x=e.m00*r+e.m04*a+e.m12,t.y=e.m01*r+e.m05*a+e.m13,o.x=e.m00*s+e.m04*a+e.m12,o.y=e.m01*s+e.m05*a+e.m13,n.x=e.m00*r+e.m04*c+e.m12,n.y=e.m01*r+e.m05*c+e.m13,i.x=e.m00*s+e.m04*c+e.m12,i.y=e.m01*s+e.m05*c+e.m13},te(t,[{key:"xMin",get:function(){return this.x},set:function(e){this.width+=this.x-e,this.x=e}},{key:"yMin",get:function(){return this.y},set:function(e){this.height+=this.y-e,this.y=e}},{key:"xMax",get:function(){return this.x+this.width},set:function(e){this.width=e-this.x}},{key:"yMax",get:function(){return this.y+this.height},set:function(e){this.height=e-this.y}},{key:"center",get:function(){return new Kn(this.x+.5*this.width,this.y+.5*this.height)},set:function(e){this.x=e.x-.5*this.width,this.y=e.y-.5*this.height}},{key:"origin",get:function(){return new Kn(this.x,this.y)},set:function(e){this.x=e.x,this.y=e.y}},{key:"size",get:function(){return new ni(this.width,this.height)},set:function(e){this.width=e.width,this.height=e.height}},{key:"z",get:function(){return this.width},set:function(e){this.width=e}},{key:"w",get:function(){return this.height},set:function(e){this.height=e}}]),t}(_t));function ri(e,t,n,i){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),new oi(e,t,n,i)}tn.fastDefine("cc.Rect",oi,{x:0,y:0,width:0,height:0}),c.Rect=oi,c.rect=ri;var ai=Object.freeze({__proto__:null,bits:j,Vec2:Kn,v2:Jn,Vec3:Rn,v3:Dn,Vec4:$n,v4:ei,Quat:zn,quat:Vn,Mat3:Mn,Mat4:jn,mat4:Xn,AffineTransform:ti,Size:ni,size:ii,Rect:oi,rect:ri,Color:In,color:Pn,EPSILON:sn,equals:cn,approx:ln,clamp:un,clamp01:hn,lerp:_n,toRadian:fn,toDegree:dn,random:pn,randomRange:mn,randomRangeInt:vn,pseudoRandom:gn,pseudoRandomRange:yn,pseudoRandomRangeInt:xn,nextPow2:Sn,repeat:En,pingPong:Tn,inverseLerp:An,absMaxComponent:Cn,absMax:wn});e("eB",ai);var si,ci=e("P",function(){function e(e,t){this._ctor=void 0,this._elementsPerBatch=void 0,this._nextAvail=void 0,this._freepool=[],this._ctor=e,this._elementsPerBatch=Math.max(t,1),this._nextAvail=this._elementsPerBatch-1;for(var n=0;n<this._elementsPerBatch;++n)this._freepool.push(e())}var t=e.prototype;return t.alloc=function(){if(this._nextAvail<0){for(var e=this._elementsPerBatch,t=0;t<e;t++)this._freepool.push(this._ctor());this._nextAvail=e-1}var n=this._freepool[this._nextAvail--];return this._freepool.length--,n},t.free=function(e){this._freepool.push(e),this._nextAvail++},t.freeArray=function(e){Array.prototype.push.apply(this._freepool,e),this._nextAvail+=e.length},t.destroy=function(e){if(e)for(var t=0;t<=this._nextAvail;t++)e(this._freepool[t]);this._freepool.length=0,this._nextAvail=-1},e}()),li=e("R",function(){function e(e,t){this._fn=void 0,this._count=0,this._data=void 0,this._fn=e,this._data=new Array(t);for(var n=0;n<t;++n)this._data[n]=e()}var t=e.prototype;return t.reset=function(){this._count=0},t.resize=function(e){if(e>this._data.length)for(var t=this._data.length;t<e;++t)this._data[t]=this._fn()},t.add=function(){return this._count>=this._data.length&&this.resize(2*this._data.length),this._data[this._count++]},t.removeAt=function(e){if(!(e>=this._count)){var t=this._count-1,n=this._data[e];this._data[e]=this._data[t],this._data[t]=n,this._count-=1}},te(e,[{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}]),e}()),ui=e("C",function(){function e(e,t){this.array=void 0,this.length=0,this._compareFn=void 0,this.array=new Array(e),this.length=0,this._compareFn=void 0!==t?t:function(e,t){return e-t}}var t=e.prototype;return t.push=function(e){this.array[this.length++]=e},t.pop=function(){return this.array[--this.length]},t.get=function(e){return this.array[e]},t.clear=function(){this.length=0},t.destroy=function(){this.length=0,this.array.length=0},t.sort=function(){this.array.length=this.length,this.array.sort(this._compareFn)},t.concat=function(e){for(var t=0;t<e.length;++t)this.array[this.length++]=e[t]},t.fastRemove=function(e){if(!(e>=this.length||e<0)){var t=--this.length;this.array[e]=this.array[t]}},t.indexOf=function(e){return this.array.indexOf(e)},e}()),hi=e("f7","__editorExtras__"),_i=[],fi=e("d7",function(){function e(e){void 0===e&&(e=""),this._objFlags=void 0,this._name=void 0,this._name=e,this._objFlags=0}e._deferredDestroy=function(){for(var e=_i.length,t=0;t<e;++t){var n=_i[t];1&n._objFlags||n._destroyImmediate()}e===_i.length?_i.length=0:_i.splice(0,e)};var t=e.prototype;return t.destroy=function(){return 1&this._objFlags?(P(5e3),!1):!(4&this._objFlags||(this._objFlags|=4,_i.push(this),0))},t._destruct=function(){var e=this.constructor,t=e.__destruct__;t||(t=function(e,t){var n,i=e instanceof c._BaseNode||e instanceof c.Component,o=i?"_id":null,r={};for(n in e)if(e.hasOwnProperty(n)){if(n===o)continue;switch(typeof e[n]){case"string":r[n]="";break;case"object":case"function":r[n]=null}}if(tn._isCCClass(t))for(var a=c.Class.Attr.getClassAttrs(t),s=t.__props__,l=0;l<s.length;l++){var u=(n=s[l])+c.Class.Attr.DELIMETER+"default";if(u in a){if(i&&"_id"===n)continue;switch(typeof a[u]){case"string":r[n]="";break;case"object":case"function":r[n]=null;break;case"undefined":r[n]=void 0}}}var h="";for(n in r){var _;_=tn.IDENTIFIER_RE.test(n)?"o."+n+"=":"o["+tn.escapeForJS(n)+"]=";var f=r[n];""===f&&(f='""'),h+=_+f+";\n"}return Function("o",h)}(this,e),we(e,"__destruct__",t,!0)),t(this)},t._destroyImmediate=function(){1&this._objFlags?N(5e3):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),this._objFlags|=1)},te(e,[{key:"name",get:function(){return this._name},set:function(e){this._name=e}},{key:"hideFlags",get:function(){return this._objFlags&e.Flags.AllHideMasks},set:function(t){var n=t&e.Flags.AllHideMasks;this._objFlags=this._objFlags&~e.Flags.AllHideMasks|n}},{key:"isValid",get:function(){return!(1&this._objFlags)}}]),e}()),di=fi.prototype;function pi(e,t){return"object"==typeof e?!(!e||e._objFlags&(t?5:1)):void 0!==e}di._deserialize=null,di._onPreDestroy=null,tn.fastDefine("cc.Object",fi,((si={_name:"",_objFlags:0})[hi]={},si)),tn.Attr.setClassAttr(fi,hi,"editorOnly",!0),we(fi,"Flags",{Destroyed:1,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,AllHideMasks:1560,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:1<<21,IsRotationLocked:1<<17,IsScaleLocked:1<<18,IsAnchorLocked:1<<19,IsSizeLocked:1<<20}),c.isValid=pi,c.Object=fi;var mi=rt.fastRemoveAt;function vi(){}var gi=function(){function e(){this.callback=vi,this.target=void 0,this.once=!1}var t=e.prototype;return t.set=function(e,t,n){this.callback=e||vi,this.target=t,this.once=!!n},t.reset=function(){this.target=void 0,this.callback=vi,this.once=!1},t.check=function(){return!(this.target instanceof fi&&!pi(this.target,!0))},e}(),yi=new ci((function(){return new gi}),32),xi=function(){function e(){this.callbackInfos=[],this.isInvoking=!1,this.containCanceled=!1}var t=e.prototype;return t.removeByCallback=function(e){for(var t=0;t<this.callbackInfos.length;++t){var n=this.callbackInfos[t];n&&n.callback===e&&(n.reset(),yi.free(n),mi(this.callbackInfos,t),--t)}},t.removeByTarget=function(e){for(var t=0;t<this.callbackInfos.length;++t){var n=this.callbackInfos[t];n&&n.target===e&&(n.reset(),yi.free(n),mi(this.callbackInfos,t),--t)}},t.cancel=function(e){var t=this.callbackInfos[e];t&&(t.reset(),this.isInvoking?this.callbackInfos[e]=null:mi(this.callbackInfos,e),yi.free(t)),this.containCanceled=!0},t.cancelAll=function(){for(var e=0;e<this.callbackInfos.length;e++){var t=this.callbackInfos[e];t&&(t.reset(),yi.free(t),this.callbackInfos[e]=null)}this.containCanceled=!0},t.purgeCanceled=function(){for(var e=this.callbackInfos.length-1;e>=0;--e)this.callbackInfos[e]||mi(this.callbackInfos,e);this.containCanceled=!1},t.clear=function(){this.cancelAll(),this.callbackInfos.length=0,this.isInvoking=!1,this.containCanceled=!1},e}(),Si=new ci((function(){return new xi}),16),Ei=function(){function e(){this._callbackTable=Re(!0)}var t=e.prototype;return t.on=function(e,t,n,i){if(!this.hasEventListener(e,t,n)){var o=this._callbackTable[e];o||(o=this._callbackTable[e]=Si.alloc());var r=yi.alloc();r.set(t,n,i),o.callbackInfos.push(r)}return t},t.hasEventListener=function(e,t,n){var i=this._callbackTable&&this._callbackTable[e];if(!i)return!1;var o=i.callbackInfos;if(!t){if(i.isInvoking){for(var r=0;r<o.length;++r)if(o[r])return!0;return!1}return o.length>0}for(var a=0;a<o.length;++a){var s=o[a];if(s&&s.check()&&s.callback===t&&s.target===n)return!0}return!1},t.removeAll=function(e){if("string"==typeof e){var t=this._callbackTable&&this._callbackTable[e];t&&(t.isInvoking?t.cancelAll():(t.clear(),Si.free(t),delete this._callbackTable[e]))}else if(e)for(var n in this._callbackTable){var i=this._callbackTable[n];if(i.isInvoking)for(var o=i.callbackInfos,r=0;r<o.length;++r){var a=o[r];a&&a.target===e&&i.cancel(r)}else i.removeByTarget(e)}},t.off=function(e,t,n){var i=this._callbackTable&&this._callbackTable[e];if(i){var o=i.callbackInfos;if(t)for(var r=0;r<o.length;++r){var a=o[r];if(a&&a.callback===t&&a.target===n){i.cancel(r);break}}else this.removeAll(e)}},t.emit=function(e,t,n,i,o,r){var a=this._callbackTable&&this._callbackTable[e];if(a){var s=!a.isInvoking;a.isInvoking=!0;for(var c=a.callbackInfos,l=0,u=c.length;l<u;++l){var h=c[l];if(h){var _=h.callback,f=h.target;h.once&&this.off(e,_,f),h.check()?f?_.call(f,t,n,i,o,r):_(t,n,i,o,r):this.off(e,_,f)}}s&&(a.isInvoking=!1,a.containCanceled&&a.purgeCanceled())}},t.clear=function(){for(var e in this._callbackTable){var t=this._callbackTable[e];t&&(t.clear(),Si.free(t),delete this._callbackTable[e])}},e}();function Ti(e){for(var t=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this)._callbackTable=Re(!0),t}ie(t,e);var n=t.prototype;return n.once=function(e,t,n){return this.on(e,t,n,!0)},n.targetOff=function(e){this.removeAll(e)},t}(e),n=Ei.prototype,i=Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n)),o=0;o<i.length;++o){var r=i[o];if(!(r in t.prototype)){var a=Object.getOwnPropertyDescriptor(n,r);a&&Object.defineProperty(t.prototype,r,a)}}return t}var Ai,Ci,wi,bi,Ii,Pi,Ri,Ni=e("em",Ti((function(){})));c.EventTarget=Ni,function(e){e.UNKNOWN="unknown",e.WECHAT="wechat",e.ANDROID="androidbrowser",e.IE="ie",e.EDGE="edge",e.QQ="qqbrowser",e.MOBILE_QQ="mqqbrowser",e.UC="ucbrowser",e.UCBS="ucbs",e.BROWSER_360="360browser",e.BAIDU_APP="baiduboxapp",e.BAIDU="baidubrowser",e.MAXTHON="maxthon",e.OPERA="opera",e.OUPENG="oupeng",e.MIUI="miuibrowser",e.FIREFOX="firefox",e.SAFARI="safari",e.CHROME="chrome",e.LIEBAO="liebao",e.QZONE="qzone",e.SOUGOU="sogou",e.HUAWEI="huawei"}(Ai||(Ai=e("bu",{}))),function(e){e.HIDE="hide",e.SHOW="show",e.RESIZE="resize",e.ORIENTATION_CHANGE="orientation_change"}(Ci||(Ci={})),function(e){e.UNKNOWN="unknown",e.ENGLISH="en",e.CHINESE="zh",e.FRENCH="fr",e.ITALIAN="it",e.GERMAN="de",e.SPANISH="es",e.DUTCH="du",e.RUSSIAN="ru",e.KOREAN="ko",e.JAPANESE="ja",e.HUNGARIAN="hu",e.PORTUGUESE="pt",e.ARABIC="ar",e.NORWEGIAN="no",e.POLISH="pl",e.TURKISH="tr",e.UKRAINIAN="uk",e.ROMANIAN="ro",e.BULGARIAN="bg"}(wi||(wi={})),function(e){e[e.NONE=0]="NONE",e[e.LAN=1]="LAN",e[e.WWAN=2]="WWAN"}(bi||(bi={})),function(e){e.UNKNOWN="Unknown",e.IOS="iOS",e.ANDROID="Android",e.WINDOWS="Windows",e.LINUX="Linux",e.OSX="OS X"}(Ii||(Ii=e("bs",{}))),function(e){e[e.PORTRAIT=1]="PORTRAIT",e[e.PORTRAIT_UPSIDE_DOWN=2]="PORTRAIT_UPSIDE_DOWN",e[e.LANDSCAPE_LEFT=4]="LANDSCAPE_LEFT",e[e.LANDSCAPE_RIGHT=8]="LANDSCAPE_RIGHT",e[e.LANDSCAPE=12]="LANDSCAPE"}(Pi||(Pi={})),function(e){e.UNKNOWN="UNKNOWN",e.EDITOR_PAGE="EDITOR_PAGE",e.EDITOR_CORE="EDITOR_CORE",e.MOBILE_BROWSER="MOBILE_BROWSER",e.DESKTOP_BROWSER="DESKTOP_BROWSER",e.WIN32="WIN32",e.ANDROID="ANDROID",e.IOS="IOS",e.MACOS="MACOS",e.WECHAT_GAME="WECHAT_GAME",e.BAIDU_MINI_GAME="BAIDU_MINI_GAME",e.XIAOMI_QUICK_GAME="XIAOMI_QUICK_GAME",e.ALIPAY_MINI_GAME="ALIPAY_MINI_GAME",e.BYTEDANCE_MINI_GAME="BYTEDANCE_MINI_GAME",e.OPPO_MINI_GAME="OPPO_MINI_GAME",e.VIVO_MINI_GAME="VIVO_MINI_GAME",e.HUAWEI_QUICK_GAME="HUAWEI_QUICK_GAME",e.COCOSPLAY="COCOSPLAY",e.LINKSURE_MINI_GAME="LINKSURE_MINI_GAME",e.QTT_MINI_GAME="QTT_MINI_GAME"}(Ri||(Ri={}));var Oi=function(){function e(){var e,t=this;this.networkType=void 0,this.isNative=void 0,this.isBrowser=void 0,this.isMobile=void 0,this.isLittleEndian=void 0,this.platform=void 0,this.language=void 0,this.nativeLanguage=void 0,this.os=void 0,this.osVersion=void 0,this.osMainVersion=void 0,this.browserType=void 0,this.browserVersion=void 0,this.pixelRatio=void 0,this.supportCapability=void 0,this._eventTarget=new Ni,this._html=void 0,this._battery=void 0;var n,i=window.navigator,o=i.userAgent.toLowerCase();this._html=document.getElementsByTagName("html")[0],null===(e=i.getBattery)||void 0===e||e.call(i).then((function(e){t._battery=e})),this.networkType=bi.LAN,this.isNative=!1,this.isBrowser=!0,this.isMobile=/mobile|android|iphone|ipad/.test(o),this.platform=this.isMobile?Ri.MOBILE_BROWSER:Ri.DESKTOP_BROWSER,this.isLittleEndian=(n=new ArrayBuffer(2),new DataView(n).setInt16(0,256,!0),256===new Int16Array(n)[0]);var r=i.language;this.nativeLanguage=r.toLowerCase(),r=(r=r||i.browserLanguage)?r.split("-")[0]:wi.ENGLISH,this.language=r;var a=!1,s=!1,c="",l=0,u=/android\s*(\d+(?:\.\d+)*)/i.exec(o)||/android\s*(\d+(?:\.\d+)*)/i.exec(i.platform);u&&(a=!0,c=u[1]||"",l=parseInt(c)||0),(u=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(o))?(s=!0,c=u[2]||"",l=parseInt(c)||0):(/(iPhone|iPad|iPod)/.exec(i.platform)||"MacIntel"===i.platform&&i.maxTouchPoints&&i.maxTouchPoints>1)&&(s=!0,c="",l=0);var h=Ii.UNKNOWN;-1!==i.appVersion.indexOf("Win")?h=Ii.WINDOWS:s?h=Ii.IOS:-1!==i.appVersion.indexOf("Mac")?h=Ii.OSX:-1!==i.appVersion.indexOf("X11")&&-1===i.appVersion.indexOf("Linux")?h=Ii.LINUX:a?h=Ii.ANDROID:-1===i.appVersion.indexOf("Linux")&&-1===o.indexOf("ubuntu")||(h=Ii.LINUX),this.os=h,this.osVersion=c,this.osMainVersion=l,this.browserType=Ai.UNKNOWN;var _=/wechat|weixin|micromessenger/i.exec(o)||/mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|ucbs|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(o)||/qq|qqbrowser|ucbrowser|ubrowser|edge|HuaweiBrowser/i.exec(o)||/chrome|safari|firefox|trident|opera|opr\/|oupeng/i.exec(o),f=_?_[0].toLowerCase():Ii.UNKNOWN;("safari"===f&&a||"qq"===f&&/android.*applewebkit/i.test(o))&&(f=Ai.ANDROID);var d={micromessenger:Ai.WECHAT,wechat:Ai.WECHAT,weixin:Ai.WECHAT,trident:Ai.IE,edge:Ai.EDGE,"360 aphone":Ai.BROWSER_360,mxbrowser:Ai.MAXTHON,"opr/":Ai.OPERA,ubrowser:Ai.UC,huaweibrowser:Ai.HUAWEI};this.browserType=d[f]||f,this.browserVersion="";var p=/(mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|uc|ucbs|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui(?:.hybrid)?)(mobile)?(browser)?\/?([\d.]+)/i.exec(o);p||(p=/(qq|chrome|safari|firefox|trident|opera|opr\/|oupeng)(mobile)?(browser)?\/?([\d.]+)/i.exec(o)),this.browserVersion=p?p[4]:"",this.pixelRatio=window.devicePixelRatio||1;var m,v=document.createElement("canvas"),g=!!v.getContext("2d"),y=!1;window.WebGLRenderingContext&&(y=!0);try{m=v.toDataURL("image/webp").startsWith("data:image/webp")}catch(e){m=!1}var x=!1;"undefined"!=typeof createImageBitmap&&"undefined"!=typeof Blob&&(v.width=v.height=2,createImageBitmap(v,{}).then((function(e){x=!0,null==e||e.close()})).catch((function(){}))),this.supportCapability={webp:m,gl:y,canvas:g,imageBitmap:x},this._registerEvent()}var t=e.prototype;return t._registerEvent=function(){var e=this;window.addEventListener("resize",(function(){e._eventTarget.emit(Ci.RESIZE)})),window.addEventListener("orientationchange",(function(){e._eventTarget.emit(Ci.ORIENTATION_CHANGE)})),this._registerVisibilityEvent()},t._registerVisibilityEvent=function(){var e,t=this;e=void 0!==document.hidden?"hidden":void 0!==document.mozHidden?"mozHidden":void 0!==document.msHidden?"msHidden":void 0!==document.webkitHidden?"webkitHidden":"hidden";var n=!1,i=function(){n||(n=!0,t._eventTarget.emit(Ci.HIDE))},o=function(e,i,o,r,a){n&&(n=!1,t._eventTarget.emit(Ci.SHOW,e,i,o,r,a))};if(e)for(var r=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],a=0;a<r.length;a++)document.addEventListener(r[a],(function(t){var n=document[e];(n=n||t.hidden)?i():o()}));else window.addEventListener("blur",i),window.addEventListener("focus",o);window.navigator.userAgent.indexOf("MicroMessenger")>-1&&(window.onfocus=o),"onpageshow"in window&&"onpagehide"in window&&(window.addEventListener("pagehide",i),window.addEventListener("pageshow",o),document.addEventListener("pagehide",i),document.addEventListener("pageshow",o))},t.getViewSize=function(){var e=document.getElementById("GameDiv");return this.isMobile||!e||e===this._html?new ni(window.innerWidth,window.innerHeight):new ni(e.clientWidth,e.clientHeight)},t.getOrientation=function(){throw new Error("TODO")},t.getSafeAreaEdge=function(){return{top:0,bottom:0,left:0,right:0}},t.getBatteryLevel=function(){return this._battery?this._battery.level:1},t.triggerGC=function(){},t.openURL=function(e){window.open(e)},t.now=function(){return Date.now?Date.now():+new Date},t.restartJSVM=function(){},t.onHide=function(e){this._eventTarget.on(Ci.HIDE,e)},t.onShow=function(e){this._eventTarget.on(Ci.SHOW,e)},t.onViewResize=function(e){this._eventTarget.on(Ci.RESIZE,e)},t.onOrientationChange=function(e){this._eventTarget.on(Ci.ORIENTATION_CHANGE,e)},t.offHide=function(e){this._eventTarget.off(Ci.HIDE,e)},t.offShow=function(e){this._eventTarget.off(Ci.SHOW,e)},t.offViewResize=function(e){this._eventTarget.off(Ci.RESIZE,e)},t.offOrientationChange=function(e){this._eventTarget.off(Ci.ORIENTATION_CHANGE,e)},e}(),Di=e("br",new Oi),Mi=/(\.[^\.\/\?\\]*)(\?.*)?$/,Li=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,Fi=/[^\.\/]+\/\.\.\//;function zi(){for(var e="",t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(var o=0,r=n;o<r.length;o++){var a=r[o];e=(e+(""===e?"":"/")+a).replace(/(\/|\\\\)$/,"")}return e}function Bi(e){var t=Mi.exec(e);return t?t[1]:""}function Ui(e){if(e){var t=e.lastIndexOf(".");if(-1!==t)return e.substring(0,t)}return e}function Hi(e,t){var n=e.indexOf("?");n>0&&(e=e.substring(0,n));var i=/(\/|\\)([^\/\\]+)$/g.exec(e.replace(/(\/|\\)$/,""));if(!i)return e;var o=i[2];return t&&e.substring(e.length-t.length).toLowerCase()===t.toLowerCase()?o.substring(0,o.length-t.length):o}function Gi(e){var t=Li.exec(e);return t?t[2]:""}function ki(e,t){t=t||"";var n=e.indexOf("?"),i="";return n>0&&(i=e.substring(n),e=e.substring(0,n)),(n=e.lastIndexOf("."))<0?e+t+i:e.substring(0,n)+t+i}function Vi(e,t,n){if(0===t.indexOf("."))return ki(e,t);var i=e.indexOf("?"),o="",r=n?Bi(e):"";return i>0&&(o=e.substring(i),e=e.substring(0,i)),i=(i=e.lastIndexOf("/"))<=0?0:i+1,e.substring(0,i)+t+r+o}function Wi(e){var t=e=String(e);do{t=e,e=e.replace(Fi,"")}while(t.length!==e.length);return e}function ji(e){return e.replace(/[\/\\]$/,"")}function qi(){return Di.os===Ii.WINDOWS?"\\":"/"}e("eY",Object.freeze({__proto__:null,join:zi,extname:Bi,mainFileName:Ui,basename:Hi,dirname:Gi,changeExtname:ki,changeBasename:Vi,_normalize:Wi,stripSep:ji,getSeperator:qi})),c.log=g,c.warn=y,c.error=x,c.assert=S,c._throw=A,c.logID=b,c.warnID=P,c.errorID=N,c.assertID=M,c.debug=B,c.path={join:zi,extname:Bi,mainFileName:Ui,basename:Hi,dirname:Gi,changeExtname:ki,changeBasename:Vi,_normalize:Wi,stripSep:ji,get sep(){return qi()}};var Yi,Xi,Ki,Qi,Zi,Ji,$i,eo,to,no,io,oo,ro,ao,so,co,lo,uo,ho,_o,fo,po,mo,vo,go,yo=0,xo={},So=function(){function e(e,t,n){this._arrayBuffers=[],this._chunkSize=void 0,this._chunkSize=n*(1<<t)}return e.prototype.allocateNewChunk=function(){return new ArrayBuffer(this._chunkSize)},e}(),Eo=function(){function e(){}return e.prototype.bind=function(){},e}(),To=function(){function e(){}var t=e.prototype;return t.alloc=function(e,t){return new ArrayBuffer(t)},t.free=function(){},e}();!function(e){e[e.UINT32=0]="UINT32",e[e.FLOAT32=1]="FLOAT32",e[e.NEVER=2]="NEVER"}(go||(go={}));var Ao,Co=function(){function e(e,t,n,i){void 0===i&&(i=8),this._dataType=void 0,this._elementCount=void 0,this._entryBits=void 0,this._stride=void 0,this._entriesPerChunk=void 0,this._entryMask=void 0,this._chunkMask=void 0,this._poolFlag=void 0,this._arrayBuffers=[],this._freelists=[],this._uint32BufferViews=[],this._float32BufferViews=[],this._hasUint32=!1,this._hasFloat32=!1,this._nativePool=void 0,this._elementCount=n.COUNT,this._entryBits=i,this._dataType=t,this._stride=4*this._elementCount,this._entriesPerChunk=1<<i,this._entryMask=this._entriesPerChunk-1,this._poolFlag=1<<30,this._chunkMask=~(this._entryMask|this._poolFlag),this._nativePool=new So(e,i,this._stride);var o=go.NEVER,r=!1,a=!1;for(var s in t){if(r=this._hasFloat32,(a=this._hasUint32)&&r)break;o=t[s],r||o!==go.FLOAT32?a||o!==go.UINT32||(this._hasUint32=!0):this._hasFloat32=!0}}var t=e.prototype;return t.alloc=function(){for(var e=0;e<this._freelists.length;e++){var t=this._freelists[e];if(t.length){var n=t[t.length-1];return t.length--,(e<<this._entryBits)+n+this._poolFlag}}for(var i=this._nativePool.allocateNewChunk(),o=[],r=[],a=[],s=this._hasFloat32,c=this._hasUint32,l=0;l<this._entriesPerChunk;l++)s&&o.push(new Float32Array(i,this._stride*l,this._elementCount)),c&&r.push(new Uint32Array(i,this._stride*l,this._elementCount)),l&&a.push(l);return this._arrayBuffers.push(i),c&&this._uint32BufferViews.push(r),s&&this._float32BufferViews.push(o),this._freelists.push(a),(e<<this._entryBits)+this._poolFlag},t.get=function(e,t){var n=(this._chunkMask&e)>>this._entryBits,i=this._entryMask&e;return(this._dataType[t]===go.UINT32?this._uint32BufferViews:this._float32BufferViews)[n][i][t]},t.set=function(e,t,n){var i=(this._chunkMask&e)>>this._entryBits,o=this._entryMask&e;(this._dataType[t]===go.UINT32?this._uint32BufferViews:this._float32BufferViews)[i][o][t]=n},t.setVec2=function(){},t.setVec3=function(){},t.getVec3=function(){},t.setVec4=function(){},t.getVec4=function(){},t.setMat4=function(){},t.free=function(e){var t=(this._chunkMask&e)>>this._entryBits,n=this._entryMask&e;(this._hasUint32?this._uint32BufferViews:this._float32BufferViews)[t][n].fill(0),this._freelists[t].push(n)},e}(),wo=function(){function e(e,t,n){this._ctor=void 0,this._dtor=void 0,this._indexMask=void 0,this._poolFlag=void 0,this._array=[],this._freelist=[],this._nativePool=void 0,this._ctor=t,n&&(this._dtor=n),this._poolFlag=1<<29,this._indexMask=~this._poolFlag,this._nativePool=new Eo(e,this._array)}var t=e.prototype;return t.alloc=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=this._freelist,o=-1;if(i.length)o=i[i.length-1],i.length--,this._array[o]=this._ctor(arguments,this._array[o]);else{o=this._array.length;var r=this._ctor(arguments);if(!r)return 0;this._array.push(r)}return o+this._poolFlag},t.get=function(e){var t=this._indexMask&e;return this._array[t]},t.free=function(e){var t=this._indexMask&e;this._dtor&&(this._array[t]=this._dtor(this._array[t])),this._freelist.push(t)},e}(),bo=function(){function e(e){this._nativeBufferAllocator=void 0,this._buffers=new Map,this._nextBufferIdx=0,this._poolFlag=void 0,this._bufferIdxMask=void 0,this._freelist=[],this._poolFlag=1<<30,this._bufferIdxMask=~this._poolFlag,this._nativeBufferAllocator=new To(e)}var t=e.prototype;return t.alloc=function(e){var t=this._freelist,n=-1;t.length?(n=t[t.length-1],t.length--):n=this._nextBufferIdx++;var i=this._nativeBufferAllocator.alloc(n,e);return this._buffers.set(n,i),n|this._poolFlag},t.free=function(e){var t=this._bufferIdxMask&e;this._buffers.get(t)&&(this._nativeBufferAllocator.free(t),this._buffers.delete(t),this._freelist.push(t))},t.getBuffer=function(e){var t=this._bufferIdxMask&e;return this._buffers.get(t)||null},e}(),Io=function(e){function t(t,n,i,o){var r;return(r=e.call(this,t)||this)._viewCtor=void 0,r._size=void 0,r._step=void 0,r._viewCtor=n,r._size=i*n.BYTES_PER_ELEMENT,r._step=o||i,r}ie(t,e);var n=t.prototype;return n.alloc=function(){var e=this._nextBufferIdx++,t=this._nativeBufferAllocator.alloc(e,this._size);return this._buffers.set(e,new this._viewCtor(t)),e|this._poolFlag},n.getBuffer=function(){return null},n.assign=function(e,t,n){var i=this._bufferIdxMask&e,o=this._buffers.get(i);if(o){var r=t+1;if(r>=o.length){for(var a=o.length;r>=a;)a+=this._step;a*=this._viewCtor.BYTES_PER_ELEMENT;var s=new this._viewCtor(this._nativeBufferAllocator.alloc(i,a));s.set(o),o=s,this._buffers.set(i,o)}o[r]=n;var c=o[0];o[0]=r>c?r:c}},n.erase=function(e,t){var n=this._bufferIdxMask&e,i=this._buffers.get(n);if(i&&!(t>=i[0])){for(var o=t+1;o<i[0];++o)i[o]=i[o+1];--i[0]}},n.push=function(e,t){var n=this._bufferIdxMask&e,i=this._buffers.get(n);i&&this.assign(e,i[0],t)},n.pop=function(e){var t=this._bufferIdxMask&e,n=this._buffers.get(t);n&&0!==n[0]&&--n[0]},n.clear=function(e){var t=this._bufferIdxMask&e,n=this._buffers.get(t);n&&(n[0]=0)},n.get=function(e,t){var n=this._bufferIdxMask&e,i=this._buffers.get(n);return!i||t>=i[0]?0:i[t+1]},n.length=function(e){var t=this._bufferIdxMask&e,n=this._buffers.get(t);return n?n[0]:0},t}(bo);function Po(e,t,n,i){void 0===i&&(i=!0);for(var o=t.length(e),r=0;r<o;r++){var a=t.get(e,r);a&&n.free(a)}i?t.free(e):t.clear(e)}!function(e){e[e.ATTRIBUTE=0]="ATTRIBUTE",e[e.DESCRIPTOR_SETS=1]="DESCRIPTOR_SETS",e[e.SHADER=2]="SHADER",e[e.INPUT_ASSEMBLER=3]="INPUT_ASSEMBLER",e[e.PIPELINE_LAYOUT=4]="PIPELINE_LAYOUT",e[e.FRAMEBUFFER=5]="FRAMEBUFFER",e[e.PASS=100]="PASS",e[e.SUB_MODEL=101]="SUB_MODEL",e[e.MODEL=102]="MODEL",e[e.SCENE=103]="SCENE",e[e.CAMERA=104]="CAMERA",e[e.NODE=105]="NODE",e[e.ROOT=106]="ROOT",e[e.AABB=107]="AABB",e[e.RENDER_WINDOW=108]="RENDER_WINDOW",e[e.FRUSTUM=109]="FRUSTUM",e[e.AMBIENT=110]="AMBIENT",e[e.FOG=111]="FOG",e[e.SKYBOX=112]="SKYBOX",e[e.SHADOW=113]="SHADOW",e[e.LIGHT=114]="LIGHT",e[e.SPHERE=115]="SPHERE",e[e.INSTANCED_ATTRIBUTE=116]="INSTANCED_ATTRIBUTE",e[e.FLAT_BUFFER=117]="FLAT_BUFFER",e[e.SUB_MESH=118]="SUB_MESH",e[e.RASTERIZER_STATE=119]="RASTERIZER_STATE",e[e.DEPTH_STENCIL_STATE=120]="DEPTH_STENCIL_STATE",e[e.BLEND_TARGET=121]="BLEND_TARGET",e[e.BLEND_STATE=122]="BLEND_STATE",e[e.BATCH_2D=123]="BATCH_2D",e[e.PIPELINE_SCENE_DATA=124]="PIPELINE_SCENE_DATA",e[e.SUB_MODEL_ARRAY=200]="SUB_MODEL_ARRAY",e[e.MODEL_ARRAY=201]="MODEL_ARRAY",e[e.ATTRIBUTE_ARRAY=202]="ATTRIBUTE_ARRAY",e[e.FLAT_BUFFER_ARRAY=203]="FLAT_BUFFER_ARRAY",e[e.INSTANCED_BUFFER_ARRAY=204]="INSTANCED_BUFFER_ARRAY",e[e.LIGHT_ARRAY=205]="LIGHT_ARRAY",e[e.BLEND_TARGET_ARRAY=206]="BLEND_TARGET_ARRAY",e[e.BATCH_ARRAY_2D=207]="BATCH_ARRAY_2D",e[e.RAW_BUFFER=300]="RAW_BUFFER",e[e.RAW_OBJECT=400]="RAW_OBJECT"}(Ao||(Ao={}));var Ro,No=e("dm",0),Oo=new wo(Ao.SHADER,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createShader(e[1])}),(function(e){return e&&e.destroy(),e})),Do=e("dy",new wo(Ao.DESCRIPTOR_SETS,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createDescriptorSet(e[1])}),(function(e){return e&&e.destroy(),e}))),Mo=e("dl",new wo(Ao.INPUT_ASSEMBLER,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createInputAssembler(e[1])}),(function(e){return e&&e.destroy(),e}))),Lo=new wo(Ao.PIPELINE_LAYOUT,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createPipelineLayout(e[1])}),(function(e){return e&&e.destroy(),e})),Fo=new wo(Ao.FRAMEBUFFER,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createFramebuffer(e[1])}),(function(e){return e&&e.destroy(),e})),zo=new Io(Ao.SUB_MODEL_ARRAY,Uint32Array,8,4),Bo=new Io(Ao.MODEL_ARRAY,Uint32Array,32,16),Uo=new Io(Ao.ATTRIBUTE_ARRAY,Uint32Array,8,4),Ho=new Io(Ao.FLAT_BUFFER_ARRAY,Uint32Array,8,4),Go=new Io(Ao.LIGHT_ARRAY,Uint32Array,8,4),ko=new Io(Ao.BLEND_TARGET_ARRAY,Uint32Array,8,4),Vo=new Io(Ao.BATCH_ARRAY_2D,Uint32Array,32,16),Wo=new bo(Ao.RAW_BUFFER),jo=new wo(Ao.RAW_OBJECT,(function(e){return e[0]||{}}),(function(){}));!function(e){e[e.PRIORITY=0]="PRIORITY",e[e.STAGE=1]="STAGE",e[e.PHASE=2]="PHASE",e[e.BATCHING_SCHEME=3]="BATCHING_SCHEME",e[e.PRIMITIVE=4]="PRIMITIVE",e[e.DYNAMIC_STATES=5]="DYNAMIC_STATES",e[e.HASH=6]="HASH",e[e.RASTERIZER_STATE=7]="RASTERIZER_STATE",e[e.DEPTH_STENCIL_STATE=8]="DEPTH_STENCIL_STATE",e[e.BLEND_STATE=9]="BLEND_STATE",e[e.DESCRIPTOR_SET=10]="DESCRIPTOR_SET",e[e.PIPELINE_LAYOUT=11]="PIPELINE_LAYOUT",e[e.COUNT=12]="COUNT"}(Ro||(Ro={}));var qo,Yo=((Yi={})[Ro.PRIORITY]=go.UINT32,Yi[Ro.STAGE]=go.UINT32,Yi[Ro.PHASE]=go.UINT32,Yi[Ro.BATCHING_SCHEME]=go.UINT32,Yi[Ro.PRIMITIVE]=go.UINT32,Yi[Ro.DYNAMIC_STATES]=go.UINT32,Yi[Ro.HASH]=go.UINT32,Yi[Ro.RASTERIZER_STATE]=go.UINT32,Yi[Ro.DEPTH_STENCIL_STATE]=go.UINT32,Yi[Ro.BLEND_STATE]=go.UINT32,Yi[Ro.DESCRIPTOR_SET]=go.UINT32,Yi[Ro.PIPELINE_LAYOUT]=go.UINT32,Yi[Ro.COUNT]=go.NEVER,Yi),Xo=e("ds",new Co(Ao.PASS,Yo,Ro));!function(e){e[e.PRIORITY=0]="PRIORITY",e[e.PASS_COUNT=1]="PASS_COUNT",e[e.PASS_0=2]="PASS_0",e[e.PASS_1=3]="PASS_1",e[e.PASS_2=4]="PASS_2",e[e.PASS_3=5]="PASS_3",e[e.PASS_4=6]="PASS_4",e[e.PASS_5=7]="PASS_5",e[e.PASS_6=8]="PASS_6",e[e.PASS_7=9]="PASS_7",e[e.SHADER_0=10]="SHADER_0",e[e.SHADER_1=11]="SHADER_1",e[e.SHADER_2=12]="SHADER_2",e[e.SHADER_3=13]="SHADER_3",e[e.SHADER_4=14]="SHADER_4",e[e.SHADER_5=15]="SHADER_5",e[e.SHADER_6=16]="SHADER_6",e[e.SHADER_7=17]="SHADER_7",e[e.PLANAR_SHADER=18]="PLANAR_SHADER",e[e.PLANAR_INSTANCE_SHADER=19]="PLANAR_INSTANCE_SHADER",e[e.DESCRIPTOR_SET=20]="DESCRIPTOR_SET",e[e.INPUT_ASSEMBLER=21]="INPUT_ASSEMBLER",e[e.SUB_MESH=22]="SUB_MESH",e[e.COUNT=23]="COUNT"}(qo||(qo=e("dx",{})));var Ko,Qo=((Xi={})[qo.PRIORITY]=go.UINT32,Xi[qo.PASS_COUNT]=go.UINT32,Xi[qo.PASS_0]=go.UINT32,Xi[qo.PASS_1]=go.UINT32,Xi[qo.PASS_2]=go.UINT32,Xi[qo.PASS_3]=go.UINT32,Xi[qo.PASS_4]=go.UINT32,Xi[qo.PASS_5]=go.UINT32,Xi[qo.PASS_6]=go.UINT32,Xi[qo.PASS_7]=go.UINT32,Xi[qo.SHADER_0]=go.UINT32,Xi[qo.SHADER_1]=go.UINT32,Xi[qo.SHADER_2]=go.UINT32,Xi[qo.SHADER_3]=go.UINT32,Xi[qo.SHADER_4]=go.UINT32,Xi[qo.SHADER_5]=go.UINT32,Xi[qo.SHADER_6]=go.UINT32,Xi[qo.SHADER_7]=go.UINT32,Xi[qo.PLANAR_SHADER]=go.UINT32,Xi[qo.PLANAR_INSTANCE_SHADER]=go.UINT32,Xi[qo.DESCRIPTOR_SET]=go.UINT32,Xi[qo.INPUT_ASSEMBLER]=go.UINT32,Xi[qo.SUB_MESH]=go.UINT32,Xi[qo.COUNT]=go.NEVER,Xi),Zo=e("dw",new Co(Ao.SUB_MODEL,Qo,qo));!function(e){e[e.ENABLED=0]="ENABLED",e[e.VIS_FLAGS=1]="VIS_FLAGS",e[e.CAST_SHADOW=2]="CAST_SHADOW",e[e.RECEIVE_SHADOW=3]="RECEIVE_SHADOW",e[e.WORLD_BOUNDS=4]="WORLD_BOUNDS",e[e.NODE=5]="NODE",e[e.TRANSFORM=6]="TRANSFORM",e[e.SUB_MODEL_ARRAY=7]="SUB_MODEL_ARRAY",e[e.INSTANCED_BUFFER=8]="INSTANCED_BUFFER",e[e.INSTANCED_ATTR_ARRAY=9]="INSTANCED_ATTR_ARRAY",e[e.COUNT=10]="COUNT"}(Ko||(Ko={}));var Jo,$o=((Ki={})[Ko.ENABLED]=go.UINT32,Ki[Ko.VIS_FLAGS]=go.UINT32,Ki[Ko.CAST_SHADOW]=go.UINT32,Ki[Ko.RECEIVE_SHADOW]=go.UINT32,Ki[Ko.WORLD_BOUNDS]=go.UINT32,Ki[Ko.NODE]=go.UINT32,Ki[Ko.TRANSFORM]=go.UINT32,Ki[Ko.SUB_MODEL_ARRAY]=go.UINT32,Ki[Ko.INSTANCED_BUFFER]=go.UINT32,Ki[Ko.INSTANCED_ATTR_ARRAY]=go.UINT32,Ki[Ko.COUNT]=go.NEVER,Ki),er=new Co(Ao.MODEL,$o,Ko);!function(e){e[e.VIS_FLAGS=0]="VIS_FLAGS",e[e.PASS_COUNT=1]="PASS_COUNT",e[e.PASS_0=2]="PASS_0",e[e.PASS_1=3]="PASS_1",e[e.PASS_2=4]="PASS_2",e[e.PASS_3=5]="PASS_3",e[e.SHADER_0=6]="SHADER_0",e[e.SHADER_1=7]="SHADER_1",e[e.SHADER_2=8]="SHADER_2",e[e.SHADER_3=9]="SHADER_3",e[e.DESCRIPTOR_SET=10]="DESCRIPTOR_SET",e[e.INPUT_ASSEMBLER=11]="INPUT_ASSEMBLER",e[e.COUNT=12]="COUNT"}(Jo||(Jo=e("dq",{})));var tr,nr=((Qi={})[Jo.VIS_FLAGS]=go.UINT32,Qi[Jo.PASS_COUNT]=go.UINT32,Qi[Jo.PASS_0]=go.UINT32,Qi[Jo.PASS_1]=go.UINT32,Qi[Jo.PASS_2]=go.UINT32,Qi[Jo.PASS_3]=go.UINT32,Qi[Jo.SHADER_0]=go.UINT32,Qi[Jo.SHADER_1]=go.UINT32,Qi[Jo.SHADER_2]=go.UINT32,Qi[Jo.SHADER_3]=go.UINT32,Qi[Jo.DESCRIPTOR_SET]=go.UINT32,Qi[Jo.INPUT_ASSEMBLER]=go.UINT32,Qi[Jo.COUNT]=go.NEVER,Qi),ir=e("dp",new Co(Ao.BATCH_2D,nr,Jo));!function(e){e[e.CENTER=0]="CENTER",e[e.HALF_EXTENSION=3]="HALF_EXTENSION",e[e.COUNT=6]="COUNT"}(tr||(tr=e("cD",{})));var or,rr=((Zi={})[tr.CENTER]=go.FLOAT32,Zi[tr.HALF_EXTENSION]=go.FLOAT32,Zi[tr.COUNT]=go.NEVER,Zi),ar=e("cC",new Co(Ao.AABB,rr,tr));!function(e){e[e.MAIN_LIGHT=0]="MAIN_LIGHT",e[e.MODEL_ARRAY=1]="MODEL_ARRAY",e[e.SPHERE_LIGHT_ARRAY=2]="SPHERE_LIGHT_ARRAY",e[e.SPOT_LIGHT_ARRAY=3]="SPOT_LIGHT_ARRAY",e[e.BATCH_ARRAY_2D=4]="BATCH_ARRAY_2D",e[e.COUNT=5]="COUNT"}(or||(or={}));var sr,cr=((Ji={})[or.MAIN_LIGHT]=go.UINT32,Ji[or.MODEL_ARRAY]=go.UINT32,Ji[or.SPHERE_LIGHT_ARRAY]=go.UINT32,Ji[or.SPOT_LIGHT_ARRAY]=go.UINT32,Ji[or.BATCH_ARRAY_2D]=go.UINT32,Ji[or.COUNT]=go.NEVER,Ji),lr=new Co(Ao.SCENE,cr,or);!function(e){e[e.WIDTH=0]="WIDTH",e[e.HEIGHT=1]="HEIGHT",e[e.EXPOSURE=2]="EXPOSURE",e[e.CLEAR_FLAGS=3]="CLEAR_FLAGS",e[e.CLEAR_DEPTH=4]="CLEAR_DEPTH",e[e.CLEAR_STENCIL=5]="CLEAR_STENCIL",e[e.VISIBILITY=6]="VISIBILITY",e[e.NODE=7]="NODE",e[e.SCENE=8]="SCENE",e[e.FRUSTUM=9]="FRUSTUM",e[e.WINDOW=10]="WINDOW",e[e.FORWARD=11]="FORWARD",e[e.POSITION=14]="POSITION",e[e.VIEW_PORT=17]="VIEW_PORT",e[e.CLEAR_COLOR=21]="CLEAR_COLOR",e[e.MAT_VIEW=25]="MAT_VIEW",e[e.MAT_VIEW_PROJ=41]="MAT_VIEW_PROJ",e[e.MAT_VIEW_PROJ_INV=57]="MAT_VIEW_PROJ_INV",e[e.MAT_PROJ=73]="MAT_PROJ",e[e.MAT_PROJ_INV=89]="MAT_PROJ_INV",e[e.MAT_VIEW_PROJ_OFFSCREEN=105]="MAT_VIEW_PROJ_OFFSCREEN",e[e.MAT_VIEW_PROJ_INV_OFFSCREEN=121]="MAT_VIEW_PROJ_INV_OFFSCREEN",e[e.MAT_PROJ_OFFSCREEN=137]="MAT_PROJ_OFFSCREEN",e[e.MAT_PROJ_INV_OFFSCREEN=153]="MAT_PROJ_INV_OFFSCREEN",e[e.COUNT=169]="COUNT"}(sr||(sr={}));var ur,hr=(($i={})[sr.WIDTH]=go.UINT32,$i[sr.HEIGHT]=go.UINT32,$i[sr.EXPOSURE]=go.FLOAT32,$i[sr.CLEAR_FLAGS]=go.UINT32,$i[sr.CLEAR_DEPTH]=go.FLOAT32,$i[sr.CLEAR_STENCIL]=go.UINT32,$i[sr.VISIBILITY]=go.UINT32,$i[sr.NODE]=go.UINT32,$i[sr.SCENE]=go.UINT32,$i[sr.FRUSTUM]=go.UINT32,$i[sr.WINDOW]=go.UINT32,$i[sr.FORWARD]=go.FLOAT32,$i[sr.POSITION]=go.FLOAT32,$i[sr.VIEW_PORT]=go.FLOAT32,$i[sr.CLEAR_COLOR]=go.FLOAT32,$i[sr.MAT_VIEW]=go.FLOAT32,$i[sr.MAT_VIEW_PROJ]=go.FLOAT32,$i[sr.MAT_VIEW_PROJ_INV]=go.FLOAT32,$i[sr.MAT_PROJ]=go.FLOAT32,$i[sr.MAT_PROJ_INV]=go.FLOAT32,$i[sr.MAT_VIEW_PROJ_OFFSCREEN]=go.FLOAT32,$i[sr.MAT_VIEW_PROJ_INV_OFFSCREEN]=go.FLOAT32,$i[sr.MAT_PROJ_OFFSCREEN]=go.FLOAT32,$i[sr.MAT_PROJ_INV_OFFSCREEN]=go.FLOAT32,$i[sr.COUNT]=go.NEVER,$i),_r=new Co(Ao.CAMERA,hr,sr);!function(e){e[e.HAS_CHANGED_FLAGS=0]="HAS_CHANGED_FLAGS",e[e.LAYER=1]="LAYER",e[e.WORLD_SCALE=2]="WORLD_SCALE",e[e.WORLD_POSITION=5]="WORLD_POSITION",e[e.WORLD_ROTATION=8]="WORLD_ROTATION",e[e.WORLD_MATRIX=12]="WORLD_MATRIX",e[e.COUNT=28]="COUNT"}(ur||(ur={}));var fr=((eo={})[ur.HAS_CHANGED_FLAGS]=go.UINT32,eo[ur.LAYER]=go.UINT32,eo[ur.WORLD_SCALE]=go.FLOAT32,eo[ur.WORLD_POSITION]=go.FLOAT32,eo[ur.WORLD_ROTATION]=go.FLOAT32,eo[ur.WORLD_MATRIX]=go.FLOAT32,eo[ur.COUNT]=go.NEVER,eo);delete ur[ur.COUNT],ur[ur.COUNT=ur.LAYER+1]="COUNT";var dr,pr=new Co(Ao.NODE,fr,ur);!function(e){e[e.CUMULATIVE_TIME=0]="CUMULATIVE_TIME",e[e.FRAME_TIME=1]="FRAME_TIME",e[e.COUNT=2]="COUNT"}(dr||(dr={}));var mr,vr=((to={})[dr.CUMULATIVE_TIME]=go.FLOAT32,to[dr.FRAME_TIME]=go.FLOAT32,to[dr.COUNT]=go.NEVER,to),gr=new Co(Ao.ROOT,vr,dr,1);!function(e){e[e.HAS_ON_SCREEN_ATTACHMENTS=0]="HAS_ON_SCREEN_ATTACHMENTS",e[e.HAS_OFF_SCREEN_ATTACHMENTS=1]="HAS_OFF_SCREEN_ATTACHMENTS",e[e.FRAMEBUFFER=2]="FRAMEBUFFER",e[e.COUNT=3]="COUNT"}(mr||(mr={}));var yr,xr=((no={})[mr.HAS_ON_SCREEN_ATTACHMENTS]=go.UINT32,no[mr.HAS_OFF_SCREEN_ATTACHMENTS]=go.UINT32,no[mr.FRAMEBUFFER]=go.UINT32,no[mr.COUNT]=go.NEVER,no),Sr=new Co(Ao.RENDER_WINDOW,xr,mr,2);!function(e){e[e.VERTICES=0]="VERTICES",e[e.PLANES=24]="PLANES",e[e.COUNT=48]="COUNT"}(yr||(yr={}));var Er,Tr=((io={})[yr.VERTICES]=go.FLOAT32,io[yr.PLANES]=go.FLOAT32,io[yr.COUNT]=go.NEVER,io),Ar=new Co(Ao.FRUSTUM,Tr,yr);!function(e){e[e.ENABLE=0]="ENABLE",e[e.ILLUM=1]="ILLUM",e[e.SKY_COLOR=2]="SKY_COLOR",e[e.GROUND_ALBEDO=6]="GROUND_ALBEDO",e[e.COUNT=10]="COUNT"}(Er||(Er={}));var Cr=((oo={})[Er.ENABLE]=go.UINT32,oo[Er.ILLUM]=go.FLOAT32,oo[Er.SKY_COLOR]=go.FLOAT32,oo[Er.GROUND_ALBEDO]=go.FLOAT32,oo[Er.COUNT]=go.NEVER,oo);delete Er[Er.COUNT],Er[Er.COUNT=Er.ILLUM+1]="COUNT";var wr,br=new Co(Ao.AMBIENT,Cr,Er,1);!function(e){e[e.ENABLE=0]="ENABLE",e[e.IS_RGBE=1]="IS_RGBE",e[e.USE_IBL=2]="USE_IBL",e[e.MODEL=3]="MODEL",e[e.COUNT=4]="COUNT"}(wr||(wr={}));var Ir,Pr=((ro={})[wr.ENABLE]=go.UINT32,ro[wr.IS_RGBE]=go.UINT32,ro[wr.USE_IBL]=go.UINT32,ro[wr.MODEL]=go.UINT32,ro[wr.COUNT]=go.NEVER,ro),Rr=new Co(Ao.SKYBOX,Pr,wr,1);!function(e){e[e.ENABLE=0]="ENABLE",e[e.TYPE=1]="TYPE",e[e.DENSITY=2]="DENSITY",e[e.START=3]="START",e[e.END=4]="END",e[e.ATTEN=5]="ATTEN",e[e.TOP=6]="TOP",e[e.RANGE=7]="RANGE",e[e.COLOR=8]="COLOR",e[e.COUNT=12]="COUNT"}(Ir||(Ir={}));var Nr=((ao={})[Ir.ENABLE]=go.UINT32,ao[Ir.TYPE]=go.UINT32,ao[Ir.DENSITY]=go.FLOAT32,ao[Ir.START]=go.FLOAT32,ao[Ir.END]=go.FLOAT32,ao[Ir.ATTEN]=go.FLOAT32,ao[Ir.TOP]=go.FLOAT32,ao[Ir.RANGE]=go.FLOAT32,ao[Ir.COLOR]=go.FLOAT32,ao[Ir.COUNT]=go.NEVER,ao);delete Ir[Ir.COUNT],Ir[Ir.COUNT=Ir.RANGE+1]="COUNT";var Or,Dr=new Co(Ao.FOG,Nr,Ir);!function(e){e[e.ENABLE=0]="ENABLE",e[e.DIRTY=1]="DIRTY",e[e.TYPE=2]="TYPE",e[e.DISTANCE=3]="DISTANCE",e[e.INSTANCE_PASS=4]="INSTANCE_PASS",e[e.PLANAR_PASS=5]="PLANAR_PASS",e[e.NEAR=6]="NEAR",e[e.FAR=7]="FAR",e[e.ASPECT=8]="ASPECT",e[e.PCF_TYPE=9]="PCF_TYPE",e[e.SHADOW_MAP_DIRTY=10]="SHADOW_MAP_DIRTY",e[e.BIAS=11]="BIAS",e[e.PACKING=12]="PACKING",e[e.LINEAR=13]="LINEAR",e[e.SELF_SHADOW=14]="SELF_SHADOW",e[e.NORMAL_BIAS=15]="NORMAL_BIAS",e[e.ORTHO_SIZE=16]="ORTHO_SIZE",e[e.AUTO_ADAPT=17]="AUTO_ADAPT",e[e.COLOR=18]="COLOR",e[e.SIZE=22]="SIZE",e[e.NORMAL=24]="NORMAL",e[e.MAT_LIGHT=27]="MAT_LIGHT",e[e.COUNT=43]="COUNT"}(Or||(Or={}));var Mr=((so={})[Or.ENABLE]=go.UINT32,so[Or.DIRTY]=go.UINT32,so[Or.TYPE]=go.UINT32,so[Or.DISTANCE]=go.FLOAT32,so[Or.INSTANCE_PASS]=go.UINT32,so[Or.PLANAR_PASS]=go.UINT32,so[Or.NEAR]=go.FLOAT32,so[Or.FAR]=go.FLOAT32,so[Or.ASPECT]=go.FLOAT32,so[Or.PCF_TYPE]=go.UINT32,so[Or.SHADOW_MAP_DIRTY]=go.UINT32,so[Or.BIAS]=go.FLOAT32,so[Or.PACKING]=go.UINT32,so[Or.LINEAR]=go.UINT32,so[Or.SELF_SHADOW]=go.UINT32,so[Or.NORMAL_BIAS]=go.FLOAT32,so[Or.ORTHO_SIZE]=go.FLOAT32,so[Or.AUTO_ADAPT]=go.UINT32,so[Or.COLOR]=go.FLOAT32,so[Or.SIZE]=go.FLOAT32,so[Or.NORMAL]=go.FLOAT32,so[Or.MAT_LIGHT]=go.FLOAT32,so[Or.COUNT]=go.NEVER,so);delete Or[Or.COUNT],Or[Or.COUNT=Or.AUTO_ADAPT+1]="COUNT";var Lr,Fr=new Co(Ao.SHADOW,Mr,Or,1);!function(e){e[e.SHADOW=0]="SHADOW",e[e.SKYBOX=1]="SKYBOX",e[e.AMBIENT=2]="AMBIENT",e[e.FOG=3]="FOG",e[e.IS_HDR=4]="IS_HDR",e[e.SHADING_SCALE=5]="SHADING_SCALE",e[e.FP_SCALE=6]="FP_SCALE",e[e.DEFERRED_LIGHT_PASS=7]="DEFERRED_LIGHT_PASS",e[e.DEFERRED_LIGHT_PASS_SHADER=8]="DEFERRED_LIGHT_PASS_SHADER",e[e.DEFERRED_POST_PASS=9]="DEFERRED_POST_PASS",e[e.DEFERRED_POST_PASS_SHADER=10]="DEFERRED_POST_PASS_SHADER",e[e.COUNT=11]="COUNT"}(Lr||(Lr={}));var zr,Br=((co={})[Lr.SHADOW]=go.UINT32,co[Lr.SKYBOX]=go.UINT32,co[Lr.AMBIENT]=go.UINT32,co[Lr.FOG]=go.UINT32,co[Lr.IS_HDR]=go.UINT32,co[Lr.SHADING_SCALE]=go.UINT32,co[Lr.FP_SCALE]=go.UINT32,co[Lr.DEFERRED_LIGHT_PASS]=go.UINT32,co[Lr.DEFERRED_LIGHT_PASS_SHADER]=go.UINT32,co[Lr.DEFERRED_POST_PASS]=go.UINT32,co[Lr.DEFERRED_POST_PASS_SHADER]=go.UINT32,co[Lr.COUNT]=go.NEVER,co),Ur=new Co(Ao.PIPELINE_SCENE_DATA,Br,Lr,1);!function(e){e[e.USE_COLOR_TEMPERATURE=0]="USE_COLOR_TEMPERATURE",e[e.ILLUMINANCE=1]="ILLUMINANCE",e[e.NODE=2]="NODE",e[e.RANGE=3]="RANGE",e[e.TYPE=4]="TYPE",e[e.AABB=5]="AABB",e[e.FRUSTUM=6]="FRUSTUM",e[e.SIZE=7]="SIZE",e[e.SPOT_ANGLE=8]="SPOT_ANGLE",e[e.ASPECT=9]="ASPECT",e[e.DIRECTION=10]="DIRECTION",e[e.COLOR=13]="COLOR",e[e.COLOR_TEMPERATURE_RGB=16]="COLOR_TEMPERATURE_RGB",e[e.POSITION=19]="POSITION",e[e.COUNT=22]="COUNT"}(zr||(zr={}));var Hr,Gr=((lo={})[zr.USE_COLOR_TEMPERATURE]=go.UINT32,lo[zr.ILLUMINANCE]=go.FLOAT32,lo[zr.NODE]=go.UINT32,lo[zr.RANGE]=go.FLOAT32,lo[zr.TYPE]=go.UINT32,lo[zr.AABB]=go.UINT32,lo[zr.FRUSTUM]=go.UINT32,lo[zr.SIZE]=go.FLOAT32,lo[zr.SPOT_ANGLE]=go.FLOAT32,lo[zr.ASPECT]=go.FLOAT32,lo[zr.DIRECTION]=go.FLOAT32,lo[zr.COLOR]=go.FLOAT32,lo[zr.COLOR_TEMPERATURE_RGB]=go.FLOAT32,lo[zr.POSITION]=go.FLOAT32,lo[zr.COUNT]=go.NEVER,lo),kr=new Co(Ao.LIGHT,Gr,zr,3);!function(e){e[e.RADIUS=0]="RADIUS",e[e.CENTER=1]="CENTER",e[e.COUNT=4]="COUNT"}(Hr||(Hr={}));var Vr=((uo={})[Hr.RADIUS]=go.FLOAT32,uo[Hr.CENTER]=go.FLOAT32,uo[Hr.COUNT]=go.NEVER,uo);delete Hr[Hr.COUNT],Hr[Hr.COUNT=Hr.RADIUS+1]="COUNT";var Wr,jr=new Co(Ao.SPHERE,Vr,Hr,3);!function(e){e[e.STRIDE=0]="STRIDE",e[e.AMOUNT=1]="AMOUNT",e[e.BUFFER=2]="BUFFER",e[e.COUNT=3]="COUNT"}(Wr||(Wr={}));var qr,Yr=((ho={})[Wr.STRIDE]=go.UINT32,ho[Wr.AMOUNT]=go.UINT32,ho[Wr.BUFFER]=go.UINT32,ho[Wr.COUNT]=go.NEVER,ho),Xr=new Co(Ao.FLAT_BUFFER,Yr,Wr,3);!function(e){e[e.FLAT_BUFFER_ARRAY=0]="FLAT_BUFFER_ARRAY",e[e.COUNT=1]="COUNT"}(qr||(qr={}));var Kr,Qr=((_o={})[qr.FLAT_BUFFER_ARRAY]=go.UINT32,_o[qr.COUNT]=go.NEVER,_o),Zr=new Co(Ao.SUB_MESH,Qr,qr,3);!function(e){e[e.IS_DISCARD=0]="IS_DISCARD",e[e.POLYGO_MODEL=1]="POLYGO_MODEL",e[e.SHADE_MODEL=2]="SHADE_MODEL",e[e.CULL_MODE=3]="CULL_MODE",e[e.IS_FRONT_FACE_CCW=4]="IS_FRONT_FACE_CCW",e[e.DEPTH_BIAS_ENABLED=5]="DEPTH_BIAS_ENABLED",e[e.DEPTH_BIAS=6]="DEPTH_BIAS",e[e.DEPTH_BIAS_CLAMP=7]="DEPTH_BIAS_CLAMP",e[e.DEPTH_BIAS_SLOP=8]="DEPTH_BIAS_SLOP",e[e.IS_DEPTH_CLIP=9]="IS_DEPTH_CLIP",e[e.IS_MULTI_SAMPLE=10]="IS_MULTI_SAMPLE",e[e.LINE_WIDTH=11]="LINE_WIDTH",e[e.COUNT=12]="COUNT"}(Kr||(Kr={}));var Jr,$r=((fo={})[Kr.IS_DISCARD]=go.UINT32,fo[Kr.POLYGO_MODEL]=go.UINT32,fo[Kr.SHADE_MODEL]=go.UINT32,fo[Kr.CULL_MODE]=go.UINT32,fo[Kr.IS_FRONT_FACE_CCW]=go.UINT32,fo[Kr.DEPTH_BIAS_ENABLED]=go.UINT32,fo[Kr.DEPTH_BIAS]=go.FLOAT32,fo[Kr.DEPTH_BIAS_CLAMP]=go.FLOAT32,fo[Kr.DEPTH_BIAS_SLOP]=go.FLOAT32,fo[Kr.IS_DEPTH_CLIP]=go.UINT32,fo[Kr.IS_MULTI_SAMPLE]=go.UINT32,fo[Kr.LINE_WIDTH]=go.FLOAT32,fo[Kr.COUNT]=go.NEVER,fo),ea=new Co(Ao.RASTERIZER_STATE,$r,Kr,9);!function(e){e[e.DEPTH_TEST=0]="DEPTH_TEST",e[e.DEPTH_WRITE=1]="DEPTH_WRITE",e[e.DEPTH_FUNC=2]="DEPTH_FUNC",e[e.STENCIL_TEST_FRONT=3]="STENCIL_TEST_FRONT",e[e.STENCIL_FUNC_FRONT=4]="STENCIL_FUNC_FRONT",e[e.STENCIL_READ_MASK_FRONT=5]="STENCIL_READ_MASK_FRONT",e[e.STENCIL_WRITE_MASK_FRONT=6]="STENCIL_WRITE_MASK_FRONT",e[e.STENCIL_FAIL_OP_FRONT=7]="STENCIL_FAIL_OP_FRONT",e[e.STENCIL_Z_FAIL_OP_FRONT=8]="STENCIL_Z_FAIL_OP_FRONT",e[e.STENCIL_PASS_OP_FRONT=9]="STENCIL_PASS_OP_FRONT",e[e.STENCIL_REF_FRONT=10]="STENCIL_REF_FRONT",e[e.STENCIL_TEST_BACK=11]="STENCIL_TEST_BACK",e[e.STENCIL_FUNC_BACK=12]="STENCIL_FUNC_BACK",e[e.STENCIL_READ_MADK_BACK=13]="STENCIL_READ_MADK_BACK",e[e.STENCIL_WRITE_MASK_BACK=14]="STENCIL_WRITE_MASK_BACK",e[e.STENCIL_FAIL_OP_BACK=15]="STENCIL_FAIL_OP_BACK",e[e.STENCIL_Z_FAIL_OP_BACK=16]="STENCIL_Z_FAIL_OP_BACK",e[e.STENCIL_PASS_OP_BACK=17]="STENCIL_PASS_OP_BACK",e[e.STENCIL_REF_BACK=18]="STENCIL_REF_BACK",e[e.COUNT=19]="COUNT"}(Jr||(Jr={}));var ta,na=((po={})[Jr.DEPTH_TEST]=go.UINT32,po[Jr.DEPTH_WRITE]=go.UINT32,po[Jr.DEPTH_FUNC]=go.UINT32,po[Jr.STENCIL_TEST_FRONT]=go.UINT32,po[Jr.STENCIL_FUNC_FRONT]=go.UINT32,po[Jr.STENCIL_READ_MASK_FRONT]=go.UINT32,po[Jr.STENCIL_WRITE_MASK_FRONT]=go.UINT32,po[Jr.STENCIL_FAIL_OP_FRONT]=go.UINT32,po[Jr.STENCIL_Z_FAIL_OP_FRONT]=go.UINT32,po[Jr.STENCIL_PASS_OP_FRONT]=go.UINT32,po[Jr.STENCIL_REF_FRONT]=go.UINT32,po[Jr.STENCIL_TEST_BACK]=go.UINT32,po[Jr.STENCIL_FUNC_BACK]=go.UINT32,po[Jr.STENCIL_READ_MADK_BACK]=go.UINT32,po[Jr.STENCIL_WRITE_MASK_BACK]=go.UINT32,po[Jr.STENCIL_FAIL_OP_BACK]=go.UINT32,po[Jr.STENCIL_Z_FAIL_OP_BACK]=go.UINT32,po[Jr.STENCIL_PASS_OP_BACK]=go.UINT32,po[Jr.STENCIL_REF_BACK]=go.UINT32,po[Jr.COUNT]=go.NEVER,po),ia=new Co(Ao.DEPTH_STENCIL_STATE,na,Jr,9);!function(e){e[e.BLEND=0]="BLEND",e[e.BLEND_SRC=1]="BLEND_SRC",e[e.BLEND_DST=2]="BLEND_DST",e[e.BLEND_EQ=3]="BLEND_EQ",e[e.BLEND_SRC_ALPHA=4]="BLEND_SRC_ALPHA",e[e.BLEND_DST_ALPHA=5]="BLEND_DST_ALPHA",e[e.BLEND_ALPHA_EQ=6]="BLEND_ALPHA_EQ",e[e.BLEND_COLOR_MASK=7]="BLEND_COLOR_MASK",e[e.COUNT=8]="COUNT"}(ta||(ta={})),(mo={})[ta.BLEND]=go.UINT32,mo[ta.BLEND_SRC]=go.UINT32,mo[ta.BLEND_DST]=go.UINT32,mo[ta.BLEND_EQ]=go.UINT32,mo[ta.BLEND_SRC_ALPHA]=go.UINT32,mo[ta.BLEND_DST_ALPHA]=go.UINT32,mo[ta.BLEND_ALPHA_EQ]=go.UINT32,mo[ta.BLEND_COLOR_MASK]=go.UINT32,mo[ta.COUNT]=go.NEVER;var oa,ra=new Co(Ao.BLEND_TARGET,na,ta,9);!function(e){e[e.IS_A2C=0]="IS_A2C",e[e.IS_INDEPEND=1]="IS_INDEPEND",e[e.BLEND_COLOR=2]="BLEND_COLOR",e[e.BLEND_TARGET=6]="BLEND_TARGET",e[e.COUNT=7]="COUNT"}(oa||(oa={}));var aa=((vo={})[oa.IS_A2C]=go.UINT32,vo[oa.IS_INDEPEND]=go.UINT32,vo[oa.BLEND_COLOR]=go.FLOAT32,vo[oa.BLEND_TARGET]=go.UINT32,vo[oa.COUNT]=go.NEVER,vo),sa=new Co(Ao.BLEND_STATE,aa,oa,9),ca=function(){function e(){this._skyColor=new In(51,128,204,1),this._groundAlbedo=new In(51,51,51,255),this._albedoArray=Float32Array.from([.2,.2,.2,1]),this._colorArray=Float32Array.from([.2,.5,.8,1]),this._handle=No,this._handle=br.alloc()}var t=e.prototype;return t.initialize=function(e){this._skyColor.set(e.skyColor),this._groundAlbedo.set(e.groundAlbedo),In.toArray(this._colorArray,this._skyColor),Rn.toArray(this._albedoArray,this._groundAlbedo),br.setVec4(this._handle,Er.SKY_COLOR,this._skyColor),br.setVec4(this._handle,Er.GROUND_ALBEDO,this._groundAlbedo),br.set(this._handle,Er.ILLUM,e.skyIllum)},t.destroy=function(){this._handle&&(br.free(this._handle),this._handle=No)},te(e,[{key:"colorArray",get:function(){return this._colorArray}},{key:"albedoArray",get:function(){return this._albedoArray}},{key:"enabled",get:function(){return br.get(this._handle,Er.ENABLE)},set:function(e){br.set(this._handle,Er.ENABLE,e?1:0)}},{key:"skyColor",get:function(){return this._skyColor},set:function(e){this._skyColor.set(e),In.toArray(this._colorArray,this._skyColor),br.setVec4(this._handle,Er.SKY_COLOR,this._skyColor)}},{key:"skyIllum",get:function(){return br.get(this._handle,Er.ILLUM)},set:function(e){br.set(this._handle,Er.ILLUM,e)}},{key:"groundAlbedo",get:function(){return this._groundAlbedo},set:function(e){this._groundAlbedo.set(e),Rn.toArray(this._albedoArray,this._groundAlbedo),br.setVec4(this._handle,Er.GROUND_ALBEDO,this._groundAlbedo)}},{key:"handle",get:function(){return this._handle}}]),e}();ca.SUN_ILLUM=65e3,ca.SKY_ILLUM=2e4,c.Ambient=ca;var la=new Rn,ua=new Rn,ha=new Rn,_a=new Rn,fa=new Rn,da=new Rn,pa=new Array(3),ma=new Array(3);function va(e,t){return Rn.dot(t.n,e)-t.d}function ga(e,t,n){return Rn.copy(e,t),Rn.subtract(fa,n.center,n.halfExtents),Rn.add(da,n.center,n.halfExtents),e.x=e.x<fa.x?fa.x:e.x,e.y=e.y<fa.y?fa.y:e.y,e.z=e.z<fa.z?fa.z:e.z,e.x=e.x>da.x?da.x:e.x,e.y=e.y>da.y?da.y:e.y,e.z=e.z>da.z?da.z:e.z,e}function ya(e,t,n){Rn.set(la,n.orientation.m00,n.orientation.m01,n.orientation.m02),Rn.set(ua,n.orientation.m03,n.orientation.m04,n.orientation.m05),Rn.set(ha,n.orientation.m06,n.orientation.m07,n.orientation.m08),pa[0]=la,pa[1]=ua,pa[2]=ha,ma[0]=n.halfExtents.x,ma[1]=n.halfExtents.y,ma[2]=n.halfExtents.z,Rn.subtract(_a,t,n.center),Rn.set(e,n.center.x,n.center.y,n.center.z);for(var i=0;i<3;i++){var o=Rn.dot(_a,pa[i]);o>ma[i]&&(o=ma[i]),o<-ma[i]&&(o=-ma[i]),e.x+=o*pa[i].x,e.y+=o*pa[i].y,e.z+=o*pa[i].z}return e}var xa=Object.freeze({__proto__:null,point_plane:va,pt_point_plane:function(e,t,n){var i=va(t,n);return Rn.subtract(e,t,Rn.multiplyScalar(e,n.n,i))},pt_point_aabb:ga,pt_point_obb:ya,pt_point_line:function(e,t,n,i){Rn.subtract(la,n,i);var o=la,r=Rn.lengthSqr(o);if(0==r)Rn.copy(e,n);else{Rn.subtract(la,t,n);var a=Rn.dot(la,o)/r;a<0?Rn.copy(e,n):a>1?Rn.copy(e,i):Rn.scaleAndAdd(e,n,o,a)}}}),Sa={SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256,SHAPE_CAPSULE:512},Ea=function(){function e(e,t,n,i,o,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===r&&(r=-1),this.s=void 0,this.e=void 0,this._type=void 0,this._type=Sa.SHAPE_LINE,this.s=new Rn(e,t,n),this.e=new Rn(i,o,r)}return e.create=function(t,n,i,o,r,a){return new e(t,n,i,o,r,a)},e.clone=function(t){return new e(t.s.x,t.s.y,t.s.z,t.e.x,t.e.y,t.e.z)},e.copy=function(e,t){return Rn.copy(e.s,t.s),Rn.copy(e.e,t.e),e},e.fromPoints=function(e,t,n){return Rn.copy(e.s,t),Rn.copy(e.e,n),e},e.set=function(e,t,n,i,o,r,a){return e.s.x=t,e.s.y=n,e.s.z=i,e.e.x=o,e.e.y=r,e.e.z=a,e},e.len=function(e){return Rn.distance(e.s,e.e)},e.prototype.length=function(){return Rn.distance(this.s,this.e)},te(e,[{key:"type",get:function(){return this._type}}]),e}(),Ta=function(){function e(e,t,n,i,o,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===r&&(r=-1),this.o=void 0,this.d=void 0,this._type=void 0,this._type=Sa.SHAPE_RAY,this.o=new Rn(e,t,n),this.d=new Rn(i,o,r)}return e.create=function(t,n,i,o,r,a){return void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===r&&(r=0),void 0===a&&(a=1),new e(t,n,i,o,r,a)},e.clone=function(t){return new e(t.o.x,t.o.y,t.o.z,t.d.x,t.d.y,t.d.z)},e.copy=function(e,t){return Rn.copy(e.o,t.o),Rn.copy(e.d,t.d),e},e.fromPoints=function(e,t,n){return Rn.copy(e.o,t),Rn.normalize(e.d,Rn.subtract(e.d,n,t)),e},e.set=function(e,t,n,i,o,r,a){return e.o.x=t,e.o.y=n,e.o.z=i,e.d.x=o,e.d.y=r,e.d.z=a,e},e.prototype.computeHit=function(e,t){Rn.normalize(e,this.d),Rn.scaleAndAdd(e,this.o,e,t)},te(e,[{key:"type",get:function(){return this._type}}]),e}(),Aa=new Rn,Ca=new Rn,wa=new Rn,ba=new Rn;function Ia(e){return Math.max(Math.max(e.x,e.y),e.z)}var Pa,Ra,Na,Oa,Da,Ma,La,Fa,za,Ba,Ua,Ha,Ga,ka,Va,Wa,ja,qa,Ya,Xa,Ka,Qa,Za,Ja,$a,es,ts,ns,is,os,rs,as,ss,cs,ls,us,hs,_s,fs=e("ea",function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),this._center=new Rn(0,0,0),this._poolHandle=No,this._type=void 0,this._type=Sa.SHAPE_SPHERE,this._center=new Rn(e,t,n),this._poolHandle=jr.alloc(),jr.setVec3(this._poolHandle,Hr.CENTER,this._center),jr.set(this._poolHandle,Hr.RADIUS,i)}e.create=function(t,n,i,o){return new e(t,n,i,o)},e.clone=function(t){return new e(t.center.x,t.center.y,t.center.z,t.radius)},e.copy=function(e,t){return Rn.copy(e.center,t.center),e.radius=t.radius,e},e.fromPoints=function(e,t,n){return Rn.multiplyScalar(e.center,Rn.add(Aa,t,n),.5),e.radius=.5*Rn.subtract(Aa,n,t).length(),e},e.set=function(e,t,n,i,o){return e.center.x=t,e.center.y=n,e.center.z=i,e.radius=o,e},e.mergePoint=function(e,t,n){if(t.radius<0)return e.center.set(n),e.radius=0,e;Rn.subtract(Ca,n,t.center);var i=Ca.length();if(i>t.radius){var o=.5*(i-t.radius);e.radius+=o,Rn.multiplyScalar(Ca,Ca,o/i),Rn.add(e.center,e.center,Ca)}return e},e.mergeAABB=function(t,n,i){return i.getBoundary(wa,ba),e.mergePoint(t,n,wa),e.mergePoint(t,n,ba),t};var t=e.prototype;return t.destroy=function(){this._poolHandle&&(jr.free(this._poolHandle),this._poolHandle=No)},t.clone=function(){return e.clone(this)},t.copy=function(t){return e.copy(this,t)},t.getBoundary=function(e,t){Rn.set(e,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius),Rn.set(t,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius)},t.transform=function(e,t,n,i,o){Rn.transformMat4(o.center,this.center,e),o.radius=this.radius*Ia(i)},t.translateAndRotate=function(e,t,n){Rn.transformMat4(n.center,this.center,e)},t.setScale=function(e,t){t.radius=this.radius*Ia(e)},te(e,[{key:"center",get:function(){return this._center},set:function(e){this._center=e,jr.setVec3(this._poolHandle,Hr.CENTER,this._center)}},{key:"radius",get:function(){return jr.get(this._poolHandle,Hr.RADIUS)},set:function(e){jr.set(this._poolHandle,Hr.RADIUS,e)}},{key:"handle",get:function(){return this._poolHandle}},{key:"type",get:function(){return this._type}}]),e}()),ds=function(){function e(e,t,n,i,o,r,a,s,c){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===o&&(o=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===s&&(s=1),void 0===c&&(c=0),this.a=void 0,this.b=void 0,this.c=void 0,this._type=void 0,this._type=Sa.SHAPE_TRIANGLE,this.a=new Rn(e,t,n),this.b=new Rn(i,o,r),this.c=new Rn(a,s,c)}return e.create=function(t,n,i,o,r,a,s,c,l){return void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=1),new e(t,n,i,o,r,a,s,c,l)},e.clone=function(t){return new e(t.a.x,t.a.y,t.a.z,t.b.x,t.b.y,t.b.z,t.c.x,t.c.y,t.c.z)},e.copy=function(e,t){return Rn.copy(e.a,t.a),Rn.copy(e.b,t.b),Rn.copy(e.c,t.c),e},e.fromPoints=function(e,t,n,i){return Rn.copy(e.a,t),Rn.copy(e.b,n),Rn.copy(e.c,i),e},e.set=function(e,t,n,i,o,r,a,s,c,l){return e.a.x=t,e.a.y=n,e.a.z=i,e.b.x=o,e.b.y=r,e.b.z=a,e.c.x=s,e.c.y=c,e.c.z=l,e},te(e,[{key:"type",get:function(){return this._type}}]),e}(),ps=function(e,t,n){for(var i=0;i<t.length;++i)e.length<=i&&e.push(new n),e[i].copy(t[i]);e.length=t.length};!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.BUFFER=1]="BUFFER",e[e.TEXTURE=2]="TEXTURE",e[e.RENDER_PASS=3]="RENDER_PASS",e[e.FRAMEBUFFER=4]="FRAMEBUFFER",e[e.SAMPLER=5]="SAMPLER",e[e.SHADER=6]="SHADER",e[e.DESCRIPTOR_SET_LAYOUT=7]="DESCRIPTOR_SET_LAYOUT",e[e.PIPELINE_LAYOUT=8]="PIPELINE_LAYOUT",e[e.PIPELINE_STATE=9]="PIPELINE_STATE",e[e.DESCRIPTOR_SET=10]="DESCRIPTOR_SET",e[e.INPUT_ASSEMBLER=11]="INPUT_ASSEMBLER",e[e.COMMAND_BUFFER=12]="COMMAND_BUFFER",e[e.QUEUE=13]="QUEUE",e[e.GLOBAL_BARRIER=14]="GLOBAL_BARRIER",e[e.TEXTURE_BARRIER=15]="TEXTURE_BARRIER",e[e.BUFFER_BARRIER=16]="BUFFER_BARRIER"}(Pa||(Pa=e("O",{}))),function(e){e[e.UNREADY=0]="UNREADY",e[e.FAILED=1]="FAILED",e[e.SUCCESS=2]="SUCCESS"}(Ra||(Ra=e("S",{}))),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.GLES2=1]="GLES2",e[e.GLES3=2]="GLES3",e[e.METAL=3]="METAL",e[e.VULKAN=4]="VULKAN",e[e.WEBGL=5]="WEBGL",e[e.WEBGL2=6]="WEBGL2",e[e.WEBGPU=7]="WEBGPU"}(Na||(Na=e("A",{}))),function(e){e[e.IDENTITY=0]="IDENTITY",e[e.ROTATE_90=1]="ROTATE_90",e[e.ROTATE_180=2]="ROTATE_180",e[e.ROTATE_270=3]="ROTATE_270"}(Oa||(Oa=e("b",{}))),function(e){e[e.COLOR_FLOAT=0]="COLOR_FLOAT",e[e.COLOR_HALF_FLOAT=1]="COLOR_HALF_FLOAT",e[e.TEXTURE_FLOAT=2]="TEXTURE_FLOAT",e[e.TEXTURE_HALF_FLOAT=3]="TEXTURE_HALF_FLOAT",e[e.TEXTURE_FLOAT_LINEAR=4]="TEXTURE_FLOAT_LINEAR",e[e.TEXTURE_HALF_FLOAT_LINEAR=5]="TEXTURE_HALF_FLOAT_LINEAR",e[e.FORMAT_R11G11B10F=6]="FORMAT_R11G11B10F",e[e.FORMAT_D16=7]="FORMAT_D16",e[e.FORMAT_D16S8=8]="FORMAT_D16S8",e[e.FORMAT_D24=9]="FORMAT_D24",e[e.FORMAT_D24S8=10]="FORMAT_D24S8",e[e.FORMAT_D32F=11]="FORMAT_D32F",e[e.FORMAT_D32FS8=12]="FORMAT_D32FS8",e[e.FORMAT_ETC1=13]="FORMAT_ETC1",e[e.FORMAT_ETC2=14]="FORMAT_ETC2",e[e.FORMAT_DXT=15]="FORMAT_DXT",e[e.FORMAT_PVRTC=16]="FORMAT_PVRTC",e[e.FORMAT_ASTC=17]="FORMAT_ASTC",e[e.FORMAT_RGB8=18]="FORMAT_RGB8",e[e.MSAA=19]="MSAA",e[e.ELEMENT_INDEX_UINT=20]="ELEMENT_INDEX_UINT",e[e.INSTANCED_ARRAYS=21]="INSTANCED_ARRAYS",e[e.MULTIPLE_RENDER_TARGETS=22]="MULTIPLE_RENDER_TARGETS",e[e.BLEND_MINMAX=23]="BLEND_MINMAX",e[e.DEPTH_BOUNDS=24]="DEPTH_BOUNDS",e[e.LINE_WIDTH=25]="LINE_WIDTH",e[e.STENCIL_WRITE_MASK=26]="STENCIL_WRITE_MASK",e[e.STENCIL_COMPARE_MASK=27]="STENCIL_COMPARE_MASK",e[e.MULTITHREADED_SUBMISSION=28]="MULTITHREADED_SUBMISSION",e[e.COMPUTE_SHADER=29]="COMPUTE_SHADER",e[e.COUNT=30]="COUNT"}(Da||(Da=e("F",{}))),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.A8=1]="A8",e[e.L8=2]="L8",e[e.LA8=3]="LA8",e[e.R8=4]="R8",e[e.R8SN=5]="R8SN",e[e.R8UI=6]="R8UI",e[e.R8I=7]="R8I",e[e.R16F=8]="R16F",e[e.R16UI=9]="R16UI",e[e.R16I=10]="R16I",e[e.R32F=11]="R32F",e[e.R32UI=12]="R32UI",e[e.R32I=13]="R32I",e[e.RG8=14]="RG8",e[e.RG8SN=15]="RG8SN",e[e.RG8UI=16]="RG8UI",e[e.RG8I=17]="RG8I",e[e.RG16F=18]="RG16F",e[e.RG16UI=19]="RG16UI",e[e.RG16I=20]="RG16I",e[e.RG32F=21]="RG32F",e[e.RG32UI=22]="RG32UI",e[e.RG32I=23]="RG32I",e[e.RGB8=24]="RGB8",e[e.SRGB8=25]="SRGB8",e[e.RGB8SN=26]="RGB8SN",e[e.RGB8UI=27]="RGB8UI",e[e.RGB8I=28]="RGB8I",e[e.RGB16F=29]="RGB16F",e[e.RGB16UI=30]="RGB16UI",e[e.RGB16I=31]="RGB16I",e[e.RGB32F=32]="RGB32F",e[e.RGB32UI=33]="RGB32UI",e[e.RGB32I=34]="RGB32I",e[e.RGBA8=35]="RGBA8",e[e.BGRA8=36]="BGRA8",e[e.SRGB8_A8=37]="SRGB8_A8",e[e.RGBA8SN=38]="RGBA8SN",e[e.RGBA8UI=39]="RGBA8UI",e[e.RGBA8I=40]="RGBA8I",e[e.RGBA16F=41]="RGBA16F",e[e.RGBA16UI=42]="RGBA16UI",e[e.RGBA16I=43]="RGBA16I",e[e.RGBA32F=44]="RGBA32F",e[e.RGBA32UI=45]="RGBA32UI",e[e.RGBA32I=46]="RGBA32I",e[e.R5G6B5=47]="R5G6B5",e[e.R11G11B10F=48]="R11G11B10F",e[e.RGB5A1=49]="RGB5A1",e[e.RGBA4=50]="RGBA4",e[e.RGB10A2=51]="RGB10A2",e[e.RGB10A2UI=52]="RGB10A2UI",e[e.RGB9E5=53]="RGB9E5",e[e.D16=54]="D16",e[e.D16S8=55]="D16S8",e[e.D24=56]="D24",e[e.D24S8=57]="D24S8",e[e.D32F=58]="D32F",e[e.D32F_S8=59]="D32F_S8",e[e.BC1=60]="BC1",e[e.BC1_ALPHA=61]="BC1_ALPHA",e[e.BC1_SRGB=62]="BC1_SRGB",e[e.BC1_SRGB_ALPHA=63]="BC1_SRGB_ALPHA",e[e.BC2=64]="BC2",e[e.BC2_SRGB=65]="BC2_SRGB",e[e.BC3=66]="BC3",e[e.BC3_SRGB=67]="BC3_SRGB",e[e.BC4=68]="BC4",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5=70]="BC5",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.BC6H_UF16=72]="BC6H_UF16",e[e.BC6H_SF16=73]="BC6H_SF16",e[e.BC7=74]="BC7",e[e.BC7_SRGB=75]="BC7_SRGB",e[e.ETC_RGB8=76]="ETC_RGB8",e[e.ETC2_RGB8=77]="ETC2_RGB8",e[e.ETC2_SRGB8=78]="ETC2_SRGB8",e[e.ETC2_RGB8_A1=79]="ETC2_RGB8_A1",e[e.ETC2_SRGB8_A1=80]="ETC2_SRGB8_A1",e[e.ETC2_RGBA8=81]="ETC2_RGBA8",e[e.ETC2_SRGB8_A8=82]="ETC2_SRGB8_A8",e[e.EAC_R11=83]="EAC_R11",e[e.EAC_R11SN=84]="EAC_R11SN",e[e.EAC_RG11=85]="EAC_RG11",e[e.EAC_RG11SN=86]="EAC_RG11SN",e[e.PVRTC_RGB2=87]="PVRTC_RGB2",e[e.PVRTC_RGBA2=88]="PVRTC_RGBA2",e[e.PVRTC_RGB4=89]="PVRTC_RGB4",e[e.PVRTC_RGBA4=90]="PVRTC_RGBA4",e[e.PVRTC2_2BPP=91]="PVRTC2_2BPP",e[e.PVRTC2_4BPP=92]="PVRTC2_4BPP",e[e.ASTC_RGBA_4x4=93]="ASTC_RGBA_4x4",e[e.ASTC_RGBA_5x4=94]="ASTC_RGBA_5x4",e[e.ASTC_RGBA_5x5=95]="ASTC_RGBA_5x5",e[e.ASTC_RGBA_6x5=96]="ASTC_RGBA_6x5",e[e.ASTC_RGBA_6x6=97]="ASTC_RGBA_6x6",e[e.ASTC_RGBA_8x5=98]="ASTC_RGBA_8x5",e[e.ASTC_RGBA_8x6=99]="ASTC_RGBA_8x6",e[e.ASTC_RGBA_8x8=100]="ASTC_RGBA_8x8",e[e.ASTC_RGBA_10x5=101]="ASTC_RGBA_10x5",e[e.ASTC_RGBA_10x6=102]="ASTC_RGBA_10x6",e[e.ASTC_RGBA_10x8=103]="ASTC_RGBA_10x8",e[e.ASTC_RGBA_10x10=104]="ASTC_RGBA_10x10",e[e.ASTC_RGBA_12x10=105]="ASTC_RGBA_12x10",e[e.ASTC_RGBA_12x12=106]="ASTC_RGBA_12x12",e[e.ASTC_SRGBA_4x4=107]="ASTC_SRGBA_4x4",e[e.ASTC_SRGBA_5x4=108]="ASTC_SRGBA_5x4",e[e.ASTC_SRGBA_5x5=109]="ASTC_SRGBA_5x5",e[e.ASTC_SRGBA_6x5=110]="ASTC_SRGBA_6x5",e[e.ASTC_SRGBA_6x6=111]="ASTC_SRGBA_6x6",e[e.ASTC_SRGBA_8x5=112]="ASTC_SRGBA_8x5",e[e.ASTC_SRGBA_8x6=113]="ASTC_SRGBA_8x6",e[e.ASTC_SRGBA_8x8=114]="ASTC_SRGBA_8x8",e[e.ASTC_SRGBA_10x5=115]="ASTC_SRGBA_10x5",e[e.ASTC_SRGBA_10x6=116]="ASTC_SRGBA_10x6",e[e.ASTC_SRGBA_10x8=117]="ASTC_SRGBA_10x8",e[e.ASTC_SRGBA_10x10=118]="ASTC_SRGBA_10x10",e[e.ASTC_SRGBA_12x10=119]="ASTC_SRGBA_12x10",e[e.ASTC_SRGBA_12x12=120]="ASTC_SRGBA_12x12",e[e.COUNT=121]="COUNT"}(Ma||(Ma=e("c",{}))),function(e){e[e.NONE=0]="NONE",e[e.UNORM=1]="UNORM",e[e.SNORM=2]="SNORM",e[e.UINT=3]="UINT",e[e.INT=4]="INT",e[e.UFLOAT=5]="UFLOAT",e[e.FLOAT=6]="FLOAT"}(La||(La=e("d",{}))),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.BOOL=1]="BOOL",e[e.BOOL2=2]="BOOL2",e[e.BOOL3=3]="BOOL3",e[e.BOOL4=4]="BOOL4",e[e.INT=5]="INT",e[e.INT2=6]="INT2",e[e.INT3=7]="INT3",e[e.INT4=8]="INT4",e[e.UINT=9]="UINT",e[e.UINT2=10]="UINT2",e[e.UINT3=11]="UINT3",e[e.UINT4=12]="UINT4",e[e.FLOAT=13]="FLOAT",e[e.FLOAT2=14]="FLOAT2",e[e.FLOAT3=15]="FLOAT3",e[e.FLOAT4=16]="FLOAT4",e[e.MAT2=17]="MAT2",e[e.MAT2X3=18]="MAT2X3",e[e.MAT2X4=19]="MAT2X4",e[e.MAT3X2=20]="MAT3X2",e[e.MAT3=21]="MAT3",e[e.MAT3X4=22]="MAT3X4",e[e.MAT4X2=23]="MAT4X2",e[e.MAT4X3=24]="MAT4X3",e[e.MAT4=25]="MAT4",e[e.SAMPLER1D=26]="SAMPLER1D",e[e.SAMPLER1D_ARRAY=27]="SAMPLER1D_ARRAY",e[e.SAMPLER2D=28]="SAMPLER2D",e[e.SAMPLER2D_ARRAY=29]="SAMPLER2D_ARRAY",e[e.SAMPLER3D=30]="SAMPLER3D",e[e.SAMPLER_CUBE=31]="SAMPLER_CUBE",e[e.SAMPLER=32]="SAMPLER",e[e.TEXTURE1D=33]="TEXTURE1D",e[e.TEXTURE1D_ARRAY=34]="TEXTURE1D_ARRAY",e[e.TEXTURE2D=35]="TEXTURE2D",e[e.TEXTURE2D_ARRAY=36]="TEXTURE2D_ARRAY",e[e.TEXTURE3D=37]="TEXTURE3D",e[e.TEXTURE_CUBE=38]="TEXTURE_CUBE",e[e.IMAGE1D=39]="IMAGE1D",e[e.IMAGE1D_ARRAY=40]="IMAGE1D_ARRAY",e[e.IMAGE2D=41]="IMAGE2D",e[e.IMAGE2D_ARRAY=42]="IMAGE2D_ARRAY",e[e.IMAGE3D=43]="IMAGE3D",e[e.IMAGE_CUBE=44]="IMAGE_CUBE",e[e.SUBPASS_INPUT=45]="SUBPASS_INPUT",e[e.COUNT=46]="COUNT"}(Fa||(Fa=e("T",{}))),function(e){e[e.NONE=0]="NONE",e[e.TRANSFER_SRC=1]="TRANSFER_SRC",e[e.TRANSFER_DST=2]="TRANSFER_DST",e[e.INDEX=4]="INDEX",e[e.VERTEX=8]="VERTEX",e[e.UNIFORM=16]="UNIFORM",e[e.STORAGE=32]="STORAGE",e[e.INDIRECT=64]="INDIRECT"}(za||(za=e("e",{}))),function(e){e[e.NONE=0]="NONE"}(Ba||(Ba=e("f",{}))),function(e){e[e.NONE=0]="NONE",e[e.READ_ONLY=1]="READ_ONLY",e[e.WRITE_ONLY=2]="WRITE_ONLY",e[e.READ_WRITE=3]="READ_WRITE"}(Ua||(Ua=e("M",{}))),function(e){e[e.NONE=0]="NONE",e[e.DEVICE=1]="DEVICE",e[e.HOST=2]="HOST"}(Ha||(Ha=e("g",{}))),function(e){e[e.TEX1D=0]="TEX1D",e[e.TEX2D=1]="TEX2D",e[e.TEX3D=2]="TEX3D",e[e.CUBE=3]="CUBE",e[e.TEX1D_ARRAY=4]="TEX1D_ARRAY",e[e.TEX2D_ARRAY=5]="TEX2D_ARRAY"}(Ga||(Ga=e("h",{}))),function(e){e[e.NONE=0]="NONE",e[e.TRANSFER_SRC=1]="TRANSFER_SRC",e[e.TRANSFER_DST=2]="TRANSFER_DST",e[e.SAMPLED=4]="SAMPLED",e[e.STORAGE=8]="STORAGE",e[e.COLOR_ATTACHMENT=16]="COLOR_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=32]="DEPTH_STENCIL_ATTACHMENT",e[e.TRANSIENT_ATTACHMENT=64]="TRANSIENT_ATTACHMENT",e[e.INPUT_ATTACHMENT=128]="INPUT_ATTACHMENT"}(ka||(ka=e("i",{}))),function(e){e[e.NONE=0]="NONE",e[e.GEN_MIPMAP=1]="GEN_MIPMAP",e[e.IMMUTABLE=2]="IMMUTABLE"}(Va||(Va=e("j",{}))),function(e){e[e.X1=0]="X1",e[e.X2=1]="X2",e[e.X4=2]="X4",e[e.X8=3]="X8",e[e.X16=4]="X16",e[e.X32=5]="X32",e[e.X64=6]="X64"}(Wa||(Wa=e("k",{}))),function(e){e[e.NONE=0]="NONE",e[e.POINT=1]="POINT",e[e.LINEAR=2]="LINEAR",e[e.ANISOTROPIC=3]="ANISOTROPIC"}(ja||(ja=e("l",{}))),function(e){e[e.WRAP=0]="WRAP",e[e.MIRROR=1]="MIRROR",e[e.CLAMP=2]="CLAMP",e[e.BORDER=3]="BORDER"}(qa||(qa=e("m",{}))),function(e){e[e.NEVER=0]="NEVER",e[e.LESS=1]="LESS",e[e.EQUAL=2]="EQUAL",e[e.LESS_EQUAL=3]="LESS_EQUAL",e[e.GREATER=4]="GREATER",e[e.NOT_EQUAL=5]="NOT_EQUAL",e[e.GREATER_EQUAL=6]="GREATER_EQUAL",e[e.ALWAYS=7]="ALWAYS"}(Ya||(Ya=e("n",{}))),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=1]="KEEP",e[e.REPLACE=2]="REPLACE",e[e.INCR=3]="INCR",e[e.DECR=4]="DECR",e[e.INVERT=5]="INVERT",e[e.INCR_WRAP=6]="INCR_WRAP",e[e.DECR_WRAP=7]="DECR_WRAP"}(Xa||(Xa=e("o",{}))),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_ALPHA=2]="SRC_ALPHA",e[e.DST_ALPHA=3]="DST_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=4]="ONE_MINUS_SRC_ALPHA",e[e.ONE_MINUS_DST_ALPHA=5]="ONE_MINUS_DST_ALPHA",e[e.SRC_COLOR=6]="SRC_COLOR",e[e.DST_COLOR=7]="DST_COLOR",e[e.ONE_MINUS_SRC_COLOR=8]="ONE_MINUS_SRC_COLOR",e[e.ONE_MINUS_DST_COLOR=9]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=10]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=11]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=12]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=13]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=14]="ONE_MINUS_CONSTANT_ALPHA"}(Ka||(Ka=e("p",{}))),function(e){e[e.ADD=0]="ADD",e[e.SUB=1]="SUB",e[e.REV_SUB=2]="REV_SUB",e[e.MIN=3]="MIN",e[e.MAX=4]="MAX"}(Qa||(Qa=e("q",{}))),function(e){e[e.NONE=0]="NONE",e[e.R=1]="R",e[e.G=2]="G",e[e.B=4]="B",e[e.A=8]="A",e[e.ALL=15]="ALL"}(Za||(Za=e("r",{}))),function(e){e[e.NONE=0]="NONE",e[e.VERTEX=1]="VERTEX",e[e.CONTROL=2]="CONTROL",e[e.EVALUATION=4]="EVALUATION",e[e.GEOMETRY=8]="GEOMETRY",e[e.FRAGMENT=16]="FRAGMENT",e[e.COMPUTE=32]="COMPUTE",e[e.ALL=63]="ALL"}(Ja||(Ja=e("s",{}))),function(e){e[e.LOAD=0]="LOAD",e[e.CLEAR=1]="CLEAR",e[e.DISCARD=2]="DISCARD"}($a||($a=e("L",{}))),function(e){e[e.STORE=0]="STORE",e[e.DISCARD=1]="DISCARD"}(es||(es=e("t",{}))),function(e){e[e.NONE=0]="NONE",e[e.INDIRECT_BUFFER=1]="INDIRECT_BUFFER",e[e.INDEX_BUFFER=2]="INDEX_BUFFER",e[e.VERTEX_BUFFER=3]="VERTEX_BUFFER",e[e.VERTEX_SHADER_READ_UNIFORM_BUFFER=4]="VERTEX_SHADER_READ_UNIFORM_BUFFER",e[e.VERTEX_SHADER_READ_TEXTURE=5]="VERTEX_SHADER_READ_TEXTURE",e[e.VERTEX_SHADER_READ_OTHER=6]="VERTEX_SHADER_READ_OTHER",e[e.FRAGMENT_SHADER_READ_UNIFORM_BUFFER=7]="FRAGMENT_SHADER_READ_UNIFORM_BUFFER",e[e.FRAGMENT_SHADER_READ_TEXTURE=8]="FRAGMENT_SHADER_READ_TEXTURE",e[e.FRAGMENT_SHADER_READ_COLOR_INPUT_ATTACHMENT=9]="FRAGMENT_SHADER_READ_COLOR_INPUT_ATTACHMENT",e[e.FRAGMENT_SHADER_READ_DEPTH_STENCIL_INPUT_ATTACHMENT=10]="FRAGMENT_SHADER_READ_DEPTH_STENCIL_INPUT_ATTACHMENT",e[e.FRAGMENT_SHADER_READ_OTHER=11]="FRAGMENT_SHADER_READ_OTHER",e[e.COLOR_ATTACHMENT_READ=12]="COLOR_ATTACHMENT_READ",e[e.DEPTH_STENCIL_ATTACHMENT_READ=13]="DEPTH_STENCIL_ATTACHMENT_READ",e[e.COMPUTE_SHADER_READ_UNIFORM_BUFFER=14]="COMPUTE_SHADER_READ_UNIFORM_BUFFER",e[e.COMPUTE_SHADER_READ_TEXTURE=15]="COMPUTE_SHADER_READ_TEXTURE",e[e.COMPUTE_SHADER_READ_OTHER=16]="COMPUTE_SHADER_READ_OTHER",e[e.TRANSFER_READ=17]="TRANSFER_READ",e[e.HOST_READ=18]="HOST_READ",e[e.PRESENT=19]="PRESENT",e[e.VERTEX_SHADER_WRITE=20]="VERTEX_SHADER_WRITE",e[e.FRAGMENT_SHADER_WRITE=21]="FRAGMENT_SHADER_WRITE",e[e.COLOR_ATTACHMENT_WRITE=22]="COLOR_ATTACHMENT_WRITE",e[e.DEPTH_STENCIL_ATTACHMENT_WRITE=23]="DEPTH_STENCIL_ATTACHMENT_WRITE",e[e.COMPUTE_SHADER_WRITE=24]="COMPUTE_SHADER_WRITE",e[e.TRANSFER_WRITE=25]="TRANSFER_WRITE",e[e.HOST_PREINITIALIZED=26]="HOST_PREINITIALIZED",e[e.HOST_WRITE=27]="HOST_WRITE"}(ts||(ts=e("u",{}))),function(e){e[e.GRAPHICS=0]="GRAPHICS",e[e.COMPUTE=1]="COMPUTE",e[e.RAY_TRACING=2]="RAY_TRACING"}(ns||(ns=e("v",{}))),function(e){e[e.POINT_LIST=0]="POINT_LIST",e[e.LINE_LIST=1]="LINE_LIST",e[e.LINE_STRIP=2]="LINE_STRIP",e[e.LINE_LOOP=3]="LINE_LOOP",e[e.LINE_LIST_ADJACENCY=4]="LINE_LIST_ADJACENCY",e[e.LINE_STRIP_ADJACENCY=5]="LINE_STRIP_ADJACENCY",e[e.ISO_LINE_LIST=6]="ISO_LINE_LIST",e[e.TRIANGLE_LIST=7]="TRIANGLE_LIST",e[e.TRIANGLE_STRIP=8]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=9]="TRIANGLE_FAN",e[e.TRIANGLE_LIST_ADJACENCY=10]="TRIANGLE_LIST_ADJACENCY",e[e.TRIANGLE_STRIP_ADJACENCY=11]="TRIANGLE_STRIP_ADJACENCY",e[e.TRIANGLE_PATCH_ADJACENCY=12]="TRIANGLE_PATCH_ADJACENCY",e[e.QUAD_PATCH_LIST=13]="QUAD_PATCH_LIST"}(is||(is=e("w",{}))),function(e){e[e.FILL=0]="FILL",e[e.POINT=1]="POINT",e[e.LINE=2]="LINE"}(os||(os=e("x",{}))),function(e){e[e.GOURAND=0]="GOURAND",e[e.FLAT=1]="FLAT"}(rs||(rs=e("y",{}))),function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK"}(as||(as=e("z",{}))),function(e){e[e.NONE=0]="NONE",e[e.VIEWPORT=1]="VIEWPORT",e[e.SCISSOR=2]="SCISSOR",e[e.LINE_WIDTH=4]="LINE_WIDTH",e[e.DEPTH_BIAS=8]="DEPTH_BIAS",e[e.BLEND_CONSTANTS=16]="BLEND_CONSTANTS",e[e.DEPTH_BOUNDS=32]="DEPTH_BOUNDS",e[e.STENCIL_WRITE_MASK=64]="STENCIL_WRITE_MASK",e[e.STENCIL_COMPARE_MASK=128]="STENCIL_COMPARE_MASK"}(ss||(ss=e("E",{}))),function(e){e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK",e[e.ALL=3]="ALL"}(cs||(cs=e("G",{}))),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.UNIFORM_BUFFER=1]="UNIFORM_BUFFER",e[e.DYNAMIC_UNIFORM_BUFFER=2]="DYNAMIC_UNIFORM_BUFFER",e[e.STORAGE_BUFFER=4]="STORAGE_BUFFER",e[e.DYNAMIC_STORAGE_BUFFER=8]="DYNAMIC_STORAGE_BUFFER",e[e.SAMPLER_TEXTURE=16]="SAMPLER_TEXTURE",e[e.SAMPLER=32]="SAMPLER",e[e.TEXTURE=64]="TEXTURE",e[e.STORAGE_IMAGE=128]="STORAGE_IMAGE",e[e.INPUT_ATTACHMENT=256]="INPUT_ATTACHMENT"}(ls||(ls=e("H",{}))),function(e){e[e.GRAPHICS=0]="GRAPHICS",e[e.COMPUTE=1]="COMPUTE",e[e.TRANSFER=2]="TRANSFER"}(us||(us=e("Q",{}))),function(e){e[e.PRIMARY=0]="PRIMARY",e[e.SECONDARY=1]="SECONDARY"}(hs||(hs=e("I",{}))),function(e){e[e.NONE=0]="NONE",e[e.COLOR=1]="COLOR",e[e.DEPTH=2]="DEPTH",e[e.STENCIL=4]="STENCIL",e[e.DEPTH_STENCIL=6]="DEPTH_STENCIL",e[e.ALL=7]="ALL"}(_s||(_s=e("J",{})));var ms,vs=e("K",function(){function e(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),this.x=e,this.y=t,this.z=n}return e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},e}()),gs=e("N",function(){function e(e,t,n,i,o,r,a,s,c,l,u,h,_,f,d,p,m,v,g,y,x,S,E){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=0),void 0===h&&(h=0),void 0===_&&(_=0),void 0===f&&(f=0),void 0===d&&(d=0),void 0===p&&(p=1),void 0===m&&(m=0),void 0===v&&(v=0),void 0===g&&(g=new vs),void 0===y&&(y=new vs),void 0===x&&(x=-1),void 0===S&&(S=1),void 0===E&&(E=1),this.maxVertexAttributes=e,this.maxVertexUniformVectors=t,this.maxFragmentUniformVectors=n,this.maxTextureUnits=i,this.maxImageUnits=o,this.maxVertexTextureUnits=r,this.maxColorRenderTargets=a,this.maxShaderStorageBufferBindings=s,this.maxShaderStorageBlockSize=c,this.maxUniformBufferBindings=l,this.maxUniformBlockSize=u,this.maxTextureSize=h,this.maxCubeMapTextureSize=_,this.depthBits=f,this.stencilBits=d,this.uboOffsetAlignment=p,this.maxComputeSharedMemorySize=m,this.maxComputeWorkGroupInvocations=v,this.maxComputeWorkGroupSize=g,this.maxComputeWorkGroupCount=y,this.clipSpaceMinZ=x,this.screenSpaceSignY=S,this.clipSpaceSignY=E}return e.prototype.copy=function(e){return this.maxVertexAttributes=e.maxVertexAttributes,this.maxVertexUniformVectors=e.maxVertexUniformVectors,this.maxFragmentUniformVectors=e.maxFragmentUniformVectors,this.maxTextureUnits=e.maxTextureUnits,this.maxImageUnits=e.maxImageUnits,this.maxVertexTextureUnits=e.maxVertexTextureUnits,this.maxColorRenderTargets=e.maxColorRenderTargets,this.maxShaderStorageBufferBindings=e.maxShaderStorageBufferBindings,this.maxShaderStorageBlockSize=e.maxShaderStorageBlockSize,this.maxUniformBufferBindings=e.maxUniformBufferBindings,this.maxUniformBlockSize=e.maxUniformBlockSize,this.maxTextureSize=e.maxTextureSize,this.maxCubeMapTextureSize=e.maxCubeMapTextureSize,this.depthBits=e.depthBits,this.stencilBits=e.stencilBits,this.uboOffsetAlignment=e.uboOffsetAlignment,this.maxComputeSharedMemorySize=e.maxComputeSharedMemorySize,this.maxComputeWorkGroupInvocations=e.maxComputeWorkGroupInvocations,this.maxComputeWorkGroupSize.copy(e.maxComputeWorkGroupSize),this.maxComputeWorkGroupCount.copy(e.maxComputeWorkGroupCount),this.clipSpaceMinZ=e.clipSpaceMinZ,this.screenSpaceSignY=e.screenSpaceSignY,this.clipSpaceSignY=e.clipSpaceSignY,this},e}()),ys=e("U",function(){function e(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),this.x=e,this.y=t,this.z=n}return e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},e}()),xs=e("V",function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=e,this.y=t,this.width=n,this.height=i}return e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this},e}()),Ss=e("W",function(){function e(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=1),this.width=e,this.height=t,this.depth=n}return e.prototype.copy=function(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this},e}()),Es=e("X",function(){function e(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=1),this.mipLevel=e,this.baseArrayLayer=t,this.layerCount=n}return e.prototype.copy=function(e){return this.mipLevel=e.mipLevel,this.baseArrayLayer=e.baseArrayLayer,this.layerCount=e.layerCount,this},e}()),Ts=e("Y",function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=1),this.baseMipLevel=e,this.levelCount=t,this.baseArrayLayer=n,this.layerCount=i}return e.prototype.copy=function(e){return this.baseMipLevel=e.baseMipLevel,this.levelCount=e.levelCount,this.baseArrayLayer=e.baseArrayLayer,this.layerCount=e.layerCount,this},e}()),As=e("Z",function(){function e(e,t,n,i,o){void 0===e&&(e=new Es),void 0===t&&(t=new ys),void 0===n&&(n=new Es),void 0===i&&(i=new ys),void 0===o&&(o=new Ss),this.srcSubres=e,this.srcOffset=t,this.dstSubres=n,this.dstOffset=i,this.extent=o}return e.prototype.copy=function(e){return this.srcSubres.copy(e.srcSubres),this.srcOffset.copy(e.srcOffset),this.dstSubres.copy(e.dstSubres),this.dstOffset.copy(e.dstOffset),this.extent.copy(e.extent),this},e}()),Cs=e("_",function(){function e(e,t,n,i,o,r){void 0===e&&(e=new Es),void 0===t&&(t=new ys),void 0===n&&(n=new Ss),void 0===i&&(i=new Es),void 0===o&&(o=new ys),void 0===r&&(r=new Ss),this.srcSubres=e,this.srcOffset=t,this.srcExtent=n,this.dstSubres=i,this.dstOffset=o,this.dstExtent=r}return e.prototype.copy=function(e){return this.srcSubres.copy(e.srcSubres),this.srcOffset.copy(e.srcOffset),this.srcExtent.copy(e.srcExtent),this.dstSubres.copy(e.dstSubres),this.dstOffset.copy(e.dstOffset),this.dstExtent.copy(e.dstExtent),this},e}()),ws=e("$",function(){function e(e,t,n,i,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=new ys),void 0===i&&(i=new Ss),void 0===o&&(o=new Es),this.buffStride=e,this.buffTexHeight=t,this.texOffset=n,this.texExtent=i,this.texSubres=o}return e.prototype.copy=function(e){return this.buffStride=e.buffStride,this.buffTexHeight=e.buffTexHeight,this.texOffset.copy(e.texOffset),this.texExtent.copy(e.texExtent),this.texSubres.copy(e.texSubres),this},e}()),bs=e("a0",function(){function e(e,t,n,i,o,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===r&&(r=1),this.left=e,this.top=t,this.width=n,this.height=i,this.minDepth=o,this.maxDepth=r}return e.prototype.copy=function(e){return this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height,this.minDepth=e.minDepth,this.maxDepth=e.maxDepth,this},e}()),Is=e("a1",function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=e,this.y=t,this.z=n,this.w=i}return e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e}()),Ps=e("a2",function(){function e(e,t,n){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=0),this.bufferOffsets=e,this.samplerOffsets=t,this.flexibleSet=n}return e.prototype.copy=function(e){return this.bufferOffsets=e.bufferOffsets.slice(),this.samplerOffsets=e.samplerOffsets.slice(),this.flexibleSet=e.flexibleSet,this},e}()),Rs=e("a3",function(){function e(e,t,n,i,o){void 0===e&&(e=za.NONE),void 0===t&&(t=Ha.NONE),void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=Ba.NONE),this.usage=e,this.memUsage=t,this.size=n,this.stride=i,this.flags=o}return e.prototype.copy=function(e){return this.usage=e.usage,this.memUsage=e.memUsage,this.size=e.size,this.stride=e.stride,this.flags=e.flags,this},e}()),Ns=e("a4",function(){function e(e,t,n){void 0===e&&(e=null),void 0===t&&(t=0),void 0===n&&(n=0),this.buffer=e,this.offset=t,this.range=n}return e.prototype.copy=function(e){return this.buffer=e.buffer,this.offset=e.offset,this.range=e.range,this},e}()),Os=e("a5",function(){function e(e,t,n,i,o,r,a){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===r&&(r=0),void 0===a&&(a=0),this.vertexCount=e,this.firstVertex=t,this.indexCount=n,this.firstIndex=i,this.vertexOffset=o,this.instanceCount=r,this.firstInstance=a}return e.prototype.copy=function(e){return this.vertexCount=e.vertexCount,this.firstVertex=e.firstVertex,this.indexCount=e.indexCount,this.firstIndex=e.firstIndex,this.vertexOffset=e.vertexOffset,this.instanceCount=e.instanceCount,this.firstInstance=e.firstInstance,this},e}()),Ds=e("a6",function(){function e(e,t,n,i,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=null),void 0===o&&(o=0),this.groupCountX=e,this.groupCountY=t,this.groupCountZ=n,this.indirectBuffer=i,this.indirectOffset=o}return e.prototype.copy=function(e){return this.groupCountX=e.groupCountX,this.groupCountY=e.groupCountY,this.groupCountZ=e.groupCountZ,this.indirectBuffer=e.indirectBuffer,this.indirectOffset=e.indirectOffset,this},e}()),Ms=e("a7",function(){function e(e){void 0===e&&(e=[]),this.drawInfos=e}return e.prototype.copy=function(e){return ps(this.drawInfos,e.drawInfos,Os),this},e}()),Ls=e("a8",function(){function e(e,t,n,i,o,r,a,s,c,l){void 0===e&&(e=Ga.TEX2D),void 0===t&&(t=ka.NONE),void 0===n&&(n=Ma.UNKNOWN),void 0===i&&(i=0),void 0===o&&(o=0),void 0===r&&(r=Va.NONE),void 0===a&&(a=1),void 0===s&&(s=1),void 0===c&&(c=Wa.X1),void 0===l&&(l=1),this.type=e,this.usage=t,this.format=n,this.width=i,this.height=o,this.flags=r,this.layerCount=a,this.levelCount=s,this.samples=c,this.depth=l}return e.prototype.copy=function(e){return this.type=e.type,this.usage=e.usage,this.format=e.format,this.width=e.width,this.height=e.height,this.flags=e.flags,this.layerCount=e.layerCount,this.levelCount=e.levelCount,this.samples=e.samples,this.depth=e.depth,this},e}()),Fs=e("a9",function(){function e(e,t,n,i,o,r,a){void 0===e&&(e=null),void 0===t&&(t=Ga.TEX2D),void 0===n&&(n=Ma.UNKNOWN),void 0===i&&(i=0),void 0===o&&(o=1),void 0===r&&(r=0),void 0===a&&(a=1),this.texture=e,this.type=t,this.format=n,this.baseLevel=i,this.levelCount=o,this.baseLayer=r,this.layerCount=a}return e.prototype.copy=function(e){return this.texture=e.texture,this.type=e.type,this.format=e.format,this.baseLevel=e.baseLevel,this.levelCount=e.levelCount,this.baseLayer=e.baseLayer,this.layerCount=e.layerCount,this},e}()),zs=e("aa",function(){function e(e,t,n,i,o,r,a,s,c,l){void 0===e&&(e=ja.LINEAR),void 0===t&&(t=ja.LINEAR),void 0===n&&(n=ja.NONE),void 0===i&&(i=qa.WRAP),void 0===o&&(o=qa.WRAP),void 0===r&&(r=qa.WRAP),void 0===a&&(a=0),void 0===s&&(s=Ya.ALWAYS),void 0===c&&(c=new Is),void 0===l&&(l=0),this.minFilter=e,this.magFilter=t,this.mipFilter=n,this.addressU=i,this.addressV=o,this.addressW=r,this.maxAnisotropy=a,this.cmpFunc=s,this.borderColor=c,this.mipLODBias=l}return e.prototype.copy=function(e){return this.minFilter=e.minFilter,this.magFilter=e.magFilter,this.mipFilter=e.mipFilter,this.addressU=e.addressU,this.addressV=e.addressV,this.addressW=e.addressW,this.maxAnisotropy=e.maxAnisotropy,this.cmpFunc=e.cmpFunc,this.borderColor.copy(e.borderColor),this.mipLODBias=e.mipLODBias,this},e}()),Bs=e("ab",function(){function e(e,t,n){void 0===e&&(e=""),void 0===t&&(t=Fa.UNKNOWN),void 0===n&&(n=0),this.name=e,this.type=t,this.count=n}return e.prototype.copy=function(e){return this.name=e.name,this.type=e.type,this.count=e.count,this},e}()),Us=e("ac",function(){function e(e,t,n,i,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=""),void 0===i&&(i=[]),void 0===o&&(o=0),this.set=e,this.binding=t,this.name=n,this.members=i,this.count=o}return e.prototype.copy=function(e){return this.set=e.set,this.binding=e.binding,this.name=e.name,ps(this.members,e.members,Bs),this.count=e.count,this},e}()),Hs=e("ad",function(){function e(e,t,n,i,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=""),void 0===i&&(i=Fa.UNKNOWN),void 0===o&&(o=0),this.set=e,this.binding=t,this.name=n,this.type=i,this.count=o}return e.prototype.copy=function(e){return this.set=e.set,this.binding=e.binding,this.name=e.name,this.type=e.type,this.count=e.count,this},e}()),Gs=e("ae",function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=""),void 0===i&&(i=0),this.set=e,this.binding=t,this.name=n,this.count=i}return e.prototype.copy=function(e){return this.set=e.set,this.binding=e.binding,this.name=e.name,this.count=e.count,this},e}()),ks=e("af",function(){function e(e,t,n,i,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=""),void 0===i&&(i=Fa.UNKNOWN),void 0===o&&(o=0),this.set=e,this.binding=t,this.name=n,this.type=i,this.count=o}return e.prototype.copy=function(e){return this.set=e.set,this.binding=e.binding,this.name=e.name,this.type=e.type,this.count=e.count,this},e}()),Vs=e("ag",function(){function e(e,t,n,i,o,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=""),void 0===i&&(i=Fa.UNKNOWN),void 0===o&&(o=0),void 0===r&&(r=Ua.READ_WRITE),this.set=e,this.binding=t,this.name=n,this.type=i,this.count=o,this.memoryAccess=r}return e.prototype.copy=function(e){return this.set=e.set,this.binding=e.binding,this.name=e.name,this.type=e.type,this.count=e.count,this.memoryAccess=e.memoryAccess,this},e}()),Ws=e("ah",function(){function e(e,t,n,i,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=""),void 0===i&&(i=0),void 0===o&&(o=Ua.READ_WRITE),this.set=e,this.binding=t,this.name=n,this.count=i,this.memoryAccess=o}return e.prototype.copy=function(e){return this.set=e.set,this.binding=e.binding,this.name=e.name,this.count=e.count,this.memoryAccess=e.memoryAccess,this},e}()),js=e("ai",function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=""),void 0===i&&(i=0),this.set=e,this.binding=t,this.name=n,this.count=i}return e.prototype.copy=function(e){return this.set=e.set,this.binding=e.binding,this.name=e.name,this.count=e.count,this},e}()),qs=e("aj",function(){function e(e,t){void 0===e&&(e=Ja.NONE),void 0===t&&(t=""),this.stage=e,this.source=t}return e.prototype.copy=function(e){return this.stage=e.stage,this.source=e.source,this},e}()),Ys=e("ak",function(){function e(e,t,n,i,o,r){void 0===e&&(e=""),void 0===t&&(t=Ma.UNKNOWN),void 0===n&&(n=!1),void 0===i&&(i=0),void 0===o&&(o=!1),void 0===r&&(r=0),this.name=e,this.format=t,this.isNormalized=n,this.stream=i,this.isInstanced=o,this.location=r}return e.prototype.copy=function(e){return this.name=e.name,this.format=e.format,this.isNormalized=e.isNormalized,this.stream=e.stream,this.isInstanced=e.isInstanced,this.location=e.location,this},e}()),Xs=e("al",function(){function e(e,t,n,i,o,r,a,s,c,l){void 0===e&&(e=""),void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===i&&(i=[]),void 0===o&&(o=[]),void 0===r&&(r=[]),void 0===a&&(a=[]),void 0===s&&(s=[]),void 0===c&&(c=[]),void 0===l&&(l=[]),this.name=e,this.stages=t,this.attributes=n,this.blocks=i,this.buffers=o,this.samplerTextures=r,this.samplers=a,this.textures=s,this.images=c,this.subpassInputs=l}return e.prototype.copy=function(e){return this.name=e.name,ps(this.stages,e.stages,qs),ps(this.attributes,e.attributes,Ys),ps(this.blocks,e.blocks,Us),ps(this.buffers,e.buffers,Ws),ps(this.samplerTextures,e.samplerTextures,Hs),ps(this.samplers,e.samplers,Gs),ps(this.textures,e.textures,ks),ps(this.images,e.images,Vs),ps(this.subpassInputs,e.subpassInputs,js),this},e}()),Ks=e("am",function(){function e(e,t,n,i){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=null),void 0===i&&(i=null),this.attributes=e,this.vertexBuffers=t,this.indexBuffer=n,this.indirectBuffer=i}return e.prototype.copy=function(e){return ps(this.attributes,e.attributes,Ys),this.vertexBuffers=e.vertexBuffers.slice(),this.indexBuffer=e.indexBuffer,this.indirectBuffer=e.indirectBuffer,this},e}()),Qs=e("an",function(){function e(e,t,n,i,o,r){void 0===e&&(e=Ma.UNKNOWN),void 0===t&&(t=Wa.X1),void 0===n&&(n=$a.CLEAR),void 0===i&&(i=es.STORE),void 0===o&&(o=[]),void 0===r&&(r=[ts.PRESENT]),this.format=e,this.sampleCount=t,this.loadOp=n,this.storeOp=i,this.beginAccesses=o,this.endAccesses=r}return e.prototype.copy=function(e){return this.format=e.format,this.sampleCount=e.sampleCount,this.loadOp=e.loadOp,this.storeOp=e.storeOp,this.beginAccesses=e.beginAccesses.slice(),this.endAccesses=e.endAccesses.slice(),this},e}()),Zs=e("ao",function(){function e(e,t,n,i,o,r,a,s){void 0===e&&(e=Ma.UNKNOWN),void 0===t&&(t=Wa.X1),void 0===n&&(n=$a.CLEAR),void 0===i&&(i=es.STORE),void 0===o&&(o=$a.CLEAR),void 0===r&&(r=es.STORE),void 0===a&&(a=[]),void 0===s&&(s=[ts.DEPTH_STENCIL_ATTACHMENT_WRITE]),this.format=e,this.sampleCount=t,this.depthLoadOp=n,this.depthStoreOp=i,this.stencilLoadOp=o,this.stencilStoreOp=r,this.beginAccesses=a,this.endAccesses=s}return e.prototype.copy=function(e){return this.format=e.format,this.sampleCount=e.sampleCount,this.depthLoadOp=e.depthLoadOp,this.depthStoreOp=e.depthStoreOp,this.stencilLoadOp=e.stencilLoadOp,this.stencilStoreOp=e.stencilStoreOp,this.beginAccesses=e.beginAccesses.slice(),this.endAccesses=e.endAccesses.slice(),this},e}()),Js=e("ap",function(){function e(e,t,n,i,o){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===i&&(i=[]),void 0===o&&(o=-1),this.inputs=e,this.colors=t,this.resolves=n,this.preserves=i,this.depthStencil=o}return e.prototype.copy=function(e){return this.inputs=e.inputs.slice(),this.colors=e.colors.slice(),this.resolves=e.resolves.slice(),this.preserves=e.preserves.slice(),this.depthStencil=e.depthStencil,this},e}()),$s=e("aq",function(){function e(e,t,n){void 0===e&&(e=[]),void 0===t&&(t=new Zs),void 0===n&&(n=[]),this.colorAttachments=e,this.depthStencilAttachment=t,this.subpasses=n}return e.prototype.copy=function(e){return ps(this.colorAttachments,e.colorAttachments,Qs),this.depthStencilAttachment.copy(e.depthStencilAttachment),ps(this.subpasses,e.subpasses,Js),this},e}()),ec=e("ar",function(){function e(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]),this.prevAccesses=e,this.nextAccesses=t}return e.prototype.copy=function(e){return this.prevAccesses=e.prevAccesses.slice(),this.nextAccesses=e.nextAccesses.slice(),this},e}()),tc=e("as",function(){function e(e,t,n,i,o){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=!1),void 0===i&&(i=null),void 0===o&&(o=null),this.prevAccesses=e,this.nextAccesses=t,this.discardContents=n,this.srcQueue=i,this.dstQueue=o}return e.prototype.copy=function(e){return this.prevAccesses=e.prevAccesses.slice(),this.nextAccesses=e.nextAccesses.slice(),this.discardContents=e.discardContents,this.srcQueue=e.srcQueue,this.dstQueue=e.dstQueue,this},e}()),nc=e("at",function(){function e(e,t,n,i,o){void 0===e&&(e=null),void 0===t&&(t=[]),void 0===n&&(n=null),void 0===i&&(i=[]),void 0===o&&(o=0),this.renderPass=e,this.colorTextures=t,this.depthStencilTexture=n,this.colorMipmapLevels=i,this.depthStencilMipmapLevel=o}return e.prototype.copy=function(e){return this.renderPass=e.renderPass,this.colorTextures=e.colorTextures.slice(),this.depthStencilTexture=e.depthStencilTexture,this.colorMipmapLevels=e.colorMipmapLevels.slice(),this.depthStencilMipmapLevel=e.depthStencilMipmapLevel,this},e}()),ic=e("au",function(){function e(e,t,n,i,o){void 0===e&&(e=-1),void 0===t&&(t=ls.UNKNOWN),void 0===n&&(n=0),void 0===i&&(i=Ja.NONE),void 0===o&&(o=[]),this.binding=e,this.descriptorType=t,this.count=n,this.stageFlags=i,this.immutableSamplers=o}return e.prototype.copy=function(e){return this.binding=e.binding,this.descriptorType=e.descriptorType,this.count=e.count,this.stageFlags=e.stageFlags,this.immutableSamplers=e.immutableSamplers.slice(),this},e}()),oc=e("av",function(){function e(e){void 0===e&&(e=[]),this.bindings=e}return e.prototype.copy=function(e){return ps(this.bindings,e.bindings,ic),this},e}()),rc=e("aw",function(){function e(e){void 0===e&&(e=null),this.layout=e}return e.prototype.copy=function(e){return this.layout=e.layout,this},e}()),ac=e("ax",function(){function e(e){void 0===e&&(e=[]),this.setLayouts=e}return e.prototype.copy=function(e){return this.setLayouts=e.setLayouts.slice(),this},e}()),sc=e("ay",function(){function e(e){void 0===e&&(e=[]),this.attributes=e}return e.prototype.copy=function(e){return ps(this.attributes,e.attributes,Ys),this},e}()),cc=e("az",function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=hs.PRIMARY),this.queue=e,this.type=t}return e.prototype.copy=function(e){return this.queue=e.queue,this.type=e.type,this},e}()),lc=e("aA",function(){function e(e){void 0===e&&(e=us.GRAPHICS),this.type=e}return e.prototype.copy=function(e){return this.type=e.type,this},e}()),uc=e("aB",(function(e,t,n,i,o,r,a,s){void 0===e&&(e=""),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=La.NONE),void 0===o&&(o=!1),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===s&&(s=!1),this.name=e,this.size=t,this.count=n,this.type=i,this.hasAlpha=o,this.hasDepth=r,this.hasStencil=a,this.isCompressed=s})),hc=e("aC",function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.bufferSize=e,this.textureSize=t}return e.prototype.copy=function(e){return this.bufferSize=e.bufferSize,this.textureSize=e.textureSize,this},e}()),_c=e("aD",function(){function e(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),this.writeMask=e,this.compareMask=t,this.reference=n}return e.prototype.copy=function(e){return this.writeMask=e.writeMask,this.compareMask=e.compareMask,this.reference=e.reference,this},e}()),fc=e("aE",function(){function e(e,t,n,i,o,r,a,s,c,l,u){void 0===e&&(e=new bs),void 0===t&&(t=new xs),void 0===n&&(n=new Is),void 0===i&&(i=1),void 0===o&&(o=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=new _c),void 0===u&&(u=new _c),this.viewport=e,this.scissor=t,this.blendConstant=n,this.lineWidth=i,this.depthBiasConstant=o,this.depthBiasClamp=r,this.depthBiasSlope=a,this.depthMinBounds=s,this.depthMaxBounds=c,this.stencilStatesFront=l,this.stencilStatesBack=u}return e.prototype.copy=function(e){return this.viewport.copy(e.viewport),this.scissor.copy(e.scissor),this.blendConstant.copy(e.blendConstant),this.lineWidth=e.lineWidth,this.depthBiasConstant=e.depthBiasConstant,this.depthBiasClamp=e.depthBiasClamp,this.depthBiasSlope=e.depthBiasSlope,this.depthMinBounds=e.depthMinBounds,this.depthMaxBounds=e.depthMaxBounds,this.stencilStatesFront.copy(e.stencilStatesFront),this.stencilStatesBack.copy(e.stencilStatesBack),this},e}()),dc=e("aF",function(){function e(e){this._gfxType=Pa.UNKNOWN,this._gfxType=e}return te(e,[{key:"gfxType",get:function(){return this._gfxType}}]),e}()),pc=e("aG",(function(e,t,n,i,o,r,a){void 0===t&&(t=!0),void 0===n&&(n=!0),void 0===i&&(i=1),void 0===o&&(o=1),void 0===r&&(r=1),void 0===a&&(a=new Ps),this.canvasElm=e,this.isAntialias=t,this.isPremultipliedAlpha=n,this.devicePixelRatio=i,this.nativeWidth=o,this.nativeHeight=r,this.bindingMappingInfo=a}));!function(e){e.ATTR_POSITION="a_position",e.ATTR_NORMAL="a_normal",e.ATTR_TANGENT="a_tangent",e.ATTR_BITANGENT="a_bitangent",e.ATTR_WEIGHTS="a_weights",e.ATTR_JOINTS="a_joints",e.ATTR_COLOR="a_color",e.ATTR_COLOR1="a_color1",e.ATTR_COLOR2="a_color2",e.ATTR_TEX_COORD="a_texCoord",e.ATTR_TEX_COORD1="a_texCoord1",e.ATTR_TEX_COORD2="a_texCoord2",e.ATTR_TEX_COORD3="a_texCoord3",e.ATTR_TEX_COORD4="a_texCoord4",e.ATTR_TEX_COORD5="a_texCoord5",e.ATTR_TEX_COORD6="a_texCoord6",e.ATTR_TEX_COORD7="a_texCoord7",e.ATTR_TEX_COORD8="a_texCoord8",e.ATTR_BATCH_ID="a_batch_id",e.ATTR_BATCH_UV="a_batch_uv"}(ms||(ms=e("aH",{})));var mc=e("aI",Object.freeze([new uc("UNKNOWN",0,0,La.NONE,!1,!1,!1,!1),new uc("A8",1,1,La.UNORM,!0,!1,!1,!1),new uc("L8",1,1,La.UNORM,!1,!1,!1,!1),new uc("LA8",1,2,La.UNORM,!0,!1,!1,!1),new uc("R8",1,1,La.UNORM,!1,!1,!1,!1),new uc("R8SN",1,1,La.SNORM,!1,!1,!1,!1),new uc("R8UI",1,1,La.UINT,!1,!1,!1,!1),new uc("R8I",1,1,La.INT,!1,!1,!1,!1),new uc("R16F",2,1,La.FLOAT,!1,!1,!1,!1),new uc("R16UI",2,1,La.UINT,!1,!1,!1,!1),new uc("R16I",2,1,La.INT,!1,!1,!1,!1),new uc("R32F",4,1,La.FLOAT,!1,!1,!1,!1),new uc("R32UI",4,1,La.UINT,!1,!1,!1,!1),new uc("R32I",4,1,La.INT,!1,!1,!1,!1),new uc("RG8",2,2,La.UNORM,!1,!1,!1,!1),new uc("RG8SN",2,2,La.SNORM,!1,!1,!1,!1),new uc("RG8UI",2,2,La.UINT,!1,!1,!1,!1),new uc("RG8I",2,2,La.INT,!1,!1,!1,!1),new uc("RG16F",4,2,La.FLOAT,!1,!1,!1,!1),new uc("RG16UI",4,2,La.UINT,!1,!1,!1,!1),new uc("RG16I",4,2,La.INT,!1,!1,!1,!1),new uc("RG32F",8,2,La.FLOAT,!1,!1,!1,!1),new uc("RG32UI",8,2,La.UINT,!1,!1,!1,!1),new uc("RG32I",8,2,La.INT,!1,!1,!1,!1),new uc("RGB8",3,3,La.UNORM,!1,!1,!1,!1),new uc("SRGB8",3,3,La.UNORM,!1,!1,!1,!1),new uc("RGB8SN",3,3,La.SNORM,!1,!1,!1,!1),new uc("RGB8UI",3,3,La.UINT,!1,!1,!1,!1),new uc("RGB8I",3,3,La.INT,!1,!1,!1,!1),new uc("RGB16F",6,3,La.FLOAT,!1,!1,!1,!1),new uc("RGB16UI",6,3,La.UINT,!1,!1,!1,!1),new uc("RGB16I",6,3,La.INT,!1,!1,!1,!1),new uc("RGB32F",12,3,La.FLOAT,!1,!1,!1,!1),new uc("RGB32UI",12,3,La.UINT,!1,!1,!1,!1),new uc("RGB32I",12,3,La.INT,!1,!1,!1,!1),new uc("RGBA8",4,4,La.UNORM,!0,!1,!1,!1),new uc("BGRA8",4,4,La.UNORM,!0,!1,!1,!1),new uc("SRGB8_A8",4,4,La.UNORM,!0,!1,!1,!1),new uc("RGBA8SN",4,4,La.SNORM,!0,!1,!1,!1),new uc("RGBA8UI",4,4,La.UINT,!0,!1,!1,!1),new uc("RGBA8I",4,4,La.INT,!0,!1,!1,!1),new uc("RGBA16F",8,4,La.FLOAT,!0,!1,!1,!1),new uc("RGBA16UI",8,4,La.UINT,!0,!1,!1,!1),new uc("RGBA16I",8,4,La.INT,!0,!1,!1,!1),new uc("RGBA32F",16,4,La.FLOAT,!0,!1,!1,!1),new uc("RGBA32UI",16,4,La.UINT,!0,!1,!1,!1),new uc("RGBA32I",16,4,La.INT,!0,!1,!1,!1),new uc("R5G6B5",2,3,La.UNORM,!1,!1,!1,!1),new uc("R11G11B10F",4,3,La.FLOAT,!1,!1,!1,!1),new uc("RGB5A1",2,4,La.UNORM,!0,!1,!1,!1),new uc("RGBA4",2,4,La.UNORM,!0,!1,!1,!1),new uc("RGB10A2",2,4,La.UNORM,!0,!1,!1,!1),new uc("RGB10A2UI",2,4,La.UINT,!0,!1,!1,!1),new uc("RGB9E5",2,4,La.FLOAT,!0,!1,!1,!1),new uc("D16",2,1,La.UINT,!1,!0,!1,!1),new uc("D16S8",3,2,La.UINT,!1,!0,!0,!1),new uc("D24",3,1,La.UINT,!1,!0,!1,!1),new uc("D24S8",4,2,La.UINT,!1,!0,!0,!1),new uc("D32F",4,1,La.FLOAT,!1,!0,!1,!1),new uc("D32FS8",5,2,La.FLOAT,!1,!0,!0,!1),new uc("BC1",1,3,La.UNORM,!1,!1,!1,!0),new uc("BC1_ALPHA",1,4,La.UNORM,!0,!1,!1,!0),new uc("BC1_SRGB",1,3,La.UNORM,!1,!1,!1,!0),new uc("BC1_SRGB_ALPHA",1,4,La.UNORM,!0,!1,!1,!0),new uc("BC2",1,4,La.UNORM,!0,!1,!1,!0),new uc("BC2_SRGB",1,4,La.UNORM,!0,!1,!1,!0),new uc("BC3",1,4,La.UNORM,!0,!1,!1,!0),new uc("BC3_SRGB",1,4,La.UNORM,!0,!1,!1,!0),new uc("BC4",1,1,La.UNORM,!1,!1,!1,!0),new uc("BC4_SNORM",1,1,La.SNORM,!1,!1,!1,!0),new uc("BC5",1,2,La.UNORM,!1,!1,!1,!0),new uc("BC5_SNORM",1,2,La.SNORM,!1,!1,!1,!0),new uc("BC6H_UF16",1,3,La.UFLOAT,!1,!1,!1,!0),new uc("BC6H_SF16",1,3,La.FLOAT,!1,!1,!1,!0),new uc("BC7",1,4,La.UNORM,!0,!1,!1,!0),new uc("BC7_SRGB",1,4,La.UNORM,!0,!1,!1,!0),new uc("ETC_RGB8",1,3,La.UNORM,!1,!1,!1,!0),new uc("ETC2_RGB8",1,3,La.UNORM,!1,!1,!1,!0),new uc("ETC2_SRGB8",1,3,La.UNORM,!1,!1,!1,!0),new uc("ETC2_RGB8_A1",1,4,La.UNORM,!0,!1,!1,!0),new uc("ETC2_SRGB8_A1",1,4,La.UNORM,!0,!1,!1,!0),new uc("ETC2_RGBA8",2,4,La.UNORM,!0,!1,!1,!0),new uc("ETC2_SRGB8_A8",2,4,La.UNORM,!0,!1,!1,!0),new uc("EAC_R11",1,1,La.UNORM,!1,!1,!1,!0),new uc("EAC_R11SN",1,1,La.SNORM,!1,!1,!1,!0),new uc("EAC_RG11",2,2,La.UNORM,!1,!1,!1,!0),new uc("EAC_RG11SN",2,2,La.SNORM,!1,!1,!1,!0),new uc("PVRTC_RGB2",2,3,La.UNORM,!1,!1,!1,!0),new uc("PVRTC_RGBA2",2,4,La.UNORM,!0,!1,!1,!0),new uc("PVRTC_RGB4",2,3,La.UNORM,!1,!1,!1,!0),new uc("PVRTC_RGBA4",2,4,La.UNORM,!0,!1,!1,!0),new uc("PVRTC2_2BPP",2,4,La.UNORM,!0,!1,!1,!0),new uc("PVRTC2_4BPP",2,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_RGBA_4x4",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_RGBA_5x4",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_RGBA_5x5",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_RGBA_6x5",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_RGBA_6x6",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_RGBA_8x5",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_RGBA_8x6",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_RGBA_8x8",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_RGBA_10x5",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_RGBA_10x6",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_RGBA_10x8",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_RGBA_10x10",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_RGBA_12x10",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_RGBA_12x12",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_SRGBA_4x4",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_SRGBA_5x4",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_SRGBA_5x5",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_SRGBA_6x5",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_SRGBA_6x6",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_SRGBA_8x5",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_SRGBA_8x6",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_SRGBA_8x8",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_SRGBA_10x5",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_SRGBA_10x6",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_SRGBA_10x8",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_SRGBA_10x10",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_SRGBA_12x10",1,4,La.UNORM,!0,!1,!1,!0),new uc("ASTC_SRGBA_12x12",1,4,La.UNORM,!0,!1,!1,!0)])),vc=e("aJ",ls.UNIFORM_BUFFER|ls.DYNAMIC_UNIFORM_BUFFER|ls.STORAGE_BUFFER|ls.DYNAMIC_STORAGE_BUFFER),gc=e("aK",ls.SAMPLER_TEXTURE|ls.SAMPLER|ls.TEXTURE|ls.STORAGE_IMAGE|ls.INPUT_ATTACHMENT),yc=e("aL",ls.DYNAMIC_STORAGE_BUFFER|ls.DYNAMIC_UNIFORM_BUFFER),xc=e("aM",28);function Sc(e){return e>0&&0==(e&e-1)}function Ec(e,t,n,i){if(!mc[e].isCompressed)return t*n*i*mc[e].size;switch(e){case Ma.BC1:case Ma.BC1_ALPHA:case Ma.BC1_SRGB:case Ma.BC1_SRGB_ALPHA:return Math.ceil(t/4)*Math.ceil(n/4)*8*i;case Ma.BC2:case Ma.BC2_SRGB:case Ma.BC3:case Ma.BC3_SRGB:case Ma.BC4:case Ma.BC4_SNORM:case Ma.BC6H_SF16:case Ma.BC6H_UF16:case Ma.BC7:case Ma.BC7_SRGB:return Math.ceil(t/4)*Math.ceil(n/4)*16*i;case Ma.BC5:case Ma.BC5_SNORM:return Math.ceil(t/4)*Math.ceil(n/4)*32*i;case Ma.ETC_RGB8:case Ma.ETC2_RGB8:case Ma.ETC2_SRGB8:case Ma.ETC2_RGB8_A1:case Ma.EAC_R11:case Ma.EAC_R11SN:return Math.ceil(t/4)*Math.ceil(n/4)*8*i;case Ma.ETC2_RGBA8:case Ma.ETC2_SRGB8_A1:case Ma.EAC_RG11:case Ma.EAC_RG11SN:return Math.ceil(t/4)*Math.ceil(n/4)*16*i;case Ma.PVRTC_RGB2:case Ma.PVRTC_RGBA2:case Ma.PVRTC2_2BPP:return Math.ceil(Math.max(t,16)*Math.max(n,8)/4)*i;case Ma.PVRTC_RGB4:case Ma.PVRTC_RGBA4:case Ma.PVRTC2_4BPP:return Math.ceil(Math.max(t,8)*Math.max(n,8)/2)*i;case Ma.ASTC_RGBA_4x4:case Ma.ASTC_SRGBA_4x4:return Math.ceil(t/4)*Math.ceil(n/4)*16*i;case Ma.ASTC_RGBA_5x4:case Ma.ASTC_SRGBA_5x4:return Math.ceil(t/5)*Math.ceil(n/4)*16*i;case Ma.ASTC_RGBA_5x5:case Ma.ASTC_SRGBA_5x5:return Math.ceil(t/5)*Math.ceil(n/5)*16*i;case Ma.ASTC_RGBA_6x5:case Ma.ASTC_SRGBA_6x5:return Math.ceil(t/6)*Math.ceil(n/5)*16*i;case Ma.ASTC_RGBA_6x6:case Ma.ASTC_SRGBA_6x6:return Math.ceil(t/6)*Math.ceil(n/6)*16*i;case Ma.ASTC_RGBA_8x5:case Ma.ASTC_SRGBA_8x5:return Math.ceil(t/8)*Math.ceil(n/5)*16*i;case Ma.ASTC_RGBA_8x6:case Ma.ASTC_SRGBA_8x6:return Math.ceil(t/8)*Math.ceil(n/6)*16*i;case Ma.ASTC_RGBA_8x8:case Ma.ASTC_SRGBA_8x8:return Math.ceil(t/8)*Math.ceil(n/8)*16*i;case Ma.ASTC_RGBA_10x5:case Ma.ASTC_SRGBA_10x5:return Math.ceil(t/10)*Math.ceil(n/5)*16*i;case Ma.ASTC_RGBA_10x6:case Ma.ASTC_SRGBA_10x6:return Math.ceil(t/10)*Math.ceil(n/6)*16*i;case Ma.ASTC_RGBA_10x8:case Ma.ASTC_SRGBA_10x8:return Math.ceil(t/10)*Math.ceil(n/8)*16*i;case Ma.ASTC_RGBA_10x10:case Ma.ASTC_SRGBA_10x10:return Math.ceil(t/10)*Math.ceil(n/10)*16*i;case Ma.ASTC_RGBA_12x10:case Ma.ASTC_SRGBA_12x10:return Math.ceil(t/12)*Math.ceil(n/10)*16*i;case Ma.ASTC_RGBA_12x12:case Ma.ASTC_SRGBA_12x12:return Math.ceil(t/12)*Math.ceil(n/12)*16*i;default:return 0}}function Tc(e,t,n,i,o){for(var r=0,a=0;a<o;++a)r+=Ec(e,t,n,i),t=Math.max(t>>1,1),n=Math.max(n>>1,1);return r}var Ac=[0,4,8,12,16,4,8,12,16,4,8,12,16,4,8,12,16,16,24,32,24,36,48,32,48,64,4,4,4,4,4,4];function Cc(e){return Ac[e]||0}function wc(e){var t=e.size/e.count;switch(e.type){case La.UNORM:case La.UINT:switch(t){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array}break;case La.SNORM:case La.INT:switch(t){case 1:return Int8Array;case 2:return Int16Array;case 4:return Int32Array}break;case La.FLOAT:return Float32Array}return Float32Array}var bc=Object.freeze({__proto__:null,get ObjectType(){return Pa},get Status(){return Ra},get API(){return Na},get SurfaceTransform(){return Oa},get Feature(){return Da},get Format(){return Ma},get FormatType(){return La},get Type(){return Fa},get BufferUsageBit(){return za},get BufferFlagBit(){return Ba},get MemoryAccessBit(){return Ua},get MemoryUsageBit(){return Ha},get TextureType(){return Ga},get TextureUsageBit(){return ka},get TextureFlagBit(){return Va},get SampleCount(){return Wa},get Filter(){return ja},get Address(){return qa},get ComparisonFunc(){return Ya},get StencilOp(){return Xa},get BlendFactor(){return Ka},get BlendOp(){return Qa},get ColorMask(){return Za},get ShaderStageFlagBit(){return Ja},get LoadOp(){return $a},get StoreOp(){return es},get AccessType(){return ts},get PipelineBindPoint(){return ns},get PrimitiveMode(){return is},get PolygonMode(){return os},get ShadeModel(){return rs},get CullMode(){return as},get DynamicStateFlagBit(){return ss},get StencilFace(){return cs},get DescriptorType(){return ls},get QueueType(){return us},get CommandBufferType(){return hs},get ClearFlagBit(){return _s},Size:vs,DeviceCaps:gs,Offset:ys,Rect:xs,Extent:Ss,TextureSubresLayers:Es,TextureSubresRange:Ts,TextureCopy:As,TextureBlit:Cs,BufferTextureCopy:ws,Viewport:bs,Color:Is,BindingMappingInfo:Ps,BufferInfo:Rs,BufferViewInfo:Ns,DrawInfo:Os,DispatchInfo:Ds,IndirectBuffer:Ms,TextureInfo:Ls,TextureViewInfo:Fs,SamplerInfo:zs,Uniform:Bs,UniformBlock:Us,UniformSamplerTexture:Hs,UniformSampler:Gs,UniformTexture:ks,UniformStorageImage:Vs,UniformStorageBuffer:Ws,UniformInputAttachment:js,ShaderStage:qs,Attribute:Ys,ShaderInfo:Xs,InputAssemblerInfo:Ks,ColorAttachment:Qs,DepthStencilAttachment:Zs,SubpassInfo:Js,RenderPassInfo:$s,GlobalBarrierInfo:ec,TextureBarrierInfo:tc,FramebufferInfo:nc,DescriptorSetLayoutBinding:ic,DescriptorSetLayoutInfo:oc,DescriptorSetInfo:rc,PipelineLayoutInfo:ac,InputState:sc,CommandBufferInfo:cc,QueueInfo:lc,FormatInfo:uc,MemoryStatus:hc,DynamicStencilStates:_c,DynamicStates:fc,Obj:dc,DeviceInfo:pc,get AttributeName(){return ms},FormatInfos:mc,DESCRIPTOR_BUFFER_TYPE:vc,DESCRIPTOR_SAMPLER_TYPE:gc,DESCRIPTOR_DYNAMIC_TYPE:yc,DRAW_INFO_SIZE:xc,IsPowerOf2:Sc,FormatSize:Ec,FormatSurfaceSize:Tc,GetTypeSize:Cc,getTypedArrayConstructor:wc}),Ic=e("B",function(e){function t(t){var n;return(n=e.call(this,Pa.BUFFER)||this)._device=void 0,n._usage=za.NONE,n._memUsage=Ha.NONE,n._size=0,n._stride=1,n._count=0,n._flags=Ba.NONE,n._indirectBuffer=null,n._isBufferView=!1,n._device=t,n}return ie(t,e),te(t,[{key:"usage",get:function(){return this._usage}},{key:"memUsage",get:function(){return this._memUsage}},{key:"size",get:function(){return this._size}},{key:"stride",get:function(){return this._stride}},{key:"count",get:function(){return this._count}},{key:"flags",get:function(){return this._flags}}]),t}(dc)),Pc=e("a",function(e){function t(t){var n;return(n=e.call(this,Pa.COMMAND_BUFFER)||this)._device=void 0,n._queue=null,n._type=hs.PRIMARY,n._numDrawCalls=0,n._numInstances=0,n._numTris=0,n._device=t,n}return ie(t,e),te(t,[{key:"type",get:function(){return this._type}},{key:"queue",get:function(){return this._queue}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}}]),t}(dc));ht(Ma);var Rc=e("aS",function(){function e(){this._canvas=null,this._canvas2D=null,this._gfxAPI=Na.UNKNOWN,this._transform=Oa.IDENTITY,this._deviceName="",this._renderer="",this._vendor="",this._version="",this._features=new Array(Da.COUNT),this._queue=null,this._cmdBuff=null,this._devicePixelRatio=1,this._width=0,this._height=0,this._nativeWidth=0,this._nativeHeight=0,this._colorFmt=Ma.UNKNOWN,this._depthStencilFmt=Ma.UNKNOWN,this._numDrawCalls=0,this._numInstances=0,this._numTris=0,this._memoryStatus=new hc,this._caps=new gs}return e.prototype.hasFeature=function(e){return this._features[e]},te(e,[{key:"canvas",get:function(){return this._canvas}},{key:"canvas2D",get:function(){return this._canvas2D}},{key:"gfxAPI",get:function(){return this._gfxAPI}},{key:"queue",get:function(){return this._queue}},{key:"commandBuffer",get:function(){return this._cmdBuff}},{key:"devicePixelRatio",get:function(){return this._devicePixelRatio}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"nativeWidth",get:function(){return this._nativeWidth}},{key:"nativeHeight",get:function(){return this._nativeHeight}},{key:"renderer",get:function(){return this._renderer}},{key:"vendor",get:function(){return this._vendor}},{key:"colorFormat",get:function(){return this._colorFmt}},{key:"depthStencilFormat",get:function(){return this._depthStencilFmt}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}},{key:"memoryStatus",get:function(){return this._memoryStatus}},{key:"capabilities",get:function(){return this._caps}},{key:"surfaceTransform",get:function(){return this._transform}}]),e}()),Nc=e("aT",function(e){function t(t){var n;return(n=e.call(this,Pa.FRAMEBUFFER)||this)._device=void 0,n._renderPass=null,n._colorTextures=[],n._depthStencilTexture=null,n._device=t,n}return ie(t,e),te(t,[{key:"renderPass",get:function(){return this._renderPass}},{key:"colorTextures",get:function(){return this._colorTextures}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}}]),t}(dc)),Oc=String.prototype.charCodeAt;function Dc(e){return this[e]}function Mc(e,t){for(var n=e.length,i=t^n,o=0,r="string"==typeof e?Oc:Dc;n>=4;){var a=255&r.call(e,o)|(255&r.call(e,++o))<<8|(255&r.call(e,++o))<<16|(255&r.call(e,++o))<<24;a=1540483477*(65535&a)+((1540483477*(a>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),n-=4,++o}switch(n){case 3:i^=(255&r.call(e,o+2))<<16;case 2:i^=(255&r.call(e,o+1))<<8;case 1:i=1540483477*(65535&(i^=255&r.call(e,o)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}var Lc=e("aU",function(e){function t(t){var n;return(n=e.call(this,Pa.INPUT_ASSEMBLER)||this)._device=void 0,n._attributes=[],n._vertexBuffers=[],n._indexBuffer=null,n._vertexCount=0,n._firstVertex=0,n._indexCount=0,n._firstIndex=0,n._vertexOffset=0,n._instanceCount=0,n._firstInstance=0,n._attributesHash=0,n._indirectBuffer=null,n._device=t,n}ie(t,e);var n=t.prototype;return n.getVertexBuffer=function(e){return void 0===e&&(e=0),e<this._vertexBuffers.length?this._vertexBuffers[e]:null},n.computeAttributesHash=function(){for(var e="attrs",t=0;t<this.attributes.length;++t){var n=this.attributes[t];e+=","+n.name+","+n.format+","+n.isNormalized+","+n.stream+","+n.isInstanced}return Mc(e,666)},te(t,[{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"attributes",get:function(){return this._attributes}},{key:"attributesHash",get:function(){return this._attributesHash}},{key:"vertexCount",get:function(){return this._vertexCount},set:function(e){this._vertexCount=e}},{key:"firstVertex",get:function(){return this._firstVertex},set:function(e){this._firstVertex=e}},{key:"indexCount",get:function(){return this._indexCount},set:function(e){this._indexCount=e}},{key:"firstIndex",get:function(){return this._firstIndex},set:function(e){this._firstIndex=e}},{key:"vertexOffset",get:function(){return this._vertexOffset},set:function(e){this._vertexOffset=e}},{key:"instanceCount",get:function(){return this._instanceCount},set:function(e){this._instanceCount=e}},{key:"firstInstance",get:function(){return this._firstInstance},set:function(e){this._firstInstance=e}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}}]),t}(dc)),Fc=e("D",function(e){function t(t){var n;return(n=e.call(this,Pa.DESCRIPTOR_SET)||this)._device=void 0,n._layout=null,n._buffers=[],n._textures=[],n._samplers=[],n._isDirty=!1,n._device=t,n}ie(t,e);var n=t.prototype;return n.bindBuffer=function(e,t,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[e],o=this._layout.bindings[i];if(o&&o.descriptorType&vc){var r=this._layout.descriptorIndices[e];this._buffers[r+n]!==t&&(this._buffers[r+n]=t,this._isDirty=!0)}},n.bindSampler=function(e,t,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[e],o=this._layout.bindings[i];if(o&&o.descriptorType&gc){var r=this._layout.descriptorIndices[e];this._samplers[r+n]!==t&&(this._samplers[r+n]=t,this._isDirty=!0)}},n.bindTexture=function(e,t,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[e],o=this._layout.bindings[i];if(o&&o.descriptorType&gc){var r=this._layout.descriptorIndices[e];this._textures[r+n]!==t&&(this._textures[r+n]=t,this._isDirty=!0)}},n.getBuffer=function(e,t){void 0===t&&(t=0);var n=this._layout.descriptorIndices[e];return this._buffers[n+t]},n.getSampler=function(e,t){void 0===t&&(t=0);var n=this._layout.descriptorIndices[e];return this._samplers[n+t]},n.getTexture=function(e,t){void 0===t&&(t=0);var n=this._layout.descriptorIndices[e];return this._textures[n+t]},te(t,[{key:"layout",get:function(){return this._layout}}]),t}(dc)),zc=e("aV",function(e){function t(t){var n;return(n=e.call(this,Pa.DESCRIPTOR_SET_LAYOUT)||this)._device=void 0,n._bindings=[],n._bindingIndices=[],n._descriptorIndices=[],n._device=t,n}return ie(t,e),te(t,[{key:"bindings",get:function(){return this._bindings}},{key:"bindingIndices",get:function(){return this._bindingIndices}},{key:"descriptorIndices",get:function(){return this._descriptorIndices}}]),t}(dc)),Bc=e("aW",function(e){function t(t){var n;return(n=e.call(this,Pa.PIPELINE_LAYOUT)||this)._device=void 0,n._setLayouts=[],n._device=t,n}return ie(t,e),te(t,[{key:"setLayouts",get:function(){return this._setLayouts}}]),t}(dc)),Uc=e("aX",function(){function e(e,t,n,i,o,r,a,s,c,l,u,h){void 0===e&&(e=!1),void 0===t&&(t=os.FILL),void 0===n&&(n=rs.GOURAND),void 0===i&&(i=as.BACK),void 0===o&&(o=!0),void 0===r&&(r=!1),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=!0),void 0===u&&(u=!1),void 0===h&&(h=1),this.isDiscard=e,this.polygonMode=t,this.shadeModel=n,this.cullMode=i,this.isFrontFaceCCW=o,this.depthBiasEnabled=r,this.depthBias=a,this.depthBiasClamp=s,this.depthBiasSlop=c,this.isDepthClip=l,this.isMultisample=u,this.lineWidth=h}var t=e.prototype;return t.reset=function(){this.isDiscard=!1,this.polygonMode=os.FILL,this.shadeModel=rs.GOURAND,this.cullMode=as.BACK,this.isFrontFaceCCW=!0,this.depthBiasEnabled=!1,this.depthBias=0,this.depthBiasClamp=0,this.depthBiasSlop=0,this.isDepthClip=!0,this.isMultisample=!1,this.lineWidth=1},t.assign=function(e){Object.assign(this,e)},t.destroy=function(){},te(e,[{key:"handle",get:function(){return No}}]),e}()),Hc=e("aY",function(){function e(e,t,n,i,o,r,a,s,c,l,u,h,_,f,d,p,m,v,g){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===n&&(n=Ya.LESS),void 0===i&&(i=!1),void 0===o&&(o=Ya.ALWAYS),void 0===r&&(r=65535),void 0===a&&(a=65535),void 0===s&&(s=Xa.KEEP),void 0===c&&(c=Xa.KEEP),void 0===l&&(l=Xa.KEEP),void 0===u&&(u=1),void 0===h&&(h=!1),void 0===_&&(_=Ya.ALWAYS),void 0===f&&(f=65535),void 0===d&&(d=65535),void 0===p&&(p=Xa.KEEP),void 0===m&&(m=Xa.KEEP),void 0===v&&(v=Xa.KEEP),void 0===g&&(g=1),this.depthTest=e,this.depthWrite=t,this.depthFunc=n,this.stencilTestFront=i,this.stencilFuncFront=o,this.stencilReadMaskFront=r,this.stencilWriteMaskFront=a,this.stencilFailOpFront=s,this.stencilZFailOpFront=c,this.stencilPassOpFront=l,this.stencilRefFront=u,this.stencilTestBack=h,this.stencilFuncBack=_,this.stencilReadMaskBack=f,this.stencilWriteMaskBack=d,this.stencilFailOpBack=p,this.stencilZFailOpBack=m,this.stencilPassOpBack=v,this.stencilRefBack=g}var t=e.prototype;return t.reset=function(){this.depthTest=!0,this.depthWrite=!0,this.depthFunc=Ya.LESS,this.stencilTestFront=!1,this.stencilFuncFront=Ya.ALWAYS,this.stencilReadMaskFront=65535,this.stencilWriteMaskFront=65535,this.stencilFailOpFront=Xa.KEEP,this.stencilZFailOpFront=Xa.KEEP,this.stencilPassOpFront=Xa.KEEP,this.stencilRefFront=1,this.stencilTestBack=!1,this.stencilFuncBack=Ya.ALWAYS,this.stencilReadMaskBack=65535,this.stencilWriteMaskBack=65535,this.stencilFailOpBack=Xa.KEEP,this.stencilZFailOpBack=Xa.KEEP,this.stencilPassOpBack=Xa.KEEP,this.stencilRefBack=1},t.assign=function(e){Object.assign(this,e)},t.destroy=function(){},te(e,[{key:"handle",get:function(){return No}}]),e}()),Gc=e("aZ",function(){function e(e,t,n,i,o,r,a,s){void 0===e&&(e=!1),void 0===t&&(t=Ka.ONE),void 0===n&&(n=Ka.ZERO),void 0===i&&(i=Qa.ADD),void 0===o&&(o=Ka.ONE),void 0===r&&(r=Ka.ZERO),void 0===a&&(a=Qa.ADD),void 0===s&&(s=Za.ALL),this.blend=e,this.blendSrc=t,this.blendDst=n,this.blendEq=i,this.blendSrcAlpha=o,this.blendDstAlpha=r,this.blendAlphaEq=a,this.blendColorMask=s}var t=e.prototype;return t.reset=function(){this.blend=!1,this.blendSrc=Ka.ONE,this.blendDst=Ka.ZERO,this.blendEq=Qa.ADD,this.blendSrcAlpha=Ka.ONE,this.blendDstAlpha=Ka.ZERO,this.blendAlphaEq=Qa.ADD,this.blendColorMask=Za.ALL},t.assign=function(e){Object.assign(this,e)},t.destroy=function(){},te(e,[{key:"handle",get:function(){return No}}]),e}()),kc=e("a_",function(){function e(e,t,n,i){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=new Is),void 0===i&&(i=[new Gc]),this.isA2C=e,this.isIndepend=t,this.blendColor=n,this.targets=i}var t=e.prototype;return t.setTarget=function(e,t){var n=this.targets[e];n||(n=this.targets[e]=new Gc),Object.assign(n,t)},t.reset=function(){this.isA2C=!1,this.isIndepend=!1,this.blendColor.x=0,this.blendColor.y=0,this.blendColor.z=0,this.blendColor.w=0,this.targets.length=1,this.targets[0].reset()},t.destroy=function(){},te(e,[{key:"handle",get:function(){return No}}]),e}()),Vc=e("a$",(function(e,t,n,i,o,r,a,s,c,l){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=new sc),void 0===o&&(o=new Uc),void 0===r&&(r=new Hc),void 0===a&&(a=new kc),void 0===s&&(s=is.TRIANGLE_LIST),void 0===c&&(c=ss.NONE),void 0===l&&(l=ns.GRAPHICS),this.shader=e,this.pipelineLayout=t,this.renderPass=n,this.inputState=i,this.rasterizerState=o,this.depthStencilState=r,this.blendState=a,this.primitive=s,this.dynamicStates=c,this.bindPoint=l})),Wc=e("b0",function(e){function t(t){var n;return(n=e.call(this,Pa.PIPELINE_STATE)||this)._device=void 0,n._shader=null,n._pipelineLayout=null,n._primitive=is.TRIANGLE_LIST,n._is=null,n._rs=new Uc,n._dss=new Hc,n._bs=new kc,n._dynamicStates=ss.NONE,n._renderPass=null,n._device=t,n}return ie(t,e),te(t,[{key:"shader",get:function(){return this._shader}},{key:"pipelineLayout",get:function(){return this._pipelineLayout}},{key:"primitive",get:function(){return this._primitive}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"inputState",get:function(){return this._is}},{key:"dynamicStates",get:function(){return this._dynamicStates}},{key:"renderPass",get:function(){return this._renderPass}}]),t}(dc)),jc=e("b1",function(e){function t(t){var n;return(n=e.call(this,Pa.QUEUE)||this)._device=void 0,n._type=us.GRAPHICS,n._isAsync=!1,n._device=t,n}return ie(t,e),t.prototype.isAsync=function(){return this._isAsync},te(t,[{key:"type",get:function(){return this._type}}]),t}(dc)),qc=e("b2",function(e){function t(t){var n;return(n=e.call(this,Pa.RENDER_PASS)||this)._device=void 0,n._colorInfos=[],n._depthStencilInfo=null,n._subpasses=[],n._hash=0,n._device=t,n}return ie(t,e),t.prototype.computeHash=function(){var e="";if(this._subpasses.length)for(var t=0;t<this._subpasses.length;++t){var n=this._subpasses[t];if(n.inputs.length){e+="ia";for(var i=0;i<n.inputs.length;++i){var o=this._colorInfos[n.inputs[i]];e+=","+o.format+","+o.sampleCount}}if(n.colors.length){e+="ca";for(var r=0;r<n.inputs.length;++r){var a=this._colorInfos[n.inputs[r]];e+=","+a.format+","+a.sampleCount}}if(n.depthStencil>=0){var s=this._colorInfos[n.depthStencil];e+="ds,"+s.format+","+s.sampleCount}}else{e+="ca";for(var c=0;c<this._colorInfos.length;++c){var l=this._colorInfos[c];e+=","+l.format+","+l.sampleCount}var u=this._depthStencilInfo;u&&(e+="ds,"+u.format+","+u.sampleCount)}return Mc(e,666)},te(t,[{key:"colorAttachments",get:function(){return this._colorInfos}},{key:"depthStencilAttachment",get:function(){return this._depthStencilInfo}},{key:"subPasses",get:function(){return this._subpasses}},{key:"hash",get:function(){return this._hash}}]),t}(dc)),Yc=e("b3",function(e){function t(t){var n;return(n=e.call(this,Pa.SAMPLER)||this)._device=void 0,n._minFilter=ja.LINEAR,n._magFilter=ja.LINEAR,n._mipFilter=ja.NONE,n._addressU=qa.WRAP,n._addressV=qa.WRAP,n._addressW=qa.WRAP,n._maxAnisotropy=16,n._cmpFunc=Ya.NEVER,n._borderColor=new Is,n._mipLODBias=0,n._device=t,n}return ie(t,e),te(t,[{key:"minFilter",get:function(){return this._minFilter}},{key:"magFilter",get:function(){return this._magFilter}},{key:"mipFilter",get:function(){return this._mipFilter}},{key:"addressU",get:function(){return this._addressU}},{key:"addressV",get:function(){return this._addressV}},{key:"addressW",get:function(){return this._addressW}},{key:"maxAnisotropy",get:function(){return this._maxAnisotropy}},{key:"cmpFunc",get:function(){return this._cmpFunc}},{key:"borderColor",get:function(){return this._borderColor}},{key:"mipLODBias",get:function(){return this._mipLODBias}}]),t}(dc)),Xc=e("b4",function(e){function t(n){var i;return(i=e.call(this,Pa.SHADER)||this)._device=void 0,i._id=void 0,i._name="",i._stages=[],i._attributes=[],i._blocks=[],i._samplers=[],i._device=n,i._id=t._shaderIdGen++,i}return ie(t,e),te(t,[{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"attributes",get:function(){return this._attributes}},{key:"blocks",get:function(){return this._blocks}},{key:"samplers",get:function(){return this._samplers}}]),t}(dc));Xc._shaderIdGen=0;var Kc=e("b5",function(e){function t(t){var n;return(n=e.call(this,Pa.TEXTURE)||this)._device=void 0,n._type=Ga.TEX2D,n._usage=ka.NONE,n._format=Ma.UNKNOWN,n._width=0,n._height=0,n._depth=1,n._layerCount=1,n._levelCount=1,n._samples=Wa.X1,n._flags=Va.NONE,n._isPowerOf2=!1,n._size=0,n._device=t,n}return ie(t,e),te(t,[{key:"type",get:function(){return this._type}},{key:"usage",get:function(){return this._usage}},{key:"format",get:function(){return this._format}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"depth",get:function(){return this._depth}},{key:"layerCount",get:function(){return this._layerCount}},{key:"levelCount",get:function(){return this._levelCount}},{key:"samples",get:function(){return this._samples}},{key:"flags",get:function(){return this._flags}},{key:"size",get:function(){return this._size}}]),t}(dc)),Qc=e("b6",function(e){function t(t){var n;return(n=e.call(this,Pa.GLOBAL_BARRIER)||this)._device=void 0,n._info=new ec,n._device=t,n}return ie(t,e),t.prototype.initialize=function(e){return this._info.copy(e),!0},t}(dc)),Zc=e("b7",function(e){function t(t){var n;return(n=e.call(this,Pa.TEXTURE_BARRIER)||this)._device=void 0,n._info=new tc,n._device=t,n}return ie(t,e),t.prototype.initialize=function(e){return this._info.copy(e),!0},t}(dc)),Jc={Device:Rc,Buffer:Ic,Texture:Kc,Sampler:Yc,Shader:Xc,InputAssembler:Lc,RenderPass:qc,Framebuffer:Nc,DescriptorSet:Fc,DescriptorSetLayout:zc,PipelineLayout:Bc,PipelineState:Wc,CommandBuffer:Pc,Queue:jc,GlobalBarrier:Qc,TextureBarrier:Zc,RasterizerState:Uc,BlendState:kc,BlendTarget:Gc,DepthStencilState:Hc,PipelineStateInfo:Vc};Object.assign(Jc,bc),c.gfx=Jc;var $c,el={Obj:"GFXObject",DRAW_INFO_SIZE:"GFX_DRAW_INFO_SIZE",DESCRIPTOR_BUFFER_TYPE:"",DESCRIPTOR_SAMPLER_TYPE:"",DESCRIPTOR_DYNAMIC_TYPE:"",getTypedArrayConstructor:""};for(var tl in c.gfx)if("__esModule"!==tl){var nl=el[tl];""===nl?nl=tl:void 0===nl&&(nl="GFX"+tl),q(c,"cc",[{name:nl,newName:tl,target:c.gfx,targetName:"cc.gfx"}])}!function(e){e[e.ALL=0]="ALL",e[e.CLOSEST=1]="CLOSEST",e[e.ANY=2]="ANY"}($c||($c={}));var il,ol,rl,al,sl,cl,ll,ul,hl=(il=new Rn(0,0,0),function(e,t){var n=Rn.dot(e.d,t.n);if(Math.abs(n)<Number.EPSILON)return 0;Rn.multiplyScalar(il,t.n,t.d);var i=Rn.dot(Rn.subtract(il,il,e.o),t.n)/n;return i<0?0:i}),_l=(ol=new Rn(0,0,0),rl=new Rn(0,0,0),al=new Rn(0,0,0),sl=new Rn(0,0,0),cl=new Rn(0,0,0),function(e,t,n){Rn.subtract(ol,t.b,t.a),Rn.subtract(rl,t.c,t.a),Rn.cross(al,e.d,rl);var i=Rn.dot(ol,al);if(i<Number.EPSILON&&(!n||i>-Number.EPSILON))return 0;var o=1/i;Rn.subtract(sl,e.o,t.a);var r=Rn.dot(sl,al)*o;if(r<0||r>1)return 0;Rn.cross(cl,sl,ol);var a=Rn.dot(e.d,cl)*o;if(a<0||r+a>1)return 0;var s=Rn.dot(rl,cl)*o;return s<0?0:s}),fl=function(){var e=new Rn(0,0,0);return function(t,n){var i=n.radius,o=n.center,r=t.o,a=t.d,s=i*i;Rn.subtract(e,o,r);var c=e.lengthSqr(),l=Rn.dot(e,a),u=s-(c-l*l);if(u<0)return 0;var h=Math.sqrt(u),_=c<s?l+h:l-h;return _<0?0:_}}(),dl=(ll=new Rn,ul=new Rn,function(e,t){return Rn.subtract(ll,t.center,t.halfExtents),Rn.add(ul,t.center,t.halfExtents),pl(e,ll,ul)});function pl(e,t,n){var i=e.o,o=e.d,r=1/o.x,a=1/o.y,s=1/o.z,c=(t.x-i.x)*r,l=(n.x-i.x)*r,u=(t.y-i.y)*a,h=(n.y-i.y)*a,_=(t.z-i.z)*s,f=(n.z-i.z)*s,d=Math.max(Math.max(Math.min(c,l),Math.min(u,h)),Math.min(_,f)),p=Math.min(Math.min(Math.max(c,l),Math.max(u,h)),Math.max(_,f));return p<0||d>p?0:d>0?d:p}var ml,vl,gl,yl,xl=function(){var e=new Rn,t=new Rn,n=new Rn,i=new Rn,o=new Rn,r=new Rn,a=new Rn,s=new Array(3),c=new Array(3),l=new Array(3),u=new Array(6);return function(h,_){s[0]=_.halfExtents.x,s[1]=_.halfExtents.y,s[2]=_.halfExtents.z,e=_.center,t=h.o,n=h.d,Rn.set(i,_.orientation.m00,_.orientation.m01,_.orientation.m02),Rn.set(o,_.orientation.m03,_.orientation.m04,_.orientation.m05),Rn.set(r,_.orientation.m06,_.orientation.m07,_.orientation.m08),Rn.subtract(a,e,t),c[0]=Rn.dot(i,n),c[1]=Rn.dot(o,n),c[2]=Rn.dot(r,n),l[0]=Rn.dot(i,a),l[1]=Rn.dot(o,a),l[2]=Rn.dot(r,a);for(var f=0;f<3;++f){if(0===c[f]){if(-l[f]-s[f]>0||-l[f]+s[f]<0)return 0;c[f]=1e-7}u[2*f+0]=(l[f]+s[f])/c[f],u[2*f+1]=(l[f]-s[f])/c[f]}var d=Math.max(Math.max(Math.min(u[0],u[1]),Math.min(u[2],u[3])),Math.min(u[4],u[5])),p=Math.min(Math.min(Math.max(u[0],u[1]),Math.max(u[2],u[3])),Math.max(u[4],u[5]));return p<0||d>p?0:d>0?d:p}}(),Sl=function(){var e=new Rn,t=new Rn,n=new Rn,i=new Rn,o=new Rn,r=new Rn,a=new Rn,s=new fs;return function(c,l){var u=l.radius*l.radius,h=Rn.normalize(e,c.d),_=l.ellipseCenter0,f=l.ellipseCenter1,d=Rn.subtract(t,f,_);if(d.equals(Rn.ZERO))return s.radius=l.radius,s.center.set(l.ellipseCenter0),ru.raySphere(c,s);var p=c.o,m=Rn.subtract(n,p,_),v=Rn.cross(i,h,d),g=v.lengthSqr();if(0===g){s.radius=l.radius;var y=Rn.subtract(o,f,p);return m.lengthSqr()<y.lengthSqr()?s.center.set(l.ellipseCenter0):s.center.set(l.ellipseCenter1),ru.raySphere(c,s)}var x=Rn.cross(o,m,d),S=d.lengthSqr(),E=2*Rn.dot(v,x),T=E*E-4*g*(x.lengthSqr()-u*S);if(T<0)return 0;var A=(-E-Math.sqrt(T))/(2*g);if(A<0){s.radius=l.radius;var C=Rn.subtract(r,f,p);return m.lengthSqr()<C.lengthSqr()?s.center.set(l.ellipseCenter0):s.center.set(l.ellipseCenter1),ru.raySphere(c,s)}var w=Rn.scaleAndAdd(r,c.o,h,A),b=Rn.subtract(a,w,_),I=Rn.dot(b,d)/S;return I>=0&&I<=1?A:I<0?(s.radius=l.radius,s.center.set(l.ellipseCenter0),ru.raySphere(c,s)):I>1?(s.radius=l.radius,s.center.set(l.ellipseCenter1),ru.raySphere(c,s)):0}}(),El=(ml=ds.create(),vl={distance:1/0,doubleSided:!1,mode:$c.ANY},gl=0,yl=function(e,t,n,i,o,r){e===$c.CLOSEST?(gl>t||0===gl)&&(gl=t,r&&(0===r.length?r.push({distance:t,vertexIndex0:n/3,vertexIndex1:i/3,vertexIndex2:o/3}):(r[0].distance=t,r[0].vertexIndex0=n/3,r[0].vertexIndex1=i/3,r[0].vertexIndex2=o/3))):(gl=t,r&&r.push({distance:t,vertexIndex0:n/3,vertexIndex1:i/3,vertexIndex2:o/3}))},function(e,t,n){if(gl=0,0===t.geometricInfo.positions.length)return gl;var i=void 0===n?vl:n;if(pl(e,t.geometricInfo.boundingBox.min,t.geometricInfo.boundingBox.max)){var o=t.primitiveMode,r=t.geometricInfo;!function(e,t,n,i,o){if(n===is.TRIANGLE_LIST)for(var r=t.length,a=0;a<r;a+=3){var s=3*t[a],c=3*t[a+1],l=3*t[a+2];Rn.set(ml.a,e[s],e[s+1],e[s+2]),Rn.set(ml.b,e[c],e[c+1],e[c+2]),Rn.set(ml.c,e[l],e[l+1],e[l+2]);var u=ru.rayTriangle(i,ml,o.doubleSided);if(!(0===u||u>o.distance)&&(yl(o.mode,u,s,c,l,o.result),o.mode===$c.ANY))return u}else if(n===is.TRIANGLE_STRIP)for(var h=t.length-2,_=0,f=0;f<h;f+=1){var d=3*t[f-_],p=3*t[f+_+1],m=3*t[f+2];Rn.set(ml.a,e[d],e[d+1],e[d+2]),Rn.set(ml.b,e[p],e[p+1],e[p+2]),Rn.set(ml.c,e[m],e[m+1],e[m+2]),_=~_;var v=ru.rayTriangle(i,ml,o.doubleSided);if(!(0===v||v>o.distance)&&(yl(o.mode,v,d,p,m,o.result),o.mode===$c.ANY))return v}else if(n===is.TRIANGLE_FAN){var g=t.length-1,y=3*t[0];Rn.set(ml.a,e[y],e[y+1],e[y+2]);for(var x=1;x<g;x+=1){var S=3*t[x],E=3*t[x+1];Rn.set(ml.b,e[S],e[S+1],e[S+2]),Rn.set(ml.c,e[E],e[E+1],e[E+2]);var T=ru.rayTriangle(i,ml,o.doubleSided);if(!(0===T||T>o.distance)&&(yl(o.mode,T,y,S,E,o.result),o.mode===$c.ANY))return T}}}(r.positions,r.indices,o,e,i)}return gl}),Tl=function(){var e=0,t={distance:1/0,doubleSided:!1,mode:$c.ANY};return function(n,i,o){e=0;var r=void 0===o?t:o,a=i.renderingSubMeshes.length,s=i.struct.minPosition,c=i.struct.maxPosition;if(s&&c&&!pl(n,s,c))return e;for(var l=0;l<a;l++){var u=i.renderingSubMeshes[l],h=El(n,u,r);if(h)if(r.mode===$c.CLOSEST)(0===e||e>h)&&(e=h,r.subIndices&&(r.subIndices[0]=l));else if(e=h,r.subIndices&&r.subIndices.push(l),r.mode===$c.ANY)return h}return e&&r.mode===$c.CLOSEST&&(r.result&&(r.result[0].distance=e,r.result.length=1),r.subIndices&&(r.subIndices.length=1)),e}}(),Al=function(){var e=0,t={distance:1/0,doubleSided:!1,mode:$c.ANY},n=new Ta,i=new jn;return function(o,r,a){e=0;var s=void 0===a?t:a,c=r.worldBounds;if(c&&!dl(o,c))return e;Ta.copy(n,o),r.node&&(jn.invert(i,r.node.getWorldMatrix(i)),Rn.transformMat4(n.o,o.o,i),Rn.transformMat4Normal(n.d,o.d,i));for(var l=r.subModels,u=0;u<l.length;u++){var h=l[u].subMesh,_=El(n,h,s);if(_)if(s.mode===$c.CLOSEST)(0===e||e>_)&&(e=_,s.subIndices&&(s.subIndices[0]=u));else if(e=_,s.subIndices&&s.subIndices.push(u),s.mode===$c.ANY)return _}return e&&s.mode===$c.CLOSEST&&(s.result&&(s.result[0].distance=e,s.result.length=1),s.subIndices&&(s.subIndices.length=1)),e}}(),Cl=function(){var e=new Rn(0,0,0);return function(t,n){Rn.subtract(e,t.e,t.s);var i=(n.d-Rn.dot(t.s,n.n))/Rn.dot(e,n.n);return i<0||i>1?0:i}}(),wl=function(){var e=new Rn(0,0,0),t=new Rn(0,0,0),n=new Rn(0,0,0),i=new Rn(0,0,0),o=new Rn(0,0,0),r=new Rn(0,0,0);return function(a,s,c){Rn.subtract(e,s.b,s.a),Rn.subtract(t,s.c,s.a),Rn.subtract(n,a.s,a.e),Rn.cross(o,e,t);var l=Rn.dot(n,o);if(l<=0)return 0;Rn.subtract(i,a.s,s.a);var u=Rn.dot(i,o);if(u<0||u>l)return 0;Rn.cross(r,n,i);var h=Rn.dot(t,r);if(h<0||h>l)return 0;var _=-Rn.dot(e,r);if(_<0||h+_>l)return 0;if(c){var f=1/l,d=1-(h*=f)-(_*=f);Rn.set(c,s.a.x*d+s.b.x*h+s.c.x*_,s.a.y*d+s.b.y*h+s.c.y*_,s.a.z*d+s.b.z*h+s.c.z*_)}return 1}}(),bl=new Ta;function Il(e,t){bl.o.set(e.s),Rn.subtract(bl.d,e.e,e.s),bl.d.normalize();var n=dl(bl,t);return n<=e.length()?n:0}function Pl(e,t){bl.o.set(e.s),Rn.subtract(bl.d,e.e,e.s),bl.d.normalize();var n=xl(bl,t);return n<=e.length()?n:0}function Rl(e,t){bl.o.set(e.s),Rn.subtract(bl.d,e.e,e.s),bl.d.normalize();var n=fl(bl,t);return n<=e.length()?n:0}var Nl,Ol,Dl,Ml,Ll=(Nl=new Rn,Ol=new Rn,Dl=new Rn,Ml=new Rn,function(e,t){return Rn.subtract(Nl,e.center,e.halfExtents),Rn.add(Ol,e.center,e.halfExtents),Rn.subtract(Dl,t.center,t.halfExtents),Rn.add(Ml,t.center,t.halfExtents),Nl.x<=Ml.x&&Ol.x>=Dl.x&&Nl.y<=Ml.y&&Ol.y>=Dl.y&&Nl.z<=Ml.z&&Ol.z>=Dl.z});function Fl(e,t,n,i,o,r){Rn.set(r[0],e.x+n.x*t.x+i.x*t.y+o.x*t.z,e.y+n.y*t.x+i.y*t.y+o.y*t.z,e.z+n.z*t.x+i.z*t.y+o.z*t.z),Rn.set(r[1],e.x-n.x*t.x+i.x*t.y+o.x*t.z,e.y-n.y*t.x+i.y*t.y+o.y*t.z,e.z-n.z*t.x+i.z*t.y+o.z*t.z),Rn.set(r[2],e.x+n.x*t.x-i.x*t.y+o.x*t.z,e.y+n.y*t.x-i.y*t.y+o.y*t.z,e.z+n.z*t.x-i.z*t.y+o.z*t.z),Rn.set(r[3],e.x+n.x*t.x+i.x*t.y-o.x*t.z,e.y+n.y*t.x+i.y*t.y-o.y*t.z,e.z+n.z*t.x+i.z*t.y-o.z*t.z),Rn.set(r[4],e.x-n.x*t.x-i.x*t.y-o.x*t.z,e.y-n.y*t.x-i.y*t.y-o.y*t.z,e.z-n.z*t.x-i.z*t.y-o.z*t.z),Rn.set(r[5],e.x+n.x*t.x-i.x*t.y-o.x*t.z,e.y+n.y*t.x-i.y*t.y-o.y*t.z,e.z+n.z*t.x-i.z*t.y-o.z*t.z),Rn.set(r[6],e.x-n.x*t.x+i.x*t.y-o.x*t.z,e.y-n.y*t.x+i.y*t.y-o.y*t.z,e.z-n.z*t.x+i.z*t.y-o.z*t.z),Rn.set(r[7],e.x-n.x*t.x-i.x*t.y+o.x*t.z,e.y-n.y*t.x-i.y*t.y+o.y*t.z,e.z-n.z*t.x-i.z*t.y+o.z*t.z)}function zl(e,t){for(var n=Rn.dot(t,e[0]),i=n,o=1;o<8;++o){var r=Rn.dot(t,e[o]);n=r<n?r:n,i=r>i?r:i}return[n,i]}var Bl,Ul,Hl,Gl=function(){for(var e=new Array(15),t=0;t<15;t++)e[t]=new Rn(0,0,0);for(var n=new Array(8),i=new Array(8),o=0;o<8;o++)n[o]=new Rn(0,0,0),i[o]=new Rn(0,0,0);var r=new Rn,a=new Rn;return function(t,o){Rn.set(e[0],1,0,0),Rn.set(e[1],0,1,0),Rn.set(e[2],0,0,1),Rn.set(e[3],o.orientation.m00,o.orientation.m01,o.orientation.m02),Rn.set(e[4],o.orientation.m03,o.orientation.m04,o.orientation.m05),Rn.set(e[5],o.orientation.m06,o.orientation.m07,o.orientation.m08);for(var s=0;s<3;++s)Rn.cross(e[6+3*s],e[s],e[0]),Rn.cross(e[7+3*s],e[s],e[1]),Rn.cross(e[7+3*s],e[s],e[2]);Rn.subtract(r,t.center,t.halfExtents),Rn.add(a,t.center,t.halfExtents),function(e,t,n){Rn.set(n[0],e.x,t.y,t.z),Rn.set(n[1],e.x,t.y,e.z),Rn.set(n[2],e.x,e.y,t.z),Rn.set(n[3],e.x,e.y,e.z),Rn.set(n[4],t.x,t.y,t.z),Rn.set(n[5],t.x,t.y,e.z),Rn.set(n[6],t.x,e.y,t.z),Rn.set(n[7],t.x,e.y,e.z)}(r,a,n),Fl(o.center,o.halfExtents,e[3],e[4],e[5],i);for(var c=0;c<15;++c){var l=zl(n,e[c]),u=zl(i,e[c]);if(u[0]>l[1]||l[0]>u[1])return 0}return 1}}(),kl=function(e,t){var n=e.halfExtents.x*Math.abs(t.n.x)+e.halfExtents.y*Math.abs(t.n.y)+e.halfExtents.z*Math.abs(t.n.z),i=Rn.dot(t.n,e.center);return i+n<t.d?-1:i-n>t.d?0:1},Vl=function(e,t){for(var n=0;n<t.planes.length;n++)if(-1===kl(e,t.planes[n]))return 0;return 1},Wl=function(){for(var e=new Array(8),t=0,n=0,i=0;i<e.length;i++)e[i]=new Rn(0,0,0);return function(i,o){for(var r=0,a=!1,s=0;s<o.planes.length;s++){if(-1===(r=kl(i,o.planes[s])))return 0;1===r&&(a=!0)}if(!a)return 1;for(var c=0;c<o.vertices.length;c++)Rn.subtract(e[c],o.vertices[c],i.center);t=0,n=0;for(var l=0;l<o.vertices.length;l++)e[l].x>i.halfExtents.x?t++:e[l].x<-i.halfExtents.x&&n++;if(t===o.vertices.length||n===o.vertices.length)return 0;t=0,n=0;for(var u=0;u<o.vertices.length;u++)e[u].y>i.halfExtents.y?t++:e[u].y<-i.halfExtents.y&&n++;if(t===o.vertices.length||n===o.vertices.length)return 0;t=0,n=0;for(var h=0;h<o.vertices.length;h++)e[h].z>i.halfExtents.z?t++:e[h].z<-i.halfExtents.z&&n++;return t===o.vertices.length||n===o.vertices.length?0:1}}(),jl=(Bl=new Rn(0,0,0),Ul=new Mn,function(e,t){return Rn.subtract(Bl,t,e.center),Rn.transformMat3(Bl,Bl,Mn.transpose(Ul,e.orientation)),n=Bl,i=e.halfExtents,Math.abs(n.x)<i.x&&Math.abs(n.y)<i.y&&Math.abs(n.z)<i.z;var n,i}),ql=(Hl=function(e,t,n,i){return Math.abs(e.x*t+e.y*n+e.z*i)},function(e,t){var n=e.halfExtents.x*Hl(t.n,e.orientation.m00,e.orientation.m01,e.orientation.m02)+e.halfExtents.y*Hl(t.n,e.orientation.m03,e.orientation.m04,e.orientation.m05)+e.halfExtents.z*Hl(t.n,e.orientation.m06,e.orientation.m07,e.orientation.m08),i=Rn.dot(t.n,e.center);return i+n<t.d?-1:i-n>t.d?0:1}),Yl=function(e,t){for(var n=0;n<t.planes.length;n++)if(-1===ql(e,t.planes[n]))return 0;return 1},Xl=function(){for(var e=new Array(8),t=0,n=0,i=0,o=0;o<e.length;o++)e[o]=new Rn(0,0,0);var r=function(e,t,n,i){return e.x*t+e.y*n+e.z*i};return function(o,a){for(var s=0,c=!1,l=0;l<a.planes.length;l++){if(-1===(s=ql(o,a.planes[l])))return 0;1===s&&(c=!0)}if(!c)return 1;for(var u=0;u<a.vertices.length;u++)Rn.subtract(e[u],a.vertices[u],o.center);n=0,i=0;for(var h=0;h<a.vertices.length;h++)(t=r(e[h],o.orientation.m00,o.orientation.m01,o.orientation.m02))>o.halfExtents.x?n++:t<-o.halfExtents.x&&i++;if(n===a.vertices.length||i===a.vertices.length)return 0;n=0,i=0;for(var _=0;_<a.vertices.length;_++)(t=r(e[_],o.orientation.m03,o.orientation.m04,o.orientation.m05))>o.halfExtents.y?n++:t<-o.halfExtents.y&&i++;if(n===a.vertices.length||i===a.vertices.length)return 0;n=0,i=0;for(var f=0;f<a.vertices.length;f++)(t=r(e[f],o.orientation.m06,o.orientation.m07,o.orientation.m08))>o.halfExtents.z?n++:t<-o.halfExtents.z&&i++;return n===a.vertices.length||i===a.vertices.length?0:1}}(),Kl=function(){for(var e=new Array(15),t=0;t<15;t++)e[t]=new Rn(0,0,0);for(var n=new Array(8),i=new Array(8),o=0;o<8;o++)n[o]=new Rn(0,0,0),i[o]=new Rn(0,0,0);return function(t,o){Rn.set(e[0],t.orientation.m00,t.orientation.m01,t.orientation.m02),Rn.set(e[1],t.orientation.m03,t.orientation.m04,t.orientation.m05),Rn.set(e[2],t.orientation.m06,t.orientation.m07,t.orientation.m08),Rn.set(e[3],o.orientation.m00,o.orientation.m01,o.orientation.m02),Rn.set(e[4],o.orientation.m03,o.orientation.m04,o.orientation.m05),Rn.set(e[5],o.orientation.m06,o.orientation.m07,o.orientation.m08);for(var r=0;r<3;++r)Rn.cross(e[6+3*r],e[r],e[0]),Rn.cross(e[7+3*r],e[r],e[1]),Rn.cross(e[7+3*r],e[r],e[2]);Fl(t.center,t.halfExtents,e[0],e[1],e[2],n),Fl(o.center,o.halfExtents,e[3],e[4],e[5],i);for(var a=0;a<15;++a){var s=zl(n,e[a]),c=zl(i,e[a]);if(c[0]>s[1]||s[0]>c[1])return 0}return 1}}(),Ql=function(){for(var e=new fs,t=new Rn,n=new Rn,i=new Rn,o=new Array(8),r=0;r<8;r++)o[r]=new Rn;for(var a=new Array(8),s=0;s<8;s++)a[s]=new Rn;return function(r,s){if(0===Rn.squaredDistance(s.ellipseCenter0,s.ellipseCenter1))return e.radius=s.radius,e.center.set(s.ellipseCenter0),ru.sphereOBB(e,r);t.x=r.orientation.m00,t.y=r.orientation.m01,t.z=r.orientation.m02,n.x=r.orientation.m03,n.y=r.orientation.m04,n.z=r.orientation.m05,i.x=r.orientation.m06,i.y=r.orientation.m07,i.z=r.orientation.m08,Fl(r.center,r.halfExtents,t,n,i,o);var c=a,l=Rn.copy(c[0],t),u=Rn.copy(c[1],n),h=Rn.copy(c[2],i);Rn.subtract(c[3],s.center,r.center).normalize();var _=Rn.subtract(c[4],s.ellipseCenter0,s.ellipseCenter1);_.normalize(),Rn.cross(c[5],l,_),Rn.cross(c[6],u,_),Rn.cross(c[7],h,_);for(var f=0;f<8;++f){var d=zl(o,c[f]),p=Rn.dot(c[f],s.ellipseCenter0),m=Rn.dot(c[f],s.ellipseCenter1),v=Math.max(p,m),g=Math.min(p,m)-s.radius,y=v+s.radius;if(g>d[1]||d[0]>y)return 0}return 1}}(),Zl=function(e,t){var n=Rn.dot(t.n,e.center),i=e.radius*t.n.length();return n+i<t.d?-1:n-i>t.d?0:1},Jl=function(e,t){for(var n=0;n<t.planes.length;n++)if(-1===Zl(e,t.planes[n]))return 0;return 1},$l=function(){var e=new Rn(0,0,0),t=[1,-1,1,-1,1,-1];return function(n,i){for(var o=0;o<6;o++){var r=i.planes[o],a=n.radius,s=n.center,c=r.n,l=r.d,u=Rn.dot(c,s);if(u+a<l)return 0;if(!(u-a>l)){Rn.add(e,s,Rn.multiplyScalar(e,c,a));for(var h=0;h<6;h++)if(h!==o&&h!==o+t[o]){var _=i.planes[h];if(Rn.dot(_.n,e)<_.d)return 0}}}return 1}}(),eu=function(e,t){var n=e.radius+t.radius;return Rn.squaredDistance(e.center,t.center)<n*n},tu=function(){var e=new Rn;return function(t,n){return ga(e,t.center,n),Rn.squaredDistance(t.center,e)<t.radius*t.radius}}(),nu=function(){var e=new Rn;return function(t,n){return ya(e,t.center,n),Rn.squaredDistance(t.center,e)<t.radius*t.radius}}(),iu=function(){var e=new Rn,t=new Rn;return function(n,i){var o=n.radius+i.radius,r=o*o,a=Rn.squaredDistance(i.ellipseCenter0,i.ellipseCenter1);if(0===a)return Rn.squaredDistance(n.center,i.center)<r;Rn.subtract(e,n.center,i.ellipseCenter0),Rn.subtract(t,i.ellipseCenter1,i.ellipseCenter0);var s=Rn.dot(e,t)/a;return s<0?Rn.squaredDistance(n.center,i.ellipseCenter0)<r:s>1?Rn.squaredDistance(n.center,i.ellipseCenter1)<r:(Rn.scaleAndAdd(e,i.ellipseCenter0,t,s),Rn.squaredDistance(n.center,e)<r)}}(),ou=function(){var e=new Rn,t=new Rn,n=new Rn,i=new Rn,o=new Rn,r=new Rn;return function(a,s){var c,l,u,h,_=Rn.subtract(e,a.ellipseCenter1,a.ellipseCenter0),f=Rn.subtract(t,s.ellipseCenter1,s.ellipseCenter0),d=Rn.subtract(n,a.ellipseCenter0,s.ellipseCenter0),p=Rn.dot(_,_),m=Rn.dot(_,f),v=Rn.dot(f,f),g=Rn.dot(_,d),y=Rn.dot(f,d),x=p*v-m*m,S=x,E=x;x<sn?(l=0,S=1,h=y,E=v):(h=p*y-m*g,(l=m*y-v*g)<0?(l=0,h=y,E=v):l>S&&(l=S,h=y+m,E=v)),h<0?(h=0,-g<0?l=0:-g>p?l=S:(l=-g,S=p)):h>E&&(h=E,-g+m<0?l=0:-g+m>p?l=S:(l=-g+m,S=p)),c=Math.abs(l)<sn?0:l/S,u=Math.abs(h)<sn?0:h/E;var T=i;T.set(d),T.add(Rn.multiplyScalar(o,_,c)),T.subtract(Rn.multiplyScalar(r,f,u));var A=a.radius+s.radius;return T.lengthSqr()<A*A}}(),ru={raySphere:fl,rayAABB:dl,rayOBB:xl,rayPlane:hl,rayTriangle:_l,rayCapsule:Sl,raySubMesh:El,rayMesh:Tl,rayModel:Al,lineSphere:Rl,lineAABB:Il,lineOBB:Pl,linePlane:Cl,lineTriangle:wl,sphereWithSphere:eu,sphereAABB:tu,sphereOBB:nu,spherePlane:Zl,sphereFrustum:Jl,sphereFrustumAccurate:$l,sphereCapsule:iu,aabbWithAABB:Ll,aabbWithOBB:Gl,aabbPlane:kl,aabbFrustum:Vl,aabbFrustumAccurate:Wl,obbWithOBB:Kl,obbPlane:ql,obbFrustum:Yl,obbFrustumAccurate:Xl,obbPoint:jl,obbCapsule:Ql,capsuleWithCapsule:ou,resolve:function(e,t,n){void 0===n&&(n=null);var i=e._type,o=t._type,r=this[i|o];return i<o?r(e,t,n):r(t,e,n)}};ru[Sa.SHAPE_RAY|Sa.SHAPE_SPHERE]=fl,ru[Sa.SHAPE_RAY|Sa.SHAPE_AABB]=dl,ru[Sa.SHAPE_RAY|Sa.SHAPE_OBB]=xl,ru[Sa.SHAPE_RAY|Sa.SHAPE_PLANE]=hl,ru[Sa.SHAPE_RAY|Sa.SHAPE_TRIANGLE]=_l,ru[Sa.SHAPE_RAY|Sa.SHAPE_CAPSULE]=Sl,ru[Sa.SHAPE_LINE|Sa.SHAPE_SPHERE]=Rl,ru[Sa.SHAPE_LINE|Sa.SHAPE_AABB]=Il,ru[Sa.SHAPE_LINE|Sa.SHAPE_OBB]=Pl,ru[Sa.SHAPE_LINE|Sa.SHAPE_PLANE]=Cl,ru[Sa.SHAPE_LINE|Sa.SHAPE_TRIANGLE]=wl,ru[Sa.SHAPE_SPHERE]=eu,ru[Sa.SHAPE_SPHERE|Sa.SHAPE_AABB]=tu,ru[Sa.SHAPE_SPHERE|Sa.SHAPE_OBB]=nu,ru[Sa.SHAPE_SPHERE|Sa.SHAPE_PLANE]=Zl,ru[Sa.SHAPE_SPHERE|Sa.SHAPE_FRUSTUM]=Jl,ru[Sa.SHAPE_SPHERE|Sa.SHAPE_FRUSTUM_ACCURATE]=$l,ru[Sa.SHAPE_SPHERE|Sa.SHAPE_CAPSULE]=iu,ru[Sa.SHAPE_AABB]=Ll,ru[Sa.SHAPE_AABB|Sa.SHAPE_OBB]=Gl,ru[Sa.SHAPE_AABB|Sa.SHAPE_PLANE]=kl,ru[Sa.SHAPE_AABB|Sa.SHAPE_FRUSTUM]=Vl,ru[Sa.SHAPE_AABB|Sa.SHAPE_FRUSTUM_ACCURATE]=Wl,ru[Sa.SHAPE_OBB]=Kl,ru[Sa.SHAPE_OBB|Sa.SHAPE_PLANE]=ql,ru[Sa.SHAPE_OBB|Sa.SHAPE_FRUSTUM]=Yl,ru[Sa.SHAPE_OBB|Sa.SHAPE_FRUSTUM_ACCURATE]=Xl,ru[Sa.SHAPE_OBB|Sa.SHAPE_CAPSULE]=Ql,ru[Sa.SHAPE_CAPSULE]=ou,q(Ea.prototype,"line",[{name:"mag",newName:"len"},{name:"magnitude",newName:"len"}]),Y(ru,"intersect",[{name:"line_quad"}]);var au=new Rn(0,0,0),su=new Rn(0,0,0),cu=c.mat4(),lu=c.v4(),uu=function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=0),this.n=void 0,this.d=void 0,this._type=void 0,this._type=Sa.SHAPE_PLANE,this.n=new Rn(e,t,n),this.d=i}return e.create=function(t,n,i,o){return new e(t,n,i,o)},e.clone=function(t){return new e(t.n.x,t.n.y,t.n.z,t.d)},e.copy=function(e,t){return Rn.copy(e.n,t.n),e.d=t.d,e},e.fromPoints=function(e,t,n,i){return Rn.subtract(au,n,t),Rn.subtract(su,i,t),Rn.normalize(e.n,Rn.cross(e.n,au,su)),e.d=Rn.dot(e.n,t),e},e.set=function(e,t,n,i,o){return e.n.x=t,e.n.y=n,e.n.z=i,e.d=o,e},e.fromNormalAndPoint=function(e,t,n){return Rn.copy(e.n,t),e.d=Rn.dot(t,n),e},e.normalize=function(e,t){var n=t.n.length();return Rn.normalize(e.n,t.n),n>0&&(e.d=t.d/n),e},e.prototype.transform=function(e){jn.invert(cu,e),jn.transpose(cu,cu),$n.set(lu,this.n.x,this.n.y,this.n.z,this.d),$n.transformMat4(lu,lu,cu),Rn.set(this.n,lu.x,lu.y,lu.z),this.d=lu.w},te(e,[{key:"type",get:function(){return this._type}},{key:"x",get:function(){return this.n.x},set:function(e){this.n.x=e}},{key:"y",get:function(){return this.n.y},set:function(e){this.n.y=e}},{key:"z",get:function(){return this.n.z},set:function(e){this.n.z=e}},{key:"w",get:function(){return this.d},set:function(e){this.d=e}}]),e}(),hu=new Rn,_u=new Rn,fu=new Rn,du=new Rn,pu=new Mn,mu=function(e,t,n){pu.m00=Math.abs(n.m00),pu.m01=Math.abs(n.m01),pu.m02=Math.abs(n.m02),pu.m03=Math.abs(n.m04),pu.m04=Math.abs(n.m05),pu.m05=Math.abs(n.m06),pu.m06=Math.abs(n.m08),pu.m07=Math.abs(n.m09),pu.m08=Math.abs(n.m10),Rn.transformMat3(e,t,pu)},vu=e("bN",function(){function e(e,t,n,i,o,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===o&&(o=1),void 0===r&&(r=1),this.center=void 0,this.halfExtents=void 0,this._type=void 0,this._type=Sa.SHAPE_AABB,this.center=new Rn(e,t,n),this.halfExtents=new Rn(i,o,r)}e.create=function(t,n,i,o,r,a){return new e(t,n,i,o,r,a)},e.clone=function(t){return new e(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z)},e.copy=function(e,t){return Rn.copy(e.center,t.center),Rn.copy(e.halfExtents,t.halfExtents),e},e.fromPoints=function(e,t,n){return Rn.add(hu,n,t),Rn.subtract(_u,n,t),Rn.multiplyScalar(e.center,hu,.5),Rn.multiplyScalar(e.halfExtents,_u,.5),e},e.set=function(e,t,n,i,o,r,a){return Rn.set(e.center,t,n,i),Rn.set(e.halfExtents,o,r,a),e},e.merge=function(t,n,i){return Rn.subtract(hu,n.center,n.halfExtents),Rn.subtract(_u,i.center,i.halfExtents),Rn.add(fu,n.center,n.halfExtents),Rn.add(du,i.center,i.halfExtents),Rn.max(du,fu,du),Rn.min(fu,hu,_u),e.fromPoints(t,fu,du)},e.toBoundingSphere=function(e,t){t.getBoundary(hu,_u),e.center.set(hu),e.radius=0,Rn.subtract(fu,_u,e.center);var n=fu.length(),i=.5*n;return e.radius+=i,Rn.multiplyScalar(fu,fu,i/n),Rn.add(e.center,e.center,fu),e},e.transform=function(e,t,n){return Rn.transformMat4(e.center,t.center,n),mu(e.halfExtents,t.halfExtents,n),e};var t=e.prototype;return t.getBoundary=function(e,t){Rn.subtract(e,this.center,this.halfExtents),Rn.add(t,this.center,this.halfExtents)},t.transform=function(e,t,n,i,o){Rn.transformMat4(o.center,this.center,e),mu(o.halfExtents,this.halfExtents,e)},t.clone=function(){return e.clone(this)},t.copy=function(t){return e.copy(this,t)},te(e,[{key:"type",get:function(){return this._type}}]),e}()),gu=new Rn,yu=new Rn,xu=new Mn,Su=function(){function e(e,t,n,i,o,r,a,s,c,l,u,h,_,f,d){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===o&&(o=1),void 0===r&&(r=1),void 0===a&&(a=1),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=1),void 0===h&&(h=0),void 0===_&&(_=0),void 0===f&&(f=0),void 0===d&&(d=1),this.center=void 0,this.halfExtents=void 0,this.orientation=void 0,this._type=void 0,this._type=Sa.SHAPE_OBB,this.center=new Rn(e,t,n),this.halfExtents=new Rn(i,o,r),this.orientation=new Mn(a,s,c,l,u,h,_,f,d)}e.create=function(t,n,i,o,r,a,s,c,l,u,h,_,f,d,p){return new e(t,n,i,o,r,a,s,c,l,u,h,_,f,d,p)},e.clone=function(t){return new e(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z,t.orientation.m00,t.orientation.m01,t.orientation.m02,t.orientation.m03,t.orientation.m04,t.orientation.m05,t.orientation.m06,t.orientation.m07,t.orientation.m08)},e.copy=function(e,t){return Rn.copy(e.center,t.center),Rn.copy(e.halfExtents,t.halfExtents),Mn.copy(e.orientation,t.orientation),e},e.fromPoints=function(e,t,n){return Rn.multiplyScalar(e.center,Rn.add(gu,t,n),.5),Rn.multiplyScalar(e.halfExtents,Rn.subtract(yu,n,t),.5),Mn.identity(e.orientation),e},e.set=function(e,t,n,i,o,r,a,s,c,l,u,h,_,f,d,p){return Rn.set(e.center,t,n,i),Rn.set(e.halfExtents,o,r,a),Mn.set(e.orientation,s,c,l,u,h,_,f,d,p),e};var t=e.prototype;return t.getBoundary=function(e,t){!function(e,t,n){xu.m00=Math.abs(n.m00),xu.m01=Math.abs(n.m01),xu.m02=Math.abs(n.m02),xu.m03=Math.abs(n.m03),xu.m04=Math.abs(n.m04),xu.m05=Math.abs(n.m05),xu.m06=Math.abs(n.m06),xu.m07=Math.abs(n.m07),xu.m08=Math.abs(n.m08),Rn.transformMat3(e,t,xu)}(gu,this.halfExtents,this.orientation),Rn.subtract(e,this.center,gu),Rn.add(t,this.center,gu)},t.transform=function(e,t,n,i,o){Rn.transformMat4(o.center,this.center,e),Mn.fromQuat(o.orientation,n),Rn.multiply(o.halfExtents,this.halfExtents,i)},t.translateAndRotate=function(e,t,n){Rn.transformMat4(n.center,this.center,e),Mn.fromQuat(n.orientation,t)},t.setScale=function(e,t){Rn.multiply(t.halfExtents,this.halfExtents,e)},te(e,[{key:"type",get:function(){return this._type}}]),e}(),Eu=function(){function e(e,t,n){void 0===e&&(e=.5),void 0===t&&(t=.5),void 0===n&&(n=1),this._type=void 0,this.radius=void 0,this.halfHeight=void 0,this.axis=void 0,this.center=void 0,this.rotation=void 0,this.ellipseCenter0=void 0,this.ellipseCenter1=void 0,this._type=Sa.SHAPE_CAPSULE,this.radius=e,this.halfHeight=t,this.axis=n,this.center=new Rn,this.rotation=new zn,this.ellipseCenter0=new Rn(0,t,0),this.ellipseCenter1=new Rn(0,-t,0),this.updateCache()}var t=e.prototype;return t.transform=function(e,t,n,i,o){var r=i,a=Cn(r);o.radius=this.radius*Math.abs(a);var s=(this.halfHeight+this.radius)*Math.abs(r.y)-o.radius;s<0&&(s=0),o.halfHeight=s,Rn.transformMat4(o.center,this.center,e),zn.multiply(o.rotation,this.rotation,n),o.updateCache()},t.updateCache=function(){this.updateLocalCenter(),Rn.transformQuat(this.ellipseCenter0,this.ellipseCenter0,this.rotation),Rn.transformQuat(this.ellipseCenter1,this.ellipseCenter1,this.rotation),this.ellipseCenter0.add(this.center),this.ellipseCenter1.add(this.center)},t.updateLocalCenter=function(){var e=this.halfHeight;switch(this.axis){case 0:this.ellipseCenter0.set(e,0,0),this.ellipseCenter1.set(-e,0,0);break;case 1:this.ellipseCenter0.set(0,e,0),this.ellipseCenter1.set(0,-e,0);break;case 2:this.ellipseCenter0.set(0,0,e),this.ellipseCenter1.set(0,0,-e)}},te(e,[{key:"type",get:function(){return this._type}}]),e}(),Tu=new Array(8);Tu[0]=new Rn(1,1,1),Tu[1]=new Rn(-1,1,1),Tu[2]=new Rn(-1,-1,1),Tu[3]=new Rn(1,-1,1),Tu[4]=new Rn(1,1,-1),Tu[5]=new Rn(-1,1,-1),Tu[6]=new Rn(-1,-1,-1),Tu[7]=new Rn(1,-1,-1);var Au,Cu,wu,bu=function(){function e(){this._type=void 0,this.planes=void 0,this.vertices=void 0,this._type=Sa.SHAPE_FRUSTUM,this.planes=new Array(6);for(var e=0;e<6;++e)this.planes[e]=uu.create(0,0,0,0);this.vertices=new Array(8);for(var t=0;t<8;++t)this.vertices[t]=new Rn}e.create=function(){return new e},e.clone=function(t){return e.copy(new e,t)},e.copy=function(e,t){e._type=t._type;for(var n=0;n<6;++n)uu.copy(e.planes[n],t.planes[n]);for(var i=0;i<8;++i)Rn.copy(e.vertices[i],t.vertices[i]);return e};var t=e.prototype;return t.update=function(e,t){if(Rn.set(this.planes[0].n,e.m03+e.m00,e.m07+e.m04,e.m11+e.m08),this.planes[0].d=-(e.m15+e.m12),Rn.set(this.planes[1].n,e.m03-e.m00,e.m07-e.m04,e.m11-e.m08),this.planes[1].d=-(e.m15-e.m12),Rn.set(this.planes[2].n,e.m03+e.m01,e.m07+e.m05,e.m11+e.m09),this.planes[2].d=-(e.m15+e.m13),Rn.set(this.planes[3].n,e.m03-e.m01,e.m07-e.m05,e.m11-e.m09),this.planes[3].d=-(e.m15-e.m13),Rn.set(this.planes[4].n,e.m03+e.m02,e.m07+e.m06,e.m11+e.m10),this.planes[4].d=-(e.m15+e.m14),Rn.set(this.planes[5].n,e.m03-e.m02,e.m07-e.m06,e.m11-e.m10),this.planes[5].d=-(e.m15-e.m14),this._type===Sa.SHAPE_FRUSTUM_ACCURATE){for(var n=0;n<6;n++){var i=this.planes[n],o=1/i.n.length();Rn.multiplyScalar(i.n,i.n,o),i.d*=o}for(var r=0;r<8;r++)Rn.transformMat4(this.vertices[r],Tu[r],t)}},t.transform=function(e){if(this._type===Sa.SHAPE_FRUSTUM_ACCURATE){for(var t=0;t<8;t++)Rn.transformMat4(this.vertices[t],this.vertices[t],e);uu.fromPoints(this.planes[0],this.vertices[1],this.vertices[5],this.vertices[6]),uu.fromPoints(this.planes[1],this.vertices[3],this.vertices[7],this.vertices[4]),uu.fromPoints(this.planes[2],this.vertices[6],this.vertices[7],this.vertices[3]),uu.fromPoints(this.planes[3],this.vertices[0],this.vertices[4],this.vertices[5]),uu.fromPoints(this.planes[4],this.vertices[2],this.vertices[3],this.vertices[0]),uu.fromPoints(this.planes[0],this.vertices[7],this.vertices[6],this.vertices[5])}},te(e,[{key:"accurate",set:function(e){this._type=e?Sa.SHAPE_FRUSTUM_ACCURATE:Sa.SHAPE_FRUSTUM}},{key:"type",get:function(){return this._type}}]),e}();function Iu(e,t){if(t&&e!==No){for(var n=t.vertices,i=yr.VERTICES,o=0;o<8;++o)Ar.setVec3(e,i,n[o]),i+=3;for(var r=t.planes,a=yr.PLANES,s=0;s<6;s++,a+=4)Ar.setVec4(e,a,r[s])}}bu.createOrtho=(Au=new Rn,function(e,t,n,i,o,r){var a=t/2,s=n/2;Rn.set(Au,a,s,i),Rn.transformMat4(e.vertices[0],Au,r),Rn.set(Au,-a,s,i),Rn.transformMat4(e.vertices[1],Au,r),Rn.set(Au,-a,-s,i),Rn.transformMat4(e.vertices[2],Au,r),Rn.set(Au,a,-s,i),Rn.transformMat4(e.vertices[3],Au,r),Rn.set(Au,a,s,o),Rn.transformMat4(e.vertices[4],Au,r),Rn.set(Au,-a,s,o),Rn.transformMat4(e.vertices[5],Au,r),Rn.set(Au,-a,-s,o),Rn.transformMat4(e.vertices[6],Au,r),Rn.set(Au,a,-s,o),Rn.transformMat4(e.vertices[7],Au,r),uu.fromPoints(e.planes[0],e.vertices[1],e.vertices[6],e.vertices[5]),uu.fromPoints(e.planes[1],e.vertices[3],e.vertices[4],e.vertices[7]),uu.fromPoints(e.planes[2],e.vertices[6],e.vertices[3],e.vertices[7]),uu.fromPoints(e.planes[3],e.vertices[0],e.vertices[5],e.vertices[4]),uu.fromPoints(e.planes[4],e.vertices[2],e.vertices[0],e.vertices[3]),uu.fromPoints(e.planes[0],e.vertices[7],e.vertices[5],e.vertices[6])}),function(e){e[e.Default=0]="Default",e[e.Normal=1]="Normal",e[e.Loop=2]="Loop",e[e.ShouldWrap=4]="ShouldWrap",e[e.Clamp=8]="Clamp",e[e.PingPong=22]="PingPong",e[e.Reverse=36]="Reverse"}(Cu||(Cu={})),function(e){e[e.Default=Cu.Default]="Default",e[e.Normal=Cu.Normal]="Normal",e[e.Reverse=Cu.Reverse]="Reverse",e[e.Loop=Cu.Loop]="Loop",e[e.LoopReverse=Cu.Loop|Cu.Reverse]="LoopReverse",e[e.PingPong=Cu.PingPong]="PingPong",e[e.PingPongReverse=Cu.PingPong|Cu.Reverse]="PingPongReverse"}(wu||(wu={})),ht(wu);var Pu=function(){function e(e){this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0,e&&this.set(e)}return e.prototype.set=function(e){this.ratio=e.ratio,this.time=e.time,this.direction=e.direction,this.stopped=e.stopped,this.iterations=e.iterations,this.frameIndex=e.frameIndex},e}(),Ru=ct({Default:Cu.Default,Normal:Cu.Normal,Clamp:Cu.Clamp,Loop:Cu.Loop,PingPong:Cu.PingPong}),Nu=function(){this.time=0,this.value=0,this.inTangent=0,this.outTangent=0};tn.fastDefine("cc.Keyframe",Nu,{time:0,value:0,inTangent:0,outTangent:0});var Ou=function(){function e(){this.index=void 0,this.time=void 0,this.endTime=void 0,this.coefficient=void 0,this.index=-1,this.time=0,this.endTime=0,this.coefficient=new Float32Array(4)}return e.prototype.evaluate=function(e){return t=e-this.time,n=this.coefficient,t*(t*(t*n[0]+n[1])+n[2])+n[3];var t,n},e}(),Du=e("dU",function(){function e(t){void 0===t&&(t=null),this.keyFrames=void 0,this.preWrapMode=Ru.Loop,this.postWrapMode=Ru.Clamp,this.cachedKey=void 0,this.keyFrames=t||[].concat(e.defaultKF),this.cachedKey=new Ou}var t=e.prototype;return t.addKey=function(e){null==this.keyFrames&&(this.keyFrames=[]),this.keyFrames.push(e)},t.evaluate_slow=function(e){var t=e,n=e<0?this.preWrapMode:this.postWrapMode,i=this.keyFrames[0].time,o=this.keyFrames[this.keyFrames.length-1].time;switch(n){case Ru.Loop:t=En(e-i,o-i)+i;break;case Ru.PingPong:t=Tn(e-i,o-i)+i;break;case Ru.Default:case Ru.Normal:case Ru.Clamp:default:t=un(e,i,o)}var r=0;if(t>this.keyFrames[0].time)if(t>=this.keyFrames[this.keyFrames.length-1].time)r=this.keyFrames.length-2;else for(var a=0;a<this.keyFrames.length-1;a++)if(t>=this.keyFrames[0].time&&t<=this.keyFrames[a+1].time){r=a;break}var s=this.keyFrames[r],c=this.keyFrames[r+1],l=An(s.time,c.time,t),u=c.time-s.time,h=s.outTangent*u,_=c.inTangent*u,f=l*l,d=f*l,p=d-2*f+l,m=d-f,v=-2*d+3*f;return(2*d-3*f+1)*s.value+p*h+m*_+v*c.value},t.evaluate=function(e){var t=e,n=e<0?this.preWrapMode:this.postWrapMode,i=this.keyFrames[0].time,o=this.keyFrames[this.keyFrames.length-1].time;switch(n){case Ru.Loop:t=En(e-i,o-i)+i;break;case Ru.PingPong:t=Tn(e-i,o-i)+i;break;case Ru.Default:case Ru.Normal:case Ru.Clamp:default:t=un(e,i,o)}if(t>=this.cachedKey.time&&t<this.cachedKey.endTime)return this.cachedKey.evaluate(t);var r=this.findIndex(this.cachedKey,t),a=Math.min(r+1,this.keyFrames.length-1);return this.calcOptimizedKey(this.cachedKey,r,a),this.cachedKey.evaluate(t)},t.calcOptimizedKey=function(e,t,n){var i=this.keyFrames[t],o=this.keyFrames[n];e.index=t,e.time=i.time,e.endTime=o.time;var r=o.time-i.time,a=o.value-i.value,s=1/(r*r),c=i.outTangent*r,l=o.inTangent*r;e.coefficient[0]=(c+l-a-a)*s/r,e.coefficient[1]=(a+a+a-c-c-l)*s,e.coefficient[2]=i.outTangent,e.coefficient[3]=i.value},t.findIndex=function(e,t){var n=e.index;if(-1!==n)if(t>this.keyFrames[n].time)for(var i=0;i<3;i++){var o=n+i;if(o+1<this.keyFrames.length&&this.keyFrames[o+1].time>t)return o}else for(var r=0;r<3;r++){var a=n-r;if(a>=0&&this.keyFrames[a-1].time<=t)return a-1}for(var s,c=0,l=this.keyFrames.length;l-c>1;)s=Math.floor((c+l)/2),this.keyFrames[s].time>=t?l=s:c=s;return c},e}());function Mu(e,t){console.warn(e+" is deprecated, please use "+t+" instead.")}Du.defaultKF=[{time:0,value:1,inTangent:0,outTangent:0},{time:1,value:1,inTangent:0,outTangent:0}],tn.fastDefine("cc.AnimationCurve",Du,{preWrapMode:Ru.Default,postWrapMode:Ru.Default,keyFrames:[]}),q(ru,"intersect",[{name:"ray_aabb",newName:"rayAABB"},{name:"ray_plane",newName:"rayPlane"},{name:"ray_triangle",newName:"rayTriangle"},{name:"ray_sphere",newName:"raySphere"},{name:"ray_obb",newName:"rayOBB"},{name:"ray_capsule",newName:"rayCapsule"},{name:"ray_subMesh",newName:"raySubMesh"},{name:"ray_mesh",newName:"rayMesh"},{name:"ray_model",newName:"rayModel"},{name:"line_plane",newName:"linePlane"},{name:"line_triangle",newName:"lineTriangle"},{name:"line_aabb",newName:"lineAABB"},{name:"line_obb",newName:"lineOBB"},{name:"line_sphere",newName:"lineSphere"},{name:"aabb_aabb",newName:"aabbWithAABB"},{name:"aabb_obb",newName:"aabbWithOBB"},{name:"aabb_plane",newName:"aabbPlane"},{name:"aabb_frustum",newName:"aabbFrustum"},{name:"aabbFrustum_accurate",newName:"aabbFrustumAccurate"},{name:"obb_point",newName:"obbPoint"},{name:"obb_plane",newName:"obbPlane"},{name:"obb_frustum",newName:"obbFrustum"},{name:"obbFrustum_accurate",newName:"obbFrustumAccurate"},{name:"obb_obb",newName:"obbWithOBB"},{name:"obb_capsule",newName:"obbCapsule"},{name:"sphere_plane",newName:"spherePlane"},{name:"sphere_frustum",newName:"sphereFrustum"},{name:"sphereFrustum_accurate",newName:"sphereFrustumAccurate"},{name:"sphere_sphere",newName:"sphereWithSphere"},{name:"sphere_aabb",newName:"sphereAABB"},{name:"sphere_obb",newName:"sphereOBB"},{name:"sphere_capsule",newName:"sphereCapsule"},{name:"capsule_capsule",newName:"capsuleWithCapsule"}]);var Lu=function(e){function t(){var t;return t=e.call(this)||this,Mu("line","Line"),t}return ie(t,e),t}(Ea),Fu=function(e){function t(){var t;return t=e.call(this)||this,Mu("plane","Plane"),t}return ie(t,e),t}(uu),zu=function(e){function t(){var t;return t=e.call(this)||this,Mu("ray","Ray"),t}return ie(t,e),t}(Ta),Bu=function(e){function t(){var t;return t=e.call(this)||this,Mu("triangle","Triangle"),t}return ie(t,e),t}(ds),Uu=function(e){function t(){var t;return t=e.call(this)||this,Mu("sphere","Sphere"),t}return ie(t,e),t}(fs),Hu=function(e){function t(){var t;return t=e.call(this)||this,Mu("aabb","AABB"),t}return ie(t,e),t}(vu),Gu=function(e){function t(){var t;return t=e.call(this)||this,Mu("obb","OBB"),t}return ie(t,e),t}(Su),ku=function(e){function t(){var t;return t=e.call(this)||this,Mu("capsule","Capsule"),t}return ie(t,e),t}(Eu),Vu=function(e){function t(){var t;return t=e.call(this)||this,Mu("frustum","Frustum"),t}return ie(t,e),t}(bu),Wu=Object.freeze({__proto__:null,distance:xa,enums:Sa,intersect:ru,Line:Ea,Plane:uu,Ray:Ta,Triangle:ds,Sphere:fs,AABB:vu,OBB:Su,Capsule:Eu,Frustum:bu,Keyframe:Nu,AnimationCurve:Du,get ERaycastMode(){return $c},line:Lu,plane:Fu,ray:zu,triangle:Bu,sphere:Uu,aabb:Hu,obb:Gu,capsule:ku,frustum:Vu});e("eC",Wu);var ju={NONE:0,IGNORE_RAYCAST:1<<20,GIZMOS:1<<21,EDITOR:1<<22,UI_3D:1<<23,SCENE_GIZMO:1<<24,UI_2D:1<<25,PROFILER:1<<28,DEFAULT:1<<30,ALL:4294967295},qu=e("dn",function(){function e(){}return e.makeMaskInclude=function(e){for(var t,n=0,i=le(e);!(t=i()).done;)n|=t.value;return n},e.makeMaskExclude=function(t){return~e.makeMaskInclude(t)},e.addLayer=function(t,n){void 0!==n?n>19||n<0?console.warn("maximum layers reached."):(e.Enum[t]=1<<n,e.Enum[n]=t,e.BitMask[t]=1<<n,e.BitMask[n]=t):console.warn("bitNum can't be undefined")},e.deleteLayer=function(t){t>19||t<0?console.warn("do not change buildin layers."):(delete e.Enum[e.Enum[t]],delete e.Enum[t],delete e.BitMask[e.BitMask[t]],delete e.BitMask[t])},e}());qu.Enum=ct(ju),qu.BitMask=st(ne({},ju)),c.Layers=qu;var Yu,Xu,Ku="GbufferFlow",Qu="LightingFlow",Zu="ForwardFlow",Ju="ShadowFlow";!function(e){e[e.DEFAULT=100]="DEFAULT",e[e.UI=200]="UI"}(Yu||(Yu={})),c.RenderPassStage=Yu,function(e){e[e.MIN=0]="MIN",e[e.MAX=255]="MAX",e[e.DEFAULT=128]="DEFAULT"}(Xu||(Xu=e("dk",{})));var $u,eh={bindings:[],layouts:{}},th={bindings:[],layouts:{}};!function(e){e[e.UBO_GLOBAL=0]="UBO_GLOBAL",e[e.UBO_CAMERA=1]="UBO_CAMERA",e[e.UBO_SHADOW=2]="UBO_SHADOW",e[e.SAMPLER_SHADOWMAP=3]="SAMPLER_SHADOWMAP",e[e.SAMPLER_ENVIRONMENT=4]="SAMPLER_ENVIRONMENT",e[e.SAMPLER_SPOT_LIGHTING_MAP=5]="SAMPLER_SPOT_LIGHTING_MAP",e[e.SAMPLER_GBUFFER_ALBEDOMAP=6]="SAMPLER_GBUFFER_ALBEDOMAP",e[e.SAMPLER_GBUFFER_POSITIONMAP=7]="SAMPLER_GBUFFER_POSITIONMAP",e[e.SAMPLER_GBUFFER_NORMALMAP=8]="SAMPLER_GBUFFER_NORMALMAP",e[e.SAMPLER_GBUFFER_EMISSIVEMAP=9]="SAMPLER_GBUFFER_EMISSIVEMAP",e[e.SAMPLER_LIGHTING_RESULTMAP=10]="SAMPLER_LIGHTING_RESULTMAP",e[e.COUNT=11]="COUNT"}($u||($u={}));var nh,ih=$u.SAMPLER_SHADOWMAP,oh=$u.COUNT-ih;!function(e){e[e.UBO_LOCAL=0]="UBO_LOCAL",e[e.UBO_FORWARD_LIGHTS=1]="UBO_FORWARD_LIGHTS",e[e.UBO_SKINNING_ANIMATION=2]="UBO_SKINNING_ANIMATION",e[e.UBO_SKINNING_TEXTURE=3]="UBO_SKINNING_TEXTURE",e[e.UBO_MORPH=4]="UBO_MORPH",e[e.SAMPLER_JOINTS=5]="SAMPLER_JOINTS",e[e.SAMPLER_MORPH_POSITION=6]="SAMPLER_MORPH_POSITION",e[e.SAMPLER_MORPH_NORMAL=7]="SAMPLER_MORPH_NORMAL",e[e.SAMPLER_MORPH_TANGENT=8]="SAMPLER_MORPH_TANGENT",e[e.SAMPLER_LIGHTMAP=9]="SAMPLER_LIGHTMAP",e[e.SAMPLER_SPRITE=10]="SAMPLER_SPRITE",e[e.COUNT=11]="COUNT"}(nh||(nh=e("dA",{})));var rh,ah=nh.SAMPLER_JOINTS,sh=nh.COUNT-ah;!function(e){e[e.GLOBAL=0]="GLOBAL",e[e.MATERIAL=1]="MATERIAL",e[e.LOCAL=2]="LOCAL"}(rh||(rh={}));var ch=new Ps;ch.bufferOffsets=[0,ih+ah,ih],ch.samplerOffsets=[-ih,oh+sh,oh-ah],ch.flexibleSet=1;var lh=function(){};lh.SIZE=4*(lh.COUNT=4+(lh.SCREEN_SIZE_OFFSET=4+(lh.NATIVE_SIZE_OFFSET=4+(lh.TIME_OFFSET=0)))),lh.NAME="CCGlobal",lh.BINDING=$u.UBO_GLOBAL,lh.DESCRIPTOR=new ic(lh.BINDING,ls.UNIFORM_BUFFER,1,Ja.ALL),lh.LAYOUT=new Us(rh.GLOBAL,lh.BINDING,lh.NAME,[new Bs("cc_time",Fa.FLOAT4,1),new Bs("cc_screenSize",Fa.FLOAT4,1),new Bs("cc_nativeSize",Fa.FLOAT4,1)],1),eh.layouts[lh.NAME]=lh.LAYOUT,eh.bindings[lh.BINDING]=lh.DESCRIPTOR;var uh=function(){};uh.SIZE=4*(uh.COUNT=4+(uh.GLOBAL_FOG_ADD_OFFSET=4+(uh.GLOBAL_FOG_BASE_OFFSET=4+(uh.GLOBAL_FOG_COLOR_OFFSET=4+(uh.AMBIENT_GROUND_OFFSET=4+(uh.AMBIENT_SKY_OFFSET=4+(uh.MAIN_LIT_COLOR_OFFSET=4+(uh.MAIN_LIT_DIR_OFFSET=4+(uh.EXPOSURE_OFFSET=4+(uh.SCREEN_SCALE_OFFSET=4+(uh.CAMERA_POS_OFFSET=16+(uh.MAT_VIEW_PROJ_INV_OFFSET=16+(uh.MAT_VIEW_PROJ_OFFSET=16+(uh.MAT_PROJ_INV_OFFSET=16+(uh.MAT_PROJ_OFFSET=16+(uh.MAT_VIEW_INV_OFFSET=16+(uh.MAT_VIEW_OFFSET=0))))))))))))))))),uh.NAME="CCCamera",uh.BINDING=$u.UBO_CAMERA,uh.DESCRIPTOR=new ic(uh.BINDING,ls.UNIFORM_BUFFER,1,Ja.ALL),uh.LAYOUT=new Us(rh.GLOBAL,uh.BINDING,uh.NAME,[new Bs("cc_matView",Fa.MAT4,1),new Bs("cc_matViewInv",Fa.MAT4,1),new Bs("cc_matProj",Fa.MAT4,1),new Bs("cc_matProjInv",Fa.MAT4,1),new Bs("cc_matViewProj",Fa.MAT4,1),new Bs("cc_matViewProjInv",Fa.MAT4,1),new Bs("cc_cameraPos",Fa.FLOAT4,1),new Bs("cc_screenScale",Fa.FLOAT4,1),new Bs("cc_exposure",Fa.FLOAT4,1),new Bs("cc_mainLitDir",Fa.FLOAT4,1),new Bs("cc_mainLitColor",Fa.FLOAT4,1),new Bs("cc_ambientSky",Fa.FLOAT4,1),new Bs("cc_ambientGround",Fa.FLOAT4,1),new Bs("cc_fogColor",Fa.FLOAT4,1),new Bs("cc_fogBase",Fa.FLOAT4,1),new Bs("cc_fogAdd",Fa.FLOAT4,1)],1),eh.layouts[uh.NAME]=uh.LAYOUT,eh.bindings[uh.BINDING]=uh.DESCRIPTOR;var hh=function(){};hh.SIZE=4*(hh.COUNT=4+(hh.SHADOW_COLOR_OFFSET=4+(hh.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET=4+(hh.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET=4+(hh.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET=16+(hh.MAT_LIGHT_VIEW_PROJ_OFFSET=16+(hh.MAT_LIGHT_VIEW_OFFSET=16+(hh.MAT_LIGHT_PLANE_PROJ_OFFSET=0)))))))),hh.NAME="CCShadow",hh.BINDING=$u.UBO_SHADOW,hh.DESCRIPTOR=new ic(hh.BINDING,ls.UNIFORM_BUFFER,1,Ja.ALL),hh.LAYOUT=new Us(rh.GLOBAL,hh.BINDING,hh.NAME,[new Bs("cc_matLightPlaneProj",Fa.MAT4,1),new Bs("cc_matLightView",Fa.MAT4,1),new Bs("cc_matLightViewProj",Fa.MAT4,1),new Bs("cc_shadowNFLSInfo",Fa.FLOAT4,1),new Bs("cc_shadowWHPBInfo",Fa.FLOAT4,1),new Bs("cc_shadowLPNNInfo",Fa.FLOAT4,1),new Bs("cc_shadowColor",Fa.FLOAT4,1)],1),eh.layouts[hh.NAME]=hh.LAYOUT,eh.bindings[hh.BINDING]=hh.DESCRIPTOR;var _h=$u.SAMPLER_SHADOWMAP,fh=new ic(_h,ls.SAMPLER_TEXTURE,1,Ja.FRAGMENT),dh=new Hs(rh.GLOBAL,_h,"cc_shadowMap",Fa.SAMPLER2D,1);eh.layouts.cc_shadowMap=dh,eh.bindings[_h]=fh;var ph=$u.SAMPLER_GBUFFER_ALBEDOMAP,mh=new ic(ph,ls.SAMPLER_TEXTURE,1,Ja.FRAGMENT),vh=new Hs(rh.GLOBAL,ph,"cc_gbuffer_albedoMap",Fa.SAMPLER2D,1);eh.layouts.cc_gbuffer_albedoMap=vh,eh.bindings[ph]=mh;var gh=$u.SAMPLER_GBUFFER_POSITIONMAP,yh=new ic(gh,ls.SAMPLER_TEXTURE,1,Ja.FRAGMENT),xh=new Hs(rh.GLOBAL,gh,"cc_gbuffer_positionMap",Fa.SAMPLER2D,1);eh.layouts.cc_gbuffer_positionMap=xh,eh.bindings[gh]=yh;var Sh=$u.SAMPLER_GBUFFER_NORMALMAP,Eh=new ic(Sh,ls.SAMPLER_TEXTURE,1,Ja.FRAGMENT),Th=new Hs(rh.GLOBAL,Sh,"cc_gbuffer_normalMap",Fa.SAMPLER2D,1);eh.layouts.cc_gbuffer_normalMap=Th,eh.bindings[Sh]=Eh;var Ah=$u.SAMPLER_LIGHTING_RESULTMAP,Ch=new ic(Ah,ls.SAMPLER_TEXTURE,1,Ja.FRAGMENT),wh=new Hs(rh.GLOBAL,Ah,"cc_lighting_resultMap",Fa.SAMPLER2D,1);eh.layouts.cc_lighting_resultMap=wh,eh.bindings[Ah]=Ch;var bh=$u.SAMPLER_GBUFFER_EMISSIVEMAP,Ih=new ic(bh,ls.SAMPLER_TEXTURE,1,Ja.FRAGMENT),Ph=new Hs(rh.GLOBAL,bh,"cc_gbuffer_emissiveMap",Fa.SAMPLER2D,1);eh.layouts.cc_gbuffer_emissiveMap=Ph,eh.bindings[bh]=Ih;var Rh=$u.SAMPLER_ENVIRONMENT,Nh=new ic(Rh,ls.SAMPLER_TEXTURE,1,Ja.FRAGMENT),Oh=new Hs(rh.GLOBAL,Rh,"cc_environment",Fa.SAMPLER_CUBE,1);eh.layouts.cc_environment=Oh,eh.bindings[Rh]=Nh;var Dh=$u.SAMPLER_SPOT_LIGHTING_MAP,Mh=new ic(Dh,ls.SAMPLER_TEXTURE,1,Ja.FRAGMENT),Lh=new Hs(rh.GLOBAL,Dh,"cc_spotLightingMap",Fa.SAMPLER2D,1);eh.layouts.cc_spotLightingMap=Lh,eh.bindings[Dh]=Mh;var Fh=e("dz",(function(){}));Fh.MAT_WORLD_OFFSET=0,Fh.MAT_WORLD_IT_OFFSET=Fh.MAT_WORLD_OFFSET+16,Fh.LIGHTINGMAP_UVPARAM=Fh.MAT_WORLD_IT_OFFSET+16,Fh.COUNT=Fh.LIGHTINGMAP_UVPARAM+4,Fh.SIZE=4*Fh.COUNT,Fh.NAME="CCLocal",Fh.BINDING=nh.UBO_LOCAL,Fh.DESCRIPTOR=new ic(Fh.BINDING,ls.UNIFORM_BUFFER,1,Ja.VERTEX),Fh.LAYOUT=new Us(rh.LOCAL,Fh.BINDING,Fh.NAME,[new Bs("cc_matWorld",Fa.MAT4,1),new Bs("cc_matWorldIT",Fa.MAT4,1),new Bs("cc_lightingMapUVParam",Fa.FLOAT4,1)],1),th.layouts[Fh.NAME]=Fh.LAYOUT,th.bindings[Fh.BINDING]=Fh.DESCRIPTOR;var zh="a_matWorld0",Bh=function(){};Bh.BATCHING_COUNT=10,Bh.MAT_WORLDS_OFFSET=0,Bh.SIZE=4*(Bh.COUNT=16*Bh.BATCHING_COUNT),Bh.NAME="CCLocalBatched",Bh.BINDING=nh.UBO_LOCAL,Bh.DESCRIPTOR=new ic(Bh.BINDING,ls.UNIFORM_BUFFER,1,Ja.VERTEX),Bh.LAYOUT=new Us(rh.LOCAL,Bh.BINDING,Bh.NAME,[new Bs("cc_matWorlds",Fa.MAT4,Bh.BATCHING_COUNT)],1),th.layouts[Bh.NAME]=Bh.LAYOUT,th.bindings[Bh.BINDING]=Bh.DESCRIPTOR;var Uh=function(){};Uh.LIGHTS_PER_PASS=1,Uh.SIZE=4*(Uh.COUNT=(Uh.LIGHT_DIR_OFFSET=(Uh.LIGHT_SIZE_RANGE_ANGLE_OFFSET=(Uh.LIGHT_COLOR_OFFSET=(Uh.LIGHT_POS_OFFSET=0)+4*Uh.LIGHTS_PER_PASS)+4*Uh.LIGHTS_PER_PASS)+4*Uh.LIGHTS_PER_PASS)+4*Uh.LIGHTS_PER_PASS),Uh.NAME="CCForwardLight",Uh.BINDING=nh.UBO_FORWARD_LIGHTS,Uh.DESCRIPTOR=new ic(Uh.BINDING,ls.DYNAMIC_UNIFORM_BUFFER,1,Ja.FRAGMENT),Uh.LAYOUT=new Us(rh.LOCAL,Uh.BINDING,Uh.NAME,[new Bs("cc_lightPos",Fa.FLOAT4,Uh.LIGHTS_PER_PASS),new Bs("cc_lightColor",Fa.FLOAT4,Uh.LIGHTS_PER_PASS),new Bs("cc_lightSizeRangeAngle",Fa.FLOAT4,Uh.LIGHTS_PER_PASS),new Bs("cc_lightDir",Fa.FLOAT4,Uh.LIGHTS_PER_PASS)],1),th.layouts[Uh.NAME]=Uh.LAYOUT,th.bindings[Uh.BINDING]=Uh.DESCRIPTOR;var Hh=function(){};Hh.LIGHTS_PER_PASS=10;var Gh=e("cG",(function(){}));Gh.JOINTS_TEXTURE_INFO_OFFSET=0,Gh.COUNT=Gh.JOINTS_TEXTURE_INFO_OFFSET+4,Gh.SIZE=4*Gh.COUNT,Gh.NAME="CCSkinningTexture",Gh.BINDING=nh.UBO_SKINNING_TEXTURE,Gh.DESCRIPTOR=new ic(Gh.BINDING,ls.UNIFORM_BUFFER,1,Ja.VERTEX),Gh.LAYOUT=new Us(rh.LOCAL,Gh.BINDING,Gh.NAME,[new Bs("cc_jointTextureInfo",Fa.FLOAT4,1)],1),th.layouts[Gh.NAME]=Gh.LAYOUT,th.bindings[Gh.BINDING]=Gh.DESCRIPTOR;var kh=e("cy",(function(){}));kh.JOINTS_ANIM_INFO_OFFSET=0,kh.COUNT=kh.JOINTS_ANIM_INFO_OFFSET+4,kh.SIZE=4*kh.COUNT,kh.NAME="CCSkinningAnimation",kh.BINDING=nh.UBO_SKINNING_ANIMATION,kh.DESCRIPTOR=new ic(kh.BINDING,ls.UNIFORM_BUFFER,1,Ja.VERTEX),kh.LAYOUT=new Us(rh.LOCAL,kh.BINDING,kh.NAME,[new Bs("cc_jointAnimInfo",Fa.FLOAT4,1)],1),th.layouts[kh.NAME]=kh.LAYOUT,th.bindings[kh.BINDING]=kh.DESCRIPTOR;var Vh=e("cI","a_jointAnimInfo"),Wh=e("cE",(function(){}));Wh.JOINTS_OFFSET=0,Wh.COUNT=Wh.JOINTS_OFFSET+360,Wh.SIZE=4*Wh.COUNT,Wh.NAME="CCSkinning",Wh.BINDING=nh.UBO_SKINNING_TEXTURE,Wh.DESCRIPTOR=new ic(Wh.BINDING,ls.UNIFORM_BUFFER,1,Ja.VERTEX),Wh.LAYOUT=new Us(rh.LOCAL,Wh.BINDING,Wh.NAME,[new Bs("cc_joints",Fa.FLOAT4,90)],1),th.layouts[Wh.NAME]=Wh.LAYOUT,th.bindings[Wh.BINDING]=Wh.DESCRIPTOR;var jh=e("bB",(function(){}));jh.MAX_MORPH_TARGET_COUNT=60,jh.OFFSET_OF_WEIGHTS=0,jh.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH=4*jh.MAX_MORPH_TARGET_COUNT,jh.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT=jh.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH+4,jh.OFFSET_OF_VERTICES_COUNT=jh.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT+4,jh.COUNT_BASE_4_BYTES=4*Math.ceil(jh.MAX_MORPH_TARGET_COUNT/4)+4,jh.SIZE=4*jh.COUNT_BASE_4_BYTES,jh.NAME="CCMorph",jh.BINDING=nh.UBO_MORPH,jh.DESCRIPTOR=new ic(jh.BINDING,ls.UNIFORM_BUFFER,1,Ja.VERTEX),jh.LAYOUT=new Us(rh.LOCAL,jh.BINDING,jh.NAME,[new Bs("cc_displacementWeights",Fa.FLOAT4,jh.MAX_MORPH_TARGET_COUNT/4),new Bs("cc_displacementTextureInfo",Fa.FLOAT4,1)],1),th.layouts[jh.NAME]=jh.LAYOUT,th.bindings[jh.BINDING]=jh.DESCRIPTOR;var qh=e("cH",nh.SAMPLER_JOINTS),Yh=new ic(qh,ls.SAMPLER_TEXTURE,1,Ja.VERTEX),Xh=new Hs(rh.LOCAL,qh,"cc_jointTexture",Fa.SAMPLER2D,1);th.layouts.cc_jointTexture=Xh,th.bindings[qh]=Yh;var Kh=e("bK",nh.SAMPLER_MORPH_POSITION),Qh=new ic(Kh,ls.SAMPLER_TEXTURE,1,Ja.VERTEX),Zh=new Hs(rh.LOCAL,Kh,"cc_PositionDisplacements",Fa.SAMPLER2D,1);th.layouts.cc_PositionDisplacements=Zh,th.bindings[Kh]=Qh;var Jh=e("bJ",nh.SAMPLER_MORPH_NORMAL),$h=new ic(Jh,ls.SAMPLER_TEXTURE,1,Ja.VERTEX),e_=new Hs(rh.LOCAL,Jh,"cc_NormalDisplacements",Fa.SAMPLER2D,1);th.layouts.cc_NormalDisplacements=e_,th.bindings[Jh]=$h;var t_=e("bI",nh.SAMPLER_MORPH_TANGENT),n_=new ic(t_,ls.SAMPLER_TEXTURE,1,Ja.VERTEX),i_=new Hs(rh.LOCAL,t_,"cc_TangentDisplacements",Fa.SAMPLER2D,1);th.layouts.cc_TangentDisplacements=i_,th.bindings[t_]=n_;var o_=nh.SAMPLER_LIGHTMAP,r_=new ic(o_,ls.SAMPLER_TEXTURE,1,Ja.FRAGMENT),a_=new Hs(rh.LOCAL,o_,"cc_lightingMap",Fa.SAMPLER2D,1);th.layouts.cc_lightingMap=a_,th.bindings[o_]=r_;var s_=nh.SAMPLER_SPRITE,c_=new ic(s_,ls.SAMPLER_TEXTURE,1,Ja.FRAGMENT),l_=new Hs(rh.LOCAL,s_,"cc_spriteTexture",Fa.SAMPLER2D,1);th.layouts.cc_spriteTexture=l_,th.bindings[s_]=c_;var u_,h_,__,f_,d_,p_=qu.makeMaskExclude([qu.BitMask.UI_2D,qu.BitMask.GIZMOS,qu.BitMask.EDITOR,qu.BitMask.SCENE_GIZMO,qu.BitMask.PROFILER]),m_=qu.makeMaskExclude([qu.BitMask.UI_2D,qu.BitMask.PROFILER]),v_=qu.Enum.ALL;function g_(e){return e.hasFeature(Da.COLOR_HALF_FLOAT)&&e.hasFeature(Da.TEXTURE_HALF_FLOAT)}e("ft",Object.freeze({__proto__:null,PIPELINE_FLOW_GBUFFER:Ku,PIPELINE_FLOW_LIGHTING:Qu,PIPELINE_FLOW_FORWARD:Zu,PIPELINE_FLOW_SHADOW:Ju,PIPELINE_FLOW_SMAA:"SMAAFlow",PIPELINE_FLOW_TONEMAP:"ToneMapFlow",get RenderPassStage(){return Yu},get RenderPriority(){return Xu},globalDescriptorSetLayout:eh,localDescriptorSetLayout:th,get PipelineGlobalBindings(){return $u},get ModelLocalBindings(){return nh},get SetIndex(){return rh},bindingMappingInfo:ch,UBOGlobal:lh,UBOCamera:uh,UBOShadow:hh,UNIFORM_SHADOWMAP_BINDING:_h,UNIFORM_GBUFFER_ALBEDOMAP_BINDING:ph,UNIFORM_GBUFFER_POSITIONMAP_BINDING:gh,UNIFORM_GBUFFER_NORMALMAP_BINDING:Sh,UNIFORM_LIGHTING_RESULTMAP_BINDING:Ah,UNIFORM_GBUFFER_EMISSIVEMAP_BINDING:bh,UNIFORM_ENVIRONMENT_BINDING:Rh,UNIFORM_SPOT_LIGHTING_MAP_TEXTURE_BINDING:Dh,UBOLocal:Fh,INST_MAT_WORLD:zh,UBOLocalBatched:Bh,UBOForwardLight:Uh,UBODeferredLight:Hh,JOINT_UNIFORM_CAPACITY:30,UBOSkinningTexture:Gh,UBOSkinningAnimation:kh,INST_JOINT_ANIM_INFO:Vh,UBOSkinning:Wh,UBOMorph:jh,UNIFORM_JOINT_TEXTURE_BINDING:qh,UNIFORM_POSITION_MORPH_TEXTURE_BINDING:Kh,UNIFORM_NORMAL_MORPH_TEXTURE_BINDING:Jh,UNIFORM_TANGENT_MORPH_TEXTURE_BINDING:t_,UNIFORM_LIGHTMAP_TEXTURE_BINDING:o_,UNIFORM_SPRITE_TEXTURE_BINDING:s_,CAMERA_DEFAULT_MASK:p_,CAMERA_EDITOR_MASK:m_,MODEL_ALWAYS_MASK:v_,supportsHalfFloatTexture:g_})),function(e){e[e.VERTICAL=0]="VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL"}(u_||(u_={})),function(e){e[e.ORTHO=0]="ORTHO",e[e.PERSPECTIVE=1]="PERSPECTIVE"}(h_||(h_={})),function(e){e[e.F1_8=0]="F1_8",e[e.F2_0=1]="F2_0",e[e.F2_2=2]="F2_2",e[e.F2_5=3]="F2_5",e[e.F2_8=4]="F2_8",e[e.F3_2=5]="F3_2",e[e.F3_5=6]="F3_5",e[e.F4_0=7]="F4_0",e[e.F4_5=8]="F4_5",e[e.F5_0=9]="F5_0",e[e.F5_6=10]="F5_6",e[e.F6_3=11]="F6_3",e[e.F7_1=12]="F7_1",e[e.F8_0=13]="F8_0",e[e.F9_0=14]="F9_0",e[e.F10_0=15]="F10_0",e[e.F11_0=16]="F11_0",e[e.F13_0=17]="F13_0",e[e.F14_0=18]="F14_0",e[e.F16_0=19]="F16_0",e[e.F18_0=20]="F18_0",e[e.F20_0=21]="F20_0",e[e.F22_0=22]="F22_0"}(__||(__={})),function(e){e[e.ISO100=0]="ISO100",e[e.ISO200=1]="ISO200",e[e.ISO400=2]="ISO400",e[e.ISO800=3]="ISO800"}(f_||(f_={})),function(e){e[e.D1=0]="D1",e[e.D2=1]="D2",e[e.D4=2]="D4",e[e.D8=3]="D8",e[e.D15=4]="D15",e[e.D30=5]="D30",e[e.D60=6]="D60",e[e.D125=7]="D125",e[e.D250=8]="D250",e[e.D500=9]="D500",e[e.D1000=10]="D1000",e[e.D2000=11]="D2000",e[e.D4000=12]="D4000"}(d_||(d_={}));var y_,x_,S_=[1.8,2,2.2,2.5,2.8,3.2,3.5,4,4.5,5,5.6,6.3,7.1,8,9,10,11,13,14,16,18,20,22],E_=[1,.5,1/4,1/8,1/15,1/30,1/60,.008,.004,.002,.001,5e-4,1/4e3],T_=[100,200,400,800],A_=new Rn,C_=new Rn,w_=new jn,b_=_s.STENCIL<<1,I_=[],P_=function(){function e(e){if(this.isWindowSize=!0,this.screenScale=void 0,this._device=void 0,this._scene=null,this._node=null,this._name=null,this._enabled=!1,this._proj=-1,this._aspect=void 0,this._orthoHeight=10,this._fovAxis=u_.VERTICAL,this._fov=fn(45),this._nearClip=1,this._farClip=1e3,this._clearColor=new Is(.2,.2,.2,1),this._viewport=new oi(0,0,1,1),this._curTransform=Oa.IDENTITY,this._isProjDirty=!0,this._matView=new jn,this._matViewInv=null,this._matProj=new jn,this._matProjInv=new jn,this._matViewProj=new jn,this._matViewProjInv=new jn,this._frustum=new bu,this._forward=new Rn,this._position=new Rn,this._priority=0,this._aperture=__.F16_0,this._apertureValue=void 0,this._shutter=d_.D125,this._shutterValue=0,this._iso=f_.ISO100,this._isoValue=0,this._ec=0,this._poolHandle=No,this._frustumHandle=No,this._window=null,this._device=e,this._apertureValue=S_[this._aperture],this._shutterValue=E_[this._shutter],this._isoValue=T_[this._iso],this._aspect=this.screenScale=1,!I_.length){var t=e.capabilities.clipSpaceSignY;I_[Oa.IDENTITY]=new jn(1,0,0,0,0,t),I_[Oa.ROTATE_90]=new jn(0,1,0,0,-t,0),I_[Oa.ROTATE_180]=new jn(-1,0,0,0,0,-t),I_[Oa.ROTATE_270]=new jn(0,-1,0,0,t,0)}}var t=e.prototype;return t.initialize=function(e){this._name=e.name,this._node=e.node,this._proj=e.projection,this._priority=e.priority||0,this._aspect=this.screenScale=1;var t=this._poolHandle=_r.alloc();_r.set(t,sr.WIDTH,1),_r.set(t,sr.HEIGHT,1),_r.set(t,sr.CLEAR_FLAGS,_s.NONE),_r.set(t,sr.CLEAR_DEPTH,1),_r.set(t,sr.NODE,this._node.handle),_r.set(t,sr.VISIBILITY,p_),this._scene&&_r.set(t,sr.SCENE,this._scene.handle),this.updateExposure(),this.changeTargetWindow(e.window),console.log("Created Camera: "+this._name+" "+_r.get(t,sr.WIDTH)+"x"+_r.get(t,sr.HEIGHT))},t.destroy=function(){this._window&&this._window.detachCamera(this),this._name=null,this._poolHandle&&(_r.free(this._poolHandle),this._poolHandle=No,this._frustumHandle&&(Ar.free(this._frustumHandle),this._frustumHandle=No))},t.attachToScene=function(e){this._scene=e,this._enabled=!0,_r.set(this._poolHandle,sr.SCENE,e.handle)},t.detachFromScene=function(){this._scene=null,this._enabled=!1,_r.set(this._poolHandle,sr.SCENE,0)},t.resize=function(e,t){var n=this._poolHandle;_r.set(n,sr.WIDTH,e),_r.set(n,sr.HEIGHT,t),this._aspect=e*this._viewport.width/(t*this._viewport.height),this._isProjDirty=!0},t.setFixedSize=function(e,t){var n=this._poolHandle;_r.set(n,sr.WIDTH,e),_r.set(n,sr.HEIGHT,t),this._aspect=e*this._viewport.width/(t*this._viewport.height),this.isWindowSize=!1},t.update=function(e){if(void 0===e&&(e=!1),this._node){var t=!1;(this._node.hasChangedFlags||e)&&(jn.invert(this._matView,this._node.worldMatrix),_r.setMat4(this._poolHandle,sr.MAT_VIEW,this._matView),this._forward.x=-this._matView.m02,this._forward.y=-this._matView.m06,this._forward.z=-this._matView.m10,this._node.getWorldPosition(this._position),_r.setVec3(this._poolHandle,sr.POSITION,this._position),_r.setVec3(this._poolHandle,sr.FORWARD,this._forward),t=!0);var n=this._device.surfaceTransform;if(this._isProjDirty||this._curTransform!==n){var i;this._curTransform=n;var o=this._device.capabilities.clipSpaceSignY;if((null===(i=this.window)||void 0===i?void 0:i.hasOffScreenAttachments)&&(n=Oa.IDENTITY),this._proj===h_.PERSPECTIVE)jn.perspective(this._matProj,this._fov,this._aspect,this._nearClip,this._farClip,this._fovAxis===u_.VERTICAL,this._device.capabilities.clipSpaceMinZ,o,n);else{var r=this._orthoHeight*this._aspect,a=this._orthoHeight;jn.ortho(this._matProj,-r,r,-a,a,this._nearClip,this._farClip,this._device.capabilities.clipSpaceMinZ,o,n)}jn.invert(this._matProjInv,this._matProj),_r.setMat4(this._poolHandle,sr.MAT_PROJ,this._matProj),_r.setMat4(this._poolHandle,sr.MAT_PROJ_INV,this._matProjInv),t=!0,this._isProjDirty=!1}t&&(jn.multiply(this._matViewProj,this._matProj,this._matView),jn.invert(this._matViewProjInv,this._matViewProj),this._frustum.update(this._matViewProj,this._matViewProjInv),_r.setMat4(this._poolHandle,sr.MAT_VIEW_PROJ,this._matViewProj),_r.setMat4(this._poolHandle,sr.MAT_VIEW_PROJ_INV,this._matViewProjInv),Iu(this._frustumHandle,this._frustum))}},t.changeTargetWindow=function(e){void 0===e&&(e=null),this._window&&this._window.detachCamera(this);var t=e||c.director.root.mainWindow;t&&(t.attachCamera(this),this.resize(t.width,t.height),this._window=t,_r.set(this._poolHandle,sr.WINDOW,t.handle))},t.detachCamera=function(){this._window&&this._window.detachCamera(this)},t.screenPointToRay=function(e,t,n){if(!this._node)return null;var i=this._poolHandle,o=_r.get(i,sr.WIDTH),r=_r.get(i,sr.HEIGHT),a=this._viewport.x*o,s=this._viewport.y*r,c=this._viewport.width*o,l=this._viewport.height*r,u=this._proj===h_.PERSPECTIVE,h=this._device.capabilities.clipSpaceSignY,_=Wn[this._curTransform];Rn.set(A_,(t-a)/c*2-1,(n-s)/l*2-1,u?1:-1);var f=A_.x,d=A_.y;return A_.x=f*_[0]+d*_[2]*h,A_.y=f*_[1]+d*_[3]*h,Rn.transformMat4(u?A_:e.o,A_,this._matViewProjInv),u?(this._node.getWorldPosition(C_),Ta.fromPoints(e,C_,A_)):Rn.transformQuat(e.d,Rn.FORWARD,this._node.worldRotation),e},t.screenToWorld=function(e,t){var n=this._poolHandle,i=_r.get(n,sr.WIDTH),o=_r.get(n,sr.HEIGHT),r=this._viewport.x*i,a=this._viewport.y*o,s=this._viewport.width*i,c=this._viewport.height*o,l=this._device.capabilities.clipSpaceSignY,u=Wn[this._curTransform];if(this._proj===h_.PERSPECTIVE){Rn.set(e,(t.x-r)/s*2-1,(t.y-a)/c*2-1,1);var h=e.x,_=e.y;e.x=h*u[0]+_*u[2]*l,e.y=h*u[1]+_*u[3]*l,Rn.transformMat4(e,e,this._matViewProjInv),this._node&&this._node.getWorldPosition(A_),Rn.lerp(e,A_,e,_n(this._nearClip/this._farClip,1,t.z))}else{Rn.set(e,(t.x-r)/s*2-1,(t.y-a)/c*2-1,2*t.z-1);var f=e.x,d=e.y;e.x=f*u[0]+d*u[2]*l,e.y=f*u[1]+d*u[3]*l,Rn.transformMat4(e,e,this._matViewProjInv)}return e},t.worldToScreen=function(e,t){var n=this._poolHandle,i=_r.get(n,sr.WIDTH),o=_r.get(n,sr.HEIGHT),r=this._viewport.x*i,a=this._viewport.y*o,s=this._viewport.width*i,c=this._viewport.height*o,l=this._device.capabilities.clipSpaceSignY,u=Wn[this._curTransform];Rn.transformMat4(e,t,this._matViewProj);var h=e.x,_=e.y;return e.x=h*u[0]+_*u[2]*l,e.y=h*u[1]+_*u[3]*l,e.x=r+.5*(e.x+1)*s,e.y=a+.5*(e.y+1)*c,e.z=.5*e.z+.5,e},t.worldMatrixToScreen=function(e,t,n,i){jn.multiply(e,this._matViewProj,t),jn.multiply(e,I_[this._curTransform],e);var o=n/2,r=i/2;return jn.identity(w_),jn.transform(w_,w_,Rn.set(A_,o,r,0)),jn.scale(w_,w_,Rn.set(A_,o,r,1)),jn.multiply(e,w_,e),e},t.updateExposure=function(){var e=Math.log2(this._apertureValue*this._apertureValue/this._shutterValue*100/this._isoValue);_r.set(this._poolHandle,sr.EXPOSURE,.833333/Math.pow(2,e))},te(e,[{key:"node",get:function(){return this._node},set:function(e){this._node=e}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(e){this._orthoHeight=e,this._isProjDirty=!0}},{key:"projectionType",get:function(){return this._proj},set:function(e){this._proj=e,this._isProjDirty=!0}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(e){this._fovAxis=e,this._isProjDirty=!0}},{key:"fov",get:function(){return this._fov},set:function(e){this._fov=e,this._isProjDirty=!0}},{key:"nearClip",get:function(){return this._nearClip},set:function(e){this._nearClip=e,this._isProjDirty=!0}},{key:"farClip",get:function(){return this._farClip},set:function(e){this._farClip=e,this._isProjDirty=!0}},{key:"clearColor",get:function(){return this._clearColor},set:function(e){this._clearColor.x=e.x,this._clearColor.y=e.y,this._clearColor.z=e.z,this._clearColor.w=e.w,_r.setVec4(this._poolHandle,sr.CLEAR_COLOR,e)}},{key:"viewport",get:function(){return this._viewport},set:function(e){var t=e.x,n=e.width,i=e.height,o=this._device.capabilities.clipSpaceSignY<0?1-e.y-i:e.y;switch(this._device.surfaceTransform){case Oa.ROTATE_90:this._viewport.x=1-o-i,this._viewport.y=t,this._viewport.width=i,this._viewport.height=n;break;case Oa.ROTATE_180:this._viewport.x=1-t-n,this._viewport.y=1-o-i,this._viewport.width=n,this._viewport.height=i;break;case Oa.ROTATE_270:this._viewport.x=o,this._viewport.y=1-t-n,this._viewport.width=i,this._viewport.height=n;break;case Oa.IDENTITY:this._viewport.x=t,this._viewport.y=o,this._viewport.width=n,this._viewport.height=i}_r.setVec4(this._poolHandle,sr.VIEW_PORT,this._viewport),this.resize(this.width,this.height)}},{key:"scene",get:function(){return this._scene}},{key:"name",get:function(){return this._name}},{key:"width",get:function(){return _r.get(this._poolHandle,sr.WIDTH)}},{key:"height",get:function(){return _r.get(this._poolHandle,sr.HEIGHT)}},{key:"aspect",get:function(){return this._aspect}},{key:"matView",get:function(){return this._matView},set:function(e){this._matView=e,_r.setMat4(this._poolHandle,sr.MAT_VIEW,this._matView)}},{key:"matViewInv",get:function(){return this._matViewInv||this._node.worldMatrix},set:function(e){this._matViewInv=e}},{key:"matProj",get:function(){return this._matProj},set:function(e){this._matProj=e,_r.setMat4(this._poolHandle,sr.MAT_PROJ,this._matProj)}},{key:"matProjInv",get:function(){return this._matProjInv},set:function(e){this._matProjInv=e,_r.setMat4(this._poolHandle,sr.MAT_PROJ_INV,this._matProjInv)}},{key:"matViewProj",get:function(){return this._matViewProj},set:function(e){this._matViewProj=e,_r.setMat4(this._poolHandle,sr.MAT_VIEW_PROJ,this._matViewProj)}},{key:"matViewProjInv",get:function(){return this._matViewProjInv},set:function(e){this._matViewProjInv=e,_r.setMat4(this._poolHandle,sr.MAT_VIEW_PROJ_INV,this._matViewProjInv)}},{key:"frustum",get:function(){return this._frustum},set:function(e){this._frustum=e,Iu(this._frustumHandle,e)}},{key:"window",get:function(){return this._window},set:function(e){this._window=e,e&&_r.set(this._poolHandle,sr.WINDOW,e.handle)}},{key:"forward",get:function(){return this._forward},set:function(e){this._forward=e,_r.setVec3(this._poolHandle,sr.FORWARD,this._forward)}},{key:"position",get:function(){return this._position},set:function(e){this._position=e,_r.setVec3(this._poolHandle,sr.POSITION,this._position)}},{key:"visibility",get:function(){return _r.get(this._poolHandle,sr.VISIBILITY)},set:function(e){_r.set(this._poolHandle,sr.VISIBILITY,e)}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e}},{key:"aperture",get:function(){return this._aperture},set:function(e){this._aperture=e,this._apertureValue=S_[this._aperture],this.updateExposure()}},{key:"apertureValue",get:function(){return this._apertureValue}},{key:"shutter",get:function(){return this._shutter},set:function(e){this._shutter=e,this._shutterValue=E_[this._shutter],this.updateExposure()}},{key:"shutterValue",get:function(){return this._shutterValue}},{key:"iso",get:function(){return this._iso},set:function(e){this._iso=e,this._isoValue=T_[this._iso],this.updateExposure()}},{key:"isoValue",get:function(){return this._isoValue}},{key:"ec",get:function(){return this._ec},set:function(e){this._ec=e}},{key:"exposure",get:function(){return _r.get(this._poolHandle,sr.EXPOSURE)}},{key:"clearFlag",get:function(){return _r.get(this._poolHandle,sr.CLEAR_FLAGS)},set:function(e){_r.set(this._poolHandle,sr.CLEAR_FLAGS,e)}},{key:"clearDepth",get:function(){return _r.get(this._poolHandle,sr.CLEAR_DEPTH)},set:function(e){_r.set(this._poolHandle,sr.CLEAR_DEPTH,e)}},{key:"clearStencil",get:function(){return _r.get(this._poolHandle,sr.CLEAR_STENCIL)},set:function(e){_r.set(this._poolHandle,sr.CLEAR_STENCIL,e)}},{key:"handle",get:function(){return this._poolHandle}}]),e}();!function(e){e[e.LOCAL=0]="LOCAL",e[e.WORLD=1]="WORLD"}(y_||(y_={})),function(e){e[e.NONE=0]="NONE",e[e.POSITION=1]="POSITION",e[e.ROTATION=2]="ROTATION",e[e.SCALE=4]="SCALE",e[e.RS=e.ROTATION|e.SCALE]="RS",e[e.TRS=e.POSITION|e.ROTATION|e.SCALE]="TRS",e[e.TRS_MASK=~e.TRS]="TRS_MASK"}(x_||(x_=e("c3",{}))),c.internal.TransformBit=x_;var R_=function(){function e(e){this._root=void 0,this._name="",this._cameras=[],this._models=[],this._batches=[],this._directionalLights=[],this._sphereLights=[],this._spotLights=[],this._mainLight=null,this._modelId=0,this._scenePoolHandle=No,this._modelArrayHandle=No,this._batchArrayHandle=No,this._sphereLightsHandle=No,this._spotLightsHandle=No,this._root=e,this._createHandles()}e.registerCreateFunc=function(t){t._createSceneFun=function(t){return new e(t)}};var t=e.prototype;return t.initialize=function(e){return this._name=e.name,this._createHandles(),!0},t.update=function(e){var t=this._mainLight;t&&t.update();for(var n=this._sphereLights,i=0;i<n.length;i++)n[i].update();for(var o=this._spotLights,r=0;r<o.length;r++)o[r].update();for(var a=this._models,s=0;s<a.length;s++){var c=a[s];c.enabled&&(c.updateTransform(e),c.updateUBOs(e))}},t.destroy=function(){this.removeCameras(),this.removeSphereLights(),this.removeSpotLights(),this.removeModels(),this._modelArrayHandle&&(Bo.free(this._modelArrayHandle),this._modelArrayHandle=No),this._scenePoolHandle&&(lr.free(this._scenePoolHandle),this._scenePoolHandle=No),this._sphereLightsHandle&&(Go.free(this._sphereLightsHandle),this._sphereLightsHandle=No),this._spotLightsHandle&&(Go.free(this._spotLightsHandle),this._spotLightsHandle=No),this._batchArrayHandle&&(Vo.free(this._batchArrayHandle),this._batchArrayHandle=No)},t.addCamera=function(e){e.attachToScene(this),this._cameras.push(e)},t.removeCamera=function(e){for(var t=0;t<this._cameras.length;++t)if(this._cameras[t]===e)return this._cameras.splice(t,1),void e.detachFromScene()},t.removeCameras=function(){for(var e,t=le(this._cameras);!(e=t()).done;)e.value.detachFromScene();this._cameras.splice(0)},t.setMainLight=function(e){this._mainLight=e,lr.set(this._scenePoolHandle,or.MAIN_LIGHT,e.handle)},t.unsetMainLight=function(e){if(this._mainLight===e){var t=this._directionalLights;t.length?(this._mainLight=t[t.length-1],this._mainLight.node&&(this._mainLight.node.hasChangedFlags|=x_.ROTATION)):this._mainLight=null}},t.addDirectionalLight=function(e){e.attachToScene(this),this._directionalLights.push(e)},t.removeDirectionalLight=function(e){for(var t=0;t<this._directionalLights.length;++t)if(this._directionalLights[t]===e)return e.detachFromScene(),void this._directionalLights.splice(t,1)},t.addSphereLight=function(e){e.attachToScene(this),this._sphereLights.push(e),Go.push(this._sphereLightsHandle,e.handle)},t.removeSphereLight=function(e){for(var t=0;t<this._sphereLights.length;++t)if(this._sphereLights[t]===e)return e.detachFromScene(),this._sphereLights.splice(t,1),void Go.erase(this._sphereLightsHandle,t)},t.addSpotLight=function(e){e.attachToScene(this),this._spotLights.push(e),Go.push(this._spotLightsHandle,e.handle)},t.removeSpotLight=function(e){for(var t=0;t<this._spotLights.length;++t)if(this._spotLights[t]===e)return e.detachFromScene(),this._spotLights.splice(t,1),void Go.erase(this._spotLightsHandle,t)},t.removeSphereLights=function(){for(var e=0;e<this._sphereLights.length;++e)this._sphereLights[e].detachFromScene();this._sphereLights.length=0,Go.clear(this._sphereLightsHandle)},t.removeSpotLights=function(){for(var e=0;e<this._spotLights.length;++e)this._spotLights[e].detachFromScene();this._spotLights=[],Go.clear(this._spotLightsHandle)},t.addModel=function(e){e.attachToScene(this),this._models.push(e),Bo.push(this._modelArrayHandle,e.handle)},t.removeModel=function(e){for(var t=0;t<this._models.length;++t)if(this._models[t]===e)return e.detachFromScene(),this._models.splice(t,1),void Bo.erase(this._modelArrayHandle,t)},t.removeModels=function(){for(var e,t=le(this._models);!(e=t()).done;){var n=e.value;n.detachFromScene(),n.destroy()}this._models.length=0,Bo.clear(this._modelArrayHandle)},t.addBatch=function(e){this._batches.push(e),Vo.push(this._batchArrayHandle,e.handle)},t.removeBatch=function(e){for(var t=0;t<this._batches.length;++t)if(this._batches[t]===e)return this._batches.splice(t,1),void Vo.erase(this._batchArrayHandle,t)},t.removeBatches=function(){this._batches.length=0,Vo.clear(this._batchArrayHandle)},t.onGlobalPipelineStateChanged=function(){for(var e,t=le(this._models);!(e=t()).done;)e.value.onGlobalPipelineStateChanged()},t.generateModelId=function(){return this._modelId++},t._createHandles=function(){this._modelArrayHandle||(this._modelArrayHandle=Bo.alloc(),this._scenePoolHandle=lr.alloc(),lr.set(this._scenePoolHandle,or.MODEL_ARRAY,this._modelArrayHandle),this._spotLightsHandle=Go.alloc(),lr.set(this._scenePoolHandle,or.SPOT_LIGHT_ARRAY,this._spotLightsHandle),this._sphereLightsHandle=Go.alloc(),lr.set(this._scenePoolHandle,or.SPHERE_LIGHT_ARRAY,this._sphereLightsHandle)),this._batchArrayHandle||(this._batchArrayHandle=Vo.alloc(),lr.set(this._scenePoolHandle,or.BATCH_ARRAY_2D,this._batchArrayHandle))},te(e,[{key:"root",get:function(){return this._root}},{key:"name",get:function(){return this._name}},{key:"cameras",get:function(){return this._cameras}},{key:"mainLight",get:function(){return this._mainLight}},{key:"sphereLights",get:function(){return this._sphereLights}},{key:"spotLights",get:function(){return this._spotLights}},{key:"models",get:function(){return this._models}},{key:"handle",get:function(){return this._scenePoolHandle}},{key:"batches",get:function(){return this._batches}}]),e}(),N_=function(){},O_=function(){return N_},D_=M_((function(){}));function M_(e){return function(t){return"function"==typeof t?e(t):function(n){return e(n,t)}}}function L_(e){return function(t){return function(n){!function(e,t,n){var i=z_(e);if(i){var o=B_(i,"proto");B_(o,"editor")[t]=n}}(n,e,t)}}}var F_="__ccclassCache__";function z_(e){return B_(e,F_)}function B_(e,t){return e[t]||(e[t]={})}var U_=e("bM",M_((function(e,t){var n=at.getSuper(e);n===Object&&(n=null);var i={name:t,extends:n,ctor:e},o=e[F_];if(o){var r=o.proto;r&&at.mixin(i,r),e[F_]=void 0}return tn(i)}))),H_=e("d3",L_("requireComponent")),G_=e("c8",L_("executionOrder")),k_=e("c$",D_);function V_(e,t,n){var i=null;function o(e,t,n){var o=z_(e.constructor);if(o){var r=B_(o,"proto"),a=B_(r,"properties");!function(e,t,n,i,o,r){var a,s=o&&(o.get||o.set);i&&(a=jt(i,s));var c=t[n],l=at.mixin(c||{},a||i||{});if(s)o.get&&(l.get=o.get),o.set&&(l.set=o.set);else if(o)o.initializer&&(l.default=function(e){var t;try{t=e()}catch(t){return e}return"object"!=typeof t||null===t?t:e}(o.initializer));else{var u=r.default||(r.default=function(e){var t;try{t=new e}catch(e){return{}}return t}(e));u.hasOwnProperty(n)&&(l.default=u[n])}t[n]=l}(e.constructor,a,t,i,n,o)}}return void 0===e?V_({type:void 0}):void 0===t?(i=e,o):void o(e,t,n)}var W_=e("bV",(function(e,t,n){return V_(q_({}))(e,t,n)})),j_=e("dQ",(function(e,t,n){return V_({editorOnly:!0})(e,t,n)}));function q_(e){return e.__noImplicit=!0,"serializable"in e||(e.serializable=!0),e}var Y_=e("c2",D_),X_=e("c9",O_),K_=e("ek",D_),Q_=O_,Z_=O_,J_=e("c7",O_),$_=e("c0",N_),ef=e("cb",O_),tf=(e("e9",N_),e("d4",O_)),nf=e("ca",O_),of=e("ck",O_),rf=e("dF",O_),af=e("dG",O_),sf=O_,cf=e("cj",N_),lf=e("d1",O_),uf=(e("co",O_),e("e1",N_),e("d6",N_),e("c5",N_)),hf=pf(Lt),_f=pf(Ft),ff=pf(zt),df=e("cV",pf(Bt));function pf(e){return V_({type:e})}var mf=e("cN",(function(e,t,n){return V_({__noImplicit:!0,override:!0})(e,t,n)})),vf=function(){function e(e){this._map=null,this._count=0,e?(this._map=e,this._count=Object.keys(e).length):(this._map=at.createMap(!0),this._count=0)}var t=e.prototype;return t.add=function(e,t){return e in this._map||this._count++,this._map[e]=t},t.get=function(e){return this._map[e]},t.has=function(e){return e in this._map},t.remove=function(e){var t=this._map[e];return e in this._map&&(delete this._map[e],this._count--),t},t.clear=function(){0!==this._count&&(this._map=at.createMap(!0),this._count=0)},t.forEach=function(e){for(var t in this._map)e(this._map[t],t)},t.find=function(e){for(var t in this._map)if(e(this._map[t],t))return this._map[t];return null},t.destroy=function(){this._map=null},te(e,[{key:"count",get:function(){return this._count}}]),e}(),gf=function(){function e(t,n){this.id=e._pipelineId++,this.name="",this.pipes=[],this.name=t;for(var i=0,o=n.length;i<o;i++)this.pipes.push(n[i])}var t=e.prototype;return t.insert=function(e,t){return t>this.pipes.length?(P(4921),this):(this.pipes.splice(t,0,e),this)},t.append=function(e){return this.pipes.push(e),this},t.remove=function(e){return this.pipes.splice(e,1),this},t.sync=function(e){var t=this.pipes;if(0===t.length)return null;e.isFinish=!1;for(var n=0,i=t.length;n<i;){var o=(0,t[n])(e);if(o)return e.isFinish=!0,o;++n!==i&&(e.input=e.output,e.output=null)}return e.isFinish=!0,e.output},t.async=function(e){0!==this.pipes.length&&(e.isFinish=!1,this._flow(0,e))},t._flow=function(e,t){var n=this;(0,this.pipes[e])(t,(function(i){i?(t.isFinish=!0,t.dispatch("complete",i)):++e<n.pipes.length?(t.input=t.output,t.output=null,n._flow(e,t)):(t.isFinish=!0,t.dispatch("complete",i,t.output))}))},e}();gf._pipelineId=0;var yf,xf=new vf,Sf=new vf,Ef=new vf,Tf=new vf,Af=new gf("normal load",[]),Cf=new gf("fetch",[]),wf=new gf("transform url",[]);!function(e){e.UUID="uuid",e.PATH="path",e.DIR="dir",e.URL="url",e.SCENE="scene"}(yf||(yf={}));var bf,If={default:{priority:0},preload:{maxConcurrency:6,maxRequestsPerFrame:2,priority:-1},scene:{maxConcurrency:20,maxRequestsPerFrame:20,priority:1},bundle:{maxConcurrency:20,maxRequestsPerFrame:20,priority:2},remote:{maxRetryCount:4}};!function(e){e.RESOURCES="resources",e.MAIN="main",e.START_SCENE="start-scene"}(bf||(bf={}));var Pf=function(){function e(t){this.id=e._taskId++,this.onComplete=null,this.onProgress=null,this.onError=null,this.source=null,this.output=null,this.input=null,this.progress=null,this.options=null,this.isFinish=!0,this.set(t)}e.create=function(t){var n;return 0!==e._deadPool.length?(n=e._deadPool.pop()).set(t):n=new e(t),n};var t=e.prototype;return t.set=function(e){void 0===e&&(e=Object.create(null)),this.onComplete=e.onComplete||null,this.onProgress=e.onProgress||null,this.onError=e.onError||null,this.source=this.input=e.input,this.output=null,this.progress=e.progress,this.options=e.options||Object.create(null)},t.dispatch=function(e,t,n,i,o){switch(e){case"complete":this.onComplete&&this.onComplete(t,n);break;case"progress":this.onProgress&&this.onProgress(t,n,i,o);break;case"error":this.onError&&this.onError(t,n,i,o);break;default:var r="on"+e[0].toUpperCase()+e.substr(1);"function"==typeof this[r]&&this[r](t,n,i,o)}},t.recycle=function(){e._deadPool.length!==e.MAX_DEAD_NUM&&(this.onComplete=null,this.onProgress=null,this.onError=null,this.source=this.output=this.input=null,this.progress=null,this.options=null,e._deadPool.push(this))},e}();Pf.MAX_DEAD_NUM=500,Pf._taskId=0,Pf._deadPool=[];var Rf="0123456789abcdef".split(""),Nf=["","","",""],Of=Nf.concat(Nf,"-",Nf,"-",Nf,"-",Nf,"-",Nf,Nf,Nf),Df=Of.map((function(e,t){return"-"===e?NaN:t})).filter(isFinite);function Mf(e){var t=e.split("@")[0];if(22!==t.length)return e;Of[0]=e[0],Of[1]=e[1];for(var n=2,i=2;n<22;n+=2){var o=gt[e.charCodeAt(n)],r=gt[e.charCodeAt(n+1)];Of[Df[i++]]=Rf[o>>2],Of[Df[i++]]=Rf[(3&o)<<2|r>>4],Of[Df[i++]]=Rf[15&r]}return e.replace(t,Of.join(""))}var Lf=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/;function Ff(e){var t=Lf.exec(e);return t?t[1]:""}function zf(e,t){(t=t||Object.create(null)).__isNative__=t.isNative,t.ext=t.nativeExt;var n=Tf.find((function(t){return!!t.getAssetInfo(e)}));return n&&(t.bundle=n.name),Hf(e,t)}function Bf(e){return e&&(e instanceof c.SceneAsset||e instanceof c.Scene)}function Uf(e){return e&&(46===e.charCodeAt(0)&&47===e.charCodeAt(1)?e=e.slice(2):47===e.charCodeAt(0)&&(e=e.slice(1))),e}function Hf(e,t){var n=Pf.create({input:e,options:t}),i=[];try{for(var o,r=le(wf.sync(n));!(o=r()).done;){var a=o.value,s=a.url;a.recycle(),i.push(s)}}catch(e){for(var c,l=le(n.output);!(c=l()).done;)c.value.recycle();x(e.message,e.stack)}return n.recycle(),i.length>1?i:i[0]}var Gf,kf,Vf,Wf,jf=Object.freeze({__proto__:null,getUuidFromURL:Ff,getUrlWithUuid:zf,isScene:Bf,normalize:Uf,transform:Hf,decodeUuid:Mf}),qf=e("dO",function(){function e(e,t){this.type=void 0,this.bubbles=void 0,this.target=null,this.currentTarget=null,this.eventPhase=0,this.propagationStopped=!1,this.propagationImmediateStopped=!1,this.type=e,this.bubbles=!!t}var t=e.prototype;return t.unuse=function(){this.type=e.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=e.NONE,this.propagationStopped=!1,this.propagationImmediateStopped=!1},t.reuse=function(e,t){this.type=e,this.bubbles=t||!1},t.isStopped=function(){return this.propagationStopped||this.propagationImmediateStopped},t.getCurrentTarget=function(){return this.currentTarget},t.getType=function(){return this.type},e}());qf.NO_TYPE="no_type",qf.TOUCH="touch",qf.MOUSE="mouse",qf.KEYBOARD="keyboard",qf.ACCELERATION="acceleration",qf.NONE=0,qf.CAPTURING_PHASE=1,qf.AT_TARGET=2,qf.BUBBLING_PHASE=3,c.Event=qf;var Yf=e("bP",U_("cc.Asset")((Wf=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).loaded=!0,ue(t,"_native",Vf,se(t)),t._nativeUrl="",t.__onLoadedInvoked__=!1,t.__nativeDepend__=null,t.__depends__=null,t._file=null,t._ref=0,Object.defineProperty(se(t),"_uuid",{value:"",writable:!0}),t}ie(t,e),t.deserialize=function(e){return c.deserialize(e)};var n=t.prototype;return n.toString=function(){return this.nativeUrl},n.serialize=function(){},n._setRawAsset=function(e,t){void 0===t&&(t=!0),this._native=!1!==t?e||"":"/"+e},n.addRef=function(){return this._ref++,this},n.decRef=function(e){return void 0===e&&(e=!0),this._ref>0&&this._ref--,e&&c.assetManager._releaseManager.tryRelease(this),this},n.onLoaded=function(){},n.initDefault=function(e){e&&(this._uuid=e),this.isDefault=!0},n.validate=function(){return!0},te(t,[{key:"nativeUrl",get:function(){if(!this._nativeUrl){if(!this._native)return"";var e=this._native;if(47===e.charCodeAt(0))return e.slice(1);46===e.charCodeAt(0)?this._nativeUrl=zf(this._uuid,{nativeExt:e,isNative:!0}):this._nativeUrl=zf(this._uuid,{__nativeName__:e,nativeExt:Bi(e),isNative:!0})}return this._nativeUrl}},{key:"_nativeAsset",get:function(){return this._file},set:function(e){this._file=e}},{key:"_nativeDep",get:function(){if(this._native)return{__isNative__:!0,uuid:this._uuid,ext:this._native}}},{key:"refCount",get:function(){return this._ref}}]),t}(Ti(fi)),Vf=he((kf=Wf).prototype,"_native",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),he(kf.prototype,"_nativeAsset",[V_],Object.getOwnPropertyDescriptor(kf.prototype,"_nativeAsset"),kf.prototype),Gf=kf))||Gf);Yf.prototype.createNode=null,c.Asset=Yf;var Xf,Kf,Qf,Zf,Jf,$f,ed,td=1024;function nd(e){return c.sys.capabilities.imageBitmap&&e instanceof ImageBitmap}!function(e){e[e.RGB565=Ma.R5G6B5]="RGB565",e[e.RGB5A1=Ma.RGB5A1]="RGB5A1",e[e.RGBA4444=Ma.RGBA4]="RGBA4444",e[e.RGB888=Ma.RGB8]="RGB888",e[e.RGB32F=Ma.RGB32F]="RGB32F",e[e.RGBA8888=Ma.RGBA8]="RGBA8888",e[e.RGBA32F=Ma.RGBA32F]="RGBA32F",e[e.A8=Ma.A8]="A8",e[e.I8=Ma.L8]="I8",e[e.AI8=Ma.LA8]="AI8",e[e.RGB_PVRTC_2BPPV1=Ma.PVRTC_RGB2]="RGB_PVRTC_2BPPV1",e[e.RGBA_PVRTC_2BPPV1=Ma.PVRTC_RGBA2]="RGBA_PVRTC_2BPPV1",e[e.RGB_A_PVRTC_2BPPV1=td++]="RGB_A_PVRTC_2BPPV1",e[e.RGB_PVRTC_4BPPV1=Ma.PVRTC_RGB4]="RGB_PVRTC_4BPPV1",e[e.RGBA_PVRTC_4BPPV1=Ma.PVRTC_RGBA4]="RGBA_PVRTC_4BPPV1",e[e.RGB_A_PVRTC_4BPPV1=td++]="RGB_A_PVRTC_4BPPV1",e[e.RGB_ETC1=Ma.ETC_RGB8]="RGB_ETC1",e[e.RGBA_ETC1=td++]="RGBA_ETC1",e[e.RGB_ETC2=Ma.ETC2_RGB8]="RGB_ETC2",e[e.RGBA_ETC2=Ma.ETC2_RGBA8]="RGBA_ETC2",e[e.RGBA_ASTC_4x4=Ma.ASTC_RGBA_4x4]="RGBA_ASTC_4x4",e[e.RGBA_ASTC_5x4=Ma.ASTC_RGBA_5x4]="RGBA_ASTC_5x4",e[e.RGBA_ASTC_5x5=Ma.ASTC_RGBA_5x5]="RGBA_ASTC_5x5",e[e.RGBA_ASTC_6x5=Ma.ASTC_RGBA_6x5]="RGBA_ASTC_6x5",e[e.RGBA_ASTC_6x6=Ma.ASTC_RGBA_6x6]="RGBA_ASTC_6x6",e[e.RGBA_ASTC_8x5=Ma.ASTC_RGBA_8x5]="RGBA_ASTC_8x5",e[e.RGBA_ASTC_8x6=Ma.ASTC_RGBA_8x6]="RGBA_ASTC_8x6",e[e.RGBA_ASTC_8x8=Ma.ASTC_RGBA_8x8]="RGBA_ASTC_8x8",e[e.RGBA_ASTC_10x5=Ma.ASTC_RGBA_10x5]="RGBA_ASTC_10x5",e[e.RGBA_ASTC_10x6=Ma.ASTC_RGBA_10x6]="RGBA_ASTC_10x6",e[e.RGBA_ASTC_10x8=Ma.ASTC_RGBA_10x8]="RGBA_ASTC_10x8",e[e.RGBA_ASTC_10x10=Ma.ASTC_RGBA_10x10]="RGBA_ASTC_10x10",e[e.RGBA_ASTC_12x10=Ma.ASTC_RGBA_12x10]="RGBA_ASTC_12x10",e[e.RGBA_ASTC_12x12=Ma.ASTC_RGBA_12x12]="RGBA_ASTC_12x12"}(Xf||(Xf=e("cM",{}))),function(e){e[e.REPEAT=qa.WRAP]="REPEAT",e[e.CLAMP_TO_EDGE=qa.CLAMP]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=qa.MIRROR]="MIRRORED_REPEAT",e[e.CLAMP_TO_BORDER=qa.BORDER]="CLAMP_TO_BORDER"}(Kf||(Kf=e("dW",{}))),function(e){e[e.NONE=ja.NONE]="NONE",e[e.LINEAR=ja.LINEAR]="LINEAR",e[e.NEAREST=ja.POINT]="NEAREST"}(Qf||(Qf=e("cL",{})));var id,od=e("bC",U_("cc.ImageAsset")((ed=$f=function(e){function t(t){var n;return(n=e.call(this)||this)._nativeData=void 0,n._tex=void 0,n._exportedExts=void 0,n._format=Xf.RGBA8888,n._width=0,n._height=0,n.loaded=!1,n._nativeData={_data:null,width:0,height:0,format:0,_compressed:!1},void 0!==t&&n.reset(t),n}ie(t,e);var n=t.prototype;return n.reset=function(e){var t=this;nd(e)?(this._nativeData=e,this._onDataComplete()):e instanceof HTMLElement?(this._nativeData=e,e.complete||e instanceof HTMLCanvasElement?this._onDataComplete():(this.loaded=!1,e.addEventListener("load",(function(){t._onDataComplete()})),e.addEventListener("error",(function(e){P(3119,e.message)})))):(this._nativeData=e,this._format=e.format,this._onDataComplete())},n.destroy=function(){return this.data&&this.data instanceof HTMLImageElement?(this.data.src="",this._setRawAsset("")):nd(this.data)&&this.data.close&&this.data.close(),e.prototype.destroy.call(this)},n._serialize=function(){},n._deserialize=function(e){var n="";"string"==typeof e?n=e:(this._width=e.w,this._height=e.h,n=e.fmt);for(var i,o=c.director.root?c.director.root.device:null,r=n.split("_"),a="",s=Number.MAX_VALUE,l=this._format,u="",h=c.macro.SUPPORT_TEXTURE_FORMATS,_=le(r);!(i=_()).done;){var f=i.value.split("@"),d=parseInt(f[0],void 0),p=t.extnames[d]||f[0],m=h.indexOf(p);if(-1!==m&&m<s){var v=f[1]?parseInt(f[1]):this._format;if(!(".astc"!==p||o&&o.hasFeature(Da.FORMAT_ASTC)))continue;if(!(".pvr"!==p||o&&o.hasFeature(Da.FORMAT_PVRTC)))continue;if(!(v!==Xf.RGB_ETC1&&v!==Xf.RGBA_ETC1||o&&o.hasFeature(Da.FORMAT_ETC1)))continue;if(!(v!==Xf.RGB_ETC2&&v!==Xf.RGBA_ETC2||o&&o.hasFeature(Da.FORMAT_ETC2)))continue;if(".webp"===p&&!c.sys.capabilities.webp)continue;s=m,u=p,l=v}else a||(a=p)}u?(this._setRawAsset(u),this._format=l):a?(this._setRawAsset(a),P(3120,a,a)):P(3121)},n._onDataComplete=function(){this.loaded=!0,this.emit("load")},n.initDefault=function(n){if(e.prototype.initDefault.call(this,n),t._sharedPlaceHolderCanvas)this.reset(t._sharedPlaceHolderCanvas);else{var i=document.createElement("canvas"),o=i.getContext("2d"),r=i.width=i.height=2;o.fillStyle="#ff00ff",o.fillRect(0,0,r,r),this.reset(i),t._sharedPlaceHolderCanvas=i}},n.validate=function(){return!!this.data},te(t,[{key:"_nativeAsset",get:function(){return this._nativeData},set:function(e){e instanceof HTMLElement||nd(e)||(e.format=e.format||this._format),this.reset(e)}},{key:"data",get:function(){return this._nativeData&&((e=this._nativeData)instanceof HTMLImageElement||e instanceof HTMLCanvasElement||nd(e))?this._nativeData:this._nativeData&&this._nativeData._data;var e}},{key:"width",get:function(){return this._nativeData.width||this._width}},{key:"height",get:function(){return this._nativeData.height||this._height}},{key:"format",get:function(){return this._format}},{key:"isCompressed",get:function(){return this._format>=Xf.RGB_ETC1&&this._format<=Xf.RGBA_ASTC_12x12||this._format>=Xf.RGB_A_PVRTC_2BPPV1&&this._format<=Xf.RGBA_ETC1}},{key:"url",get:function(){return this.nativeUrl}},{key:"_texture",get:function(){if(!this._tex){var e=new c.Texture2D;e.name=this.nativeUrl,e.image=this,this._tex=e}return this._tex},set:function(e){this._tex=e}}]),t}(Yf),$f.extnames=[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm",".astc"],$f._sharedPlaceHolderCanvas=null,he((Jf=ed).prototype,"_nativeAsset",[mf],Object.getOwnPropertyDescriptor(Jf.prototype,"_nativeAsset"),Jf.prototype),Zf=Jf))||Zf);c.ImageAsset=od,function(e){e[e.minFilter=0]="minFilter",e[e.magFilter=1]="magFilter",e[e.mipFilter=2]="mipFilter",e[e.addressU=3]="addressU",e[e.addressV=4]="addressV",e[e.addressW=5]="addressW",e[e.maxAnisotropy=6]="maxAnisotropy",e[e.cmpFunc=7]="cmpFunc",e[e.mipLODBias=8]="mipLODBias",e[e.total=9]="total"}(id||(id={}));var rd=[ja.LINEAR,ja.LINEAR,ja.NONE,qa.WRAP,qa.WRAP,qa.WRAP,0,Ya.NEVER,0],ad=ld(rd),sd=new Is,cd=new zs;function ld(e){for(var t=0,n=0,i=0;i<rd.length;i++)switch(t=e[i]||rd[i],i){case id.minFilter:n|=t;break;case id.magFilter:n|=t<<2;break;case id.mipFilter:n|=t<<4;break;case id.addressU:n|=t<<6;break;case id.addressV:n|=t<<8;break;case id.addressW:n|=t<<10;break;case id.maxAnisotropy:n|=t<<12;break;case id.cmpFunc:n|=t<<16;break;case id.mipLODBias:n|=t<<28}return n}var ud,hd,_d,fd,dd,pd,md,vd,gd,yd,xd,Sd,Ed=function(){function e(){this._cache={}}return e.prototype.getSampler=function(e,t){return t||(t=ad),this._cache[t]||(cd.minFilter=3&t,cd.magFilter=t>>2&3,cd.mipFilter=t>>4&3,cd.addressU=t>>6&3,cd.addressV=t>>8&3,cd.addressW=t>>10&3,cd.maxAnisotropy=t>>12&15,cd.cmpFunc=t>>16&15,cd.mipLODBias=t>>28&15,cd.borderColor=sd,this._cache[t]=e.createSampler(cd))},e}(),Td=e("bE",new Ed);c.samplerLib=Td;var Ad=new ge("Tex"),Cd=e("d5",U_("cc.TextureBase")((Sd=xd=function(e){function t(){var t;return ue(t=e.call(this)||this,"_format",_d,se(t)),ue(t,"_minFilter",fd,se(t)),ue(t,"_magFilter",dd,se(t)),ue(t,"_mipFilter",pd,se(t)),ue(t,"_wrapS",md,se(t)),ue(t,"_wrapT",vd,se(t)),ue(t,"_wrapR",gd,se(t)),ue(t,"_anisotropy",yd,se(t)),t._width=1,t._height=1,t._id=void 0,t._samplerInfo=[],t._samplerHash=0,t._gfxSampler=null,t._gfxDevice=null,t._textureHash=0,t._id=Ad.getNewId(),t.loaded=!1,t._gfxDevice=t._getGFXDevice(),t._textureHash=Mc(t._id,666),t}ie(t,e);var n=t.prototype;return n.getId=function(){return this._id},n.getPixelFormat=function(){return this._format},n.getAnisotropy=function(){return this._anisotropy},n.setWrapMode=function(e,t,n){this._wrapS=e,this._samplerInfo[id.addressU]=e,this._wrapT=t,this._samplerInfo[id.addressV]=t,void 0!==n&&(this._wrapR=n,this._samplerInfo[id.addressW]=n),this._samplerHash=ld(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=Td.getSampler(this._gfxDevice,this._samplerHash))},n.setFilters=function(e,t){this._minFilter=e,this._samplerInfo[id.minFilter]=e,this._magFilter=t,this._samplerInfo[id.magFilter]=t,this._samplerHash=ld(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=Td.getSampler(this._gfxDevice,this._samplerHash))},n.setMipFilter=function(e){this._mipFilter=e,this._samplerInfo[id.mipFilter]=e,this._samplerHash=ld(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=Td.getSampler(this._gfxDevice,this._samplerHash))},n.setAnisotropy=function(e){this._anisotropy=e,this._samplerInfo[id.maxAnisotropy]=e,this._samplerHash=ld(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=Td.getSampler(this._gfxDevice,this._samplerHash))},n.destroy=function(){var t=e.prototype.destroy.call(this);return t&&c.director.root&&c.director.root.batcher2D&&c.director.root.batcher2D._releaseDescriptorSetCache(this._textureHash),t},n.getHash=function(){return this._textureHash},n.getGFXTexture=function(){return null},n.getSamplerHash=function(){return this._samplerHash},n.getGFXSampler=function(){return this._gfxSampler||(this._gfxDevice?this._gfxSampler=Td.getSampler(this._gfxDevice,this._samplerHash):N(9302)),this._gfxSampler},n._serialize=function(){return""},n._deserialize=function(e){var t=e.split(",");t.unshift(""),t.length>=5&&(this.setFilters(parseInt(t[1]),parseInt(t[2])),this.setWrapMode(parseInt(t[3]),parseInt(t[4]))),t.length>=7&&(this.setMipFilter(parseInt(t[5])),this.setAnisotropy(parseInt(t[6])))},n._getGFXDevice=function(){return c.director.root?c.director.root.device:null},n._getGFXFormat=function(){return this._getGFXPixelFormat(this._format)},n._setGFXFormat=function(e){this._format=void 0===e?Xf.RGBA8888:e},n._getGFXPixelFormat=function(e){return e===Xf.RGBA_ETC1?e=Xf.RGB_ETC1:e===Xf.RGB_A_PVRTC_4BPPV1?e=Xf.RGB_PVRTC_4BPPV1:e===Xf.RGB_A_PVRTC_2BPPV1&&(e=Xf.RGB_PVRTC_2BPPV1),e},te(t,[{key:"isCompressed",get:function(){return this._format>=Xf.RGB_ETC1&&this._format<=Xf.RGBA_ASTC_12x12||this._format>=Xf.RGB_A_PVRTC_2BPPV1&&this._format<=Xf.RGBA_ETC1}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]),t}(Yf),xd.PixelFormat=Xf,xd.WrapMode=Kf,xd.Filter=Qf,_d=he((hd=Sd).prototype,"_format",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Xf.RGBA8888}}),fd=he(hd.prototype,"_minFilter",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qf.LINEAR}}),dd=he(hd.prototype,"_magFilter",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qf.LINEAR}}),pd=he(hd.prototype,"_mipFilter",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qf.NONE}}),md=he(hd.prototype,"_wrapS",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Kf.REPEAT}}),vd=he(hd.prototype,"_wrapT",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Kf.REPEAT}}),gd=he(hd.prototype,"_wrapR",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Kf.REPEAT}}),yd=he(hd.prototype,"_anisotropy",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ud=hd))||ud);c.TextureBase=Cd;var wd=[Kn,Rn,$n,zn,In,ni,oi,jn];function bd(e,t){e.x=t[1],e.y=t[2],e.z=t[3],e.w=t[4]}var Id=[function(e,t){e.x=t[1],e.y=t[2]},function(e,t){e.x=t[1],e.y=t[2],e.z=t[3]},bd,bd,function(e,t){e._val=t[1]},function(e,t){e.width=t[1],e.height=t[2]},function(e,t){e.x=t[1],e.y=t[2],e.width=t[3],e.height=t[4]},function(e,t){jn.fromArray(e,t,1)}],Pd=e("f4",function(){function e(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null,this.uuidTypeList=[]}var t=e.prototype;return t.init=function(e){this.uuidObjList=e[8],this.uuidPropList=e[9],this.uuidList=e[10]},t.reset=function(){this.uuidList=null,this.uuidObjList=null,this.uuidPropList=null},t.push=function(e,t,n,i){this.uuidObjList.push(e),this.uuidPropList.push(t),this.uuidList.push(n),this.uuidTypeList.push(i||"")},e}());function Rd(e,t){for(var n=e[4][t[0]],i=n[0],o=new(0,i[0]),r=i[1],a=i[2],s=n[n.length-1],c=1;c<s;++c)o[r[n[c]]]=t[c];for(;c<t.length;++c){var l=r[n[c]],u=i[n[c]+a];(0,Fd[u])(e,o,l,t[c])}return o}function Nd(e,t,n){var i=new t;return i._deserialize?i._deserialize(n,e[0]):N(5303,Ne(t)),i}function Od(e,t,n,i){i>=0?t[n]=e[5][i]:e[7][3*~i]=t}function Dd(e){return function(t,n,i,o){n[i]=o;for(var r=0;r<o.length;++r)e(t,o,r,o[r])}}function Md(e,t,n,i){t[n]=null,e[8][i]=t}function Ld(e,t,n,i){t[n]=Rd(e,i)}Pd.pool=new ot((function(e){e.reset()}),5),Pd.pool.get=function(){return this._get()||new Pd};var Fd=new Array(13);function zd(e,t){return e||Gd.reportMissingClass(t),Object}function Bd(e,t,n,i,o,r){var a=e(t);if(!a){if(o)return void(n[i]=function(t,n,i){return function(){var o=e(i)||zd(r,i);return t[n]=o,new o}}(n,i,t));a=zd(r,t)}n[i]=a}function Ud(e,t,n){for(var i=n||tt,o=e[3],r=0;r<o.length;++r){var a=o[r];"string"!=typeof a?Bd(i,a[0],a,0,t,n):Bd(i,a,o,r,t,n)}}function Hd(e){var t=e[4];if(t)for(var n=e[3],i=0;i<t.length;++i){var o=t[i];o[0]=n[o[0]]}}function Gd(e,t,n){"string"==typeof e&&(e=JSON.parse(e));var i,o=!t;(t=t||Pd.pool.get()).init(e),n=n||{};var r=e[0],a=!1;if("object"==typeof r&&(a=r.preprocessed,r=r.version),r<1)throw new Error(L(5304,r));n._version=r,n.result=t,e[0]=n,a||(Ud(e,!1,n.classFinder),Hd(e)),c.game._isCloning=!0;var s=e[5],l=function(e){var t=e[5],n=e[6],i=0===n?0:n.length,o=t[t.length-1],r=t.length-i;"number"!=typeof o?o=0:(o<0&&(o=~o),--r);for(var a=0;a<r;++a)t[a]=Rd(e,t[a]);for(var s=e[3],c=0;c<i;++c,++a){var l=n[c],u=t[a];if(l>=0){var h=s[l];t[a]=Nd(e,h,u)}else(0,Fd[l=~l])(e,t,a,u)}return o}(e);return c.game._isCloning=!1,e[7]&&function(e,t,n){for(var i=e.length-1,o=0,r=3*e[i];o<r;o+=3){var a=e[o],s=t[e[o+2]],c=e[o+1];c>=0?a[n[c]]=s:a[~c]=s}for(;o<i;o+=3){var l=t[e[o]],u=t[e[o+2]],h=e[o+1];h>=0?l[n[h]]=u:l[~h]=u}}(e[7],s,e[2]),function(e){for(var t=e[5],n=e[2],i=e[1],o=e[8],r=e[9],a=e[10],s=0;s<o.length;++s){var c=o[s];"number"==typeof c&&(o[s]=t[c]);var l=r[s];"number"==typeof l&&(l=l>=0?n[l]:~l,r[s]=l);var u=a[s];"number"==typeof u&&(a[s]=i[u])}}(e),i=s[l],o&&Pd.pool.put(t),i}Fd[0]=function(e,t,n,i){t[n]=i},Fd[1]=Od,Fd[2]=Dd(Od),Fd[3]=Dd(Md),Fd[4]=Ld,Fd[5]=function(e,t,n,i){Id[i[0]](t[n],i)},Fd[6]=Md,Fd[7]=function(e,t,n,i){t[n].set(i)},Fd[8]=function(e,t,n,i){var o=new wd[i[0]];Id[i[0]](o,i),t[n]=o},Fd[9]=Dd(Ld),Fd[10]=function(e,t,n,i){var o=e[3][i[0]];t[n]=Nd(e,o,i[1])},Fd[11]=function(e,t,n,i){var o=i[0];t[n]=o;for(var r=1;r<i.length;r+=3){var a=i[r],s=i[r+1],c=i[r+2];(0,Fd[s])(e,o,a,c)}},Fd[12]=function(e,t,n,i){var o=i[0];t[n]=o;for(var r=0;r<o.length;++r){var a=o[r],s=i[r+1];0!==s&&(0,Fd[s])(e,o,r,a)}},Gd.Details=Pd,Gd.reportMissingClass=function(e){P(5302,e)};var kd,Vd,Wd,jd=function(e){this.preprocessed=!0,this.version=e};function qd(e,t,n){return[1,0,0,[e],0,n?[t,-1]:[t],[0],0,[],[],[]]}c.deserialize=Gd;var Yd=e("fd",U_("cc.Script")(kd=function(e){function t(){return e.apply(this,arguments)||this}return ie(t,e),t}(Yf))||kd);c._Script=Yd;var Xd=e("fe",U_("cc.JavaScript")(Vd=function(e){function t(){return e.apply(this,arguments)||this}return ie(t,e),t}(Yd))||Vd);c._JavaScript=Xd;var Kd,Qd,Zd,Jd,$d,ep,tp,np,ip,op,rp,ap=e("ff",U_("cc.TypeScript")(Wd=function(e){function t(){return e.apply(this,arguments)||this}return ie(t,e),t}(Yd))||Wd);c._TypeScript=ap;var sp,cp,lp,up,hp=new ge("Comp"),_p=fi.Flags.IsOnLoadCalled,fp=e("cm",(Kd=U_("cc.Component"),Qd=tf(),Zd=pf(Yd),Jd=nf(),Kd((rp=op=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return ue(t=e.call.apply(e,[this].concat(i))||this,"node",tp,se(t)),ue(t,"_enabled",np,se(t)),ue(t,"__prefab",ip,se(t)),t._sceneGetter=null,t._id=hp.getNewId(),t}ie(t,e);var n=t.prototype;return n._getRenderScene=function(){return this._sceneGetter?this._sceneGetter():this.node.scene._renderScene},n.addComponent=function(e){return this.node.addComponent(e)},n.getComponent=function(e){return this.node.getComponent(e)},n.getComponents=function(e){return this.node.getComponents(e)},n.getComponentInChildren=function(e){return this.node.getComponentInChildren(e)},n.getComponentsInChildren=function(e){return this.node.getComponentsInChildren(e)},n.destroy=function(){return!!e.prototype.destroy.call(this)&&(this._enabled&&this.node.activeInHierarchy&&c.director._compScheduler.disableComp(this),!0)},n._onPreDestroy=function(){this.unscheduleAllCallbacks(),c.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},n._instantiate=function(e){return e||(e=c.instantiate._clone(this,this)),e&&(e.node=null),e},n.schedule=function(e,t,n,i){void 0===t&&(t=0),void 0===n&&(n=c.macro.REPEAT_FOREVER),void 0===i&&(i=0),M(e,1619),M((t=t||0)>=0,1620),n=Number.isNaN(n)?c.macro.REPEAT_FOREVER:n,i=i||0;var o=c.director.getScheduler(),r=o.isTargetPaused(this);o.schedule(e,this,t,n,i,r)},n.scheduleOnce=function(e,t){void 0===t&&(t=0),this.schedule(e,0,0,t)},n.unschedule=function(e){e&&c.director.getScheduler().unschedule(e,this)},n.unscheduleAllCallbacks=function(){c.director.getScheduler().unscheduleAllForTarget(this)},te(t,[{key:"name",get:function(){if(this._name)return this._name;var e=Ne(this),t=e.lastIndexOf(".");return t>=0&&(e=e.slice(t+1)),this.node.name+"<"+e+">"},set:function(e){this._name=e}},{key:"uuid",get:function(){return this._id}},{key:"__scriptAsset",get:function(){return null}},{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&(this._enabled=e,this.node.activeInHierarchy)){var t=c.director._compScheduler;e?t.enableComp(this):t.disableComp(this)}}},{key:"enabledInHierarchy",get:function(){return this._enabled&&this.node&&this.node.activeInHierarchy}},{key:"_isOnLoadCalled",get:function(){return this._objFlags&_p}}]),t}(fi),op.system=null,he((ep=rp).prototype,"__scriptAsset",[Qd,Zd,Jd,uf],Object.getOwnPropertyDescriptor(ep.prototype,"__scriptAsset"),ep.prototype),tp=he(ep.prototype,"node",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),np=he(ep.prototype,"_enabled",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ip=he(ep.prototype,"__prefab",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$d=ep))||$d)),dp=fp.prototype;dp.update=null,dp.lateUpdate=null,dp.__preload=null,dp.onLoad=null,dp.start=null,dp.onEnable=null,dp.onDisable=null,dp.onDestroy=null,dp.onFocusInEditor=null,dp.onLostFocusInEditor=null,dp.resetInEditor=null,dp._getLocalBounds=null,dp.onRestore=null,fp._requireComponent=null,fp._executionOrder=0,we(fp,"_registerEditorProps",(function(e,t){var n=t.requireComponent;n&&(e._requireComponent=n);var i=t.executionOrder;i&&"number"==typeof i&&(e._executionOrder=i)})),c.Component=fp;var pp=e("fV",U_("cc.MissingScript")(sp=Q_()((up=function(e){function t(){var t;return ue(t=e.call(this)||this,"_$erialized",lp,se(t)),t}return ie(t,e),t.safeFindClass=function(e){var t=tt(e);if(t)return t;c.deserialize.reportMissingClass(e)},t.prototype.onLoad=function(){P(4600,this.node.name)},t}(fp),lp=he((cp=up).prototype,"_$erialized",[W_,j_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sp=cp))||sp)||sp);function mp(e,t){var n;n=pp.safeFindClass;var i,o=Pd.pool.get();try{i=Gd(e,o,{classFinder:n,customEnv:t})}catch(e){throw x(e),Pd.pool.put(o),e}i._uuid=t.__uuid__||"";for(var r=o.uuidList,a=o.uuidObjList,s=o.uuidPropList,c=o.uuidTypeList||[],l=[],u=0;u<r.length;u++){var h=r[u];l[u]={uuid:Mf(h),owner:a[u],prop:s[u],type:at._getClassById(c[u])}}return i.__depends__=l,i._native&&(i.__nativeDepend__=!0),Pd.pool.put(o),i}c._MissingScript=pp;var vp,gp=new(function(){function e(){this._depends=new vf}var t=e.prototype;return t.init=function(){this._depends.clear()},t.getNativeDep=function(e){var t=this._depends.get(e);return t&&t.nativeDep?ne({},t.nativeDep):null},t.getDeps=function(e){return this._depends.has(e)?this._depends.get(e).deps:[]},t.getDepsRecursively=function(e){var t=Object.create(null),n=[];return this._descend(e,t,n),n},t.remove=function(e){this._depends.remove(e)},t.parse=function(e,t){var n,i,o=null;if(Array.isArray(t)||t.__type__){if(this._depends.has(e))return this._depends.get(e);if(!Array.isArray(t)||"number"==typeof(i=(n=t[5])[n.length-1])&&i<0)try{var r=mp(t,{__uuid__:e});(o=this._parseDepsFromAsset(r)).nativeDep&&(o.nativeDep.uuid=e),Ef.add(e+"@import",r)}catch(t){Sf.remove(e+"@import"),o={deps:[]}}else o={deps:this._parseDepsFromJson(t)}}else{if(this._depends.has(e)&&(o=this._depends.get(e)).parsedFromExistAsset)return o;o=this._parseDepsFromAsset(t)}return this._depends.add(e,o),o},t._parseDepsFromAsset=function(e){for(var t={deps:[],parsedFromExistAsset:!0},n=e.__depends__,i=0,o=n.length;i<o;i++)t.deps.push(n[i].uuid);return e.__nativeDepend__&&(t.nativeDep=e._nativeDep),t},t._parseDepsFromJson=function(e){var t=null;return(t=function(e){var t=e[1];return e[10].map((function(e){return t[e]}))}(e)).forEach((function(e,n){return t[n]=Mf(e)})),t},t._descend=function(e,t,n){for(var i=this.getDeps(e),o=0;o<i.length;o++){var r=i[o];t[r]||(t[r]=!0,n.push(r),this._descend(r,t,n))}},e}()),yp=[new ws];function xp(e){return e&&0==(e&e-1)}var Sp,Ep,Tp,Ap,Cp,wp,bp=U_("cc.SimpleTexture")(vp=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this)._gfxTexture=null,t._mipmapLevel=1,t._textureWidth=0,t._textureHeight=0,t}ie(t,e);var n=t.prototype;return n.getGFXTexture=function(){return this._gfxTexture},n.destroy=function(){return this._tryDestroyTexture(),e.prototype.destroy.call(this)},n.updateImage=function(){this.updateMipmaps(0)},n.updateMipmaps=function(){},n.uploadData=function(e,t,n){if(void 0===t&&(t=0),void 0===n&&(n=0),this._gfxTexture&&!(this._mipmapLevel<=t)){var i=this._getGFXDevice();if(i){var o=yp[0];o.texExtent.width=this._textureWidth>>t,o.texExtent.height=this._textureHeight>>t,o.texSubres.mipLevel=t,o.texSubres.baseArrayLayer=n,ArrayBuffer.isView(e)?i.copyBuffersToTexture([e],this._gfxTexture,yp):i.copyTexImagesToTexture([e],this._gfxTexture,yp)}}},n._assignImage=function(e,t,n){var i=this,o=function(){var o=e.data;if(o&&(i.uploadData(o,t,n),i._checkTextureLoaded(),ft.CLEANUP_IMAGE_CACHE)){var r=gp.getDeps(i._uuid),a=r.indexOf(e._uuid);-1!==a&&(de(r,a),e.decRef())}};if(e.loaded)o();else{if(e.once("load",(function(){o()})),!this.isCompressed){var r=c.builtinResMgr.get("black-texture").image;this.uploadData(r.data,t,n)}c.assetManager.postLoadNative(e)}},n._checkTextureLoaded=function(){this._textureReady()},n._textureReady=function(){this.loaded=!0,this.emit("load")},n._setMipmapLevel=function(e){this._mipmapLevel=e<1?1:e},n._getGfxTextureCreateInfo=function(){return null},n._tryReset=function(){if(this._tryDestroyTexture(),0!==this._mipmapLevel){var e=this._getGFXDevice();e&&this._createTexture(e)}},n._createTexture=function(e){if(0!==this._width&&0!==this._height){var t=Va.NONE;this._mipFilter!==Qf.NONE&&function(e,t,n){return!(e.gfxAPI===Na.WEBGL)||xp(t)&&xp(n)}(e,this._width,this._height)&&(this._mipmapLevel=function(e,t){for(var n=Math.max(e,t),i=0;n;)n>>=1,i++;return i}(this._width,this._height),t=Va.GEN_MIPMAP);var n=this._getGfxTextureCreateInfo({usage:ka.SAMPLED|ka.TRANSFER_DST,format:this._getGFXFormat(),levelCount:this._mipmapLevel,flags:t|Va.IMMUTABLE});if(n){var i=e.createTexture(n);this._textureWidth=n.width,this._textureHeight=n.height,this._gfxTexture=i}}},n._tryDestroyTexture=function(){this._gfxTexture&&(this._gfxTexture.destroy(),this._gfxTexture=null)},te(t,[{key:"mipmapLevel",get:function(){return this._mipmapLevel}}]),t}(Cd))||vp;c.SimpleTexture=bp;var Ip,Pp,Rp,Np,Op,Dp,Mp=e("bD",(Sp=U_("cc.Texture2D"),Ep=pf([od]),Sp((wp=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return ue(t=e.call.apply(e,[this].concat(i))||this,"_mipmaps",Cp,se(t)),t}ie(t,e);var n=t.prototype;return n.initialize=function(){this.mipmaps=this._mipmaps},n.onLoaded=function(){this.initialize()},n.reset=function(e){this._width=e.width,this._height=e.height,this._setGFXFormat(e.format),this._setMipmapLevel(e.mipmapLevel||1),this._tryReset()},n.create=function(e,t,n,i){void 0===n&&(n=Xf.RGBA8888),void 0===i&&(i=1),this.reset({width:e,height:t,format:n,mipmapLevel:i})},n.toString=function(){return 0!==this._mipmaps.length?this._mipmaps[0].url:""},n.updateMipmaps=function(e,t){if(void 0===e&&(e=0),!(e>=this._mipmaps.length))for(var n=Math.min(void 0===t?this._mipmaps.length:t,this._mipmaps.length-e),i=0;i<n;++i){var o=e+i;this._assignImage(this._mipmaps[o],o)}},n.getHtmlElementObj=function(){return this._mipmaps[0]&&this._mipmaps[0].data instanceof HTMLElement?this._mipmaps[0].data:null},n.destroy=function(){return this._mipmaps=[],e.prototype.destroy.call(this)},n.description=function(){return"<cc.Texture2D | Name = "+(this._mipmaps[0]?this._mipmaps[0].url:"")+" | Dimension = "+this.width+" x "+this.height+">"},n.releaseTexture=function(){this.destroy()},n._serialize=function(){return null},n._deserialize=function(t,n){var i=t;e.prototype._deserialize.call(this,i.base,n),this._mipmaps=new Array(i.mipmaps.length);for(var o=0;o<i.mipmaps.length;++o)if(this._mipmaps[o]=new od,i.mipmaps[o]){var r=i.mipmaps[o];n.result.push(this._mipmaps,""+o,r,at._getClassId(od)),this._mipmaps[o]._texture=this}},n._getGfxTextureCreateInfo=function(e){var t=new Ls(Ga.TEX2D);return t.width=this._width,t.height=this._height,Object.assign(t,e)},n._checkTextureLoaded=function(){for(var t=!0,n=0;n<this._mipmaps.length;++n)if(!this._mipmaps[n].loaded){t=!1;break}t&&e.prototype._textureReady.call(this)},n.initDefault=function(t){e.prototype.initDefault.call(this,t);var n=new od;n.initDefault(),this.image=n},n.validate=function(){return this.mipmaps&&0!==this.mipmaps.length},te(t,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(e){var t=this;if(this._mipmaps=e,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var n=this._mipmaps[0];this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this._mipmaps.length}),this._mipmaps.forEach((function(e,n){t._assignImage(e,n)}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(e){this.mipmaps=e?[e]:[]}}]),t}(bp),Cp=he((Ap=wp).prototype,"_mipmaps",[Ep],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Tp=Ap))||Tp));c.Texture2D=Mp,function(e){e[e.right=0]="right",e[e.left=1]="left",e[e.top=2]="top",e[e.bottom=3]="bottom",e[e.front=4]="front",e[e.back=5]="back"}(Dp||(Dp={}));var Lp=e("fc",U_("cc.TextureCube")((Op=Np=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return ue(t=e.call.apply(e,[this].concat(i))||this,"_mipmaps",Rp,se(t)),t}ie(t,e),t.fromTexture2DArray=function(e,n){for(var i=[],o=e.length/6,r=0;r<o;r++){var a=6*r;i.push({front:e[a+Dp.front].image,back:e[a+Dp.back].image,left:e[a+Dp.left].image,right:e[a+Dp.right].image,top:e[a+Dp.top].image,bottom:e[a+Dp.bottom].image})}return(n=n||new t).mipmaps=i,n};var n=t.prototype;return n.onLoaded=function(){this.mipmaps=this._mipmaps,this.loaded=!0,this.emit("load")},n.reset=function(e){this._width=e.width,this._height=e.height,this._setGFXFormat(e.format),this._setMipmapLevel(e.mipmapLevel||1),this._tryReset()},n.updateMipmaps=function(e,t){var n=this;if(void 0===e&&(e=0),!(e>=this._mipmaps.length))for(var i=Math.min(void 0===t?this._mipmaps.length:t,this._mipmaps.length-e),o=function(t){var i=e+t;Fp(n._mipmaps[i],(function(e,t){n._assignImage(e,i,t)}))},r=0;r<i;++r)o(r)},n.destroy=function(){return this._mipmaps=[],e.prototype.destroy.call(this)},n.releaseTexture=function(){this.mipmaps=[]},n._serialize=function(){return null},n._deserialize=function(t,n){var i=t;e.prototype._deserialize.call(this,i.base,n),this._mipmaps=new Array(i.mipmaps.length);for(var o=0;o<i.mipmaps.length;++o){this._mipmaps[o]={front:new od,back:new od,left:new od,right:new od,top:new od,bottom:new od};var r=i.mipmaps[o],a=at._getClassId(od);n.result.push(this._mipmaps[o],"front",r.front,a),n.result.push(this._mipmaps[o],"back",r.back,a),n.result.push(this._mipmaps[o],"left",r.left,a),n.result.push(this._mipmaps[o],"right",r.right,a),n.result.push(this._mipmaps[o],"top",r.top,a),n.result.push(this._mipmaps[o],"bottom",r.bottom,a)}},n._getGfxTextureCreateInfo=function(e){var t=new Ls(Ga.CUBE);return t.width=this._width,t.height=this._height,t.layerCount=6,Object.assign(t,e),t},n.initDefault=function(t){e.prototype.initDefault.call(this,t);var n=new od;n.initDefault(),this.mipmaps=[{front:n,back:n,top:n,bottom:n,left:n,right:n}]},n.validate=function(){return 0!==this._mipmaps.length&&!this._mipmaps.find((function(e){return!(e.top&&e.bottom&&e.front&&e.back&&e.left&&e.right)}))},te(t,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(e){var t=this;if(this._mipmaps=e,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var n=this._mipmaps[0].front;this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this._mipmaps.length}),this._mipmaps.forEach((function(e,n){Fp(e,(function(e,i){t._assignImage(e,n,i)}))}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(e){this.mipmaps=e?[e]:[]}}]),t}(bp),Np.FaceIndex=Dp,Rp=he((Pp=Op).prototype,"_mipmaps",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ip=Pp))||Ip);function Fp(e,t){t(e.front,Dp.front),t(e.back,Dp.back),t(e.left,Dp.left),t(e.right,Dp.right),t(e.top,Dp.top),t(e.bottom,Dp.bottom)}c.TextureCube=Lp;var zp,Bp,Up,Hp=e("fW",[{name:"billboard",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"billboard|vert:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"billboard|vert:vs_main|tinted-fs:add",hash:121727045,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:50,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:38},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[]}},defines:[{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"builtin",defines:[],binding:1,stageFlags:1,members:[{name:"cc_size_rotation",type:16,count:1}]},{name:"FragConstants",defines:[],binding:2,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:3}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:2}]}]},{name:"clear-stencil",techniques:[{passes:[{blendState:{targets:[{blend:!0}]},rasterizerState:{cullMode:0},program:"clear-stencil|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"clear-stencil|sprite-vs:vert|sprite-fs:frag",hash:3507038093,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:0,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[],samplerTextures:[]},locals:{blocks:[],samplerTextures:[]}},defines:[],blocks:[],samplerTextures:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0}]}]},{name:"graphics",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:1,blendDst:4,blendSrcAlpha:1,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"graphics|vs:vert|fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"graphics|vs:vert|fs:frag",hash:3113634185,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:46,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[]}},defines:[],blocks:[],samplerTextures:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:1},{name:"a_dist",type:13,count:1,defines:[],stageFlags:1,format:11,location:2}]}]},{name:"particle-gpu",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",hash:3356319967,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:60,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:38},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"COLOR_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"ROTATION_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"SIZE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"FORCE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"VELOCITY_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"TEXTURE_ANIMATION_MODULE_ENABLE",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"SampleConstants",defines:[],binding:1,stageFlags:1,members:[{name:"u_sampleInfo",type:16,count:1}]},{name:"TickConstants",defines:[],binding:2,stageFlags:1,members:[{name:"u_worldRot",type:16,count:1},{name:"u_timeDelta",type:16,count:1}]},{name:"ColorConstant",defines:["COLOR_OVER_TIME_MODULE_ENABLE"],binding:3,stageFlags:1,members:[{name:"u_color_mode",type:5,count:1}]},{name:"RotationConstant",defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],binding:4,stageFlags:1,members:[{name:"u_rotation_mode",type:5,count:1}]},{name:"SizeConstant",defines:["SIZE_OVER_TIME_MODULE_ENABLE"],binding:5,stageFlags:1,members:[{name:"u_size_mode",type:5,count:1}]},{name:"ForceConstant",defines:["FORCE_OVER_TIME_MODULE_ENABLE"],binding:6,stageFlags:1,members:[{name:"u_force_mode",type:5,count:1},{name:"u_force_space",type:5,count:1}]},{name:"VelocityConstant",defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],binding:7,stageFlags:1,members:[{name:"u_velocity_mode",type:5,count:1},{name:"u_velocity_space",type:5,count:1}]},{name:"AnimationConstant",defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],binding:8,stageFlags:1,members:[{name:"u_anim_info",type:16,count:1}]},{name:"FragConstants",defines:[],binding:9,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"color_over_time_tex0",type:28,count:1,defines:["COLOR_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:10},{name:"rotation_over_time_tex0",type:28,count:1,defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:11},{name:"size_over_time_tex0",type:28,count:1,defines:["SIZE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:12},{name:"force_over_time_tex0",type:28,count:1,defines:["FORCE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:13},{name:"velocity_over_time_tex0",type:28,count:1,defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:14},{name:"texture_animation_tex0",type:28,count:1,defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],stageFlags:1,binding:15},{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:16}],attributes:[{name:"a_position_starttime",type:16,count:1,defines:[],stageFlags:1,format:44,location:0},{name:"a_size_uv",type:16,count:1,defines:[],stageFlags:1,format:44,location:1},{name:"a_rotation_uv",type:16,count:1,defines:[],stageFlags:1,format:44,location:2},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_dir_life",type:16,count:1,defines:[],stageFlags:1,format:44,location:4},{name:"a_rndSeed",type:13,count:1,defines:[],stageFlags:1,format:11,location:5},{name:"a_texCoord",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:6},{name:"a_texCoord3",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:7},{name:"a_normal",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:8},{name:"a_color1",type:16,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:44,location:9}]}]},{name:"particle-trail",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-trail|particle-trail:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},frameTile_velLenScale:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-trail|particle-trail:vs_main|tinted-fs:add",hash:2637621064,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:49,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:38},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_DRAW_WIRE_FRAME",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:16,count:1,defines:[],stageFlags:1,format:44,location:1},{name:"a_texCoord1",type:15,count:1,defines:[],stageFlags:1,format:32,location:2},{name:"a_texCoord2",type:15,count:1,defines:[],stageFlags:1,format:32,location:3},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:4}]}]},{name:"particle",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",hash:1755172438,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:49,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:38},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord1",type:15,count:1,defines:[],stageFlags:1,format:32,location:2},{name:"a_texCoord2",type:15,count:1,defines:[],stageFlags:1,format:32,location:3},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:4},{name:"a_color1",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:8},{name:"a_texCoord3",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:6},{name:"a_normal",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:7}]}]},{name:"spine",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"spine|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"spine|sprite-vs:vert|sprite-fs:frag",hash:1867464226,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:46,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:1},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplerTextures:[{name:"cc_spriteTexture",defines:[]}]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"TWO_COLORED",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplerTextures:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:2},{name:"a_color2",type:16,count:1,defines:["TWO_COLORED"],stageFlags:1,format:44,location:3}]}]},{name:"sprite",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"sprite|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"sprite|sprite-vs:vert|sprite-fs:frag",hash:1559944983,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:46,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:1},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplerTextures:[{name:"cc_spriteTexture",defines:["USE_TEXTURE"]}]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"SAMPLE_FROM_RT",type:"boolean"},{name:"USE_PIXEL_ALIGNMENT",type:"boolean"},{name:"CC_USE_EMBEDDED_ALPHA",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"IS_GRAY",type:"boolean"}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplerTextures:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:2}]}]},{name:"standard",techniques:[{name:"opaque",passes:[{program:"standard|standard-vs|standard-fs",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},normalMap:{value:"normal",type:28},pbrMap:{value:"grey",type:28},metallicRoughnessMap:{value:"grey",type:28},occlusionMap:{value:"white",type:28},emissiveMap:{value:"grey",type:28},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}},{phase:"deferred",propertyIndex:0,blendState:{targets:[{blend:!1},{blend:!1},{blend:!1},{blend:!1}]},program:"standard|standard-vs|standard-fs",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},normalMap:{value:"normal",type:28},pbrMap:{value:"grey",type:28},metallicRoughnessMap:{value:"grey",type:28},occlusionMap:{value:"white",type:28},emissiveMap:{value:"grey",type:28},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"standard|standard-vs|standard-fs",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1},properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},normalMap:{value:"normal",type:28},pbrMap:{value:"grey",type:28},metallicRoughnessMap:{value:"grey",type:28},occlusionMap:{value:"white",type:28},emissiveMap:{value:"grey",type:28},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}},{phase:"shadow-caster",propertyIndex:0,rasterizerState:{cullMode:1},program:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}}]}],shaders:[{name:"standard|standard-vs|standard-fs",hash:442396670,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:216,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:59},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_environment",defines:["CC_USE_IBL"]}]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"cc_lightingMap",defines:["USE_LIGHTMAP","!USE_BATCHING","!CC_FORWARD_ADD"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"USE_NORMAL_MAP",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"SAMPLE_FROM_RT",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"NORMAL_UV",type:"string",options:["v_uv","v_uv1"]},{name:"PBR_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_PBR_MAP",type:"boolean"},{name:"USE_METALLIC_ROUGHNESS_MAP",type:"boolean"},{name:"USE_OCCLUSION_MAP",type:"boolean"},{name:"USE_EMISSIVE_MAP",type:"boolean"},{name:"EMISSIVE_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]},{name:"CC_PIPELINE_TYPE",type:"number",range:[0,1]}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplerTextures:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1},{name:"normalMap",type:28,count:1,defines:["USE_NORMAL_MAP"],stageFlags:16,binding:2},{name:"pbrMap",type:28,count:1,defines:["USE_PBR_MAP"],stageFlags:16,binding:3},{name:"metallicRoughnessMap",type:28,count:1,defines:["USE_METALLIC_ROUGHNESS_MAP"],stageFlags:16,binding:4},{name:"occlusionMap",type:28,count:1,defines:["USE_OCCLUSION_MAP"],stageFlags:16,binding:5},{name:"emissiveMap",type:28,count:1,defines:["USE_EMISSIVE_MAP"],stageFlags:16,binding:6}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:"u32vec4",count:1,defines:["CC_USE_SKINNING"],stageFlags:1,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12},{name:"a_color",type:16,count:1,defines:["USE_VERTEX_COLOR"],stageFlags:1,format:44,location:13},{name:"a_texCoord1",type:14,count:1,defines:[],stageFlags:1,format:21,location:14}]},{name:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:826679743,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:179,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:22},globals:{blocks:[{name:"CCShadow",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplerTextures:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:"u32vec4",count:1,defines:["CC_USE_SKINNING"],stageFlags:1,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12},{name:"a_texCoord1",type:14,count:1,defines:[],stageFlags:1,format:21,location:13}]}]},{name:"terrain",techniques:[{name:"opaque",passes:[{program:"terrain|terrain-vs|terrain-fs",properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal",type:28},normalMap1:{value:"normal",type:28},normalMap2:{value:"normal",type:28},normalMap3:{value:"normal",type:28},lightMap:{value:"grey",type:28}}},{phase:"deferred",propertyIndex:0,blendState:{targets:[{blend:!1},{blend:!1},{blend:!1},{blend:!1}]},program:"terrain|terrain-vs|terrain-fs",properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal",type:28},normalMap1:{value:"normal",type:28},normalMap2:{value:"normal",type:28},normalMap3:{value:"normal",type:28},lightMap:{value:"grey",type:28}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"terrain|terrain-vs|terrain-fs",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1},properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal",type:28},normalMap1:{value:"normal",type:28},normalMap2:{value:"normal",type:28},normalMap3:{value:"normal",type:28},lightMap:{value:"grey",type:28}}},{phase:"shadow-add",propertyIndex:0,rasterizerState:{cullMode:2},program:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag"}]}],shaders:[{name:"terrain|terrain-vs|terrain-fs",hash:3030724902,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:64,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:55},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_environment",defines:["CC_USE_IBL"]}]},locals:{blocks:[{name:"CCLocal",defines:[]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD"]}],samplerTextures:[{name:"cc_lightingMap",defines:["USE_LIGHTMAP","!USE_BATCHING","!CC_FORWARD_ADD"]}]}},defines:[{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"USE_NORMALMAP",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"LAYERS",type:"number",range:[0,4]},{name:"USE_PBR",type:"boolean"},{name:"CC_PIPELINE_TYPE",type:"number",range:[0,1]}],blocks:[{name:"TexCoords",defines:[],binding:0,stageFlags:1,members:[{name:"UVScale",type:16,count:1},{name:"lightMapUVParam",type:16,count:1}]},{name:"PbrParams",defines:[],binding:1,stageFlags:16,members:[{name:"metallic",type:16,count:1},{name:"roughness",type:16,count:1}]}],samplerTextures:[{name:"weightMap",type:28,count:1,defines:[],stageFlags:16,binding:2},{name:"detailMap0",type:28,count:1,defines:[],stageFlags:16,binding:3},{name:"detailMap1",type:28,count:1,defines:[],stageFlags:16,binding:4},{name:"detailMap2",type:28,count:1,defines:[],stageFlags:16,binding:5},{name:"detailMap3",type:28,count:1,defines:[],stageFlags:16,binding:6},{name:"normalMap0",type:28,count:1,defines:[],stageFlags:16,binding:7},{name:"normalMap1",type:28,count:1,defines:[],stageFlags:16,binding:8},{name:"normalMap2",type:28,count:1,defines:[],stageFlags:16,binding:9},{name:"normalMap3",type:28,count:1,defines:[],stageFlags:16,binding:10},{name:"lightMap",type:28,count:1,defines:[],stageFlags:16,binding:11}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2}]},{name:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:1471860764,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:62,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[]}},defines:[],blocks:[],samplerTextures:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2}]}]},{name:"unlit",techniques:[{name:"opaque",passes:[{program:"unlit|unlit-vs:vert|unlit-fs:frag",properties:{mainTexture:{value:"grey",type:28},tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16},colorScale:{value:[1,1,1],type:15,handleInfo:["colorScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["colorScaleAndCutoff",3,13]},color:{type:16,handleInfo:["mainColor",0,16]},colorScaleAndCutoff:{type:16,value:[1,1,1,.5]}}}]}],shaders:[{name:"unlit|unlit-vs:vert|unlit-fs:frag",hash:1017648509,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:195,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"SAMPLE_FROM_RT",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r","g","b"]}],blocks:[{name:"TexCoords",defines:["USE_TEXTURE"],binding:0,stageFlags:1,members:[{name:"tilingOffset",type:16,count:1}]},{name:"Constant",defines:[],binding:1,stageFlags:16,members:[{name:"mainColor",type:16,count:1},{name:"colorScaleAndCutoff",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:["USE_TEXTURE"],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:"u32vec4",count:1,defines:["CC_USE_SKINNING"],stageFlags:1,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12},{name:"a_color",type:16,count:1,defines:["USE_VERTEX_COLOR"],stageFlags:1,format:44,location:13}]}]},{name:"deferred-lighting",techniques:[{passes:[{phase:"deferred-lighting",program:"deferred-lighting|lighting-vs|lighting-fs",depthStencilState:{depthFunc:4,depthTest:!0,depthWrite:!1}}]}],shaders:[{name:"deferred-lighting|lighting-vs|lighting-fs",hash:1507574087,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:37,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:53},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_gbuffer_albedoMap",defines:[]},{name:"cc_gbuffer_positionMap",defines:[]},{name:"cc_gbuffer_normalMap",defines:[]},{name:"cc_gbuffer_emissiveMap",defines:[]}]},locals:{blocks:[{name:"CCForwardLight",defines:[]}],samplerTextures:[]}},defines:[{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"USE_LIGHTMAP",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"CC_PIPELINE_TYPE",type:"number",range:[0,1]},{name:"CC_USE_FOG",type:"number",range:[0,4]}],blocks:[],samplerTextures:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3}]}]},{name:"planar-shadow",techniques:[{passes:[{phase:"planarShadow",blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",depthStencilState:{depthTest:!0,depthWrite:!1,stencilTestFront:!0,stencilFuncFront:5,stencilPassOpFront:2,stencilRefBack:128,stencilRefFront:128,stencilReadMaskBack:128,stencilReadMaskFront:128,stencilWriteMaskBack:128,stencilWriteMaskFront:128}}]}],shaders:[{name:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",hash:649108546,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:210,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:53},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[],samplerTextures:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:"u32vec4",count:1,defines:["CC_USE_SKINNING"],stageFlags:1,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12}]}]},{name:"post-process",techniques:[{passes:[{phase:"post-process",blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendSrcAlpha:2,blendDstAlpha:4}]},program:"post-process|post-process-vs|post-process-fs",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"post-process|post-process-vs|post-process-fs",hash:1780456825,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:145,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:37},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[{name:"cc_lighting_resultMap",defines:[]}]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"}],blocks:[],samplerTextures:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:"u32vec4",count:1,defines:["CC_USE_SKINNING"],stageFlags:1,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7}]}]},{name:"skybox",techniques:[{passes:[{rasterizerState:{cullMode:0},program:"skybox|sky-vs:vert|sky-fs:frag",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1}}]}],shaders:[{name:"skybox|sky-vs:vert|sky-fs:frag",hash:311136147,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:37,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:37},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[{name:"cc_environment",defines:[]}]},locals:{blocks:[],samplerTextures:[]}},defines:[{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_RGBE_CUBEMAP",type:"boolean"}],blocks:[],samplerTextures:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3}]}]},{name:"profiler",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"profiler|profiler-vs:vert|profiler-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"profiler|profiler-vs:vert|profiler-fs:frag",hash:3552712539,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:58,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:37},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[]},locals:{blocks:[],samplerTextures:[]}},defines:[{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"offset",type:16,count:1}]},{name:"PerFrameInfo",defines:[],binding:1,stageFlags:1,members:[{name:"digits",type:16,count:20}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:1}]}]},{name:"splash-screen",techniques:[{name:"default",passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},resolution:{value:[640,960],type:14,handleInfo:["u_buffer0",0,14]},precent:{value:[.5],type:13,handleInfo:["u_buffer0",2,13]},scale:{value:[200,500],type:14,handleInfo:["u_buffer1",0,14]},translate:{value:[320,480],type:14,handleInfo:["u_buffer1",2,14]},u_buffer0:{type:16,value:[640,960,.5,0]},u_buffer1:{type:16,value:[200,500,320,480]}}}]}],shaders:[{name:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",hash:1349506124,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:6,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[],samplerTextures:[]},locals:{blocks:[],samplerTextures:[]}},defines:[],blocks:[{name:"Constant",defines:[],binding:0,stageFlags:1,members:[{name:"u_buffer0",type:16,count:1},{name:"u_buffer1",type:16,count:1},{name:"u_projection",type:25,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:1}],attributes:[{name:"a_position",type:14,count:1,defines:[],stageFlags:1,format:21,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1}]}]}]),Gp=4026531840,kp=264241152,Vp=3145728,Wp=1032192;!function(e){e[e.BUFFER=0]="BUFFER",e[e.TEXTURE=1]="TEXTURE"}(Up||(Up={}));var jp=function(e,t,n,i,o){return void 0===o&&(o=0),e<<28&Gp|i<<22&kp|t<<20&Vp|n<<14&Wp|16383&o},qp=function(e){return(e&Gp)>>>28},Yp=function(e){return(e&kp)>>>22},Xp=function(e){return(e&Wp)>>>14},Kp=function(e){return 16383&e},Qp=function(e,t){return e&~kp|t<<22&kp},Zp=((zp={})[Fa.UNKNOWN]=function(){return console.warn("illegal uniform handle")},zp[Fa.INT]=function(e,t,n){return void 0===n&&(n=0),e[n]},zp[Fa.INT2]=function(e,t,n){return void 0===n&&(n=0),Kn.fromArray(t,e,n)},zp[Fa.INT3]=function(e,t,n){return void 0===n&&(n=0),Rn.fromArray(t,e,n)},zp[Fa.INT4]=function(e,t,n){return void 0===n&&(n=0),$n.fromArray(t,e,n)},zp[Fa.FLOAT]=function(e,t,n){return void 0===n&&(n=0),e[n]},zp[Fa.FLOAT2]=function(e,t,n){return void 0===n&&(n=0),Kn.fromArray(t,e,n)},zp[Fa.FLOAT3]=function(e,t,n){return void 0===n&&(n=0),Rn.fromArray(t,e,n)},zp[Fa.FLOAT4]=function(e,t,n){return void 0===n&&(n=0),$n.fromArray(t,e,n)},zp[Fa.MAT3]=function(e,t,n){return void 0===n&&(n=0),Mn.fromArray(t,e,n)},zp[Fa.MAT4]=function(e,t,n){return void 0===n&&(n=0),jn.fromArray(t,e,n)},zp),Jp=((Bp={})[Fa.UNKNOWN]=function(){return console.warn("illegal uniform handle")},Bp[Fa.INT]=function(e,t,n){return void 0===n&&(n=0),e[n]=t},Bp[Fa.INT2]=function(e,t,n){return void 0===n&&(n=0),Kn.toArray(e,t,n)},Bp[Fa.INT3]=function(e,t,n){return void 0===n&&(n=0),Rn.toArray(e,t,n)},Bp[Fa.INT4]=function(e,t,n){return void 0===n&&(n=0),$n.toArray(e,t,n)},Bp[Fa.FLOAT]=function(e,t,n){return void 0===n&&(n=0),e[n]=t},Bp[Fa.FLOAT2]=function(e,t,n){return void 0===n&&(n=0),Kn.toArray(e,t,n)},Bp[Fa.FLOAT3]=function(e,t,n){return void 0===n&&(n=0),Rn.toArray(e,t,n)},Bp[Fa.FLOAT4]=function(e,t,n){return void 0===n&&(n=0),$n.toArray(e,t,n)},Bp[Fa.MAT3]=function(e,t,n){return void 0===n&&(n=0),Mn.toArray(e,t,n)},Bp[Fa.MAT4]=function(e,t,n){return void 0===n&&(n=0),jn.toArray(e,t,n)},Bp),$p=[Object.freeze([0]),Object.freeze([0,0]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])];function em(e){switch(e){case Fa.BOOL:case Fa.INT:case Fa.UINT:case Fa.FLOAT:return $p[0];case Fa.BOOL2:case Fa.INT2:case Fa.UINT2:case Fa.FLOAT2:return $p[1];case Fa.BOOL4:case Fa.INT4:case Fa.UINT4:case Fa.FLOAT4:return $p[2];case Fa.MAT4:return $p[3];case Fa.SAMPLER2D:return"default-texture";case Fa.SAMPLER_CUBE:return"default-cube-texture"}return $p[0]}function tm(e,t){for(var n=Object.entries(t),i=!1,o=0;o<n.length;o++)e[n[o][0]]!==n[o][1]&&(e[n[o][0]]=n[o][1],i=!0);return i}var nm=new oc;function im(e){return Math.ceil(Math.log2(Math.max(e,2)))}function om(e,t){switch(e.type){case"boolean":return"number"==typeof t?t.toString():t?"1":"0";case"string":return void 0!==t?t:e.options[0];case"number":return void 0!==t?t.toString():e.range[0].toString();default:return console.warn("unknown define type '"+e.type+"'"),"-1"}}function rm(e,t,n,i,o){for(var r=e.builtins[i],a=[],s=function(e){var t=r.blocks[e],i=n.layouts[t.name],s=i&&n.bindings.find((function(e){return e.binding===i.binding}));if(!(i&&s&&s.descriptorType&vc))return console.warn("builtin UBO '"+t.name+"' not available!"),"continue";a.push(i),o&&!o.includes(s)&&o.push(s)},c=0;c<r.blocks.length;c++)s(c);Array.prototype.unshift.apply(t.gfxBlocks,a);for(var l=[],u=function(e){var t=r.samplerTextures[e],i=n.layouts[t.name],a=i&&n.bindings.find((function(e){return e.binding===i.binding}));if(!(i&&a&&a.descriptorType&gc))return console.warn("builtin samplerTexture '"+t.name+"' not available!"),"continue";l.push(i),o&&!o.includes(a)&&o.push(a)},h=0;h<r.samplerTextures.length;h++)u(h);Array.prototype.unshift.apply(t.gfxSamplerTextures,l),o&&o.sort((function(e,t){return e.binding-t.binding}))}function am(e){return e.members.reduce((function(e,t){return e+Cc(t.type)*t.count}),0)}function sm(e,t){for(var n=0;n<e.length;n++){var i=e[n];if("!"===i[0]){if(t[i.slice(1)])return!1}else if(!t[i])return!1}return!0}function cm(e){switch(e.gfxAPI){case Na.GLES2:case Na.WEBGL:return"glsl1";case Na.GLES3:case Na.WEBGL2:return"glsl3";default:return"glsl4"}}var lm=new(function(){function e(){this._templates={},this._cache={},this._templateInfos={}}var t=e.prototype;return t.register=function(e){for(var t=0;t<e.shaders.length;t++)this.define(e.shaders[t]).effectName=e.name},t.define=function(e){var t=this._templates[e.name];if(t&&t.hash===e.hash)return t;for(var n=ne({},e),i=0,o=function(e){var t=n.defines[e],o=1;if("number"===t.type){var r=t.range;o=im(r[1]-r[0]+1),t._map=function(e){return e-r[0]}}else"string"===t.type?(o=im(t.options.length),t._map=function(e){return Math.max(0,t.options.findIndex((function(t){return t===e})))}):"boolean"===t.type&&(t._map=function(e){return e?1:0});t._offset=i,i+=o},r=0;r<n.defines.length;r++)o(r);for(var a in i>31&&(n.uber=!0),n.constantMacros="",n.builtins.statistics)n.constantMacros+="#define "+a+" "+n.builtins.statistics[a]+"\n";if(this._templates[e.name]=n,!this._templateInfos[n.hash]){var s={};s.samplerStartBinding=n.blocks.length,s.gfxBlocks=[],s.gfxSamplerTextures=[],s.bindings=[],s.blockSizes=[];for(var c=0;c<n.blocks.length;c++){var l=n.blocks[c];s.blockSizes.push(am(l)),s.bindings.push(new ic(l.binding,l.descriptorType||ls.UNIFORM_BUFFER,1,l.stageFlags)),s.gfxBlocks.push(new Us(rh.MATERIAL,l.binding,l.name,l.members.map((function(e){return new Bs(e.name,e.type,e.count)})),1))}for(var u=0;u<n.samplerTextures.length;u++){var h=n.samplerTextures[u];s.bindings.push(new ic(h.binding,h.descriptorType||ls.SAMPLER_TEXTURE,h.count,h.stageFlags)),s.gfxSamplerTextures.push(new Hs(rh.MATERIAL,h.binding,h.name,h.type,h.count))}s.gfxAttributes=[];for(var _=0;_<n.attributes.length;_++){var f=n.attributes[_];s.gfxAttributes.push(new Ys(f.name,f.format,f.isNormalized,0,f.isInstanced,f.location))}rm(n,s,th,"locals"),s.gfxStages=[],s.gfxStages.push(new qs(Ja.VERTEX,"")),s.gfxStages.push(new qs(Ja.FRAGMENT,"")),s.handleMap=function(e){for(var t={},n=0;n<e.blocks.length;n++)for(var i=e.blocks[n],o=i.members,r=0,a=0;a<o.length;a++){var s=o[a];t[s.name]=jp(Up.BUFFER,rh.MATERIAL,i.binding,s.type,r),r+=(Cc(s.type)>>2)*s.count}for(var c=0;c<e.samplerTextures.length;c++){var l=e.samplerTextures[c];t[l.name]=jp(Up.TEXTURE,rh.MATERIAL,l.binding,l.type)}return t}(n),s.hPipelineLayout=No,s.setLayouts=[],this._templateInfos[n.hash]=s}return n},t.getTemplate=function(e){return this._templates[e]},t.getTemplateInfo=function(e){var t=this._templates[e].hash;return this._templateInfos[t]},t.getDescriptorSetLayout=function(e,t,n){void 0===n&&(n=!1);var i=this._templates[t],o=this._templateInfos[i.hash];return o.setLayouts.length||(nm.bindings=o.bindings,o.setLayouts[rh.MATERIAL]=e.createDescriptorSetLayout(nm),nm.bindings=th.bindings,o.setLayouts[rh.LOCAL]=e.createDescriptorSetLayout(nm)),o.setLayouts[n?rh.LOCAL:rh.MATERIAL]},t.hasProgram=function(e){return void 0!==this._templates[e]},t.getKey=function(e,t){var n=this._templates[e],i=n.defines;if(n.uber){for(var o="",r=0;r<i.length;r++){var a=i[r],s=t[a.name];if(s&&a._map){var c=a._map(s);o+=""+a._offset+c+"|"}}return""+o+n.hash}for(var l=0,u=0;u<i.length;u++){var h=i[u],_=t[h.name];_&&h._map&&(l|=h._map(_)<<h._offset)}return l.toString(16)+"|"+n.hash},t.destroyShaderByDefines=function(e){var t=this,n=Object.keys(e);if(n.length)for(var i=n.map((function(t){var n=e[t];return"boolean"==typeof n&&(n=n?"1":"0"),new RegExp(""+t+n)})),o=Object.keys(this._cache).filter((function(e){return i.every((function(n){return n.test(Oo.get(t._cache[e]).name)}))})),r=0;r<o.length;r++){var a=o[r],s=Oo.get(this._cache[a]);console.log("destroyed shader "+s.name),s.destroy(),delete this._cache[a]}},t.getGFXShader=function(e,t,n,i,o){Object.assign(n,i.macros),o||(o=this.getKey(t,n));var r=this._cache[o];if(r)return r;var a=this._templates[t],s=this._templateInfos[a.hash];s.hPipelineLayout||(this.getDescriptorSetLayout(e,t),rm(a,s,eh,"globals"),s.setLayouts[rh.GLOBAL]=i.descriptorSetLayout,s.hPipelineLayout=Lo.alloc(e,new ac(s.setLayouts)));var c=function(e,t){for(var n=[],i=0;i<t.length;i++){var o=t[i],r=o.name,a=e[r],s=om(o,a),c=!a||"0"===a;n.push({name:r,value:s,isDefault:c})}return n}(n,a.defines),l=i.constantMacros+a.constantMacros+c.reduce((function(e,t){return e+"#define "+t.name+" "+t.value+"\n"}),""),u=a.glsl3,h=cm(e);h?u=a[h]:console.error("Invalid GFX API!"),s.gfxStages[0].source=l+u.vert,s.gfxStages[1].source=l+u.frag;var _=function(e,t,n){for(var i=[],o=e.attributes,r=t.gfxAttributes,a=0;a<o.length;a++)sm(o[a].defines,n)&&i.push(r[a]);return i}(a,s,n),f=function(e,t){return e+t.reduce((function(e,t){return t.isDefault?e:e+"|"+t.name+t.value}),"")}(t,c),d=new Xs(f,s.gfxStages,_,s.gfxBlocks);return d.samplerTextures=s.gfxSamplerTextures,this._cache[o]=Oo.alloc(e,d)},e}());c.programLib=lm;var um,hm,_m,fm={glsl1:[[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp mat4 cc_matWorld;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\nfloat xOS = cos(angle) * corner.x - sin(angle) * corner.y;\nfloat yOS = sin(angle) * corner.x + cos(angle) * corner.y;\ncorner.x = xOS;\ncorner.y = yOS;\n}\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n, mat4 viewInv\n) {\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n}\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nuniform vec4 cc_size_rotation;\nvec4 vs_main() {\nvec4 pos = vec4(a_position, 1);\npos = cc_matWorld * pos;\nvec2 vertOffset = a_texCoord.xy - 0.5;\ncomputeVertPos(pos, vertOffset, quaternionFromEuler(vec3(0., 0., cc_size_rotation.z)), vec3(cc_size_rotation.xy, 0.), cc_matViewInv);\npos = cc_matViewProj * pos;\nuv = a_texCoord.xy;\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nattribute vec3 a_position;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 frag () {\nvec4 o = vec4(1.0);\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\nuniform highp mat4 cc_matWorld;\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec4 v_color;\nattribute float a_dist;\nvarying float v_dist;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\npos = cc_matViewProj * cc_matWorld * pos;\nv_color = a_color;\nv_dist = a_dist;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\nprecision highp float;\nvarying vec4 v_color;\nvarying float v_dist;\nvec4 frag () {\nvec4 o = v_color;\n#ifdef GL_OES_standard_derivatives\nfloat aa = fwidth(v_dist);\n#else\nfloat aa = 0.05;\n#endif\nfloat alpha = 1. - smoothstep(-aa, 0., abs(v_dist) - 1.0);\no.rgb *= o.a;\no *= alpha;\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\nfloat xOS = cos(angle) * corner.x - sin(angle) * corner.y;\nfloat yOS = sin(angle) * corner.x + cos(angle) * corner.y;\ncorner.x = xOS;\ncorner.y = yOS;\n}\nuniform vec4 mainTiling_Offset;\nuniform vec4 frameTile_velLenScale;\nuniform vec4 scale;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\nrotateCorner(viewSpaceVert, q.z);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nuniform vec4 u_sampleInfo;\nuniform vec4 u_worldRot;\nuniform vec4 u_timeDelta;\nattribute vec4 a_position_starttime;\nattribute vec4 a_size_uv;\nattribute vec4 a_rotation_uv;\nattribute vec4 a_color;\nattribute vec4 a_dir_life;\nattribute float a_rndSeed;\n#if CC_RENDER_MODE == 4\nattribute vec3 a_texCoord;\nattribute vec3 a_texCoord3;\nattribute vec3 a_normal;\nattribute vec4 a_color1;\n#endif\nvec3 unpackCurveData (sampler2D tex, vec2 coord) {\nvec4 a = texture2D(tex, coord);\nvec4 b = texture2D(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nreturn mix(a.xyz, b.xyz, c);\n}\nvec3 unpackCurveData (sampler2D tex, vec2 coord, out float w) {\nvec4 a = texture2D(tex, coord);\nvec4 b = texture2D(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nw = mix(a.w, b.w, c);\nreturn mix(a.xyz, b.xyz, c);\n}\nfloat pseudoRandom (float seed) {\nseed = mod(seed, 233280.);\nfloat q = (seed * 9301. + 49297.) / 233280.;\nreturn fract(q);\n}\n#if COLOR_OVER_TIME_MODULE_ENABLE\nuniform sampler2D color_over_time_tex0;\nuniform int u_color_mode;\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nuniform sampler2D rotation_over_time_tex0;\nuniform int u_rotation_mode;\n#endif\n#if SIZE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D size_over_time_tex0;\nuniform int u_size_mode;\n#endif\n#if FORCE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D force_over_time_tex0;\nuniform int u_force_mode;\nuniform int u_force_space;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nuniform sampler2D velocity_over_time_tex0;\nuniform int u_velocity_mode;\nuniform int u_velocity_space;\n#endif\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nuniform sampler2D texture_animation_tex0;\nuniform vec4 u_anim_info;\n#endif\nfloat repeat (float t, float length) {\nreturn t - floor(t / length) * length;\n}\nvec4 rotateQuat (vec4 p, vec4 q) {\nvec3 iv = cross(q.xyz, p.xyz) + q.w * p.xyz;\nvec3 res = p.xyz + 2.0 * cross(q.xyz, iv);\nreturn vec4(res.xyz, p.w);\n}\nvec4 gpvs_main () {\nfloat activeTime = u_timeDelta.x - a_position_starttime.w;\nfloat normalizedTime = clamp(activeTime / a_dir_life.w, 0.0, 1.0);\nvec2 timeCoord0 = vec2(normalizedTime, 0.);\nvec2 timeCoord1 = vec2(normalizedTime, 1.);\n#if CC_RENDER_MODE == 4\nvec2 vertIdx = vec2(a_texCoord.x, a_texCoord.y);\n#else\nvec2 vertIdx = vec2(a_size_uv.w, a_rotation_uv.w);\n#endif\nvec4 velocity = vec4(a_dir_life.xyz, 0.);\nvec4 pos = vec4(a_position_starttime.xyz, 1.);\nvec3 size = a_size_uv.xyz;\n#if SIZE_OVER_TIME_MODULE_ENABLE\nif (u_size_mode == 1) {\nsize *= unpackCurveData(size_over_time_tex0, timeCoord0);\n} else {\nvec3 size_0 = unpackCurveData(size_over_time_tex0, timeCoord0);\nvec3 size_1 = unpackCurveData(size_over_time_tex0, timeCoord1);\nfloat factor_s = pseudoRandom(a_rndSeed + 39825.);\nsize *= mix(size_0, size_1, factor_s);\n}\n#endif\nvec3 compScale = scale.xyz * size;\n#if FORCE_OVER_TIME_MODULE_ENABLE\nvec3 forceAnim = vec3(0.);\nif (u_force_mode == 1) {\nforceAnim = unpackCurveData(force_over_time_tex0, timeCoord0);\n} else {\nvec3 force_0 = unpackCurveData(force_over_time_tex0, timeCoord0);\nvec3 force_1 = unpackCurveData(force_over_time_tex0, timeCoord1);\nfloat factor_f =  pseudoRandom(a_rndSeed + 212165.);\nforceAnim = mix(force_0, force_1, factor_f);\n}\nvec4 forceTrack = vec4(forceAnim, 0.);\nif (u_force_space == 0) {\nforceTrack = rotateQuat(forceTrack, u_worldRot);\n}\nvelocity.xyz += forceTrack.xyz;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nfloat speedModifier0 = 1.;\nfloat speedModifier1 = 1.;\nvec3 velocityAnim = vec3(0.);\nif (u_velocity_mode == 1) {\nvelocityAnim = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n} else {\nvec3 vectory_0 = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\nvec3 vectory_1 = unpackCurveData(velocity_over_time_tex0, timeCoord1, speedModifier1);\nfloat factor_v = pseudoRandom(a_rndSeed + 197866.);\nvelocityAnim = mix(vectory_0, vectory_1, factor_v);\nspeedModifier0 = mix(speedModifier0, speedModifier1, factor_v);\n}\nvec4 velocityTrack = vec4(velocityAnim, 0.);\nif (u_velocity_space == 0) {\nvelocityTrack = rotateQuat(velocityTrack, u_worldRot);\n}\nvelocity.xyz += velocityTrack.xyz;\nvelocity.xyz *= speedModifier0;\n#endif\npos.xyz += velocity.xyz * normalizedTime * a_dir_life.w;\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = rotateQuat(velocity, u_worldRot);\n#endif\n#endif\nvec3 rotation = a_rotation_uv.xyz;\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nif (u_rotation_mode == 1) {\nrotation += unpackCurveData(rotation_over_time_tex0, timeCoord0) * normalizedTime * a_dir_life.w;\n} else {\nvec3 rotation_0 = unpackCurveData(rotation_over_time_tex0, timeCoord0);\nvec3 rotation_1 = unpackCurveData(rotation_over_time_tex0, timeCoord1);\nfloat factor_r = pseudoRandom(a_rndSeed + 125292.);\nrotation += mix(rotation_0, rotation_1, factor_r) * normalizedTime * a_dir_life.w;\n}\n#endif\n#if COLOR_OVER_TIME_MODULE_ENABLE\nif (u_color_mode == 1) {\ncolor = a_color * texture2D(color_over_time_tex0, timeCoord0);\n} else {\nvec4 color_0 = texture2D(color_over_time_tex0, timeCoord0);\nvec4 color_1 = texture2D(color_over_time_tex0, timeCoord1);\nfloat factor_c = pseudoRandom(a_rndSeed + 91041.);\ncolor = a_color * mix(color_0, color_1, factor_c);\n}\n#else\ncolor = a_color;\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((vertIdx - 0.5));\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = rotation.xyz;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., rotation.z);\n#endif\ncomputeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, cc_matViewInv\n#endif\n#if CC_RENDER_MODE == 1\n, cc_cameraPos.xyz\n, velocity\n, frameTile_velLenScale.z\n, frameTile_velLenScale.w\n, a_size_uv.w\n#endif\n);\n#else\nmat4 xformNoScale = matrixFromRT(quaternionFromEuler(rotation), pos.xyz);\nmat4 xform = matFromRTS(quaternionFromEuler(rotation), pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor *= a_color1;\n#endif\npos = cc_matViewProj * pos;\nfloat frameIndex = 0.;\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nfloat startFrame = 0.;\nvec3 frameInfo = vec3(0.);\nif (int(u_anim_info.x) == 1) {\nframeInfo = unpackCurveData(texture_animation_tex0, timeCoord0);\n} else {\nvec3 frameInfo0 = unpackCurveData(texture_animation_tex0, timeCoord0);\nvec3 frameInfo1 = unpackCurveData(texture_animation_tex0, timeCoord1);\nfloat factor_t = pseudoRandom(a_rndSeed + 90794.);\nframeInfo = mix(frameInfo0, frameInfo1, factor_t);\n}\nstartFrame = frameInfo.x / u_anim_info.y;\nframeIndex = repeat(u_anim_info.z * (frameInfo.y + startFrame), 1.);\n#endif\nuv = computeUV(frameIndex, vertIdx, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\nreturn pos;\n}\nvoid main() { gl_Position = gpvs_main(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision mediump float;\nuniform vec4 mainTiling_Offset;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nattribute vec3 a_position;\nattribute vec4 a_texCoord;\nattribute vec3 a_texCoord1;\nattribute vec3 a_texCoord2;\nattribute vec4 a_color;\n#if CC_DRAW_WIRE_FRAME\nvarying vec3 vBarycentric;\n#endif\nvec4 vs_main() {\nhighp vec4 pos = vec4(a_position, 1);\nvec4 velocity = vec4(a_texCoord1.xyz, 0);\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\nvelocity = cc_matWorld * velocity;\n#endif\nfloat vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\nvec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\npos.xyz += camUp * vertOffset;\npos = cc_matViewProj * pos;\nuv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\ncolor = a_color;\n#if CC_DRAW_WIRE_FRAME\nvBarycentric = a_texCoord2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\n#if CC_DRAW_WIRE_FRAME\nvarying vec3 vBarycentric;\n#endif\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n#if CC_DRAW_WIRE_FRAME\nif (any(lessThan(vBarycentric, vec3(0.02)))) {\ncol = vec4(0., 1., 1., 1.);\n}\n#endif\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\nfloat xOS = cos(angle) * corner.x - sin(angle) * corner.y;\nfloat yOS = sin(angle) * corner.x + cos(angle) * corner.y;\ncorner.x = xOS;\ncorner.y = yOS;\n}\nuniform vec4 mainTiling_Offset;\nuniform vec4 frameTile_velLenScale;\nuniform vec4 scale;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\nrotateCorner(viewSpaceVert, q.z);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nattribute vec3 a_position;\nattribute vec3 a_texCoord;\nattribute vec3 a_texCoord1;\nattribute vec3 a_texCoord2;\nattribute vec4 a_color;\n#if CC_RENDER_MODE == 1\nattribute vec3 a_color1;\n#endif\n#if CC_RENDER_MODE == 4\nattribute vec3 a_texCoord3;\nattribute vec3 a_normal;\nattribute vec4 a_color1;\n#endif\nvec4 lpvs_main () {\nvec3 compScale = scale.xyz * a_texCoord1;\nvec4 pos = vec4(a_position, 1);\n#if CC_RENDER_MODE == 1\nvec4 velocity = vec4(a_color1.xyz, 0);\n#endif\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = cc_matWorld * velocity;\n#endif\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = a_texCoord2;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., a_texCoord2.z);\n#endif\ncomputeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, cc_matViewInv\n#endif\n#if CC_RENDER_MODE == 1\n, cc_cameraPos.xyz\n, velocity\n, frameTile_velLenScale.z\n, frameTile_velLenScale.w\n, a_texCoord.x\n#endif\n);\ncolor = a_color;\n#else\nmat4 xformNoScale = matrixFromRT(quaternionFromEuler(a_texCoord2), pos.xyz);\nmat4 xform = matFromRTS(quaternionFromEuler(a_texCoord2), pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor = a_color * a_color1;\n#endif\nuv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\npos = cc_matViewProj * pos;\nreturn pos;\n}\nvoid main() { gl_Position = lpvs_main(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\n#if USE_LOCAL\nuniform highp mat4 cc_matWorld;\n#endif\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 v_light;\nvarying vec2 uv0;\n#if TWO_COLORED\nattribute vec4 a_color2;\nvarying vec4 v_dark;\n#endif\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\npos = cc_matViewProj * pos;\nuv0 = a_texCoord;\nv_light = a_color;\n#if TWO_COLORED\nv_dark = a_color2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\n#if USE_ALPHA_TEST\nuniform float alphaThreshold;\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nvarying vec4 v_light;\n#if TWO_COLORED\nvarying vec4 v_dark;\n#endif\nvarying vec2 uv0;\nuniform sampler2D cc_spriteTexture;\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if TWO_COLORED\nvec4 texColor = vec4(1, 1, 1, 1);\ntexColor *= texture2D(cc_spriteTexture, uv0);\no.a = texColor.a * v_light.a;\no.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n#else\no *= texture2D(cc_spriteTexture, uv0);\no *= v_light;\n#endif\nALPHA_TEST(o);\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\n#if USE_LOCAL\nuniform highp mat4 cc_matWorld;\n#endif\n#if SAMPLE_FROM_RT\n#endif\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 color;\nvarying vec2 uv0;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\n#if USE_PIXEL_ALIGNMENT\npos = cc_matView * pos;\npos.xyz = floor(pos.xyz);\npos = cc_matProj * pos;\n#else\npos = cc_matViewProj * pos;\n#endif\nuv0 = a_texCoord;\n#if SAMPLE_FROM_RT\nuv0 = cc_cameraPos.w > 1.0 ? vec2(uv0.x, 1.0 - uv0.y) : uv0;\n#endif\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 CCSampleWithAlphaSeparated(sampler2D tex, vec2 uv) {\n#if CC_USE_EMBEDDED_ALPHA\nreturn vec4(texture2D(tex, uv).rgb, texture2D(tex, uv + vec2(0.0, 0.5)).r);\n#else\nreturn texture2D(tex, uv);\n#endif\n}\n#if USE_ALPHA_TEST\nuniform float alphaThreshold;\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nvarying vec4 color;\n#if USE_TEXTURE\nvarying vec2 uv0;\nuniform sampler2D cc_spriteTexture;\n#endif\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if USE_TEXTURE\no *= CCSampleWithAlphaSeparated(cc_spriteTexture, uv0);\n#if IS_GRAY\nfloat gray  = 0.2126 * o.r + 0.7152 * o.g + 0.0722 * o.b;\no.r = o.g = o.b = gray;\n#endif\n#endif\no *= color;\nALPHA_TEST(o);\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\n#if USE_INSTANCING\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matWorldIT;\nuniform highp vec4 cc_lightingMapUVParam;\n#endif\nuniform vec4 tilingOffset;\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvarying float v_fog_factor;\nvarying highp vec4 v_shadowPos;\nuniform highp mat4 cc_matLightViewProj;\n#if CC_RECEIVE_SHADOW\nuniform sampler2D cc_shadowMap;\nuniform sampler2D cc_spotLightingMap;\n#endif\n#if USE_VERTEX_COLOR\nattribute vec4 a_color;\nvarying vec4 v_color;\n#endif\nvarying vec3 v_position;\nvarying vec3 v_normal;\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\n#if USE_NORMAL_MAP\nvarying vec3 v_tangent;\nvarying vec3 v_bitangent;\n#endif\n#if HAS_SECOND_UV || USE_LIGHTMAP\nattribute vec2 a_texCoord1;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvarying vec3 v_luv;\nvoid CCLightingMapCaclUV()\n{\n#if !USE_INSTANCING\nv_luv.xy = cc_lightingMapUVParam.xy + a_texCoord1 * cc_lightingMapUVParam.zw;\nv_luv.z = cc_lightingMapUVParam.z;\n#else\nv_luv.xy = a_lightingMapUVParam.xy + a_texCoord1 * a_lightingMapUVParam.zw;\nv_luv.z = a_lightingMapUVParam.z;\n#endif\n}\n#endif\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nmat4 matWorld, matWorldIT;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\nvec4 pos = matWorld * In.position;\nv_position = pos.xyz;\nv_normal = normalize((matWorldIT * vec4(In.normal, 0.0)).xyz);\n#if USE_NORMAL_MAP\nv_tangent = normalize((matWorld * vec4(In.tangent.xyz, 0.0)).xyz);\nv_bitangent = cross(v_normal, v_tangent) * In.tangent.w;\n#endif\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv1 = cc_cameraPos.w > 1.0 ? vec2(v_uv1.x, 1.0 - v_uv1.y) : v_uv1;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\n#if CC_USE_FOG == 0\nv_fog_factor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nv_fog_factor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nv_fog_factor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nv_fog_factor = LayeredFog(pos);\n#else\nv_fog_factor = 1.0;\n#endif\nv_shadowPos = cc_matLightViewProj * pos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nCCLightingMapCaclUV();\n#endif\ngl_Position = cc_matProj * (cc_matView * matWorld) * In.position;\n}",frag:"\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers: enable\n#endif\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_exposure;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform vec4 albedo;\nuniform vec4 albedoScaleAndCutoff;\nuniform vec4 pbrParams;\nuniform vec4 emissive;\nuniform vec4 emissiveScaleParam;\nvarying float v_fog_factor;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nuniform highp mat4 cc_matLightView;\nuniform lowp vec4 cc_shadowNFLSInfo;\nuniform lowp vec4 cc_shadowWHPBInfo;\nuniform lowp vec4 cc_shadowLPNNInfo;\nuniform lowp vec4 cc_shadowColor;\n#if CC_RECEIVE_SHADOW\nuniform sampler2D cc_shadowMap;\nuniform sampler2D cc_spotLightingMap;\nfloat CCGetLinearDepth (vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nfloat dist = length(viewStartPos.xyz);\nreturn cc_shadowNFLSInfo.x + (-dist / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x));\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture2D(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, clipPos.z- cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z - cc_shadowWHPBInfo.w;\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock1 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock2 = step(dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock3 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\n} else {\nblock0 = step(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x, offsetDepth);\nblock1 = step(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x, offsetDepth);\nblock2 = step(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x, offsetDepth);\nblock3 = step(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x, offsetDepth);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat bias = cc_shadowWHPBInfo.w;\nfloat offsetDepth = clipPos.z - bias;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock1 = step(dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock2 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock3 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock4 = step(dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock5 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock6 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock7 = step(dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock8 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\n} else {\nblock0 = step(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x, offsetDepth);\nblock1 = step(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x, offsetDepth);\nblock2 = step(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x, offsetDepth);\nblock3 = step(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x, offsetDepth);\nblock4 = step(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x, offsetDepth);\nblock5 = step(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x, offsetDepth);\nblock6 = step(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x, offsetDepth);\nblock7 = step(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x, offsetDepth);\nblock8 = step(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x, offsetDepth);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture2D(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, depth - cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfloat closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n} else {\nfloat closestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\nreturn shadow / 5.0;\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 9.0;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DLodEXT(tex, coord, lod);\n#else\nreturn texture2D(tex, coord, lod);\n#endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn textureCubeLodEXT(tex, coord, lod);\n#else\nreturn textureCube(tex, coord, lod);\n#endif\n}\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\nstruct StandardSurface {\nvec4 albedo;\nvec3 position;\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.001);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\n#if CC_RECEIVE_SHADOW\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, L.xyz), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 2.0) shadowAttenuation = CCGetShadowFactorSoft2X(pos);\nelse if (pcf > 1.0) shadowAttenuation = CCGetShadowFactorSoft(pos);\nelse shadowAttenuation = CCGetShadowFactorHard(pos);\nvec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + dirlightContrib.rgb * (1.0 - cc_shadowColor.a);\nif (cc_shadowNFLSInfo.w > 0.000001) {\ndirlightContrib.rgb = shadowColor.rgb * shadowAttenuation + dirlightContrib.rgb * (1.0 - shadowAttenuation);\n} else {\ndirlightContrib.rgb = shadowColor.rgb * shadowAttenuation * NL + dirlightContrib.rgb * (1.0 - shadowAttenuation * NL);\n}\n}\n#endif\nfinalColor *= dirlightContrib;\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\nfinalColor += (ambDiff.rgb * diffuse);\n#if CC_USE_IBL\nvec3 R = normalize(reflect(-V, N));\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\nfinalColor += env * cc_ambientSky.w * specular;\n#endif\nfinalColor = finalColor * s.occlusion;\n#if CC_USE_HDR\ns.emissive *= cc_exposure.w;\n#endif\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if !CC_USE_HDR\ncolor.rgb = sqrt(ACESToneMap(color.rgb));\n#endif\nreturn color;\n}\nvarying highp vec4 v_shadowPos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvarying vec3 v_luv;\nuniform sampler2D cc_lightingMap;\nvec3 UnpackLightingmap(vec4 color) {\nvec3 c;\nfloat e = 1.0 + color.a * (8.0 - 1.0);\nc.r = color.r * e;\nc.g = color.g * e;\nc.b = color.b * e;\nreturn c;\n}\n#endif\nvarying vec3 v_position;\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying vec3 v_normal;\n#if USE_VERTEX_COLOR\nvarying vec4 v_color;\n#endif\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_NORMAL_MAP\nvarying vec3 v_tangent;\nvarying vec3 v_bitangent;\nuniform sampler2D normalMap;\n#endif\n#if USE_PBR_MAP\nuniform sampler2D pbrMap;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nuniform sampler2D metallicRoughnessMap;\n#endif\n#if USE_OCCLUSION_MAP\nuniform sampler2D occlusionMap;\n#endif\n#if USE_EMISSIVE_MAP\nuniform sampler2D emissiveMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvoid surf (out StandardSurface s) {\nvec4 baseColor = albedo;\n#if USE_VERTEX_COLOR\nbaseColor *= v_color;\n#endif\n#if USE_ALBEDO_MAP\nvec4 texColor = texture2D(albedoMap, ALBEDO_UV);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\nbaseColor *= texColor;\n#endif\ns.albedo = baseColor;\ns.albedo.rgb *= albedoScaleAndCutoff.xyz;\n#if USE_ALPHA_TEST\nif (s.albedo.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture2D(cc_lightingMap, v_luv.xy);\ns.lightmap = UnpackLightingmap(lightColor);\ns.lightmap_test = v_luv.z;\n#endif\ns.normal = v_normal;\n#if USE_NORMAL_MAP\nvec3 nmmp = texture2D(normalMap, NORMAL_UV).xyz - vec3(0.5);\ns.normal =\n(nmmp.x * pbrParams.w) * normalize(v_tangent) +\n(nmmp.y * pbrParams.w) * normalize(v_bitangent) +\nnmmp.z * normalize(s.normal);\n#endif\ns.position = v_position;\nvec4 pbr = pbrParams;\n#if USE_PBR_MAP\nvec4 res = texture2D(pbrMap, PBR_UV);\npbr.x *= res.r;\npbr.y *= res.g;\npbr.z *= res.b;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nvec4 metallicRoughness = texture2D(metallicRoughnessMap, PBR_UV);\npbr.z *= metallicRoughness.b;\npbr.y *= metallicRoughness.g;\n#endif\n#if USE_OCCLUSION_MAP\npbr.x *= texture2D(occlusionMap, PBR_UV).r;\n#endif\ns.occlusion = clamp(pbr.x, 0.0, 0.96);\ns.roughness = clamp(pbr.y, 0.04, 1.0);\ns.metallic = pbr.z;\ns.emissive = emissive.rgb * emissiveScaleParam.xyz;\n#if USE_EMISSIVE_MAP\ns.emissive *= SRGBToLinear(texture2D(emissiveMap, EMISSIVE_UV).rgb);\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\nuniform highp vec4 cc_lightPos[LIGHTS_PER_PASS];\nuniform vec4 cc_lightColor[LIGHTS_PER_PASS];\nuniform vec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nuniform vec4 cc_lightDir[LIGHTS_PER_PASS];\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - s.position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, normalize(cc_lightPos[i].xyz - s.position.xyz)), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 2.0) shadowAttenuation = CCGetSpotLightShadowFactorSoft2X(pos, s.position);\nelse if (pcf > 1.0) shadowAttenuation = CCGetSpotLightShadowFactorSoft(pos, s.position);\nelse shadowAttenuation = CCGetSpotLightShadowFactorHard(pos, s.position);\nlightColor *= 1.0 - shadowAttenuation;\n}\n}\n#endif\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nfinalColor = finalColor * s.occlusion;\nreturn vec4(finalColor, 0.0);\n}\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\ncolor = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 0\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\ncolor = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvoid main () {\nStandardSurface s; surf(s);\ngl_FragData[0] = s.albedo;\ngl_FragData[1] = vec4(s.position, s.roughness);\ngl_FragData[2] = vec4(s.normal, s.metallic);\ngl_FragData[3] = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\n#if USE_INSTANCING\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matWorldIT;\n#endif\nuniform vec4 tilingOffset;\nuniform highp mat4 cc_matLightViewProj;\n#if HAS_SECOND_UV || USE_LIGHTMAP\nattribute vec2 a_texCoord1;\n#endif\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying vec4 v_worldPos;\nvarying float v_clip_depth;\nvec4 vert () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nmat4 matWorld, matWorldIT;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\nv_worldPos = matWorld * In.position;\nvec4 clipPos = cc_matLightViewProj * v_worldPos;\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#endif\nv_clip_depth = clipPos.z / clipPos.w * 0.5 + 0.5;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nuniform vec4 albedo;\nuniform vec4 albedoScaleAndCutoff;\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\nret = fract(ret);\nret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\nreturn ret;\n}\nuniform highp mat4 cc_matLightView;\nuniform lowp vec4 cc_shadowNFLSInfo;\nuniform lowp vec4 cc_shadowLPNNInfo;\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying vec4 v_worldPos;\nvarying float v_clip_depth;\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvec4 frag () {\nvec4 baseColor = albedo;\n#if USE_ALBEDO_MAP\nbaseColor *= texture2D(albedoMap, ALBEDO_UV);\n#endif\n#if USE_ALPHA_TEST\nif (baseColor.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\nif(cc_shadowLPNNInfo.x > 0.000001 && cc_shadowLPNNInfo.x < 1.999999) {\nif (cc_shadowNFLSInfo.z > 0.000001) {\nvec4 viewStartPos = cc_matLightView * v_worldPos;\nfloat dist = length(viewStartPos.xyz);\nfloat linearDepth = cc_shadowNFLSInfo.x + (-dist / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x));\nreturn vec4(linearDepth, 1.0, 1.0, 1.0);\n}\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nreturn packDepthToRGBA(v_clip_depth);\n}\nreturn vec4(v_clip_depth, 1.0, 1.0, 1.0);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform highp mat4 cc_matWorld;\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvarying float v_fog_factor;\nvarying highp vec4 v_shadowPos;\nuniform highp mat4 cc_matLightViewProj;\n#if CC_RECEIVE_SHADOW\nuniform sampler2D cc_shadowMap;\nuniform sampler2D cc_spotLightingMap;\n#endif\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nvarying highp vec3 v_position;\nvarying mediump vec3 v_normal;\n#if USE_NORMALMAP\nvarying mediump vec3 v_tangent;\nvarying mediump vec3 v_binormal;\n#endif\nvarying mediump vec2 uvw;\nvarying mediump vec2 uv0;\nvarying mediump vec2 uv1;\nvarying mediump vec2 uv2;\nvarying mediump vec2 uv3;\nvarying mediump vec3 luv;\nvarying mediump vec3 diffuse;\nuniform vec4 UVScale;\nuniform vec4 lightMapUVParam;\nvoid main () {\nvec3 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nvec4 pos = vec4(worldPos, 1.0);\npos = cc_matViewProj * pos;\nuvw = a_texCoord;\nuv0 = a_position.xz * UVScale.x;\nuv1 = a_position.xz * UVScale.y;\nuv2 = a_position.xz * UVScale.z;\nuv3 = a_position.xz * UVScale.w;\n#if USE_LIGHTMAP\nluv.xy = lightMapUVParam.xy + a_texCoord * lightMapUVParam.zw;\nluv.z = lightMapUVParam.z;\n#endif\nv_position = worldPos;\nv_normal = a_normal;\n#if CC_USE_FOG == 0\nv_fog_factor = LinearFog(vec4(worldPos, 1.0));\n#elif CC_USE_FOG == 1\nv_fog_factor = ExpFog(vec4(worldPos, 1.0));\n#elif CC_USE_FOG == 2\nv_fog_factor = ExpSquaredFog(vec4(worldPos, 1.0));\n#elif CC_USE_FOG == 3\nv_fog_factor = LayeredFog(vec4(worldPos, 1.0));\n#else\nv_fog_factor = 1.0;\n#endif\n#if USE_NORMALMAP\nv_tangent = vec3(1.0, 0.0, 0.0);\nv_binormal = vec3(0.0, 0.0, 1.0);\nv_binormal = cross(v_tangent, a_normal);\nv_tangent = cross(a_normal, v_binormal);\n#endif\nv_shadowPos = cc_matLightViewProj * vec4(worldPos, 1.0);\ngl_Position = pos;\n}",frag:"\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers: enable\n#endif\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_exposure;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nuniform highp mat4 cc_matLightView;\nuniform lowp vec4 cc_shadowNFLSInfo;\nuniform lowp vec4 cc_shadowWHPBInfo;\nuniform lowp vec4 cc_shadowLPNNInfo;\nuniform lowp vec4 cc_shadowColor;\n#if CC_RECEIVE_SHADOW\nuniform sampler2D cc_shadowMap;\nuniform sampler2D cc_spotLightingMap;\nfloat CCGetLinearDepth (vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nfloat dist = length(viewStartPos.xyz);\nreturn cc_shadowNFLSInfo.x + (-dist / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x));\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture2D(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, clipPos.z- cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z - cc_shadowWHPBInfo.w;\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock1 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock2 = step(dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock3 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\n} else {\nblock0 = step(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x, offsetDepth);\nblock1 = step(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x, offsetDepth);\nblock2 = step(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x, offsetDepth);\nblock3 = step(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x, offsetDepth);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat bias = cc_shadowWHPBInfo.w;\nfloat offsetDepth = clipPos.z - bias;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock1 = step(dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock2 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock3 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock4 = step(dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock5 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock6 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock7 = step(dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock8 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\n} else {\nblock0 = step(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x, offsetDepth);\nblock1 = step(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x, offsetDepth);\nblock2 = step(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x, offsetDepth);\nblock3 = step(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x, offsetDepth);\nblock4 = step(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x, offsetDepth);\nblock5 = step(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x, offsetDepth);\nblock6 = step(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x, offsetDepth);\nblock7 = step(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x, offsetDepth);\nblock8 = step(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x, offsetDepth);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture2D(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, depth - cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfloat closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n} else {\nfloat closestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\nreturn shadow / 5.0;\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 9.0;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DLodEXT(tex, coord, lod);\n#else\nreturn texture2D(tex, coord, lod);\n#endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn textureCubeLodEXT(tex, coord, lod);\n#else\nreturn textureCube(tex, coord, lod);\n#endif\n}\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\nstruct StandardSurface {\nvec4 albedo;\nvec3 position;\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.001);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\n#if CC_RECEIVE_SHADOW\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, L.xyz), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 2.0) shadowAttenuation = CCGetShadowFactorSoft2X(pos);\nelse if (pcf > 1.0) shadowAttenuation = CCGetShadowFactorSoft(pos);\nelse shadowAttenuation = CCGetShadowFactorHard(pos);\nvec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + dirlightContrib.rgb * (1.0 - cc_shadowColor.a);\nif (cc_shadowNFLSInfo.w > 0.000001) {\ndirlightContrib.rgb = shadowColor.rgb * shadowAttenuation + dirlightContrib.rgb * (1.0 - shadowAttenuation);\n} else {\ndirlightContrib.rgb = shadowColor.rgb * shadowAttenuation * NL + dirlightContrib.rgb * (1.0 - shadowAttenuation * NL);\n}\n}\n#endif\nfinalColor *= dirlightContrib;\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\nfinalColor += (ambDiff.rgb * diffuse);\n#if CC_USE_IBL\nvec3 R = normalize(reflect(-V, N));\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\nfinalColor += env * cc_ambientSky.w * specular;\n#endif\nfinalColor = finalColor * s.occlusion;\n#if CC_USE_HDR\ns.emissive *= cc_exposure.w;\n#endif\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if !CC_USE_HDR\ncolor.rgb = sqrt(ACESToneMap(color.rgb));\n#endif\nreturn color;\n}\nvarying float v_fog_factor;\nvarying highp vec4 v_shadowPos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvarying vec3 v_luv;\nuniform sampler2D cc_lightingMap;\nvec3 UnpackLightingmap(vec4 color) {\nvec3 c;\nfloat e = 1.0 + color.a * (8.0 - 1.0);\nc.r = color.r * e;\nc.g = color.g * e;\nc.b = color.b * e;\nreturn c;\n}\n#endif\nvarying highp vec3 v_position;\nvarying mediump vec3 v_normal;\n#if USE_NORMALMAP\nvarying mediump vec3 v_tangent;\nvarying mediump vec3 v_binormal;\n#endif\nvarying mediump vec2 uvw;\nvarying mediump vec2 uv0;\nvarying mediump vec2 uv1;\nvarying mediump vec2 uv2;\nvarying mediump vec2 uv3;\nvarying mediump vec3 diffuse;\nvarying mediump vec3 luv;\nuniform vec4 metallic;\nuniform vec4 roughness;\nuniform sampler2D weightMap;\nuniform sampler2D detailMap0;\nuniform sampler2D detailMap1;\nuniform sampler2D detailMap2;\nuniform sampler2D detailMap3;\nuniform sampler2D normalMap0;\nuniform sampler2D normalMap1;\nuniform sampler2D normalMap2;\nuniform sampler2D normalMap3;\nuniform sampler2D lightMap;\nvoid surf (out StandardSurface s) {\n#if LAYERS > 1\nvec4 w = texture2D(weightMap, uvw);\n#endif\nvec4 baseColor = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseColor = texture2D(detailMap0, uv0);\n#elif LAYERS == 2\nbaseColor += texture2D(detailMap0, uv0) * w.r;\nbaseColor += texture2D(detailMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseColor += texture2D(detailMap0, uv0) * w.r;\nbaseColor += texture2D(detailMap1, uv1) * w.g;\nbaseColor += texture2D(detailMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseColor += texture2D(detailMap0, uv0) * w.r;\nbaseColor += texture2D(detailMap1, uv1) * w.g;\nbaseColor += texture2D(detailMap2, uv2) * w.b;\nbaseColor += texture2D(detailMap3, uv3) * w.a;\n#else\nbaseColor = texture2D(detailMap0, uv0);\n#endif\ns.position = v_position;\n#if USE_NORMALMAP\nvec4 baseNormal = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseNormal = texture2D(normalMap0, uv0);\n#elif LAYERS == 2\nbaseNormal += texture2D(normalMap0, uv0) * w.r;\nbaseNormal += texture2D(normalMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseNormal += texture2D(normalMap0, uv0) * w.r;\nbaseNormal += texture2D(normalMap1, uv1) * w.g;\nbaseNormal += texture2D(normalMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseNormal += texture2D(normalMap0, uv0) * w.r;\nbaseNormal += texture2D(normalMap1, uv1) * w.g;\nbaseNormal += texture2D(normalMap2, uv2) * w.b;\nbaseNormal += texture2D(normalMap3, uv3) * w.a;\n#else\nbaseNormal = texture2D(normalMap0, uv0);\n#endif\nvec3 nmmp = baseNormal.xyz - vec3(0.5);\ns.normal =\nnmmp.x * normalize(v_tangent) +\nnmmp.y * normalize(v_binormal) +\nnmmp.z * normalize(v_normal);\n#else\ns.normal = v_normal;\n#endif\ns.albedo = vec4(SRGBToLinear(baseColor.rgb), 1.0);\ns.occlusion = 1.0;\n#if USE_PBR\ns.roughness = 0.0;\n#if LAYERS == 1\ns.roughness = roughness.x;\n#elif LAYERS == 2\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\n#elif LAYERS == 3\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\n#elif LAYERS == 4\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\ns.roughness += roughness.w * w.a;\n#else\ns.roughness = 1.0;\n#endif\ns.metallic = 0.0;\n#if LAYERS == 1\ns.metallic = metallic.x;\n#elif LAYERS == 2\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\n#elif LAYERS == 3\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\n#elif LAYERS == 4\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\ns.metallic += metallic.w * w.a;\n#else\ns.metallic = 0.0;\n#endif\n#else\ns.roughness = 1.0;\ns.metallic = 0.0;\n#endif\ns.emissive = vec3(0.0, 0.0, 0.0);\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture2D(lightMap, luv.xy);\ns.lightmap = UnpackLightingmap(lightColor);\ns.lightmap_test = luv.z;\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\nuniform highp vec4 cc_lightPos[LIGHTS_PER_PASS];\nuniform vec4 cc_lightColor[LIGHTS_PER_PASS];\nuniform vec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nuniform vec4 cc_lightDir[LIGHTS_PER_PASS];\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - s.position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, normalize(cc_lightPos[i].xyz - s.position.xyz)), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 2.0) shadowAttenuation = CCGetSpotLightShadowFactorSoft2X(pos, s.position);\nelse if (pcf > 1.0) shadowAttenuation = CCGetSpotLightShadowFactorSoft(pos, s.position);\nelse shadowAttenuation = CCGetSpotLightShadowFactorHard(pos, s.position);\nlightColor *= 1.0 - shadowAttenuation;\n}\n}\n#endif\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nfinalColor = finalColor * s.occlusion;\nreturn vec4(finalColor, 0.0);\n}\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\ncolor = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 0\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\ncolor = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvoid main () {\nStandardSurface s; surf(s);\ngl_FragData[0] = s.albedo;\ngl_FragData[1] = vec4(s.position, s.roughness);\ngl_FragData[2] = vec4(s.normal, s.metallic);\ngl_FragData[3] = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matLightViewProj;\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nvarying vec2 v_clip_depth;\nvec4 vert () {\nvec4 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nworldPos.w = 1.0;\nvec4 clipPos = cc_matLightViewProj * worldPos;\nv_clip_depth = clipPos.zw;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\nret = fract(ret);\nret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\nreturn ret;\n}\nvarying vec2 v_clip_depth;\nvec4 frag () {\nreturn packDepthToRGBA(v_clip_depth.x / v_clip_depth.y * 0.5 + 0.5);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\n#if USE_INSTANCING\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\n#endif\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvarying float v_fog_factor;\n#if USE_VERTEX_COLOR\nattribute lowp vec4 a_color;\nvarying lowp vec4 v_color;\n#endif\n#if USE_TEXTURE\nvarying vec2 v_uv;\nuniform vec4 tilingOffset;\n#endif\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(position);\n#endif\n#if CC_USE_SKINNING\nCCSkin(position);\n#endif\nmat4 matWorld;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\n#if USE_TEXTURE\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\n#if CC_USE_FOG == 0\nv_fog_factor = LinearFog(matWorld * position);\n#elif CC_USE_FOG == 1\nv_fog_factor = ExpFog(matWorld * position);\n#elif CC_USE_FOG == 2\nv_fog_factor = ExpSquaredFog(matWorld * position);\n#elif CC_USE_FOG == 3\nv_fog_factor = LayeredFog(matWorld * position);\n#else\nv_fog_factor = 1.0;\n#endif\nreturn cc_matProj * (cc_matView * matWorld) * position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nuniform mediump vec4 cc_exposure;\nuniform mediump vec4 cc_fogColor;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nvarying float v_fog_factor;\n#if USE_ALPHA_TEST\n#endif\n#if USE_TEXTURE\nvarying vec2 v_uv;\nuniform sampler2D mainTexture;\n#endif\nuniform vec4 mainColor;\nuniform vec4 colorScaleAndCutoff;\n#if USE_VERTEX_COLOR\nvarying lowp vec4 v_color;\n#endif\nvec4 frag () {\nvec4 o = mainColor;\no.rgb *= colorScaleAndCutoff.xyz;\n#if USE_VERTEX_COLOR\no *= v_color;\n#endif\n#if USE_TEXTURE\no *= texture2D(mainTexture, v_uv);\n#endif\n#if USE_ALPHA_TEST\nif (o.ALPHA_TEST_CHANNEL < colorScaleAndCutoff.w) discard;\n#endif\no = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, o.rgb, v_fog_factor), o.a);\nreturn CCFragOutput(o);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition.xy = cc_cameraPos.w == 0.0 ? vec2(position.xy.x, -position.xy.y) : position.xy;\ngl_Position = vec4(position.x, position.y, 1.0, 1.0);\nv_uv = a_texCoord;\n}",frag:"\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_exposure;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nuniform highp mat4 cc_matLightView;\nuniform highp mat4 cc_matLightViewProj;\nuniform lowp vec4 cc_shadowNFLSInfo;\nuniform lowp vec4 cc_shadowWHPBInfo;\nuniform lowp vec4 cc_shadowLPNNInfo;\nuniform lowp vec4 cc_shadowColor;\n#if CC_RECEIVE_SHADOW\nuniform sampler2D cc_shadowMap;\nuniform sampler2D cc_spotLightingMap;\nfloat CCGetLinearDepth (vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nfloat dist = length(viewStartPos.xyz);\nreturn cc_shadowNFLSInfo.x + (-dist / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x));\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture2D(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, clipPos.z- cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z - cc_shadowWHPBInfo.w;\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock1 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock2 = step(dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock3 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\n} else {\nblock0 = step(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x, offsetDepth);\nblock1 = step(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x, offsetDepth);\nblock2 = step(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x, offsetDepth);\nblock3 = step(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x, offsetDepth);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat bias = cc_shadowWHPBInfo.w;\nfloat offsetDepth = clipPos.z - bias;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock1 = step(dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock2 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock3 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock4 = step(dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock5 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock6 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock7 = step(dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock8 = step(dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\n} else {\nblock0 = step(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x, offsetDepth);\nblock1 = step(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x, offsetDepth);\nblock2 = step(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x, offsetDepth);\nblock3 = step(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x, offsetDepth);\nblock4 = step(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x, offsetDepth);\nblock5 = step(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x, offsetDepth);\nblock6 = step(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x, offsetDepth);\nblock7 = step(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x, offsetDepth);\nblock8 = step(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x, offsetDepth);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture2D(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, depth - cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfloat closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n} else {\nfloat closestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\nreturn shadow / 5.0;\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 9.0;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DLodEXT(tex, coord, lod);\n#else\nreturn texture2D(tex, coord, lod);\n#endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn textureCubeLodEXT(tex, coord, lod);\n#else\nreturn textureCube(tex, coord, lod);\n#endif\n}\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\nstruct StandardSurface {\nvec4 albedo;\nvec3 position;\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.001);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\n#if CC_RECEIVE_SHADOW\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, L.xyz), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 2.0) shadowAttenuation = CCGetShadowFactorSoft2X(pos);\nelse if (pcf > 1.0) shadowAttenuation = CCGetShadowFactorSoft(pos);\nelse shadowAttenuation = CCGetShadowFactorHard(pos);\nvec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + dirlightContrib.rgb * (1.0 - cc_shadowColor.a);\nif (cc_shadowNFLSInfo.w > 0.000001) {\ndirlightContrib.rgb = shadowColor.rgb * shadowAttenuation + dirlightContrib.rgb * (1.0 - shadowAttenuation);\n} else {\ndirlightContrib.rgb = shadowColor.rgb * shadowAttenuation * NL + dirlightContrib.rgb * (1.0 - shadowAttenuation * NL);\n}\n}\n#endif\nfinalColor *= dirlightContrib;\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\nfinalColor += (ambDiff.rgb * diffuse);\n#if CC_USE_IBL\nvec3 R = normalize(reflect(-V, N));\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\nfinalColor += env * cc_ambientSky.w * specular;\n#endif\nfinalColor = finalColor * s.occlusion;\n#if CC_USE_HDR\ns.emissive *= cc_exposure.w;\n#endif\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\nuniform highp vec4 cc_lightPos[LIGHTS_PER_PASS];\nuniform vec4 cc_lightColor[LIGHTS_PER_PASS];\nuniform vec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nuniform vec4 cc_lightDir[LIGHTS_PER_PASS];\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - s.position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, normalize(cc_lightPos[i].xyz - s.position.xyz)), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 2.0) shadowAttenuation = CCGetSpotLightShadowFactorSoft2X(pos, s.position);\nelse if (pcf > 1.0) shadowAttenuation = CCGetSpotLightShadowFactorSoft(pos, s.position);\nelse shadowAttenuation = CCGetSpotLightShadowFactorHard(pos, s.position);\nlightColor *= 1.0 - shadowAttenuation;\n}\n}\n#endif\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nfinalColor = finalColor * s.occlusion;\nreturn vec4(finalColor, 0.0);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if !CC_USE_HDR\ncolor.rgb = sqrt(ACESToneMap(color.rgb));\n#endif\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvarying vec2 v_uv;\nuniform sampler2D cc_gbuffer_albedoMap;\nuniform sampler2D cc_gbuffer_positionMap;\nuniform sampler2D cc_gbuffer_normalMap;\nuniform sampler2D cc_gbuffer_emissiveMap;\nvoid main () {\nStandardSurface s;\nvec4 albedoMap = texture2D(cc_gbuffer_albedoMap,v_uv);\nvec4 positionMap = texture2D(cc_gbuffer_positionMap,v_uv);\nvec4 normalMap = texture2D(cc_gbuffer_normalMap,v_uv);\nvec4 emissiveMap = texture2D(cc_gbuffer_emissiveMap,v_uv);\ns.albedo = albedoMap;\ns.position = positionMap.xyz;\ns.roughness = positionMap.w;\ns.normal = normalMap.xyz;\ns.metallic = normalMap.w;\ns.emissive = emissiveMap.xyz;\ns.occlusion = emissiveMap.w;\nfloat fogFactor;\n#if CC_USE_FOG == 0\nfogFactor = LinearFog(vec4(s.position, 1));\n#elif CC_USE_FOG == 1\nfogFactor = ExpFog(vec4(s.position, 1));\n#elif CC_USE_FOG == 2\nfogFactor = ExpSquaredFog(vec4(s.position, 1));\n#elif CC_USE_FOG == 3\nfogFactor = LayeredFog(vec4(s.position, 1));\n#else\nfogFactor = 1.0;\n#endif\nvec4 shadowPos;\nshadowPos = cc_matLightViewProj * vec4(s.position, 1);\nvec4 color = CCStandardShadingBase(s, shadowPos) +\nCCStandardShadingAdditive(s, shadowPos);\ncolor = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, fogFactor), color.a);\ngl_FragColor = CCFragOutput(color);\n}"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\n#if USE_INSTANCING\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\n#endif\nuniform highp mat4 cc_matLightPlaneProj;\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(position);\n#endif\n#if CC_USE_SKINNING\nCCSkin(position);\n#endif\nmat4 matWorld;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\nposition = cc_matProj * (cc_matView * cc_matLightPlaneProj * matWorld) * position;\nposition.z -= 0.0001;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform lowp vec4 cc_shadowColor;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nvec4 frag () {\nreturn CCFragOutput(cc_shadowColor);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nuniform mediump vec4 cc_screenSize;\nvarying vec2 v_uv;\nuniform sampler2D cc_lighting_resultMap;\nvoid texcoords(vec2 fragCoord, vec2 resolution,\nout vec2 v_rgbNW, out vec2 v_rgbNE,\nout vec2 v_rgbSW, out vec2 v_rgbSE,\nout vec2 v_rgbM) {\nvec2 inverseVP = 1.0 / resolution.xy;\nv_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\nv_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\nv_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\nv_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\nv_rgbM = vec2(fragCoord * inverseVP);\n}\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\nvec2 v_rgbNW, vec2 v_rgbNE,\nvec2 v_rgbSW, vec2 v_rgbSE,\nvec2 v_rgbM) {\nvec4 color;\nmediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\nvec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\nvec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\nvec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\nvec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\nvec4 texColor = texture2D(tex, v_rgbM);\nvec3 rgbM  = texColor.xyz;\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat lumaNW = dot(rgbNW, luma);\nfloat lumaNE = dot(rgbNE, luma);\nfloat lumaSW = dot(rgbSW, luma);\nfloat lumaSE = dot(rgbSE, luma);\nfloat lumaM  = dot(rgbM,  luma);\nfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\nfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\nmediump vec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n(0.25 * (1.0 / 8.0)), (1.0/ 128.0));\nfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\ndir = min(vec2(8.0, 8.0),\nmax(vec2(-8.0, -8.0),\ndir * rcpDirMin)) * inverseVP;\nvec3 rgbA = 0.5 * (\ntexture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\ntexture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\nvec3 rgbB = rgbA * 0.5 + 0.25 * (\ntexture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\ntexture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\nfloat lumaB = dot(rgbB, luma);\nif ((lumaB < lumaMin) || (lumaB > lumaMax))\ncolor = vec4(rgbA, texColor.a);\nelse\ncolor = vec4(rgbB, texColor.a);\nreturn color;\n}\nvoid main () {\nmediump vec2 v_rgbNW;\nmediump vec2 v_rgbNE;\nmediump vec2 v_rgbSW;\nmediump vec2 v_rgbSE;\nmediump vec2 v_rgbM;\nvec2 resolution = cc_screenSize.xy;\nvec2 fragCoord = v_uv * resolution;\ntexcoords(fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\ngl_FragColor = fxaa(cc_lighting_resultMap, fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\nvarying mediump vec4 viewDir;\nvec4 vert () {\nviewDir = vec4(a_position, 1.0);\nmat4 matViewRotOnly = mat4(mat3(cc_matView));\nmat4 matProj = cc_matProj;\nif (matProj[3].w > 0.0) {\nvec2 scale = vec2(48.0, 24.0);\nmatProj[0].xy *= scale;\nmatProj[1].xy *= scale;\nmatProj[2].zw = vec2(-1.0);\nmatProj[3].zw = vec2(0.0);\n}\nvec4 pos = matProj * matViewRotOnly * viewDir;\npos.z = 0.99999 * pos.w;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_ambientSky;\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if !CC_USE_HDR\ncolor.rgb = sqrt(ACESToneMap(color.rgb));\n#endif\nreturn color;\n}\nvarying mediump vec4 viewDir;\nvec4 frag () {\n#if USE_RGBE_CUBEMAP\nvec3 c = unpackRGBE(textureCube(cc_environment, viewDir.xyz));\n#else\nvec3 c = SRGBToLinear(textureCube(cc_environment, viewDir.xyz).rgb);\n#endif\nreturn CCFragOutput(vec4(c * cc_ambientSky.w, 1.0));\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec2 v_uv;\nuniform vec4 offset;\nuniform vec4 digits[20];\nfloat getComponent(vec4 v, float i) {\nif (i < 1.0) { return v.x; }\nelse if (i < 2.0) { return v.y; }\nelse if (i < 3.0) { return v.z; }\nelse { return v.w; }\n}\nvec4 vert () {\nvec4 position = cc_matViewProj * vec4(a_position, 1.0);\nposition.xy += offset.xy;\nv_uv = a_color.xy;\nif (a_color.z >= 0.0) {\nfloat n = getComponent(digits[int(a_color.z)], a_color.w);\nv_uv += vec2(offset.z * n, 0.0);\n}\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nvarying vec2 v_uv;\nuniform sampler2D mainTexture;\nvec4 frag () {\nreturn CCFragOutput(texture2D(mainTexture, v_uv));\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nvarying vec2 v_uv;\nvarying float v_percent;\nuniform vec4 u_buffer0;\nuniform vec4 u_buffer1;\nuniform mat4 u_projection;\nvec4 vert () {\nvec2 worldPos = a_position * u_buffer1.xy + u_buffer1.zw;\nvec2 clipSpace = worldPos / u_buffer0.xy * 2.0 - 1.0;\nvec4 screenPos = u_projection * vec4(clipSpace, 0.0, 1.0);\nv_uv = a_texCoord;\nv_percent = u_buffer0.z;\nreturn screenPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvarying vec2 v_uv;\nvarying float v_percent;\nuniform sampler2D mainTexture;\nvec4 frag () {\nvec4 color = texture2D(mainTexture, v_uv);\nfloat precent = clamp(v_percent, 0.0, 1.0);\ncolor.xyz *= precent;\nreturn color;\n}\nvoid main() { gl_FragColor = frag(); }"}]],glsl3:[[{vert:"\nprecision mediump float;\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\nfloat xOS = cos(angle) * corner.x - sin(angle) * corner.y;\nfloat yOS = sin(angle) * corner.x + cos(angle) * corner.y;\ncorner.x = xOS;\ncorner.y = yOS;\n}\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n, mat4 viewInv\n) {\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n}\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nlayout(std140) uniform builtin {\nvec4 cc_size_rotation;\n};\nvec4 vs_main() {\nvec4 pos = vec4(a_position, 1);\npos = cc_matWorld * pos;\nvec2 vertOffset = a_texCoord.xy - 0.5;\ncomputeVertPos(pos, vertOffset, quaternionFromEuler(vec3(0., 0., cc_size_rotation.z)), vec3(cc_size_rotation.xy, 0.), cc_matViewInv);\npos = cc_matViewProj * pos;\nuv = a_texCoord.xy;\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nin vec3 a_position;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 frag () {\nvec4 o = vec4(1.0);\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nin vec3 a_position;\nin vec4 a_color;\nout vec4 v_color;\nin float a_dist;\nout float v_dist;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\npos = cc_matViewProj * cc_matWorld * pos;\nv_color = a_color;\nv_dist = a_dist;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nin vec4 v_color;\nin float v_dist;\nvec4 frag () {\nvec4 o = v_color;\nfloat aa = fwidth(v_dist);\nfloat alpha = 1. - smoothstep(-aa, 0., abs(v_dist) - 1.0);\no.rgb *= o.a;\no *= alpha;\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\nfloat xOS = cos(angle) * corner.x - sin(angle) * corner.y;\nfloat yOS = sin(angle) * corner.x + cos(angle) * corner.y;\ncorner.x = xOS;\ncorner.y = yOS;\n}\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\nrotateCorner(viewSpaceVert, q.z);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nlayout(std140) uniform SampleConstants {\nvec4 u_sampleInfo;\n};\nlayout(std140) uniform TickConstants {\nvec4 u_worldRot;\nvec4 u_timeDelta;\n};\nin vec4 a_position_starttime;\nin vec4 a_size_uv;\nin vec4 a_rotation_uv;\nin vec4 a_color;\nin vec4 a_dir_life;\nin float a_rndSeed;\n#if CC_RENDER_MODE == 4\nin vec3 a_texCoord;\nin vec3 a_texCoord3;\nin vec3 a_normal;\nin vec4 a_color1;\n#endif\nvec3 unpackCurveData (sampler2D tex, vec2 coord) {\nvec4 a = texture(tex, coord);\nvec4 b = texture(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nreturn mix(a.xyz, b.xyz, c);\n}\nvec3 unpackCurveData (sampler2D tex, vec2 coord, out float w) {\nvec4 a = texture(tex, coord);\nvec4 b = texture(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nw = mix(a.w, b.w, c);\nreturn mix(a.xyz, b.xyz, c);\n}\nfloat pseudoRandom (float seed) {\nseed = mod(seed, 233280.);\nfloat q = (seed * 9301. + 49297.) / 233280.;\nreturn fract(q);\n}\n#if COLOR_OVER_TIME_MODULE_ENABLE\nuniform sampler2D color_over_time_tex0;\nlayout(std140) uniform ColorConstant {\nint u_color_mode;\n};\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nuniform sampler2D rotation_over_time_tex0;\nlayout(std140) uniform RotationConstant {\nint u_rotation_mode;\n};\n#endif\n#if SIZE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D size_over_time_tex0;\nlayout(std140) uniform SizeConstant {\nint u_size_mode;\n};\n#endif\n#if FORCE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D force_over_time_tex0;\nlayout(std140) uniform ForceConstant {\nint u_force_mode;\nint u_force_space;\n};\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nuniform sampler2D velocity_over_time_tex0;\nlayout(std140) uniform VelocityConstant {\nint u_velocity_mode;\nint u_velocity_space;\n};\n#endif\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nuniform sampler2D texture_animation_tex0;\nlayout(std140) uniform AnimationConstant {\nvec4 u_anim_info;\n};\n#endif\nfloat repeat (float t, float length) {\nreturn t - floor(t / length) * length;\n}\nvec4 rotateQuat (vec4 p, vec4 q) {\nvec3 iv = cross(q.xyz, p.xyz) + q.w * p.xyz;\nvec3 res = p.xyz + 2.0 * cross(q.xyz, iv);\nreturn vec4(res.xyz, p.w);\n}\nvec4 gpvs_main () {\nfloat activeTime = u_timeDelta.x - a_position_starttime.w;\nfloat normalizedTime = clamp(activeTime / a_dir_life.w, 0.0, 1.0);\nvec2 timeCoord0 = vec2(normalizedTime, 0.);\nvec2 timeCoord1 = vec2(normalizedTime, 1.);\n#if CC_RENDER_MODE == 4\nvec2 vertIdx = vec2(a_texCoord.x, a_texCoord.y);\n#else\nvec2 vertIdx = vec2(a_size_uv.w, a_rotation_uv.w);\n#endif\nvec4 velocity = vec4(a_dir_life.xyz, 0.);\nvec4 pos = vec4(a_position_starttime.xyz, 1.);\nvec3 size = a_size_uv.xyz;\n#if SIZE_OVER_TIME_MODULE_ENABLE\nif (u_size_mode == 1) {\nsize *= unpackCurveData(size_over_time_tex0, timeCoord0);\n} else {\nvec3 size_0 = unpackCurveData(size_over_time_tex0, timeCoord0);\nvec3 size_1 = unpackCurveData(size_over_time_tex0, timeCoord1);\nfloat factor_s = pseudoRandom(a_rndSeed + 39825.);\nsize *= mix(size_0, size_1, factor_s);\n}\n#endif\nvec3 compScale = scale.xyz * size;\n#if FORCE_OVER_TIME_MODULE_ENABLE\nvec3 forceAnim = vec3(0.);\nif (u_force_mode == 1) {\nforceAnim = unpackCurveData(force_over_time_tex0, timeCoord0);\n} else {\nvec3 force_0 = unpackCurveData(force_over_time_tex0, timeCoord0);\nvec3 force_1 = unpackCurveData(force_over_time_tex0, timeCoord1);\nfloat factor_f =  pseudoRandom(a_rndSeed + 212165.);\nforceAnim = mix(force_0, force_1, factor_f);\n}\nvec4 forceTrack = vec4(forceAnim, 0.);\nif (u_force_space == 0) {\nforceTrack = rotateQuat(forceTrack, u_worldRot);\n}\nvelocity.xyz += forceTrack.xyz;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nfloat speedModifier0 = 1.;\nfloat speedModifier1 = 1.;\nvec3 velocityAnim = vec3(0.);\nif (u_velocity_mode == 1) {\nvelocityAnim = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n} else {\nvec3 vectory_0 = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\nvec3 vectory_1 = unpackCurveData(velocity_over_time_tex0, timeCoord1, speedModifier1);\nfloat factor_v = pseudoRandom(a_rndSeed + 197866.);\nvelocityAnim = mix(vectory_0, vectory_1, factor_v);\nspeedModifier0 = mix(speedModifier0, speedModifier1, factor_v);\n}\nvec4 velocityTrack = vec4(velocityAnim, 0.);\nif (u_velocity_space == 0) {\nvelocityTrack = rotateQuat(velocityTrack, u_worldRot);\n}\nvelocity.xyz += velocityTrack.xyz;\nvelocity.xyz *= speedModifier0;\n#endif\npos.xyz += velocity.xyz * normalizedTime * a_dir_life.w;\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = rotateQuat(velocity, u_worldRot);\n#endif\n#endif\nvec3 rotation = a_rotation_uv.xyz;\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nif (u_rotation_mode == 1) {\nrotation += unpackCurveData(rotation_over_time_tex0, timeCoord0) * normalizedTime * a_dir_life.w;\n} else {\nvec3 rotation_0 = unpackCurveData(rotation_over_time_tex0, timeCoord0);\nvec3 rotation_1 = unpackCurveData(rotation_over_time_tex0, timeCoord1);\nfloat factor_r = pseudoRandom(a_rndSeed + 125292.);\nrotation += mix(rotation_0, rotation_1, factor_r) * normalizedTime * a_dir_life.w;\n}\n#endif\n#if COLOR_OVER_TIME_MODULE_ENABLE\nif (u_color_mode == 1) {\ncolor = a_color * texture(color_over_time_tex0, timeCoord0);\n} else {\nvec4 color_0 = texture(color_over_time_tex0, timeCoord0);\nvec4 color_1 = texture(color_over_time_tex0, timeCoord1);\nfloat factor_c = pseudoRandom(a_rndSeed + 91041.);\ncolor = a_color * mix(color_0, color_1, factor_c);\n}\n#else\ncolor = a_color;\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((vertIdx - 0.5));\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = rotation.xyz;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., rotation.z);\n#endif\ncomputeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, cc_matViewInv\n#endif\n#if CC_RENDER_MODE == 1\n, cc_cameraPos.xyz\n, velocity\n, frameTile_velLenScale.z\n, frameTile_velLenScale.w\n, a_size_uv.w\n#endif\n);\n#else\nmat4 xformNoScale = matrixFromRT(quaternionFromEuler(rotation), pos.xyz);\nmat4 xform = matFromRTS(quaternionFromEuler(rotation), pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor *= a_color1;\n#endif\npos = cc_matViewProj * pos;\nfloat frameIndex = 0.;\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nfloat startFrame = 0.;\nvec3 frameInfo = vec3(0.);\nif (int(u_anim_info.x) == 1) {\nframeInfo = unpackCurveData(texture_animation_tex0, timeCoord0);\n} else {\nvec3 frameInfo0 = unpackCurveData(texture_animation_tex0, timeCoord0);\nvec3 frameInfo1 = unpackCurveData(texture_animation_tex0, timeCoord1);\nfloat factor_t = pseudoRandom(a_rndSeed + 90794.);\nframeInfo = mix(frameInfo0, frameInfo1, factor_t);\n}\nstartFrame = frameInfo.x / u_anim_info.y;\nframeIndex = repeat(u_anim_info.z * (frameInfo.y + startFrame), 1.);\n#endif\nuv = computeUV(frameIndex, vertIdx, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\nreturn pos;\n}\nvoid main() { gl_Position = gpvs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nin vec3 a_position;\nin vec4 a_texCoord;\nin vec3 a_texCoord1;\nin vec3 a_texCoord2;\nin vec4 a_color;\n#if CC_DRAW_WIRE_FRAME\nout vec3 vBarycentric;\n#endif\nvec4 vs_main() {\nhighp vec4 pos = vec4(a_position, 1);\nvec4 velocity = vec4(a_texCoord1.xyz, 0);\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\nvelocity = cc_matWorld * velocity;\n#endif\nfloat vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\nvec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\npos.xyz += camUp * vertOffset;\npos = cc_matViewProj * pos;\nuv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\ncolor = a_color;\n#if CC_DRAW_WIRE_FRAME\nvBarycentric = a_texCoord2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\n#if CC_DRAW_WIRE_FRAME\nin vec3 vBarycentric;\n#endif\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n#if CC_DRAW_WIRE_FRAME\nif (any(lessThan(vBarycentric, vec3(0.02)))) {\ncol = vec4(0., 1., 1., 1.);\n}\n#endif\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\nfloat xOS = cos(angle) * corner.x - sin(angle) * corner.y;\nfloat yOS = sin(angle) * corner.x + cos(angle) * corner.y;\ncorner.x = xOS;\ncorner.y = yOS;\n}\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\nrotateCorner(viewSpaceVert, q.z);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nin vec3 a_position;\nin vec3 a_texCoord;\nin vec3 a_texCoord1;\nin vec3 a_texCoord2;\nin vec4 a_color;\n#if CC_RENDER_MODE == 1\nin vec3 a_color1;\n#endif\n#if CC_RENDER_MODE == 4\nin vec3 a_texCoord3;\nin vec3 a_normal;\nin vec4 a_color1;\n#endif\nvec4 lpvs_main () {\nvec3 compScale = scale.xyz * a_texCoord1;\nvec4 pos = vec4(a_position, 1);\n#if CC_RENDER_MODE == 1\nvec4 velocity = vec4(a_color1.xyz, 0);\n#endif\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = cc_matWorld * velocity;\n#endif\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = a_texCoord2;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., a_texCoord2.z);\n#endif\ncomputeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, cc_matViewInv\n#endif\n#if CC_RENDER_MODE == 1\n, cc_cameraPos.xyz\n, velocity\n, frameTile_velLenScale.z\n, frameTile_velLenScale.w\n, a_texCoord.x\n#endif\n);\ncolor = a_color;\n#else\nmat4 xformNoScale = matrixFromRT(quaternionFromEuler(a_texCoord2), pos.xyz);\nmat4 xform = matFromRTS(quaternionFromEuler(a_texCoord2), pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor = a_color * a_color1;\n#endif\nuv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\npos = cc_matViewProj * pos;\nreturn pos;\n}\nvoid main() { gl_Position = lpvs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\n#if USE_LOCAL\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nout vec4 v_light;\nout vec2 uv0;\n#if TWO_COLORED\nin vec4 a_color2;\nout vec4 v_dark;\n#endif\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\npos = cc_matViewProj * pos;\nuv0 = a_texCoord;\nv_light = a_color;\n#if TWO_COLORED\nv_dark = a_color2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\n#if USE_ALPHA_TEST\nlayout(std140) uniform ALPHA_TEST_DATA {\nfloat alphaThreshold;\n};\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nin vec4 v_light;\n#if TWO_COLORED\nin vec4 v_dark;\n#endif\nin vec2 uv0;\nuniform sampler2D cc_spriteTexture;\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if TWO_COLORED\nvec4 texColor = vec4(1, 1, 1, 1);\ntexColor *= texture(cc_spriteTexture, uv0);\no.a = texColor.a * v_light.a;\no.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n#else\no *= texture(cc_spriteTexture, uv0);\no *= v_light;\n#endif\nALPHA_TEST(o);\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\n#if USE_LOCAL\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\n#if SAMPLE_FROM_RT\n#endif\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nout vec4 color;\nout vec2 uv0;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\n#if USE_PIXEL_ALIGNMENT\npos = cc_matView * pos;\npos.xyz = floor(pos.xyz);\npos = cc_matProj * pos;\n#else\npos = cc_matViewProj * pos;\n#endif\nuv0 = a_texCoord;\n#if SAMPLE_FROM_RT\nuv0 = cc_cameraPos.w > 1.0 ? vec2(uv0.x, 1.0 - uv0.y) : uv0;\n#endif\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 CCSampleWithAlphaSeparated(sampler2D tex, vec2 uv) {\n#if CC_USE_EMBEDDED_ALPHA\nreturn vec4(texture(tex, uv).rgb, texture(tex, uv + vec2(0.0, 0.5)).r);\n#else\nreturn texture(tex, uv);\n#endif\n}\n#if USE_ALPHA_TEST\nlayout(std140) uniform ALPHA_TEST_DATA {\nfloat alphaThreshold;\n};\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nin vec4 color;\n#if USE_TEXTURE\nin vec2 uv0;\nuniform sampler2D cc_spriteTexture;\n#endif\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if USE_TEXTURE\no *= CCSampleWithAlphaSeparated(cc_spriteTexture, uv0);\n#if IS_GRAY\nfloat gray  = 0.2126 * o.r + 0.7152 * o.g + 0.0722 * o.b;\no.r = o.g = o.b = gray;\n#endif\n#endif\no *= color;\nALPHA_TEST(o);\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\n#if USE_INSTANCING\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nout float v_fog_factor;\nout highp vec4 v_shadowPos;\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nlowp  vec4 cc_shadowNFLSInfo;\nlowp  vec4 cc_shadowWHPBInfo;\nlowp  vec4 cc_shadowLPNNInfo;\nlowp  vec4 cc_shadowColor;\n};\n#if CC_RECEIVE_SHADOW\nuniform sampler2D cc_shadowMap;\nuniform sampler2D cc_spotLightingMap;\n#endif\n#if USE_VERTEX_COLOR\nin vec4 a_color;\nout vec4 v_color;\n#endif\nout vec3 v_position;\nout vec3 v_normal;\nout vec2 v_uv;\nout vec2 v_uv1;\n#if USE_NORMAL_MAP\nout vec3 v_tangent;\nout vec3 v_bitangent;\n#endif\n#if HAS_SECOND_UV || USE_LIGHTMAP\nin vec2 a_texCoord1;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nout vec3 v_luv;\nvoid CCLightingMapCaclUV()\n{\n#if !USE_INSTANCING\nv_luv.xy = cc_lightingMapUVParam.xy + a_texCoord1 * cc_lightingMapUVParam.zw;\nv_luv.z = cc_lightingMapUVParam.z;\n#else\nv_luv.xy = a_lightingMapUVParam.xy + a_texCoord1 * a_lightingMapUVParam.zw;\nv_luv.z = a_lightingMapUVParam.z;\n#endif\n}\n#endif\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nmat4 matWorld, matWorldIT;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\nvec4 pos = matWorld * In.position;\nv_position = pos.xyz;\nv_normal = normalize((matWorldIT * vec4(In.normal, 0.0)).xyz);\n#if USE_NORMAL_MAP\nv_tangent = normalize((matWorld * vec4(In.tangent.xyz, 0.0)).xyz);\nv_bitangent = cross(v_normal, v_tangent) * In.tangent.w;\n#endif\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv1 = cc_cameraPos.w > 1.0 ? vec2(v_uv1.x, 1.0 - v_uv1.y) : v_uv1;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\n#if CC_USE_FOG == 0\nv_fog_factor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nv_fog_factor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nv_fog_factor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nv_fog_factor = LayeredFog(pos);\n#else\nv_fog_factor = 1.0;\n#endif\nv_shadowPos = cc_matLightViewProj * pos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nCCLightingMapCaclUV();\n#endif\ngl_Position = cc_matProj * (cc_matView * matWorld) * In.position;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nin float v_fog_factor;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nlowp  vec4 cc_shadowNFLSInfo;\nlowp  vec4 cc_shadowWHPBInfo;\nlowp  vec4 cc_shadowLPNNInfo;\nlowp  vec4 cc_shadowColor;\n};\n#if CC_RECEIVE_SHADOW\nuniform sampler2D cc_shadowMap;\nuniform sampler2D cc_spotLightingMap;\nfloat CCGetLinearDepth (vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nfloat dist = length(viewStartPos.xyz);\nreturn cc_shadowNFLSInfo.x + (-dist / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x));\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, clipPos.z- cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z - cc_shadowWHPBInfo.w;\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock1 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock2 = step(dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock3 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\n} else {\nblock0 = step(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x, offsetDepth);\nblock1 = step(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x, offsetDepth);\nblock2 = step(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x, offsetDepth);\nblock3 = step(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x, offsetDepth);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat bias = cc_shadowWHPBInfo.w;\nfloat offsetDepth = clipPos.z - bias;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock1 = step(dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock2 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock3 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock4 = step(dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock5 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock6 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock7 = step(dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock8 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\n} else {\nblock0 = step(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x, offsetDepth);\nblock1 = step(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x, offsetDepth);\nblock2 = step(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x, offsetDepth);\nblock3 = step(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x, offsetDepth);\nblock4 = step(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x, offsetDepth);\nblock5 = step(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x, offsetDepth);\nblock6 = step(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x, offsetDepth);\nblock7 = step(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x, offsetDepth);\nblock8 = step(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x, offsetDepth);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, depth - cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfloat closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n} else {\nfloat closestDepth = texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\nreturn shadow / 5.0;\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 9.0;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\nstruct StandardSurface {\nvec4 albedo;\nvec3 position;\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.001);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\n#if CC_RECEIVE_SHADOW\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, L.xyz), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 2.0) shadowAttenuation = CCGetShadowFactorSoft2X(pos);\nelse if (pcf > 1.0) shadowAttenuation = CCGetShadowFactorSoft(pos);\nelse shadowAttenuation = CCGetShadowFactorHard(pos);\nvec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + dirlightContrib.rgb * (1.0 - cc_shadowColor.a);\nif (cc_shadowNFLSInfo.w > 0.000001) {\ndirlightContrib.rgb = shadowColor.rgb * shadowAttenuation + dirlightContrib.rgb * (1.0 - shadowAttenuation);\n} else {\ndirlightContrib.rgb = shadowColor.rgb * shadowAttenuation * NL + dirlightContrib.rgb * (1.0 - shadowAttenuation * NL);\n}\n}\n#endif\nfinalColor *= dirlightContrib;\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\nfinalColor += (ambDiff.rgb * diffuse);\n#if CC_USE_IBL\nvec3 R = normalize(reflect(-V, N));\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\nfinalColor += env * cc_ambientSky.w * specular;\n#endif\nfinalColor = finalColor * s.occlusion;\n#if CC_USE_HDR\ns.emissive *= cc_exposure.w;\n#endif\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if !CC_USE_HDR\ncolor.rgb = sqrt(ACESToneMap(color.rgb));\n#endif\nreturn color;\n}\nin highp vec4 v_shadowPos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nin vec3 v_luv;\nuniform sampler2D cc_lightingMap;\nvec3 UnpackLightingmap(vec4 color) {\nvec3 c;\nfloat e = 1.0 + color.a * (8.0 - 1.0);\nc.r = color.r * e;\nc.g = color.g * e;\nc.b = color.b * e;\nreturn c;\n}\n#endif\nin vec3 v_position;\nin vec2 v_uv;\nin vec2 v_uv1;\nin vec3 v_normal;\n#if USE_VERTEX_COLOR\nin vec4 v_color;\n#endif\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_NORMAL_MAP\nin vec3 v_tangent;\nin vec3 v_bitangent;\nuniform sampler2D normalMap;\n#endif\n#if USE_PBR_MAP\nuniform sampler2D pbrMap;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nuniform sampler2D metallicRoughnessMap;\n#endif\n#if USE_OCCLUSION_MAP\nuniform sampler2D occlusionMap;\n#endif\n#if USE_EMISSIVE_MAP\nuniform sampler2D emissiveMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvoid surf (out StandardSurface s) {\nvec4 baseColor = albedo;\n#if USE_VERTEX_COLOR\nbaseColor *= v_color;\n#endif\n#if USE_ALBEDO_MAP\nvec4 texColor = texture(albedoMap, ALBEDO_UV);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\nbaseColor *= texColor;\n#endif\ns.albedo = baseColor;\ns.albedo.rgb *= albedoScaleAndCutoff.xyz;\n#if USE_ALPHA_TEST\nif (s.albedo.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture(cc_lightingMap, v_luv.xy);\ns.lightmap = UnpackLightingmap(lightColor);\ns.lightmap_test = v_luv.z;\n#endif\ns.normal = v_normal;\n#if USE_NORMAL_MAP\nvec3 nmmp = texture(normalMap, NORMAL_UV).xyz - vec3(0.5);\ns.normal =\n(nmmp.x * pbrParams.w) * normalize(v_tangent) +\n(nmmp.y * pbrParams.w) * normalize(v_bitangent) +\nnmmp.z * normalize(s.normal);\n#endif\ns.position = v_position;\nvec4 pbr = pbrParams;\n#if USE_PBR_MAP\nvec4 res = texture(pbrMap, PBR_UV);\npbr.x *= res.r;\npbr.y *= res.g;\npbr.z *= res.b;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nvec4 metallicRoughness = texture(metallicRoughnessMap, PBR_UV);\npbr.z *= metallicRoughness.b;\npbr.y *= metallicRoughness.g;\n#endif\n#if USE_OCCLUSION_MAP\npbr.x *= texture(occlusionMap, PBR_UV).r;\n#endif\ns.occlusion = clamp(pbr.x, 0.0, 0.96);\ns.roughness = clamp(pbr.y, 0.04, 1.0);\ns.metallic = pbr.z;\ns.emissive = emissive.rgb * emissiveScaleParam.xyz;\n#if USE_EMISSIVE_MAP\ns.emissive *= SRGBToLinear(texture(emissiveMap, EMISSIVE_UV).rgb);\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\nlayout(std140) uniform CCForwardLight {\nhighp vec4 cc_lightPos[LIGHTS_PER_PASS];\nvec4 cc_lightColor[LIGHTS_PER_PASS];\nvec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nvec4 cc_lightDir[LIGHTS_PER_PASS];\n};\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - s.position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, normalize(cc_lightPos[i].xyz - s.position.xyz)), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 2.0) shadowAttenuation = CCGetSpotLightShadowFactorSoft2X(pos, s.position);\nelse if (pcf > 1.0) shadowAttenuation = CCGetSpotLightShadowFactorSoft(pos, s.position);\nelse shadowAttenuation = CCGetSpotLightShadowFactorHard(pos, s.position);\nlightColor *= 1.0 - shadowAttenuation;\n}\n}\n#endif\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nfinalColor = finalColor * s.occlusion;\nreturn vec4(finalColor, 0.0);\n}\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\ncolor = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\nfragColorX = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 0\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\ncolor = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\nfragColorX = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nlayout(location = 0) out vec4 fragColor0;\nlayout(location = 1) out vec4 fragColor1;\nlayout(location = 2) out vec4 fragColor2;\nlayout(location = 3) out vec4 fragColor3;\nvoid main () {\nStandardSurface s; surf(s);\nfragColor0 = s.albedo;\nfragColor1 = vec4(s.position, s.roughness);\nfragColor2 = vec4(s.normal, s.metallic);\nfragColor3 = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\n#if USE_INSTANCING\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nlowp  vec4 cc_shadowNFLSInfo;\nlowp  vec4 cc_shadowWHPBInfo;\nlowp  vec4 cc_shadowLPNNInfo;\nlowp  vec4 cc_shadowColor;\n};\n#if HAS_SECOND_UV || USE_LIGHTMAP\nin vec2 a_texCoord1;\n#endif\nout vec2 v_uv;\nout vec2 v_uv1;\nout vec4 v_worldPos;\nout float v_clip_depth;\nvec4 vert () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nmat4 matWorld, matWorldIT;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\nv_worldPos = matWorld * In.position;\nvec4 clipPos = cc_matLightViewProj * v_worldPos;\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#endif\nv_clip_depth = clipPos.z / clipPos.w * 0.5 + 0.5;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\nret = fract(ret);\nret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\nreturn ret;\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nlowp  vec4 cc_shadowNFLSInfo;\nlowp  vec4 cc_shadowWHPBInfo;\nlowp  vec4 cc_shadowLPNNInfo;\nlowp  vec4 cc_shadowColor;\n};\nin vec2 v_uv;\nin vec2 v_uv1;\nin vec4 v_worldPos;\nin float v_clip_depth;\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvec4 frag () {\nvec4 baseColor = albedo;\n#if USE_ALBEDO_MAP\nbaseColor *= texture(albedoMap, ALBEDO_UV);\n#endif\n#if USE_ALPHA_TEST\nif (baseColor.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\nif(cc_shadowLPNNInfo.x > 0.000001 && cc_shadowLPNNInfo.x < 1.999999) {\nif (cc_shadowNFLSInfo.z > 0.000001) {\nvec4 viewStartPos = cc_matLightView * v_worldPos;\nfloat dist = length(viewStartPos.xyz);\nfloat linearDepth = cc_shadowNFLSInfo.x + (-dist / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x));\nreturn vec4(linearDepth, 1.0, 1.0, 1.0);\n}\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nreturn packDepthToRGBA(v_clip_depth);\n}\nreturn vec4(v_clip_depth, 1.0, 1.0, 1.0);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nout float v_fog_factor;\nout highp vec4 v_shadowPos;\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nlowp  vec4 cc_shadowNFLSInfo;\nlowp  vec4 cc_shadowWHPBInfo;\nlowp  vec4 cc_shadowLPNNInfo;\nlowp  vec4 cc_shadowColor;\n};\n#if CC_RECEIVE_SHADOW\nuniform sampler2D cc_shadowMap;\nuniform sampler2D cc_spotLightingMap;\n#endif\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nout highp vec3 v_position;\nout mediump vec3 v_normal;\n#if USE_NORMALMAP\nout mediump vec3 v_tangent;\nout mediump vec3 v_binormal;\n#endif\nout mediump vec2 uvw;\nout mediump vec2 uv0;\nout mediump vec2 uv1;\nout mediump vec2 uv2;\nout mediump vec2 uv3;\nout mediump vec3 luv;\nout mediump vec3 diffuse;\nlayout(std140) uniform TexCoords {\nvec4 UVScale;\nvec4 lightMapUVParam;\n};\nvoid main () {\nvec3 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nvec4 pos = vec4(worldPos, 1.0);\npos = cc_matViewProj * pos;\nuvw = a_texCoord;\nuv0 = a_position.xz * UVScale.x;\nuv1 = a_position.xz * UVScale.y;\nuv2 = a_position.xz * UVScale.z;\nuv3 = a_position.xz * UVScale.w;\n#if USE_LIGHTMAP\nluv.xy = lightMapUVParam.xy + a_texCoord * lightMapUVParam.zw;\nluv.z = lightMapUVParam.z;\n#endif\nv_position = worldPos;\nv_normal = a_normal;\n#if CC_USE_FOG == 0\nv_fog_factor = LinearFog(vec4(worldPos, 1.0));\n#elif CC_USE_FOG == 1\nv_fog_factor = ExpFog(vec4(worldPos, 1.0));\n#elif CC_USE_FOG == 2\nv_fog_factor = ExpSquaredFog(vec4(worldPos, 1.0));\n#elif CC_USE_FOG == 3\nv_fog_factor = LayeredFog(vec4(worldPos, 1.0));\n#else\nv_fog_factor = 1.0;\n#endif\n#if USE_NORMALMAP\nv_tangent = vec3(1.0, 0.0, 0.0);\nv_binormal = vec3(0.0, 0.0, 1.0);\nv_binormal = cross(v_tangent, a_normal);\nv_tangent = cross(a_normal, v_binormal);\n#endif\nv_shadowPos = cc_matLightViewProj * vec4(worldPos, 1.0);\ngl_Position = pos;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nlowp  vec4 cc_shadowNFLSInfo;\nlowp  vec4 cc_shadowWHPBInfo;\nlowp  vec4 cc_shadowLPNNInfo;\nlowp  vec4 cc_shadowColor;\n};\n#if CC_RECEIVE_SHADOW\nuniform sampler2D cc_shadowMap;\nuniform sampler2D cc_spotLightingMap;\nfloat CCGetLinearDepth (vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nfloat dist = length(viewStartPos.xyz);\nreturn cc_shadowNFLSInfo.x + (-dist / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x));\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, clipPos.z- cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z - cc_shadowWHPBInfo.w;\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock1 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock2 = step(dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock3 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\n} else {\nblock0 = step(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x, offsetDepth);\nblock1 = step(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x, offsetDepth);\nblock2 = step(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x, offsetDepth);\nblock3 = step(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x, offsetDepth);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat bias = cc_shadowWHPBInfo.w;\nfloat offsetDepth = clipPos.z - bias;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock1 = step(dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock2 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock3 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock4 = step(dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock5 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock6 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock7 = step(dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock8 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\n} else {\nblock0 = step(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x, offsetDepth);\nblock1 = step(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x, offsetDepth);\nblock2 = step(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x, offsetDepth);\nblock3 = step(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x, offsetDepth);\nblock4 = step(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x, offsetDepth);\nblock5 = step(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x, offsetDepth);\nblock6 = step(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x, offsetDepth);\nblock7 = step(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x, offsetDepth);\nblock8 = step(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x, offsetDepth);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, depth - cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfloat closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n} else {\nfloat closestDepth = texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\nreturn shadow / 5.0;\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 9.0;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\nstruct StandardSurface {\nvec4 albedo;\nvec3 position;\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.001);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\n#if CC_RECEIVE_SHADOW\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, L.xyz), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 2.0) shadowAttenuation = CCGetShadowFactorSoft2X(pos);\nelse if (pcf > 1.0) shadowAttenuation = CCGetShadowFactorSoft(pos);\nelse shadowAttenuation = CCGetShadowFactorHard(pos);\nvec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + dirlightContrib.rgb * (1.0 - cc_shadowColor.a);\nif (cc_shadowNFLSInfo.w > 0.000001) {\ndirlightContrib.rgb = shadowColor.rgb * shadowAttenuation + dirlightContrib.rgb * (1.0 - shadowAttenuation);\n} else {\ndirlightContrib.rgb = shadowColor.rgb * shadowAttenuation * NL + dirlightContrib.rgb * (1.0 - shadowAttenuation * NL);\n}\n}\n#endif\nfinalColor *= dirlightContrib;\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\nfinalColor += (ambDiff.rgb * diffuse);\n#if CC_USE_IBL\nvec3 R = normalize(reflect(-V, N));\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\nfinalColor += env * cc_ambientSky.w * specular;\n#endif\nfinalColor = finalColor * s.occlusion;\n#if CC_USE_HDR\ns.emissive *= cc_exposure.w;\n#endif\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if !CC_USE_HDR\ncolor.rgb = sqrt(ACESToneMap(color.rgb));\n#endif\nreturn color;\n}\nin float v_fog_factor;\nin highp vec4 v_shadowPos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nin vec3 v_luv;\nuniform sampler2D cc_lightingMap;\nvec3 UnpackLightingmap(vec4 color) {\nvec3 c;\nfloat e = 1.0 + color.a * (8.0 - 1.0);\nc.r = color.r * e;\nc.g = color.g * e;\nc.b = color.b * e;\nreturn c;\n}\n#endif\nin highp vec3 v_position;\nin mediump vec3 v_normal;\n#if USE_NORMALMAP\nin mediump vec3 v_tangent;\nin mediump vec3 v_binormal;\n#endif\nin mediump vec2 uvw;\nin mediump vec2 uv0;\nin mediump vec2 uv1;\nin mediump vec2 uv2;\nin mediump vec2 uv3;\nin mediump vec3 diffuse;\nin mediump vec3 luv;\nlayout(std140) uniform PbrParams {\nvec4 metallic;\nvec4 roughness;\n};\nuniform sampler2D weightMap;\nuniform sampler2D detailMap0;\nuniform sampler2D detailMap1;\nuniform sampler2D detailMap2;\nuniform sampler2D detailMap3;\nuniform sampler2D normalMap0;\nuniform sampler2D normalMap1;\nuniform sampler2D normalMap2;\nuniform sampler2D normalMap3;\nuniform sampler2D lightMap;\nvoid surf (out StandardSurface s) {\n#if LAYERS > 1\nvec4 w = texture(weightMap, uvw);\n#endif\nvec4 baseColor = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseColor = texture(detailMap0, uv0);\n#elif LAYERS == 2\nbaseColor += texture(detailMap0, uv0) * w.r;\nbaseColor += texture(detailMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseColor += texture(detailMap0, uv0) * w.r;\nbaseColor += texture(detailMap1, uv1) * w.g;\nbaseColor += texture(detailMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseColor += texture(detailMap0, uv0) * w.r;\nbaseColor += texture(detailMap1, uv1) * w.g;\nbaseColor += texture(detailMap2, uv2) * w.b;\nbaseColor += texture(detailMap3, uv3) * w.a;\n#else\nbaseColor = texture(detailMap0, uv0);\n#endif\ns.position = v_position;\n#if USE_NORMALMAP\nvec4 baseNormal = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseNormal = texture(normalMap0, uv0);\n#elif LAYERS == 2\nbaseNormal += texture(normalMap0, uv0) * w.r;\nbaseNormal += texture(normalMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseNormal += texture(normalMap0, uv0) * w.r;\nbaseNormal += texture(normalMap1, uv1) * w.g;\nbaseNormal += texture(normalMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseNormal += texture(normalMap0, uv0) * w.r;\nbaseNormal += texture(normalMap1, uv1) * w.g;\nbaseNormal += texture(normalMap2, uv2) * w.b;\nbaseNormal += texture(normalMap3, uv3) * w.a;\n#else\nbaseNormal = texture(normalMap0, uv0);\n#endif\nvec3 nmmp = baseNormal.xyz - vec3(0.5);\ns.normal =\nnmmp.x * normalize(v_tangent) +\nnmmp.y * normalize(v_binormal) +\nnmmp.z * normalize(v_normal);\n#else\ns.normal = v_normal;\n#endif\ns.albedo = vec4(SRGBToLinear(baseColor.rgb), 1.0);\ns.occlusion = 1.0;\n#if USE_PBR\ns.roughness = 0.0;\n#if LAYERS == 1\ns.roughness = roughness.x;\n#elif LAYERS == 2\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\n#elif LAYERS == 3\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\n#elif LAYERS == 4\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\ns.roughness += roughness.w * w.a;\n#else\ns.roughness = 1.0;\n#endif\ns.metallic = 0.0;\n#if LAYERS == 1\ns.metallic = metallic.x;\n#elif LAYERS == 2\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\n#elif LAYERS == 3\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\n#elif LAYERS == 4\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\ns.metallic += metallic.w * w.a;\n#else\ns.metallic = 0.0;\n#endif\n#else\ns.roughness = 1.0;\ns.metallic = 0.0;\n#endif\ns.emissive = vec3(0.0, 0.0, 0.0);\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture(lightMap, luv.xy);\ns.lightmap = UnpackLightingmap(lightColor);\ns.lightmap_test = luv.z;\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\nlayout(std140) uniform CCForwardLight {\nhighp vec4 cc_lightPos[LIGHTS_PER_PASS];\nvec4 cc_lightColor[LIGHTS_PER_PASS];\nvec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nvec4 cc_lightDir[LIGHTS_PER_PASS];\n};\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - s.position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, normalize(cc_lightPos[i].xyz - s.position.xyz)), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 2.0) shadowAttenuation = CCGetSpotLightShadowFactorSoft2X(pos, s.position);\nelse if (pcf > 1.0) shadowAttenuation = CCGetSpotLightShadowFactorSoft(pos, s.position);\nelse shadowAttenuation = CCGetSpotLightShadowFactorHard(pos, s.position);\nlightColor *= 1.0 - shadowAttenuation;\n}\n}\n#endif\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nfinalColor = finalColor * s.occlusion;\nreturn vec4(finalColor, 0.0);\n}\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\ncolor = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\nfragColorX = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 0\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\ncolor = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\nfragColorX = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nlayout(location = 0) out vec4 fragColor0;\nlayout(location = 1) out vec4 fragColor1;\nlayout(location = 2) out vec4 fragColor2;\nlayout(location = 3) out vec4 fragColor3;\nvoid main () {\nStandardSurface s; surf(s);\nfragColor0 = s.albedo;\nfragColor1 = vec4(s.position, s.roughness);\nfragColor2 = vec4(s.normal, s.metallic);\nfragColor3 = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nlowp  vec4 cc_shadowNFLSInfo;\nlowp  vec4 cc_shadowWHPBInfo;\nlowp  vec4 cc_shadowLPNNInfo;\nlowp  vec4 cc_shadowColor;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nout vec2 v_clip_depth;\nvec4 vert () {\nvec4 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nworldPos.w = 1.0;\nvec4 clipPos = cc_matLightViewProj * worldPos;\nv_clip_depth = clipPos.zw;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\nret = fract(ret);\nret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\nreturn ret;\n}\nin vec2 v_clip_depth;\nvec4 frag () {\nreturn packDepthToRGBA(v_clip_depth.x / v_clip_depth.y * 0.5 + 0.5);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\n#if USE_INSTANCING\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nout float v_fog_factor;\n#if USE_VERTEX_COLOR\nin lowp vec4 a_color;\nout lowp vec4 v_color;\n#endif\n#if USE_TEXTURE\nout vec2 v_uv;\nlayout(std140) uniform TexCoords {\nvec4 tilingOffset;\n};\n#endif\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(position);\n#endif\n#if CC_USE_SKINNING\nCCSkin(position);\n#endif\nmat4 matWorld;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\n#if USE_TEXTURE\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\n#if CC_USE_FOG == 0\nv_fog_factor = LinearFog(matWorld * position);\n#elif CC_USE_FOG == 1\nv_fog_factor = ExpFog(matWorld * position);\n#elif CC_USE_FOG == 2\nv_fog_factor = ExpSquaredFog(matWorld * position);\n#elif CC_USE_FOG == 3\nv_fog_factor = LayeredFog(matWorld * position);\n#else\nv_fog_factor = 1.0;\n#endif\nreturn cc_matProj * (cc_matView * matWorld) * position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nin float v_fog_factor;\n#if USE_ALPHA_TEST\n#endif\n#if USE_TEXTURE\nin vec2 v_uv;\nuniform sampler2D mainTexture;\n#endif\nlayout(std140) uniform Constant {\nvec4 mainColor;\nvec4 colorScaleAndCutoff;\n};\n#if USE_VERTEX_COLOR\nin lowp vec4 v_color;\n#endif\nvec4 frag () {\nvec4 o = mainColor;\no.rgb *= colorScaleAndCutoff.xyz;\n#if USE_VERTEX_COLOR\no *= v_color;\n#endif\n#if USE_TEXTURE\no *= texture(mainTexture, v_uv);\n#endif\n#if USE_ALPHA_TEST\nif (o.ALPHA_TEST_CHANNEL < colorScaleAndCutoff.w) discard;\n#endif\no = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, o.rgb, v_fog_factor), o.a);\nreturn CCFragOutput(o);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nout vec2 v_uv;\nvoid main () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition.xy = cc_cameraPos.w == 0.0 ? vec2(position.xy.x, -position.xy.y) : position.xy;\ngl_Position = vec4(position.x, position.y, 1.0, 1.0);\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nlowp  vec4 cc_shadowNFLSInfo;\nlowp  vec4 cc_shadowWHPBInfo;\nlowp  vec4 cc_shadowLPNNInfo;\nlowp  vec4 cc_shadowColor;\n};\n#if CC_RECEIVE_SHADOW\nuniform sampler2D cc_shadowMap;\nuniform sampler2D cc_spotLightingMap;\nfloat CCGetLinearDepth (vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nfloat dist = length(viewStartPos.xyz);\nreturn cc_shadowNFLSInfo.x + (-dist / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x));\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, clipPos.z- cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z - cc_shadowWHPBInfo.w;\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock1 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock2 = step(dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock3 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\n} else {\nblock0 = step(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x, offsetDepth);\nblock1 = step(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x, offsetDepth);\nblock2 = step(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x, offsetDepth);\nblock3 = step(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x, offsetDepth);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat bias = cc_shadowWHPBInfo.w;\nfloat offsetDepth = clipPos.z - bias;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock1 = step(dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock2 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock3 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock4 = step(dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock5 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock6 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock7 = step(dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\nblock8 = step(dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0)), offsetDepth);\n} else {\nblock0 = step(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x, offsetDepth);\nblock1 = step(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x, offsetDepth);\nblock2 = step(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x, offsetDepth);\nblock3 = step(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x, offsetDepth);\nblock4 = step(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x, offsetDepth);\nblock5 = step(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x, offsetDepth);\nblock6 = step(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x, offsetDepth);\nblock7 = step(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x, offsetDepth);\nblock8 = step(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x, offsetDepth);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, depth - cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfloat closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n} else {\nfloat closestDepth = texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\nreturn shadow / 5.0;\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 9.0;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\nstruct StandardSurface {\nvec4 albedo;\nvec3 position;\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.001);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\n#if CC_RECEIVE_SHADOW\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, L.xyz), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 2.0) shadowAttenuation = CCGetShadowFactorSoft2X(pos);\nelse if (pcf > 1.0) shadowAttenuation = CCGetShadowFactorSoft(pos);\nelse shadowAttenuation = CCGetShadowFactorHard(pos);\nvec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + dirlightContrib.rgb * (1.0 - cc_shadowColor.a);\nif (cc_shadowNFLSInfo.w > 0.000001) {\ndirlightContrib.rgb = shadowColor.rgb * shadowAttenuation + dirlightContrib.rgb * (1.0 - shadowAttenuation);\n} else {\ndirlightContrib.rgb = shadowColor.rgb * shadowAttenuation * NL + dirlightContrib.rgb * (1.0 - shadowAttenuation * NL);\n}\n}\n#endif\nfinalColor *= dirlightContrib;\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\nfinalColor += (ambDiff.rgb * diffuse);\n#if CC_USE_IBL\nvec3 R = normalize(reflect(-V, N));\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\nfinalColor += env * cc_ambientSky.w * specular;\n#endif\nfinalColor = finalColor * s.occlusion;\n#if CC_USE_HDR\ns.emissive *= cc_exposure.w;\n#endif\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\nlayout(std140) uniform CCForwardLight {\nhighp vec4 cc_lightPos[LIGHTS_PER_PASS];\nvec4 cc_lightColor[LIGHTS_PER_PASS];\nvec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nvec4 cc_lightDir[LIGHTS_PER_PASS];\n};\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - s.position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, normalize(cc_lightPos[i].xyz - s.position.xyz)), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 2.0) shadowAttenuation = CCGetSpotLightShadowFactorSoft2X(pos, s.position);\nelse if (pcf > 1.0) shadowAttenuation = CCGetSpotLightShadowFactorSoft(pos, s.position);\nelse shadowAttenuation = CCGetSpotLightShadowFactorHard(pos, s.position);\nlightColor *= 1.0 - shadowAttenuation;\n}\n}\n#endif\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nfinalColor = finalColor * s.occlusion;\nreturn vec4(finalColor, 0.0);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if !CC_USE_HDR\ncolor.rgb = sqrt(ACESToneMap(color.rgb));\n#endif\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nin vec2 v_uv;\nuniform sampler2D cc_gbuffer_albedoMap;\nuniform sampler2D cc_gbuffer_positionMap;\nuniform sampler2D cc_gbuffer_normalMap;\nuniform sampler2D cc_gbuffer_emissiveMap;\nlayout(location = 0) out vec4 fragColor;\nvoid main () {\nStandardSurface s;\nvec4 albedoMap = texture(cc_gbuffer_albedoMap,v_uv);\nvec4 positionMap = texture(cc_gbuffer_positionMap,v_uv);\nvec4 normalMap = texture(cc_gbuffer_normalMap,v_uv);\nvec4 emissiveMap = texture(cc_gbuffer_emissiveMap,v_uv);\ns.albedo = albedoMap;\ns.position = positionMap.xyz;\ns.roughness = positionMap.w;\ns.normal = normalMap.xyz;\ns.metallic = normalMap.w;\ns.emissive = emissiveMap.xyz;\ns.occlusion = emissiveMap.w;\nfloat fogFactor;\n#if CC_USE_FOG == 0\nfogFactor = LinearFog(vec4(s.position, 1));\n#elif CC_USE_FOG == 1\nfogFactor = ExpFog(vec4(s.position, 1));\n#elif CC_USE_FOG == 2\nfogFactor = ExpSquaredFog(vec4(s.position, 1));\n#elif CC_USE_FOG == 3\nfogFactor = LayeredFog(vec4(s.position, 1));\n#else\nfogFactor = 1.0;\n#endif\nvec4 shadowPos;\nshadowPos = cc_matLightViewProj * vec4(s.position, 1);\nvec4 color = CCStandardShadingBase(s, shadowPos) +\nCCStandardShadingAdditive(s, shadowPos);\ncolor = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, fogFactor), color.a);\nfragColor = CCFragOutput(color);\n}"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\n#if USE_INSTANCING\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nlowp  vec4 cc_shadowNFLSInfo;\nlowp  vec4 cc_shadowWHPBInfo;\nlowp  vec4 cc_shadowLPNNInfo;\nlowp  vec4 cc_shadowColor;\n};\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(position);\n#endif\n#if CC_USE_SKINNING\nCCSkin(position);\n#endif\nmat4 matWorld;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\nposition = cc_matProj * (cc_matView * cc_matLightPlaneProj * matWorld) * position;\nposition.z -= 0.0001;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nlowp  vec4 cc_shadowNFLSInfo;\nlowp  vec4 cc_shadowWHPBInfo;\nlowp  vec4 cc_shadowLPNNInfo;\nlowp  vec4 cc_shadowColor;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nvec4 frag () {\nreturn CCFragOutput(cc_shadowColor);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nin vec2 v_uv;\nuniform sampler2D cc_lighting_resultMap;\nlayout(location = 0) out vec4 fragColor;\nvoid texcoords(vec2 fragCoord, vec2 resolution,\nout vec2 v_rgbNW, out vec2 v_rgbNE,\nout vec2 v_rgbSW, out vec2 v_rgbSE,\nout vec2 v_rgbM) {\nvec2 inverseVP = 1.0 / resolution.xy;\nv_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\nv_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\nv_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\nv_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\nv_rgbM = vec2(fragCoord * inverseVP);\n}\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\nvec2 v_rgbNW, vec2 v_rgbNE,\nvec2 v_rgbSW, vec2 v_rgbSE,\nvec2 v_rgbM) {\nvec4 color;\nmediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\nvec3 rgbNW = texture(tex, v_rgbNW).xyz;\nvec3 rgbNE = texture(tex, v_rgbNE).xyz;\nvec3 rgbSW = texture(tex, v_rgbSW).xyz;\nvec3 rgbSE = texture(tex, v_rgbSE).xyz;\nvec4 texColor = texture(tex, v_rgbM);\nvec3 rgbM  = texColor.xyz;\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat lumaNW = dot(rgbNW, luma);\nfloat lumaNE = dot(rgbNE, luma);\nfloat lumaSW = dot(rgbSW, luma);\nfloat lumaSE = dot(rgbSE, luma);\nfloat lumaM  = dot(rgbM,  luma);\nfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\nfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\nmediump vec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n(0.25 * (1.0 / 8.0)), (1.0/ 128.0));\nfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\ndir = min(vec2(8.0, 8.0),\nmax(vec2(-8.0, -8.0),\ndir * rcpDirMin)) * inverseVP;\nvec3 rgbA = 0.5 * (\ntexture(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\ntexture(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\nvec3 rgbB = rgbA * 0.5 + 0.25 * (\ntexture(tex, fragCoord * inverseVP + dir * -0.5).xyz +\ntexture(tex, fragCoord * inverseVP + dir * 0.5).xyz);\nfloat lumaB = dot(rgbB, luma);\nif ((lumaB < lumaMin) || (lumaB > lumaMax))\ncolor = vec4(rgbA, texColor.a);\nelse\ncolor = vec4(rgbB, texColor.a);\nreturn color;\n}\nvoid main () {\nmediump vec2 v_rgbNW;\nmediump vec2 v_rgbNE;\nmediump vec2 v_rgbSW;\nmediump vec2 v_rgbSE;\nmediump vec2 v_rgbM;\nvec2 resolution = cc_screenSize.xy;\nvec2 fragCoord = v_uv * resolution;\ntexcoords(fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\nfragColor = fxaa(cc_lighting_resultMap, fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\nout mediump vec4 viewDir;\nvec4 vert () {\nviewDir = vec4(a_position, 1.0);\nmat4 matViewRotOnly = mat4(mat3(cc_matView));\nmat4 matProj = cc_matProj;\nif (matProj[3].w > 0.0) {\nvec2 scale = vec2(48.0, 24.0);\nmatProj[0].xy *= scale;\nmatProj[1].xy *= scale;\nmatProj[2].zw = vec2(-1.0);\nmatProj[3].zw = vec2(0.0);\n}\nvec4 pos = matProj * matViewRotOnly * viewDir;\npos.z = 0.99999 * pos.w;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if !CC_USE_HDR\ncolor.rgb = sqrt(ACESToneMap(color.rgb));\n#endif\nreturn color;\n}\nin mediump vec4 viewDir;\nvec4 frag () {\n#if USE_RGBE_CUBEMAP\nvec3 c = unpackRGBE(texture(cc_environment, viewDir.xyz));\n#else\nvec3 c = SRGBToLinear(texture(cc_environment, viewDir.xyz).rgb);\n#endif\nreturn CCFragOutput(vec4(c * cc_ambientSky.w, 1.0));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nin vec3 a_position;\nin vec4 a_color;\nout vec2 v_uv;\nlayout(std140) uniform Constants {\nvec4 offset;\n};\nlayout(std140) uniform PerFrameInfo {\nvec4 digits[8 * 10 / 4];\n};\nfloat getComponent(vec4 v, float i) {\nif (i < 1.0) { return v.x; }\nelse if (i < 2.0) { return v.y; }\nelse if (i < 3.0) { return v.z; }\nelse { return v.w; }\n}\nvec4 vert () {\nvec4 position = cc_matViewProj * vec4(a_position, 1.0);\nposition.xy += offset.xy;\nv_uv = a_color.xy;\nif (a_color.z >= 0.0) {\nfloat n = getComponent(digits[int(a_color.z)], a_color.w);\nv_uv += vec2(offset.z * n, 0.0);\n}\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nin vec2 v_uv;\nuniform sampler2D mainTexture;\nvec4 frag () {\nreturn CCFragOutput(texture(mainTexture, v_uv));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nin vec2 a_position;\nin vec2 a_texCoord;\nout vec2 v_uv;\nout float v_percent;\nlayout(std140) uniform Constant {\nvec4 u_buffer0;\nvec4 u_buffer1;\nmat4 u_projection;\n};\nvec4 vert () {\nvec2 worldPos = a_position * u_buffer1.xy + u_buffer1.zw;\nvec2 clipSpace = worldPos / u_buffer0.xy * 2.0 - 1.0;\nvec4 screenPos = u_projection * vec4(clipSpace, 0.0, 1.0);\nv_uv = a_texCoord;\nv_percent = u_buffer0.z;\nreturn screenPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nin vec2 v_uv;\nin float v_percent;\nuniform sampler2D mainTexture;\nvec4 frag () {\nvec4 color = texture(mainTexture, v_uv);\nfloat precent = clamp(v_percent, 0.0, 1.0);\ncolor.xyz *= precent;\nreturn color;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}]]},dm=function(){function e(){this._device=null,this._resources={}}var t=e.prototype;return t.initBuiltinRes=function(e){var t=this;this._device=e;var n=this._resources,i=document.createElement("canvas"),o=i.getContext("2d"),r=new od(i),a=i.width=i.height=2;o.fillStyle="#000",o.fillRect(0,0,a,a);var s=new Mp;s._uuid="black-texture",s.image=r,n[s._uuid]=s,o.fillStyle="rgba(0,0,0,0)",o.fillRect(0,0,a,a);var l=new Mp;l._uuid="empty-texture",l.image=r,n[l._uuid]=l;var u=new Lp;u._uuid="black-cube-texture",u.setMipFilter(Lp.Filter.NEAREST),u.image={front:new od(i),back:new od(i),left:new od(i),right:new od(i),top:new od(i),bottom:new od(i)},n[u._uuid]=u,o.fillStyle="#777",o.fillRect(0,0,a,a);var h=new Mp;h._uuid="grey-texture",h.image=r,n[h._uuid]=h,o.fillStyle="#fff",o.fillRect(0,0,a,a);var _=new Mp;_._uuid="white-texture",_.image=r,n[_._uuid]=_;var f=new Lp;f._uuid="white-cube-texture",f.setMipFilter(Lp.Filter.NEAREST),f.image={front:new od(i),back:new od(i),left:new od(i),right:new od(i),top:new od(i),bottom:new od(i)},n[f._uuid]=f,o.fillStyle="#7f7fff",o.fillRect(0,0,a,a);var d=new Mp;d._uuid="normal-texture",d.image=r,n[d._uuid]=d,i.width=i.height=16,o.fillStyle="#ddd",o.fillRect(0,0,16,16),o.fillStyle="#555",o.fillRect(0,0,8,8),o.fillStyle="#555",o.fillRect(8,8,8,8);var p=new Mp;p._uuid="default-texture",p.image=r,n[p._uuid]=p;var m=new Lp;if(m.setMipFilter(Lp.Filter.NEAREST),m._uuid="default-cube-texture",m.image={front:new od(i),back:new od(i),left:new od(i),right:new od(i),top:new od(i),bottom:new od(i)},n[m._uuid]=m,c.SpriteFrame){var v=new c.SpriteFrame,g=r._texture;v.texture=g,v._uuid="default-spriteframe",n[v._uuid]=v}var y=cm(e);if(!y)return Promise.reject(Error("Failed to initialize builtin shaders: unknown device."));var x=fm[y];return x?Promise.resolve().then((function(){Hp.forEach((function(e,t){var n=Object.assign(new c.EffectAsset,e);n.shaders.forEach((function(e,n){var i=x[t][n];i&&(e[y]=i)})),n.hideInEditor=!0,n.onLoaded()})),t._initMaterials()})):Promise.reject(Error("Current device is requiring builtin shaders of version "+y+" but shaders of that version are not assembled in this build."))},t.get=function(e){return this._resources[e]},t._initMaterials=function(){var e=this._resources,t=[],n=new c.Material;n._uuid="standard-material",n.initialize({effectName:"standard"}),e[n._uuid]=n,t.push(n);var i=new c.Material;i._uuid="missing-effect-material",i.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),i.setProperty("mainColor",c.color("#ffff00")),e[i._uuid]=i,t.push(i);var o=new c.Material;o._uuid="missing-material",o.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),o.setProperty("mainColor",c.color("#ff00ff")),e[o._uuid]=o,t.push(o);var r=new c.Material;r._uuid="default-clear-stencil",r.initialize({defines:{USE_TEXTURE:!1},effectName:"clear-stencil"}),e[r._uuid]=r,t.push(r);var a=new c.Material;a._uuid="ui-base-material",a.initialize({defines:{USE_TEXTURE:!1},effectName:"sprite"}),e[a._uuid]=a,t.push(a);var s=new c.Material;s._uuid="ui-sprite-material",s.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),e[s._uuid]=s,t.push(s);var l=new c.Material;l._uuid="ui-alpha-test-material",l.initialize({defines:{USE_TEXTURE:!0,USE_ALPHA_TEST:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),e[l._uuid]=l,t.push(l);var u=new c.Material;u._uuid="ui-sprite-gray-material",u.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!0},effectName:"sprite"}),e[u._uuid]=u,t.push(u);var h=new c.Material;h._uuid="ui-sprite-alpha-sep-material",h.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!1},effectName:"sprite"}),e[h._uuid]=h,t.push(h);var _=new c.Material;_._uuid="ui-sprite-gray-alpha-sep-material",_.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!0},effectName:"sprite"}),e[_._uuid]=_,t.push(_);var f=new c.Material;f._uuid="ui-graphics-material",f.initialize({effectName:"graphics"}),e[f._uuid]=f,t.push(f);var d=new c.Material;d._uuid="default-particle-material",d.initialize({effectName:"particle"}),e[d._uuid]=d,t.push(d);var p=new c.Material;p._uuid="default-particle-gpu-material",p.initialize({effectName:"particle-gpu"}),e[p._uuid]=p,t.push(p);var m=new c.Material;m._uuid="default-trail-material",m.initialize({effectName:"particle-trail"}),e[m._uuid]=m,t.push(m);var v=new c.Material;v._uuid="default-billboard-material",v.initialize({effectName:"billboard"}),e[v._uuid]=v,t.push(v);var g=new c.Material;g._uuid="default-spine-material",g.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"spine"}),e[g._uuid]=g,t.push(g);var y=new c.Material;y._uuid="builtin-deferred-material",y.initialize({effectName:"deferred-lighting"}),e[y._uuid]=y,t.push(y);var x=new c.Material;x._uuid="builtin-post-process-material",x.initialize({effectName:"post-process"}),e[x._uuid]=x,t.push(x),c.game.on(c.Game.EVENT_GAME_INITED,(function(){for(var e=0;e<t.length;++e)for(var n=t[e],i=0;i<n.passes.length;++i)n.passes[i].tryCompile()}))},e}(),pm=e("c4",c.builtinResMgr=new dm),mm=e("fL",(um=new Map,hm=0,function(e){return"number"==typeof e?e:(um.has(e)||(um.set(e,1<<hm),hm++),um.get(e))})),vm=new Rs(za.UNIFORM|za.TRANSFER_DST,Ha.HOST|Ha.DEVICE),gm=new Ns(null),ym=new rc(null);!function(e){e[e.INSTANCING=1]="INSTANCING",e[e.VB_MERGING=2]="VB_MERGING"}(_m||(_m={}));var xm=e("dr",function(){function e(e){this._rootBuffer=null,this._rootBufferDirty=!1,this._buffers=[],this._descriptorSet=null,this._priority=Xu.DEFAULT,this._hash=0,this._pipelineLayout=null,this._primitiveMode=is.TRIANGLE_LIST,this._dynamicStates=ss.NONE,this._stage=Yu.DEFAULT,this._phase=mm("default"),this._batchingSchemes=0,this._passIndex=0,this._propertyIndex=0,this._programName="",this._dynamics={},this._propertyHandleMap={},this._rootBlock=null,this._blocks=[],this._shaderInfo=null,this._defines={},this._properties={},this._root=void 0,this._device=void 0,this._hShaderDefault=No,this._handle=No,this._bs=new kc,this._dss=new Hc,this._rs=new Uc,this._root=e,this._device=e.device}e.fillPipelineInfo=function(e,t){void 0!==t.priority&&(e.priority=t.priority),void 0!==t.primitive&&(e.primitive=t.primitive),void 0!==t.stage&&(e.stage=t.stage),void 0!==t.dynamicStates&&(e.dynamicStates=t.dynamicStates),void 0!==t.phase&&(e.phase=mm(t.phase));var n=e._bs;if(t.blendState){var i=t.blendState,o=i.targets;o&&o.forEach((function(e,t){n.setTarget(t,e)})),void 0!==i.isA2C&&(n.isA2C=i.isA2C),void 0!==i.isIndepend&&(n.isIndepend=i.isIndepend),void 0!==i.blendColor&&(n.blendColor=i.blendColor)}e._rs.assign(t.rasterizerState),e._dss.assign(t.depthStencilState)},e.getPassHash=function(e,t){var n,i=t+","+e.primitive+","+e.dynamicStates;return i+=function(e){for(var t,n=",bs,"+e.isA2C,i=le(e.targets);!(t=i()).done;){var o=t.value;n+=",bt,"+o.blend+","+o.blendEq+","+o.blendAlphaEq+","+o.blendColorMask,n+=","+o.blendSrc+","+o.blendDst+","+o.blendSrcAlpha+","+o.blendDstAlpha}return n}(e._bs),i+=function(e){var t=",dss,"+e.depthTest+","+e.depthWrite+","+e.depthFunc;return t+=","+e.stencilTestFront+","+e.stencilFuncFront+","+e.stencilRefFront+","+e.stencilReadMaskFront,t+=","+e.stencilFailOpFront+","+e.stencilZFailOpFront+","+e.stencilPassOpFront+","+e.stencilWriteMaskFront,(t+=","+e.stencilTestBack+","+e.stencilFuncBack+","+e.stencilRefBack+","+e.stencilReadMaskBack)+","+e.stencilFailOpBack+","+e.stencilZFailOpBack+","+e.stencilPassOpBack+","+e.stencilWriteMaskBack}(e._dss),Mc(i+=",rs,"+(n=e._rs).cullMode+","+n.depthBias+","+n.isFrontFaceCCW,666)};var t=e.prototype;return t.initialize=function(e){this._doInit(e),this.resetUBOs(),this.resetTextures(),this.tryCompile()},t.getHandle=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=Fa.UNKNOWN);var i=this._propertyHandleMap[e];return i?(n?i=Qp(i,n):t&&(i=Qp(i,Yp(i)-t)),i+t):0},t.getBinding=function(t){var n=this.getHandle(t);return n?e.getBindingFromHandle(n):-1},t.setUniform=function(t,n){var i=e.getBindingFromHandle(t),o=e.getTypeFromHandle(t),r=e.getOffsetFromHandle(t),a=this._blocks[i];Jp[o](a,n,r),this._rootBufferDirty=!0},t.getUniform=function(t,n){var i=e.getBindingFromHandle(t),o=e.getTypeFromHandle(t),r=e.getOffsetFromHandle(t),a=this._blocks[i];return Zp[o](a,n,r)},t.setUniformArray=function(t,n){for(var i=e.getBindingFromHandle(t),o=e.getTypeFromHandle(t),r=Cc(o)>>2,a=this._blocks[i],s=e.getOffsetFromHandle(t),c=0;c<n.length;c++,s+=r)null!==n[c]&&Jp[o](a,n[c],s);this._rootBufferDirty=!0},t.bindTexture=function(e,t,n){this._descriptorSet.bindTexture(e,t,n||0)},t.bindSampler=function(e,t,n){this._descriptorSet.bindSampler(e,t,n||0)},t.setDynamicState=function(e,t){var n=this._dynamics[e];n&&n.value===t||(n.value=t,n.dirty=!0)},t.overridePipelineStates=function(){console.warn("base pass cannot override states, please use pass instance instead.")},t.update=function(){this._descriptorSet?(this._rootBuffer&&this._rootBufferDirty&&(this._rootBuffer.update(this._rootBlock),this._rootBufferDirty=!1),this._descriptorSet.update()):N(12006)},t.destroy=function(){for(var e=0;e<this._shaderInfo.blocks.length;e++){var t=this._shaderInfo.blocks[e];this._buffers[t.binding].destroy()}this._buffers=[],this._rootBuffer&&(this._rootBuffer.destroy(),this._rootBuffer=null),this._descriptorSet=null,this._rs.destroy(),this._dss.destroy(),this._bs.destroy(),this._handle&&(Do.free(Xo.get(this._handle,Ro.DESCRIPTOR_SET)),Xo.free(this._handle),this._handle=No)},t.resetUniform=function(t){var n=this.getHandle(t);if(n){var i=e.getTypeFromHandle(n),o=e.getBindingFromHandle(n),r=e.getOffsetFromHandle(n),a=this._blocks[o],s=this._properties[t],c=s&&s.value||em(i);Jp[i](a,c,r),this._rootBufferDirty=!0}},t.resetTexture=function(t,n){var i=this.getHandle(t);if(i){var o=e.getTypeFromHandle(i),r=e.getBindingFromHandle(i),a=this._properties[t],s=a&&a.value,c=s?s+"-texture":em(o),l=pm.get(c),u=l&&l.getGFXTexture(),h=a&&void 0!==a.samplerHash?a.samplerHash:l&&l.getSamplerHash(),_=Td.getSampler(this._device,h);this._descriptorSet.bindSampler(r,_,n),this._descriptorSet.bindTexture(r,u,n)}},t.resetUBOs=function(){for(var e=0;e<this._shaderInfo.blocks.length;e++)for(var t=this._shaderInfo.blocks[e],n=this._blocks[t.binding],i=0,o=0;o<t.members.length;o++){for(var r=t.members[o],a=this._properties[r.name],s=a&&a.value||em(r.type),c=(Cc(r.type)>>2)*r.count,l=0;l+s.length<=c;l+=s.length)n.set(s,i+l);i+=c}this._rootBufferDirty=!0},t.resetTextures=function(){for(var e=0;e<this._shaderInfo.samplerTextures.length;e++)for(var t=this._shaderInfo.samplerTextures[e],n=0;n<t.count;n++)this.resetTexture(t.name,n)},t.tryCompile=function(){var t=this._root.pipeline;return!!t&&(this._syncBatchingScheme(),this._hShaderDefault=lm.getGFXShader(this._device,this._programName,this._defines,t),this._hShaderDefault?(this.pipelineLayoutHandle=lm.getTemplateInfo(this._programName).hPipelineLayout,this.hash=e.getPassHash(this,this._hShaderDefault),!0):(console.warn("create shader "+this._programName+" failed"),!1))},t.getShaderVariant=function(e){if(void 0===e&&(e=null),!this._hShaderDefault&&!this.tryCompile())return console.warn("pass resources incomplete"),No;if(!e)return this._hShaderDefault;for(var t=this._root.pipeline,n=0;n<e.length;n++){var i=e[n];this._defines[i.name]=i.value}for(var o=lm.getGFXShader(this._device,this._programName,this._defines,t),r=0;r<e.length;r++){var a=e[r];delete this._defines[a.name]}return o},t.beginChangeStatesSilently=function(){},t.endChangeStatesSilently=function(){},t._doInit=function(t,n){void 0===n&&(n=!1),this._handle=Xo.alloc(),this.priority=Xu.DEFAULT,this.stage=Yu.DEFAULT,this.phase=mm("default"),this.primitive=is.TRIANGLE_LIST,this.rasterizerState=this._rs,this.depthStencilState=this._dss,this.blendState=this._bs,this._passIndex=t.passIndex,this._propertyIndex=void 0!==t.propertyIndex?t.propertyIndex:t.passIndex,this._programName=t.program,this._defines=n?ne({},t.defines):t.defines,this._shaderInfo=lm.getTemplate(t.program),this._properties=t.properties||this._properties;var i=this._device;e.fillPipelineInfo(this,t),t.stateOverrides&&e.fillPipelineInfo(this,t.stateOverrides),ym.layout=lm.getDescriptorSetLayout(this._device,t.program),this.descriptorSetHandle=Do.alloc(this._device,ym);for(var o=this._shaderInfo.blocks,r=lm.getTemplateInfo(t.program),a=r.blockSizes,s=r.handleMap,c=i.capabilities.uboOffsetAlignment,l=[],u=0,h=0,_=0;_<o.length;_++){var f=a[_];l.push(h),h+=Math.ceil(f/c)*c,u=f}var d=l[l.length-1]+u;d&&(vm.size=16*Math.ceil(d/16),this._rootBuffer=i.createBuffer(vm),this._rootBlock=new ArrayBuffer(d));for(var p=0,m=0;p<o.length;p++){var v=o[p].binding,g=a[p];gm.buffer=this._rootBuffer,gm.offset=l[m++],gm.range=16*Math.ceil(g/16);var y=this._buffers[v]=i.createBuffer(gm);this._blocks[v]=new Float32Array(this._rootBlock,gm.offset,g/Float32Array.BYTES_PER_ELEMENT),this._descriptorSet.bindBuffer(v,y)}var x=this._propertyHandleMap=s,S={};for(var E in this._properties){var T=this._properties[E];T.handleInfo&&(S[E]=this.getHandle.apply(this,T.handleInfo))}Object.assign(x,S)},t._syncBatchingScheme=function(){this._defines.USE_INSTANCING?this._device.hasFeature(Da.INSTANCED_ARRAYS)?this.batchingScheme=_m.INSTANCING:(this._defines.USE_INSTANCING=!1,this.batchingScheme=0):this._defines.USE_BATCHING?this.batchingScheme=_m.VB_MERGING:this.batchingScheme=0},t._destroyHandle=function(){this._handle&&(Xo.free(this._handle),this._handle=No)},t._initPassFromTarget=function(e,t,n,i){this._passIndex=e.passIndex,this._propertyIndex=e.propertyIndex,this._programName=e.program,this._defines=e.defines,this._shaderInfo=e._shaderInfo,this._properties=e._properties,this._hShaderDefault=e._hShaderDefault,this._blocks=e._blocks,this._dynamics=e._dynamics,this.priority=e.priority,this.stage=e.stage,this.phase=e.phase,this.batchingScheme=e.batchingScheme,this.primitive=e.primitive,this.dynamicStates=e.dynamicStates,this.hash=e.hash^i,this.rasterizerState=e.rasterizerState,this.blendState=n,this.depthStencilState=t,this.pipelineLayoutHandle=lm.getTemplateInfo(this._programName).hPipelineLayout,this.descriptorSetHandle=Xo.get(e.handle,Ro.DESCRIPTOR_SET)},te(e,[{key:"root",get:function(){return this._root}},{key:"device",get:function(){return this._device}},{key:"shaderInfo",get:function(){return this._shaderInfo}},{key:"localSetLayout",get:function(){return lm.getDescriptorSetLayout(this._device,this._programName,!0)}},{key:"program",get:function(){return this._programName}},{key:"properties",get:function(){return this._properties}},{key:"defines",get:function(){return this._defines}},{key:"passIndex",get:function(){return this._passIndex}},{key:"propertyIndex",get:function(){return this._propertyIndex}},{key:"dynamics",get:function(){return this._dynamics}},{key:"blocks",get:function(){return this._blocks}},{key:"rootBufferDirty",get:function(){return this._rootBufferDirty}},{key:"handle",get:function(){return this._handle}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e,Xo.set(this._handle,Ro.PRIORITY,e)}},{key:"primitive",get:function(){return this._primitiveMode},set:function(e){this._primitiveMode=e,Xo.set(this._handle,Ro.PRIMITIVE,e)}},{key:"stage",get:function(){return this._stage},set:function(e){this._stage=e,Xo.set(this._handle,Ro.STAGE,e)}},{key:"phase",get:function(){return this._phase},set:function(e){this._phase=e,Xo.set(this._handle,Ro.PHASE,e)}},{key:"dynamicStates",get:function(){return this._dynamicStates},set:function(e){this._dynamicStates=e,Xo.set(this._handle,Ro.DYNAMIC_STATES,e)}},{key:"batchingScheme",get:function(){return this._batchingSchemes},set:function(e){this._batchingSchemes=e,Xo.set(this._handle,Ro.BATCHING_SCHEME,e)}},{key:"hash",get:function(){return this._hash},set:function(e){this._hash=e,Xo.set(this._handle,Ro.HASH,e)}},{key:"pipelineLayoutHandle",set:function(e){this._pipelineLayout=Lo.get(e),Xo.set(this._handle,Ro.PIPELINE_LAYOUT,e)}},{key:"pipelineLayout",get:function(){return this._pipelineLayout}},{key:"descriptorSetHandle",set:function(e){this._descriptorSet=Do.get(e),Xo.set(this._handle,Ro.DESCRIPTOR_SET,e)}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"rasterizerState",get:function(){return this._rs},set:function(e){this._rs=e,Xo.set(this._handle,Ro.RASTERIZER_STATE,e.handle)}},{key:"depthStencilState",get:function(){return this._dss},set:function(e){this._dss=e,Xo.set(this._handle,Ro.DEPTH_STENCIL_STATE,e.handle)}},{key:"blendState",get:function(){return this._bs},set:function(e){this._bs=e,Xo.set(this._handle,Ro.BLEND_STATE,e.handle)}}]),e}());xm.PropertyType=Up,xm.getPropertyTypeFromHandle=qp,xm.getTypeFromHandle=Yp,xm.getBindingFromHandle=Xp,xm.getOffsetFromHandle=Kp,Y(R_.prototype,"RenderScene.prototype",[{name:"raycastUI2DNode"},{name:"raycastUINode"}]),Y(R_.prototype,"RenderScene.prototype",[{name:"raycastAll",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllModels",suggest:"using intersect.rayModel in geometry"},{name:"raycastSingleModel",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllCanvas",suggest:"using intersect.rayAABB in geometry"},{name:"rayResultCanvas"},{name:"rayResultModels"},{name:"rayResultAll"},{name:"rayResultSingleModel"}]);var Sm={};Y(Sm,"CameraVisFlags",[{name:"GENERAL"}]),q(Sm,"CameraVisFlags",[{name:"PROFILER",newName:"PROFILER",target:qu.BitMask,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:qu.BitMask,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:qu.BitMask,targetName:"EDITOR"},{name:"UI",newName:"UI",target:qu.BitMask,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:qu.BitMask,targetName:"UI_2D"}]),c.CameraVisFlags=Sm;var Em,Tm={};function Am(e,t){t<1e3?t=1e3:t>15e3&&(t=15e3);var n=t*t,i=(.860117757+.000154118254*t+1.28641212e-7*n)/(1+.000842420235*t+7.08145163e-7*n),o=(.317398726+422806245e-13*t+4.20481691e-8*n)/(1-289741816e-13*t+1.61456053e-7*n),r=2*i-8*o+4,a=3*i/r,s=2*o/r,c=1/s*a,l=1/s*(1-a-s);e.x=3.2404542*c-1.5371385+-.4985314*l,e.y=-.969266*c+1.8760108+.041556*l,e.z=.0556434*c-.2040259+1.0572252*l}Y(Tm,"VisibilityFlags",[{name:"GENERAL"}]),q(Tm,"VisibilityFlags",[{name:"ALWALS",newName:"ALWALS",target:qu.Enum,targetName:"ALWALS"},{name:"PROFILER",newName:"PROFILER",target:qu.Enum,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:qu.Enum,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:qu.Enum,targetName:"EDITOR"},{name:"UI",newName:"UI",target:qu.Enum,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:qu.Enum,targetName:"UI_2D"}]),c.VisibilityFlags=Tm,q(xm.prototype,"Pass.prototype",[{name:"getBindingTypeFromHandle",newName:"getDescriptorTypeFromHandle"}]),Y(P_.prototype,"Camera.prototype",[{name:"getSplitFrustum"}]),function(e){e[e.DIRECTIONAL=0]="DIRECTIONAL",e[e.SPHERE=1]="SPHERE",e[e.SPOT=2]="SPOT",e[e.UNKNOWN=3]="UNKNOWN"}(Em||(Em=e("ci",{})));var Cm=e("cr",(function(e){return 4*Math.PI*Math.PI*e*e})),wm=e("cl",function(){function e(){this._baked=!1,this._color=new Rn(1,1,1),this._colorTemp=6550,this._colorTempRGB=new Rn(1,1,1),this._scene=null,this._node=null,this._name=null,this._handle=No}var t=e.prototype;return t.initialize=function(){this._handle=kr.alloc(),kr.setVec3(this._handle,zr.COLOR,this._color),kr.setVec3(this._handle,zr.COLOR_TEMPERATURE_RGB,this._colorTempRGB),kr.set(this._handle,zr.TYPE,Em.UNKNOWN)},t.attachToScene=function(e){this._scene=e},t.detachFromScene=function(){this._scene=null},t.destroy=function(){this._name=null,this._node=null,this._handle&&(kr.free(this._handle),this._handle=No)},t.update=function(){},te(e,[{key:"baked",get:function(){return this._baked},set:function(e){this._baked=e}},{key:"color",get:function(){return this._color},set:function(e){this._color.set(e),kr.setVec3(this._handle,zr.COLOR,e)}},{key:"useColorTemperature",get:function(){return 1===kr.get(this._handle,zr.USE_COLOR_TEMPERATURE)},set:function(e){kr.set(this._handle,zr.USE_COLOR_TEMPERATURE,e?1:0)}},{key:"colorTemperature",get:function(){return this._colorTemp},set:function(e){this._colorTemp=e,Am(this._colorTempRGB,this._colorTemp),kr.setVec3(this._handle,zr.COLOR_TEMPERATURE_RGB,this._colorTempRGB)}},{key:"colorTemperatureRGB",get:function(){return this._colorTempRGB}},{key:"node",get:function(){return this._node},set:function(e){this._node=e,this._node&&(this._node.hasChangedFlags|=x_.ROTATION,kr.set(this._handle,zr.NODE,this._node.handle))}},{key:"type",get:function(){return kr.get(this._handle,zr.TYPE)}},{key:"name",get:function(){return this._name},set:function(e){this._name=e}},{key:"scene",get:function(){return this._scene}},{key:"handle",get:function(){return this._handle}}]),e}()),bm=new Rn(0,0,-1),Im=new Rn,Pm=e("cp",function(e){function t(){var t;return(t=e.call(this)||this)._dir=new Rn(1,-1,-1),t}ie(t,e);var n=t.prototype;return n.initialize=function(){e.prototype.initialize.call(this),kr.set(this._handle,zr.ILLUMINANCE,ca.SUN_ILLUM),kr.setVec3(this._handle,zr.DIRECTION,this._dir),kr.set(this._handle,zr.TYPE,Em.DIRECTIONAL)},n.update=function(){this._node&&this._node.hasChangedFlags&&(this.direction=Rn.transformQuat(Im,bm,this._node.worldRotation))},te(t,[{key:"direction",get:function(){return this._dir},set:function(e){Rn.normalize(this._dir,e),kr.setVec3(this._handle,zr.DIRECTION,this._dir)}},{key:"illuminance",get:function(){return kr.get(this._handle,zr.ILLUMINANCE)},set:function(e){kr.set(this._handle,zr.ILLUMINANCE,e)}}]),t}(wm));function Rm(e,t){for(var n,i=le(t);!(n=i()).done;){var o=n.value;Array.isArray(o)?Rm(e,o):e.push(o)}}function Nm(e){var t=[];return Rm(t,e),t.join("")}var Om=fi.Flags.Destroyed,Dm=fi.Flags.PersistentMask,Mm=tn.IDENTIFIER_RE,Lm="var ",Fm="o",zm={"cc.ClickEvent":!1,"cc.PrefabInfo":!1},Bm=tn.escapeForJS,Um=function(){function e(e,t){this.varName=void 0,this.expression=void 0,this.varName=e,this.expression=t}return e.prototype.toString=function(){return Lm+this.varName+"="+this.expression+";"},e}();function Hm(e,t){return t instanceof Um?new Um(t.varName,e+t.expression):e+t}function Gm(e,t,n){Array.isArray(n)?(n[0]=Hm(t,n[0]),e.push(n)):e.push(Hm(t,n)+";")}var km=function(){function e(e){this._exps=void 0,this._targetExp=void 0,this._exps=[],this._targetExp=e}var t=e.prototype;return t.append=function(e,t){this._exps.push([e,t])},t.writeCode=function(e){var t;if(this._exps.length>1)e.push("t="+this._targetExp+";"),t="t";else{if(1!==this._exps.length)return;t=this._targetExp}for(var n=0;n<this._exps.length;n++){var i=this._exps[n];Gm(e,t+Vm(i[0])+"=",i[1])}},e}();function Vm(e){return Mm.test(e)?"."+e:"["+Bm(e)+"]"}km.pool=void 0,km.pool=new ot((function(e){e._exps.length=0,e._targetExp=null}),1),km.pool.get=function(e){var t=this._get()||new km;return t._targetExp=e,t};var Wm=function(){function e(e,t){var n;this.parent=void 0,this.objsToClear_iN$t=void 0,this.codeArray=void 0,this.objs=void 0,this.funcs=void 0,this.funcModuleCache=void 0,this.globalVariables=void 0,this.globalVariableId=void 0,this.localVariableId=void 0,this.result=void 0,this.parent=t,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=Re(),Ge(this.funcModuleCache,zm),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push("var o,t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(e.constructor,!0)+"();","}"),e._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(e),this.enumerateObject(this.codeArray,e),this.globalVariables.length>0&&(n=Lm+this.globalVariables.join(",")+";");var i=Nm(["return (function(R){",n||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",i)(this.objs,this.funcs);for(var o=0,r=this.objsToClear_iN$t.length;o<r;++o)this.objsToClear_iN$t[o]._iN$t=null;this.objsToClear_iN$t.length=0}var t=e.prototype;return t.getFuncModule=function(e,t){var n=Ne(e);if(n){var i=this.funcModuleCache[n];if(i)return i;if(void 0===i){var o=-1!==n.indexOf(".");if(o)try{if(o=e===Function("return "+n)())return this.funcModuleCache[n]=n,n}catch(e){}}}var r=this.funcs.indexOf(e);r<0&&(r=this.funcs.length,this.funcs.push(e));var a="F["+r+"]";return t&&(a="("+a+")"),this.funcModuleCache[n]=a,a},t.getObjRef=function(e){var t=this.objs.indexOf(e);return t<0&&(t=this.objs.length,this.objs.push(e)),"O["+t+"]"},t.setValueType=function(e,t,n,i){var o=km.pool.get(i),r=t.constructor.__props__;r||(r=Object.keys(t));for(var a=0;a<r.length;a++){var s=r[a],c=n[s];if(t[s]!==c){var l=this.enumerateField(n,s,c);o.append(s,l)}}o.writeCode(e),km.pool.put(o)},t.enumerateCCClass=function(e,t,n){for(var i=n.__values__,o=Ot(n),r=0;r<i.length;r++){var a=i[r],s=t[a],l=o[a+"$_$default"];if(!jm(l,s))if("object"==typeof s&&s instanceof c.ValueType&&(l=tn.getDefault(l))&&l.constructor===s.constructor){var u=Fm+Vm(a);this.setValueType(e,l,s,u)}else this.setObjProp(e,t,a,s)}},t.instantiateArray=function(e){if(0===e.length)return"[]";var t="a"+ ++this.localVariableId,n=[new Um(t,"new Array("+e.length+")")];e._iN$t={globalVar:"",source:n},this.objsToClear_iN$t.push(e);for(var i=0;i<e.length;++i)Gm(n,t+"["+i+"]=",this.enumerateField(e,i,e[i]));return n},t.instantiateTypedArray=function(e){var t=e.constructor.name;if(0===e.length)return"new "+t;var n="a"+ ++this.localVariableId,i=[new Um(n,"new "+t+"("+e.length+")")];e._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(e);for(var o=0;o<e.length;++o)0!==e[o]&&Gm(i,n+"["+o+"]=",e[o]);return i},t.enumerateField=function(e,t,n){if("object"==typeof n&&n){var i=n._iN$t;if(i){var o=i.globalVar;if(!o){o=i.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(o);var r=i.source[0];i.source[0]=Hm(o+"=",r)}return o}return ArrayBuffer.isView(n)?this.instantiateTypedArray(n):Array.isArray(n)?this.instantiateArray(n):this.instantiateObj(n)}return"function"==typeof n?this.getFuncModule(n):"string"==typeof n?Bm(n):("_objFlags"===t&&e instanceof fi&&(n&=Dm),n)},t.setObjProp=function(e,t,n,i){Gm(e,Fm+Vm(n)+"=",this.enumerateField(t,n,i))},t.enumerateObject=function(e,t){var n=t.constructor;if(c.Class._isCCClass(n))this.enumerateCCClass(e,t,n);else for(var i in t)if(t.hasOwnProperty(i)&&(95!==i.charCodeAt(0)||95!==i.charCodeAt(1)||"__type__"===i)){var o=t[i];"object"==typeof o&&o&&o===t._iN$t||this.setObjProp(e,t,i,o)}},t.instantiateObj=function(e){if(e instanceof c.ValueType)return tn.getNewValueTypeCode(e);if(e instanceof c.Asset)return this.getObjRef(e);if(e._objFlags&Om)return null;var t,n=e.constructor;if(c.Class._isCCClass(n)){if(this.parent)if(this.parent instanceof c.Component){if(e instanceof c._BaseNode||e instanceof c.Component)return this.getObjRef(e)}else if(this.parent instanceof c._BaseNode)if(e instanceof c._BaseNode){if(!e.isChildOf(this.parent))return this.getObjRef(e)}else if(e instanceof c.Component&&!e.node.isChildOf(this.parent))return this.getObjRef(e);t=new Um(Fm,"new "+this.getFuncModule(n,!0)+"()")}else if(n===Object)t=new Um(Fm,"{}");else{if(n)return this.getObjRef(e);t=new Um(Fm,"Object.create(null)")}var i=[t];return e._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(e),this.enumerateObject(i,e),["(function(){",i,"return o;})();"]},e}();function jm(e,t){if("function"==typeof e)try{e=e()}catch(e){return!1}if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t&&e.constructor===t.constructor)if(e instanceof c.ValueType){if(e.equals(t))return!0}else{if(Array.isArray(e))return 0===e.length&&0===t.length;if(e.constructor===Object)return Ae(e)&&Ae(t)}return!1}var qm,Ym=function(){function e(e){this._uiComp=null,this.opacity=1,this.localOpacity=1,this._uiTransformComp=null,this._node=void 0,this.uiTransformDirty=!0,this._node=e}return te(e,[{key:"uiTransformComp",get:function(){return this._uiTransformComp||(this._uiTransformComp=this._node.getComponent("cc.UITransform")),this._uiTransformComp},set:function(e){this._uiTransformComp=e}},{key:"uiComp",get:function(){return this._uiComp},set:function(e){this._uiComp&&e?P(12002):this._uiComp=e}}]),e}();!function(e){e.TOUCH_START="touch-start",e.TOUCH_MOVE="touch-move",e.TOUCH_END="touch-end",e.TOUCH_CANCEL="touch-cancel",e.MOUSE_DOWN="mouse-down",e.MOUSE_MOVE="mouse-move",e.MOUSE_UP="mouse-up",e.MOUSE_WHEEL="mouse-wheel",e.MOUSE_ENTER="mouse-enter",e.MOUSE_LEAVE="mouse-leave",e.KEY_DOWN="keydown",e.KEY_UP="keyup",e.DEVICEMOTION="devicemotion",e.TRANSFORM_CHANGED="transform-changed",e.SCENE_CHANGED_FOR_PERSISTS="scene-changed-for-persists",e.SIZE_CHANGED="size-changed",e.ANCHOR_CHANGED="anchor-changed",e.COLOR_CHANGED="color-changed",e.CHILD_ADDED="child-added",e.CHILD_REMOVED="child-removed",e.PARENT_CHANGED="parent-changed",e.NODE_DESTROYED="node-destroyed",e.LAYER_CHANGED="layer-changed",e.SIBLING_ORDER_CHANGED="sibling-order-changed"}(qm||(qm=e("d0",{}))),ht(qm),c.SystemEventType=qm;var Xm=function(){function e(e,t,n){this._cameraPriority=0,this.owner=null,this.mask=null,this._previousIn=!1,this._target=null,this._onEvent=void 0,this._type=void 0,this._listenerID=void 0,this._registered=!1,this._fixedPriority=0,this._node=null,this._paused=!0,this._isEnabled=!0,this._onEvent=n,this._type=e||0,this._listenerID=t||""}e.create=function(e){M(e&&e.event,1900);var t=e.event;delete e.event;var n=null;if(t===c.EventListener.TOUCH_ONE_BY_ONE?n=new Zm:t===c.EventListener.TOUCH_ALL_AT_ONCE?n=new Jm:t===c.EventListener.MOUSE?n=new Qm:t===c.EventListener.KEYBOARD?n=new ev:t===c.EventListener.ACCELERATION&&(n=new $m(e.callback),delete e.callback),n)for(var i=0,o=Object.keys(e);i<o.length;i++){var r=o[i];n[r]=e[r]}return n};var t=e.prototype;return t._setPaused=function(e){this._paused=e},t._isPaused=function(){return this._paused},t._setRegistered=function(e){this._registered=e},t._isRegistered=function(){return this._registered},t._getType=function(){return this._type},t._getListenerID=function(){return this._listenerID},t._setFixedPriority=function(e){this._fixedPriority=e},t._getFixedPriority=function(){return this._fixedPriority},t._setSceneGraphPriority=function(e){this._target=e,this._node=e},t._getSceneGraphPriority=function(){return this._node},t.checkAvailable=function(){return null!==this._onEvent},t.clone=function(){return null},t.setEnabled=function(e){this._isEnabled=e},t.isEnabled=function(){return this._isEnabled},te(e,[{key:"onEvent",get:function(){return this._onEvent}}]),e}();Xm.UNKNOWN=0,Xm.TOUCH_ONE_BY_ONE=1,Xm.TOUCH_ALL_AT_ONCE=2,Xm.KEYBOARD=3,Xm.MOUSE=4,Xm.ACCELERATION=6,Xm.CUSTOM=8,Xm.ListenerID={MOUSE:"__cc_mouse",TOUCH_ONE_BY_ONE:"__cc_touch_one_by_one",TOUCH_ALL_AT_ONCE:"__cc_touch_all_at_once",KEYBOARD:"__cc_keyboard",ACCELERATION:"__cc_acceleration"};var Km=Xm.ListenerID,Qm=function(e){function t(){var t;return(t=e.call(this,Xm.MOUSE,Km.MOUSE,null)||this).onMouseDown=null,t.onMouseUp=null,t.onMouseMove=null,t.onMouseScroll=null,t._onEvent=function(e){return t._callback(e)},t}ie(t,e);var n=t.prototype;return n._callback=function(e){switch(e.eventType){case qm.MOUSE_DOWN:this.onMouseDown&&this.onMouseDown(e);break;case qm.MOUSE_UP:this.onMouseUp&&this.onMouseUp(e);break;case qm.MOUSE_MOVE:this.onMouseMove&&this.onMouseMove(e);break;case qm.MOUSE_WHEEL:this.onMouseScroll&&this.onMouseScroll(e)}},n.clone=function(){var e=new t;return e.onMouseDown=this.onMouseDown,e.onMouseUp=this.onMouseUp,e.onMouseMove=this.onMouseMove,e.onMouseScroll=this.onMouseScroll,e},n.checkAvailable=function(){return!0},t}(Xm),Zm=function(e){function t(){var t;return(t=e.call(this,Xm.TOUCH_ONE_BY_ONE,Km.TOUCH_ONE_BY_ONE,null)||this).swallowTouches=!1,t.onTouchBegan=null,t.onTouchMoved=null,t.onTouchEnded=null,t.onTouchCancelled=null,t._claimedTouches=[],t}ie(t,e);var n=t.prototype;return n.setSwallowTouches=function(e){this.swallowTouches=e},n.isSwallowTouches=function(){return this.swallowTouches},n.clone=function(){var e=new t;return e.onTouchBegan=this.onTouchBegan,e.onTouchMoved=this.onTouchMoved,e.onTouchEnded=this.onTouchEnded,e.onTouchCancelled=this.onTouchCancelled,e.swallowTouches=this.swallowTouches,e},n.checkAvailable=function(){return!!this.onTouchBegan||(b(1801),!1)},t}(Xm),Jm=function(e){function t(){var t;return(t=e.call(this,Xm.TOUCH_ALL_AT_ONCE,Km.TOUCH_ALL_AT_ONCE,null)||this).onTouchesBegan=null,t.onTouchesMoved=null,t.onTouchesEnded=null,t.onTouchesCancelled=null,t}ie(t,e);var n=t.prototype;return n.clone=function(){var e=new t;return e.onTouchesBegan=this.onTouchesBegan,e.onTouchesMoved=this.onTouchesMoved,e.onTouchesEnded=this.onTouchesEnded,e.onTouchesCancelled=this.onTouchesCancelled,e},n.checkAvailable=function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(b(1802),!1)},t}(Xm),$m=function(e){function t(t){var n;return(n=e.call(this,Xm.ACCELERATION,Km.ACCELERATION,null)||this)._onAccelerationEvent=null,n._onEvent=function(e){return n._callback(e)},n._onAccelerationEvent=t,n}ie(t,e);var n=t.prototype;return n._callback=function(e){this._onAccelerationEvent&&this._onAccelerationEvent(e.acc,e)},n.checkAvailable=function(){return M(this._onAccelerationEvent,1803),!0},n.clone=function(){return new t(this._onAccelerationEvent)},t}(Xm),ev=function(e){function t(){var t;return(t=e.call(this,Xm.KEYBOARD,Km.KEYBOARD,null)||this).onKeyPressed=null,t.onKeyReleased=null,t._onEvent=function(e){return t._callback(e)},t}ie(t,e);var n=t.prototype;return n._callback=function(e){e.isPressed?this.onKeyPressed&&this.onKeyPressed(e.keyCode,e):this.onKeyReleased&&this.onKeyReleased(e.keyCode,e)},n.clone=function(){var e=new t;return e.onKeyPressed=this.onKeyPressed,e.onKeyReleased=this.onKeyReleased,e},n.checkAvailable=function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(b(1800),!1)},t}(Xm);c.EventListener=Xm;var tv=Xm.ListenerID,nv=function(){function e(){this.gt0Index=0,this._fixedListeners=[],this._sceneGraphListeners=[]}var t=e.prototype;return t.size=function(){return this._fixedListeners.length+this._sceneGraphListeners.length},t.empty=function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},t.push=function(e){0===e._getFixedPriority()?this._sceneGraphListeners.push(e):this._fixedListeners.push(e)},t.clearSceneGraphListeners=function(){this._sceneGraphListeners.length=0},t.clearFixedListeners=function(){this._fixedListeners.length=0},t.clear=function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},t.getFixedPriorityListeners=function(){return this._fixedListeners},t.getSceneGraphPriorityListeners=function(){return this._sceneGraphListeners},e}(),iv=function(){function e(){this._listenersMap={},this._priorityDirtyFlagMap={},this._nodeListenersMap={},this._toAddedListeners=[],this._toRemovedListeners=[],this._dirtyListeners={},this._inDispatch=0,this._isEnabled=!1,this._internalCustomListenerIDs=[],this._currentTouch=null,this._currentTouchListener=null}var t=e.prototype;return t.pauseTarget=function(e,t){if(void 0===t&&(t=!1),e instanceof c._BaseNode){var n=this._nodeListenersMap[e.uuid];if(n)for(var i=0;i<n.length;++i)n[i]._setPaused(!0);if(!0===t){var o=e.children;if(o)for(var r=0;r<o.length;++r){var a=o[r];this.pauseTarget(a,!0)}}}else P(3506)},t.resumeTarget=function(e,t){if(void 0===t&&(t=!1),e instanceof c._BaseNode){var n=this._nodeListenersMap[e.uuid];if(n)for(var i=0;i<n.length;++i)n[i]._setPaused(!1);if(this._setDirtyForNode(e),!0===t&&e.children.length>0){var o=e.children;if(o)for(var r=0;r<o.length;++r){var a=o[r];this.resumeTarget(a,!0)}}}else P(3506)},t.frameUpdateListeners=function(){var e=this._listenersMap,t=this._priorityDirtyFlagMap;for(var n in e)e[n].empty()&&(delete t[n],delete e[n]);var i=this._toAddedListeners;if(0!==i.length){for(var o=0,r=i.length;o<r;o++)this._forceAddEventListener(i[o]);i.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()},t.hasEventListener=function(e){return!!this._getListeners(e)},t.addListener=function(e,t){if(M(e&&t,3503),!(c.js.isNumber(t)||t instanceof c._BaseNode))return P(3506),null;if(e instanceof c.EventListener){if(e._isRegistered())return b(3505),null}else M(!c.js.isNumber(t),3504),e=c.EventListener.create(e);if(!e.checkAvailable())return null;if(c.js.isNumber(t)){if(0===t)return b(3500),null;e._setSceneGraphPriority(null),e._setFixedPriority(t),e._setRegistered(!0),e._setPaused(!1),this._addListener(e)}else{if(!(n=t)||!n.getComponent("cc.UITransform"))return b(3512),null;e._setSceneGraphPriority(t),e._setFixedPriority(0),e._setRegistered(!0),this._addListener(e)}var n;return e},t.addCustomListener=function(e,t){var n=Xm.create({event:c.EventListener.CUSTOM,eventName:e,callback:t});return this.addListener(n,1),n},t.removeListener=function(e){if(null!=e){var t=!1,n=this._listenersMap;for(var i in e===this._currentTouchListener&&(this._currentTouchListener=this._currentTouch=null),n){var o=n[i],r=o.getFixedPriorityListeners(),a=o.getSceneGraphPriorityListeners();if((t=this._removeListenerInVector(a,e))?this._setDirty(e._getListenerID(),2):(t=this._removeListenerInVector(r,e))&&this._setDirty(e._getListenerID(),1),o.empty()&&(delete this._priorityDirtyFlagMap[e._getListenerID()],delete n[i]),t)break}if(!t)for(var s=this._toAddedListeners,l=s.length-1;l>=0;l--){var u=s[l];if(u===e){c.js.array.removeAt(s,l),u._setRegistered(!1);break}}}},t.removeListeners=function(e,t){if(void 0===t&&(t=!1),c.js.isNumber(e)||e instanceof c._BaseNode)if(void 0!==e._id){var n=this._nodeListenersMap[e._id];if(n){for(var i=c.js.array.copy(n),o=0;o<i.length;++o){var r=i[o];this.removeListener(r)}delete this._nodeListenersMap[e._id]}for(var a=this._toAddedListeners,s=0;s<a.length;){var l=a[s];l._getSceneGraphPriority()===e?(l._setSceneGraphPriority(null),l._setRegistered(!1),a.splice(s,1)):++s}if(!0===t)for(var u=e.getChildren(),h=0;h<u.length;++h){var _=u[h];this.removeListeners(_,!0)}}else e===c.EventListener.TOUCH_ONE_BY_ONE?this._removeListenersForListenerID(tv.TOUCH_ONE_BY_ONE):e===c.EventListener.TOUCH_ALL_AT_ONCE?this._removeListenersForListenerID(tv.TOUCH_ALL_AT_ONCE):e===c.EventListener.MOUSE?this._removeListenersForListenerID(tv.MOUSE):e===c.EventListener.ACCELERATION?this._removeListenersForListenerID(tv.ACCELERATION):e===c.EventListener.KEYBOARD?this._removeListenersForListenerID(tv.KEYBOARD):b(3501);else P(3506)},t.removeCustomListeners=function(e){this._removeListenersForListenerID(e)},t.removeAllListeners=function(){var e=this._listenersMap,t=this._internalCustomListenerIDs;for(var n in e)-1===t.indexOf(n)&&this._removeListenersForListenerID(n)},t.setPriority=function(e,t){if(null!=e){var n=this._listenersMap;for(var i in n){var o=n[i].getFixedPriorityListeners();if(o&&-1!==o.indexOf(e))return null!=e._getSceneGraphPriority()&&b(3502),void(e._getFixedPriority()!==t&&(e._setFixedPriority(t),this._setDirty(e._getListenerID(),1)))}}},t.setEnabled=function(e){this._isEnabled=e},t.isEnabled=function(){return this._isEnabled},t.dispatchEvent=function(e){if(this._isEnabled)if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,e&&e.getType){if(e.getType().startsWith(c.Event.TOUCH))return this._dispatchTouchEvent(e),void this._inDispatch--;var t=function(e){var t=qf,n=e.type;return n===t.ACCELERATION?tv.ACCELERATION:n===t.KEYBOARD?tv.KEYBOARD:n.startsWith(t.MOUSE)?tv.MOUSE:(n.startsWith(t.TOUCH)&&b(2e3),"")}(e);this._sortEventListeners(t);var n=this._listenersMap[t];null!=n&&(this._dispatchEventToListeners(n,this._onListenerCallback,e),this._onUpdateListeners(n)),this._inDispatch--}else N(3511)},t._onListenerCallback=function(e,t){t.currentTarget=e._target;var n=e.onEvent;return n&&n(t),t.isStopped()},t.dispatchCustomEvent=function(e,t){var n=new c.Event.EventCustom(e);n.setUserData(t),this.dispatchEvent(n)},t._setDirtyForNode=function(e){var t=this._nodeListenersMap[e._id];if(void 0!==t)for(var n=0,i=t.length;n<i;n++){var o=t[n]._getListenerID();this._dirtyListeners[o]||(this._dirtyListeners[o]=!0)}if(e.children.length>0)for(var r=e.children,a=0,s=r?r.length:0;a<s;a++)this._setDirtyForNode(r[a])},t._addListener=function(e){0===this._inDispatch?this._forceAddEventListener(e):this._toAddedListeners.push(e)},t._forceAddEventListener=function(e){var t=e._getListenerID(),n=this._listenersMap[t];if(n||(n=new nv,this._listenersMap[t]=n),n.push(e),0===e._getFixedPriority()){this._setDirty(t,2);var i=e._getSceneGraphPriority();null===i&&b(3507),this._associateNodeAndEventListener(i,e),i.activeInHierarchy&&this.resumeTarget(i)}else this._setDirty(t,1)},t._getListeners=function(e){return this._listenersMap[e]},t._updateDirtyFlagForSceneGraph=function(){var e=this._dirtyListeners;for(var t in e)this._setDirty(t,2),e[t]=!1},t._removeAllListenersInVector=function(e){if(e)for(var t,n=e.length-1;n>=0;n--)(t=e[n])._setRegistered(!1),null!=t._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(t._getSceneGraphPriority(),t),t._setSceneGraphPriority(null)),0===this._inDispatch&&c.js.array.removeAt(e,n)},t._removeListenersForListenerID=function(e){var t=this._listenersMap[e];if(t){var n=t.getFixedPriorityListeners(),i=t.getSceneGraphPriorityListeners();this._removeAllListenersInVector(i),this._removeAllListenersInVector(n),delete this._priorityDirtyFlagMap[e],this._inDispatch||(t.clear(),delete this._listenersMap[e])}for(var o=this._toAddedListeners,r=o.length-1;r>=0;r--){var a=o[r];a&&a._getListenerID()===e&&c.js.array.removeAt(o,r)}},t._sortEventListeners=function(e){var t=0,n=this._priorityDirtyFlagMap;n[e]&&(t=n[e]),0!==t&&(n[e]=0,1&t&&this._sortListenersOfFixedPriority(e),2&t&&c.director.getScene()&&this._sortListenersOfSceneGraphPriority(e))},t._sortListenersOfSceneGraphPriority=function(e){var t=this._getListeners(e);if(t){var n=t.getSceneGraphPriorityListeners();if(n&&0!==n.length){var i=t.getSceneGraphPriorityListeners();i.forEach((function(e){var t=e._getSceneGraphPriority()._uiProps.uiTransformComp;e._cameraPriority=t.cameraPriority})),i.sort(this._sortEventListenersOfSceneGraphPriorityDes)}}},t._sortEventListenersOfSceneGraphPriorityDes=function(e,t){var n=e._getSceneGraphPriority(),i=t._getSceneGraphPriority();if(!(t&&i&&i._activeInHierarchy&&i._uiProps.uiTransformComp))return-1;if(!(e&&n&&n._activeInHierarchy&&n._uiProps.uiTransformComp))return 1;var o=n,r=i,a=!1;if(e._cameraPriority!==t._cameraPriority)return t._cameraPriority-e._cameraPriority;for(;o.parent._id!==r.parent._id;)o=null===o.parent.parent?(a=!0)&&i:o.parent,r=null===r.parent.parent?(a=!0)&&n:r.parent;if(o._id===r._id){if(o._id===i._id)return-1;if(o._id===n._id)return 1}var s=o.getSiblingIndex(),c=r.getSiblingIndex();return a?s-c:c-s},t._sortListenersOfFixedPriority=function(e){var t=this._listenersMap[e];if(t){var n=t.getFixedPriorityListeners();if(n&&0!==n.length){n.sort(this._sortListenersOfFixedPriorityAsc);for(var i=0,o=n.length;i<o&&!(n[i]._getFixedPriority()>=0);)++i;t.gt0Index=i}}},t._sortListenersOfFixedPriorityAsc=function(e,t){return e._getFixedPriority()-t._getFixedPriority()},t._onUpdateListeners=function(e){var t=e.getFixedPriorityListeners(),n=e.getSceneGraphPriorityListeners(),i=this._toRemovedListeners;if(n)for(var o=n.length-1;o>=0;o--){var r=n[o];if(!r._isRegistered()){c.js.array.removeAt(n,o);var a=i.indexOf(r);-1!==a&&i.splice(a,1)}}if(t)for(var s=t.length-1;s>=0;s--){var l=t[s];if(!l._isRegistered()){c.js.array.removeAt(t,s);var u=i.indexOf(l);-1!==u&&i.splice(u,1)}}n&&0===n.length&&e.clearSceneGraphListeners(),t&&0===t.length&&e.clearFixedListeners()},t._updateTouchListeners=function(){var e=this._inDispatch;if(M(e>0,3508),!(e>1)){var t;(t=this._listenersMap[tv.TOUCH_ONE_BY_ONE])&&this._onUpdateListeners(t),(t=this._listenersMap[tv.TOUCH_ALL_AT_ONCE])&&this._onUpdateListeners(t),M(1===e,3509);var n=this._toAddedListeners;if(0!==n.length){for(var i=0,o=n.length;i<o;i++)this._forceAddEventListener(n[i]);this._toAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},t._cleanToRemovedListeners=function(){for(var e=this._toRemovedListeners,t=0;t<e.length;++t){var n=e[t],i=this._listenersMap[n._getListenerID()];if(i){var o=i.getFixedPriorityListeners(),r=i.getSceneGraphPriorityListeners();if(r){var a=r.indexOf(n);-1!==a&&r.splice(a,1)}if(o){var s=o.indexOf(n);-1!==s&&o.splice(s,1)}}}e.length=0},t._onTouchEventCallback=function(e,t){if(!e._isRegistered())return!1;var n=t.event,i=n.touch;n.currentTarget=e._getSceneGraphPriority();var o=!1,r=-1,a=n.getEventCode();if(a===qm.TOUCH_START){if(!ft.ENABLE_MULTI_TOUCH&&ov._currentTouch){var s=ov._currentTouchListener._node;if(!s||s.activeInHierarchy)return!1}e.onTouchBegan&&(o=e.onTouchBegan(i,n))&&e._isRegistered()&&!e._isPaused()&&(e._claimedTouches.push(i),!ft.ENABLE_MULTI_TOUCH&&ov._currentTouch||(ov._currentTouch=i),ov._currentTouchListener=e)}else if(e._claimedTouches.length>0&&-1!==(r=e._claimedTouches.indexOf(i))){if(o=!0,!ft.ENABLE_MULTI_TOUCH&&ov._currentTouch&&ov._currentTouch!==i)return!1;a===qm.TOUCH_MOVE&&e.onTouchMoved?e.onTouchMoved(i,n):a===qm.TOUCH_END?(e.onTouchEnded&&e.onTouchEnded(i,n),e._isRegistered()&&e._claimedTouches.splice(r,1),(ft.ENABLE_MULTI_TOUCH||ov._currentTouch===i)&&(ov._currentTouch=null),ov._currentTouchListener=null):a===qm.TOUCH_CANCEL&&(e.onTouchCancelled&&e.onTouchCancelled(i,n),e._isRegistered()&&e._claimedTouches.splice(r,1),(ft.ENABLE_MULTI_TOUCH||ov._currentTouch===i)&&(ov._currentTouch=null),ov._currentTouchListener=null)}return n.isStopped()?(ov._updateTouchListeners(n),!0):!!(o&&e._isRegistered()&&e.swallowTouches)&&(t.needsMutableSet&&t.touches.splice(i,1),!0)},t._dispatchTouchEvent=function(e){this._sortEventListeners(tv.TOUCH_ONE_BY_ONE),this._sortEventListeners(tv.TOUCH_ALL_AT_ONCE);var t=this._getListeners(tv.TOUCH_ONE_BY_ONE),n=this._getListeners(tv.TOUCH_ALL_AT_ONCE);if(null!==t||null!==n){var i=e.getTouches(),o=c.js.array.copy(i),r={event:e,needsMutableSet:t&&n,touches:o,selTouch:null};if(t)for(var a=0;a<i.length;++a){var s=i[a];e.touch=s,e.propagationStopped=e.propagationImmediateStopped=!1,this._dispatchEventToListeners(t,this._onTouchEventCallback,r)}n&&o.length>0&&(this._dispatchEventToListeners(n,this._onTouchesEventCallback,{event:e,touches:o}),e.isStopped())||this._updateTouchListeners(e)}},t._onTouchesEventCallback=function(e,t){if(!e._isRegistered())return!1;var n=t.event,i=t.touches,o=n.getEventCode();return n.currentTarget=e._getSceneGraphPriority(),o===qm.TOUCH_START&&e.onTouchesBegan?e.onTouchesBegan(i,n):o===qm.TOUCH_MOVE&&e.onTouchesMoved?e.onTouchesMoved(i,n):o===qm.TOUCH_END&&e.onTouchesEnded?e.onTouchesEnded(i,n):o===qm.TOUCH_CANCEL&&e.onTouchesCancelled&&e.onTouchesCancelled(i,n),!!n.isStopped()&&(ov._updateTouchListeners(n),!0)},t._associateNodeAndEventListener=function(e,t){var n=this._nodeListenersMap[e.uuid];n||(n=[],this._nodeListenersMap[e.uuid]=n),n.push(t)},t._dissociateNodeAndEventListener=function(e,t){var n=this._nodeListenersMap[e.uuid];n&&(c.js.array.remove(n,t),0===n.length&&delete this._nodeListenersMap[e.uuid])},t._dispatchEventToListeners=function(e,t,n){var i=!1,o=e.getFixedPriorityListeners(),r=e.getSceneGraphPriorityListeners(),a=0;if(o&&0!==o.length)for(;a<e.gt0Index;++a){var s=o[a];if(s.isEnabled()&&!s._isPaused()&&s._isRegistered()&&t(s,n)){i=!0;break}}if(r&&!i)for(var c=0;c<r.length;++c){var l=r[c];if(l.isEnabled()&&!l._isPaused()&&l._isRegistered()&&t(l,n)){i=!0;break}}if(o&&!i)for(;a<o.length;++a){var u=o[a];if(u.isEnabled()&&!u._isPaused()&&u._isRegistered()&&t(u,n)){i=!0;break}}},t._setDirty=function(e,t){var n=this._priorityDirtyFlagMap;null==n[e]?n[e]=t:n[e]|=t},t._sortNumberAsc=function(e,t){return e-t},t._removeListenerInCallback=function(e,t){if(null==e)return!1;for(var n=e.length-1;n>=0;n--){var i=e[n];if(i._onCustomEvent===t||i.onEvent===t)return i._setRegistered(!1),null!=i._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(i._getSceneGraphPriority(),i),i._setSceneGraphPriority(null)),0===this._inDispatch?c.js.array.removeAt(e,n):this._toRemovedListeners.push(i),!0}return!1},t._removeListenerInVector=function(e,t){if(null==e)return!1;for(var n=e.length-1;n>=0;n--){var i=e[n];if(i===t)return i._setRegistered(!1),null!=i._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(i._getSceneGraphPriority(),i),i._setSceneGraphPriority(null)),0===this._inDispatch?c.js.array.removeAt(e,n):this._toRemovedListeners.push(i),!0}return!1},e}(),ov=e("fm",new iv);c.eventManager=ov,fi.Flags.Destroying;var rv,av,sv,cv,lv,uv,hv,_v,fv,dv=fi.Flags.Destroying,pv=fi.Flags.DontDestroy,mv=fi.Flags.Deactivating,vv=new ge("Node");function gv(e){return e?"string"==typeof e?nt(e):e:(N(3804),null)}var yv=e("fS",U_("cc.BaseNode")((fv=_v=function(e){ie(n,e),n._setScene=function(e){e._updateScene()},n._findComponent=function(e,t){var n=t,i=e._components;if(n._sealed)for(var o=0;o<i.length;++o){var r=i[o];if(r.constructor===t)return r}else for(var a=0;a<i.length;++a){var s=i[a];if(s instanceof t)return s}return null},n._findComponents=function(e,t,n){var i=t,o=e._components;if(i._sealed)for(var r=0;r<o.length;++r){var a=o[r];a.constructor===t&&n.push(a)}else for(var s=0;s<o.length;++s){var c=o[s];c instanceof t&&n.push(c)}},n._findChildComponent=function(e,t){for(var i=0;i<e.length;++i){var o=e[i],r=n._findComponent(o,t);if(r)return r;if(o._children.length>0&&(r=n._findChildComponent(o._children,t)))return r}return null},n._findChildComponents=function(e,t,i){for(var o=0;o<e.length;++o){var r=e[o];n._findComponents(r,t,i),r._children.length>0&&n._findChildComponents(r._children,t,i)}};var t=n.prototype;function n(t){var n;return ue(n=e.call(this,t)||this,"_parent",sv,se(n)),ue(n,"_children",cv,se(n)),ue(n,"_active",lv,se(n)),ue(n,"_components",uv,se(n)),ue(n,"_prefab",hv,se(n)),n._scene=null,n._activeInHierarchy=!1,n._id=vv.getNewId(),n._name=void 0,n._eventProcessor=new c.NodeEventProcessor(se(n)),n._eventMask=0,n._siblingIndex=0,n._originalSceneId="",n._registerIfAttached=void 0,n._name=void 0!==t?t:"New Node",n}return t._updateScene=function(){null==this._parent?x("Node %s(%s) has not attached to a scene.",this.name,this.uuid):this._scene=this._parent._scene},t.attr=function(e){Ge(this,e)},t.getParent=function(){return this._parent},t.setParent=function(e,t){if(void 0===t&&(t=!1),this._parent!==e){var n=this._parent,i=e;if(this._parent=i,this._siblingIndex=0,this._onSetParent(n,t),this.emit&&this.emit(qm.PARENT_CHANGED,n),n&&!(n._objFlags&dv)){var o=n._children.indexOf(this);n._children.splice(o,1),n._updateSiblingIndex(),n.emit&&n.emit(qm.CHILD_REMOVED,this)}i&&(i._children.push(this),this._siblingIndex=i._children.length-1,i.emit&&i.emit(qm.CHILD_ADDED,this)),this._onHierarchyChanged(n)}},t.getChildByUuid=function(e){if(!e)return g("Invalid uuid"),null;for(var t=this._children,n=0,i=t.length;n<i;n++)if(t[n]._id===e)return t[n];return null},t.getChildByName=function(e){if(!e)return g("Invalid name"),null;for(var t=this._children,n=0,i=t.length;n<i;n++)if(t[n]._name===e)return t[n];return null},t.getChildByPath=function(e){for(var t=e.split("/"),n=this,i=function(e){var i=t[e];if(0===i.length)return"continue";var o=n.children.find((function(e){return e.name===i}));if(!o)return{v:null};n=o},o=0;o<t.length;++o){var r=i(o);if("continue"!==r&&"object"==typeof r)return r.v}return n},t.addChild=function(e){e.setParent(this)},t.insertChild=function(e,t){e.parent=this,e.setSiblingIndex(t)},t.getSiblingIndex=function(){return this._siblingIndex},t.setSiblingIndex=function(e){if(this._parent)if(this._parent._objFlags&mv)N(3821);else{var t=this._parent._children;e=-1!==e?e:t.length-1;var n=t.indexOf(this);e!==n&&(t.splice(n,1),e<t.length?t.splice(e,0,this):t.push(this),this._parent._updateSiblingIndex(),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(e))}},t.walk=function(e,t){var i=1,o=null,r=null,a=0,s=n._stacks[n._stackId];s||(s=[],n._stacks.push(s)),n._stackId++,s.length=0,s[0]=this;for(var c=null,l=!1;i;)if(r=s[--i])if(!l&&e?e(r):l&&t&&t(r),s[i]=null,l){if(c===this._parent)break;if(l=!1,o)if(o[++a])s[i]=o[a],i++;else if(c&&(s[i]=c,i++,l=!0,c._parent?(a=(o=c._parent._children).indexOf(c),c=c._parent):(c=null,o=null),a<0))break}else r._children.length>0?(c=r,o=r._children,a=0,s[i]=o[a],i++):(s[i]=r,i++,l=!0);s.length=0,n._stackId--},t.removeFromParent=function(){this._parent&&this._parent.removeChild(this)},t.removeChild=function(e){this._children.indexOf(e)>-1&&(e.parent=null)},t.removeAllChildren=function(){for(var e=this._children,t=e.length-1;t>=0;t--){var n=e[t];n&&(n.parent=null)}this._children.length=0},t.isChildOf=function(e){var t=this;do{if(t===e)return!0;t=t._parent}while(t);return!1},t.getComponent=function(e){var t=gv(e);return t?n._findComponent(this,t):null},t.getComponents=function(e){var t=gv(e),i=[];return t&&n._findComponents(this,t,i),i},t.getComponentInChildren=function(e){var t=gv(e);return t?n._findChildComponent(this._children,t):null},t.getComponentsInChildren=function(e){var t=gv(e),i=[];return t&&(n._findComponents(this,t,i),n._findChildComponents(this._children,t,i)),i},t.addComponent=function(e){var t;if("string"==typeof e){if(!(t=nt(e)))throw c._RF.peek()&&N(3808,e),TypeError(L(3807,e))}else{if(!e)throw TypeError(L(3804));t=e}if("function"!=typeof t)throw TypeError(L(3809));if(!We(t,c.Component))throw TypeError(L(3810));var n=t._requireComponent;n&&!this.getComponent(n)&&this.addComponent(n);var i=new t;return i.node=this,this._components.push(i),this._activeInHierarchy&&c.director._nodeActivator.activateComp(i),i},t.removeComponent=function(e){if(e){var t=null;(t=e instanceof fp?e:this.getComponent(e))&&t.destroy()}else N(3813)},t.on=function(e,t,n,i){switch(void 0===i&&(i=!1),e){case qm.TRANSFORM_CHANGED:this._eventMask|=1}this._eventProcessor.on(e,t,n,i)},t.off=function(e,t,n,i){if(void 0===i&&(i=!1),this._eventProcessor.off(e,t,n,i),!this._eventProcessor.hasEventListener(e))switch(e){case qm.TRANSFORM_CHANGED:this._eventMask&=-2}},t.once=function(e,t,n,i){this._eventProcessor.once(e,t,n,i)},t.emit=function(e,t,n,i,o,r){this._eventProcessor.emit(e,t,n,i,o,r)},t.dispatchEvent=function(e){this._eventProcessor.dispatchEvent(e)},t.hasEventListener=function(e,t,n){return this._eventProcessor.hasEventListener(e,t,n)},t.targetOff=function(e){this._eventProcessor.targetOff(e),1&this._eventMask&&!this._eventProcessor.hasEventListener(qm.TRANSFORM_CHANGED)&&(this._eventMask&=-2)},t.destroy=function(){return!!e.prototype.destroy.call(this)&&(this.active=!1,!0)},t.destroyAllChildren=function(){for(var e=this._children,t=0;t<e.length;++t)e[t].destroy()},t._removeComponent=function(e){if(e){if(!(this._objFlags&dv)){var t=this._components.indexOf(e);-1!==t?this._components.splice(t,1):e.node!==this&&N(3815)}}else N(3814)},t._updateSiblingIndex=function(){for(var e=0;e<this._children.length;++e)this._children[e]._siblingIndex=e;this.emit(qm.SIBLING_ORDER_CHANGED)},t._onSetParent=function(e){this._parent&&(null!=e&&e._scene===this._parent._scene||null==this._parent._scene||this.walk(n._setScene))},t._onPostActivated=function(){},t._onBatchCreated=function(){this._parent&&(this._siblingIndex=this._parent.children.indexOf(this))},t._onPreDestroy=function(){this._onPreDestroyBase()},t._onHierarchyChanged=function(e){return this._onHierarchyChangedBase(e)},t._instantiate=function(e,t){return e||(e=c.instantiate._clone(this,this)),e._prefab,e._parent=null,e._onBatchCreated(t),e},t._onHierarchyChangedBase=function(){var e=this._parent;!this._persistNode||e instanceof c.Scene||c.game.removePersistRootNode(this);var t=this._active&&!(!e||!e._activeInHierarchy);this._activeInHierarchy!==t&&c.director._nodeActivator.activateNode(this,t)},t._onPreDestroyBase=function(){this._objFlags|=dv;var e=this._parent,t=!!e&&0!=(e._objFlags&dv);if(!t&&i&&this._registerIfAttached(!1),this._persistNode&&c.game.removePersistRootNode(this),!t&&e){this.emit(qm.PARENT_CHANGED,this);var n=e._children.indexOf(this);e._children.splice(n,1),this._siblingIndex=0,e._updateSiblingIndex(),e.emit&&e.emit(qm.CHILD_REMOVED,this)}this.emit(qm.NODE_DESTROYED,this),this._eventProcessor.destroy();for(var o=this._children,r=0;r<o.length;++r)o[r]._destroyImmediate();for(var a=this._components,s=0;s<a.length;++s)a[s]._destroyImmediate();return t},te(n,[{key:"components",get:function(){return this._components}},{key:"_persistNode",get:function(){return(this._objFlags&pv)>0},set:function(e){e?this._objFlags|=pv:this._objFlags&=~pv}},{key:"name",get:function(){return this._name},set:function(e){this._name=e}},{key:"uuid",get:function(){return this._id}},{key:"children",get:function(){return this._children}},{key:"active",get:function(){return this._active},set:function(e){if(this._active!==e){this._active=e;var t=this._parent;t&&t._activeInHierarchy&&c.director._nodeActivator.activateNode(this,e)}}},{key:"activeInHierarchy",get:function(){return this._activeInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(e){this.setParent(e)}},{key:"scene",get:function(){return this._scene}},{key:"eventProcessor",get:function(){return this._eventProcessor}}]),n}(fi),_v.idGenerator=vv,_v._stacks=[[]],_v._stackId=0,he((av=fv).prototype,"_persistNode",[V_],Object.getOwnPropertyDescriptor(av.prototype,"_persistNode"),av.prototype),he(av.prototype,"name",[$_],Object.getOwnPropertyDescriptor(av.prototype,"name"),av.prototype),he(av.prototype,"children",[$_],Object.getOwnPropertyDescriptor(av.prototype,"children"),av.prototype),he(av.prototype,"active",[$_],Object.getOwnPropertyDescriptor(av.prototype,"active"),av.prototype),he(av.prototype,"activeInHierarchy",[$_],Object.getOwnPropertyDescriptor(av.prototype,"activeInHierarchy"),av.prototype),he(av.prototype,"parent",[$_],Object.getOwnPropertyDescriptor(av.prototype,"parent"),av.prototype),sv=he(av.prototype,"_parent",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cv=he(av.prototype,"_children",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lv=he(av.prototype,"_active",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),uv=he(av.prototype,"_components",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),hv=he(av.prototype,"_prefab",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rv=av))||rv);c._BaseNode=yv;var xv=Object.freeze({__proto__:null,ccclass:U_,property:V_,requireComponent:H_,executionOrder:G_,disallowMultiple:k_,executeInEditMode:Y_,menu:X_,playOnFocus:K_,inspector:Q_,icon:Z_,help:J_,type:pf,integer:hf,float:_f,boolean:ff,string:df});e("f2",xv);var Sv,Ev,Tv,Av,Cv,wv,bv,Iv,Pv,Rv,Nv,Ov=fi.Flags.Destroyed,Dv=fi.Flags.PersistentMask,Mv=[];function Lv(e){var t;if(e instanceof fi){if(e._instantiate)return c.game._isCloning=!0,t=e._instantiate(null,!0),c.game._isCloning=!1,t;if(e instanceof c.Asset)throw new TypeError(L(6903))}return c.game._isCloning=!0,t=Fv(e),c.game._isCloning=!1,t}function Fv(e,t){var n;zv(e,n=e._iN$t?e._iN$t:e.constructor?new(0,e.constructor):Object.create(null),t);for(var i=0,o=Mv.length;i<o;++i)Mv[i]._iN$t=null;return Mv.length=0,n}function zv(e,t,n){at.value(e,"_iN$t",t,!0),Mv.push(e);var i=e.constructor;if(c.Class._isCCClass(i))!function(e,t,n,i){for(var o=e.__values__,r=0;r<o.length;r++){var a=o[r],s=t[a];if("object"==typeof s&&s){var c=n[a];c instanceof _t&&c.constructor===s.constructor?c.set(s):n[a]=s._iN$t||Bv(s,i)}else n[a]=s}}(i,e,t,n);else for(var o in e)if(e.hasOwnProperty(o)&&(95!==o.charCodeAt(0)||95!==o.charCodeAt(1)||"__type__"===o)){var r=e[o];if("object"==typeof r&&r){if(r===t)continue;t[o]=r._iN$t||Bv(r,n)}else t[o]=r}e instanceof fi&&(t._objFlags&=Dv)}function Bv(e,t){if(e instanceof _t)return e.clone();if(e instanceof c.Asset)return e;var n;if(ArrayBuffer.isView(e)){var i=e.length;n=new e.constructor(i),e._iN$t=n,Mv.push(e);for(var o=0;o<i;++o)n[o]=e[o];return n}if(Array.isArray(e)){var r=e.length;n=new Array(r),e._iN$t=n,Mv.push(e);for(var a=0;a<r;++a){var s=e[a];n[a]="object"==typeof s&&s?s._iN$t||Bv(s,t):s}return n}if(e._objFlags&Ov)return null;var l=e.constructor;if(c.Class._isCCClass(l)){if(t)if(t instanceof c.Component){if(e instanceof c._BaseNode||e instanceof c.Component)return e}else if(t instanceof c._BaseNode)if(e instanceof c._BaseNode){if(!e.isChildOf(t))return e}else if(e instanceof c.Component&&e.node&&!e.node.isChildOf(t))return e;n=new l}else if(l===Object)n={};else{if(l)return e;n=Object.create(null)}return zv(e,n,t),n}function Uv(e,t){return(t<<3)+e}Lv._clone=Fv,c.instantiate=Lv,function(e){e[e.Uint8=0]="Uint8",e[e.Uint16=1]="Uint16",e[e.Uint32=2]="Uint32",e[e.Int8=3]="Int8",e[e.Int16=4]="Int16",e[e.Int32=5]="Int32",e[e.Float32=6]="Float32",e[e.Float64=7]="Float64"}(Rv||(Rv={})),function(e){e[e.Scalar=0]="Scalar",e[e.Vec2=1]="Vec2",e[e.Vec3=2]="Vec3",e[e.Vec4=3]="Vec4",e[e.Quat=4]="Quat",e[e.Mat4=5]="Mat4"}(Nv||(Nv={}));var Hv=e("f6",U_("cc.CompactValueTypeArray")((Iv=bv=function(){function e(){ue(this,"_byteOffset",Tv,this),ue(this,"_unitCount",Av,this),ue(this,"_unitElement",Cv,this),ue(this,"_length",wv,this)}return e.lengthFor=function(e,t,n){return Gv(t).requiredUnits*e.length*kv(n).BYTES_PER_ELEMENT},e.compress=function(t,n,i,o,r,a){for(var s=Gv(n),c=kv(i),l=s.requiredUnits*t.length,u=new c(o,r,l),h=0;h<t.length;++h)s.compress(u,h,t[h]);var _=new e;return _._unitElement=Uv(i,n),_._byteOffset=a,_._unitCount=l,_._length=t.length,_},e.prototype.decompress=function(e){for(var t,n={storageUnit:7&(t=this._unitElement),elementType:t>>3},i=n.storageUnit,o=Gv(n.elementType),r=new(kv(i))(e,this._byteOffset,this._unitCount),a=new Array(this._length),s=0;s<this._length;++s)a[s]=o.decompress(r,s);return a},e}(),bv.StorageUnit=Rv,bv.ElementType=Nv,Tv=he((Ev=Iv).prototype,"_byteOffset",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Av=he(Ev.prototype,"_unitCount",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Cv=he(Ev.prototype,"_unitElement",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Uv(Rv.Uint8,Nv.Scalar)}}),wv=he(Ev.prototype,"_length",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Sv=Ev))||Sv);function Gv(e){return eg[e]}function kv(e){switch(e){case Rv.Uint8:return Uint8Array;case Rv.Uint16:return Uint16Array;case Rv.Uint32:return Uint32Array;case Rv.Int8:return Int8Array;case Rv.Int16:return Int16Array;case Rv.Int32:return Int32Array;case Rv.Float32:return Float32Array;case Rv.Float64:return Float64Array}}var Vv,Wv,jv,qv,Yv,Xv,Kv,Qv,Zv,Jv,$v,eg=((Pv={})[Nv.Scalar]={requiredUnits:1,compress:function(e,t,n){e[t]=n},decompress:function(e,t){return e[t]}},Pv[Nv.Vec2]={requiredUnits:2,compress:function(e,t,n){e[2*t]=n.x,e[2*t+1]=n.y},decompress:function(e,t){return new Rn(e[2*t],e[2*t+1])}},Pv[Nv.Vec3]={requiredUnits:3,compress:function(e,t,n){e[3*t]=n.x,e[3*t+1]=n.y,e[3*t+2]=n.z},decompress:function(e,t){return new Rn(e[3*t],e[3*t+1],e[3*t+2])}},Pv[Nv.Vec4]={requiredUnits:4,compress:function(e,t,n){e[4*t]=n.x,e[4*t+1]=n.y,e[4*t+2]=n.z,e[4*t+3]=n.w},decompress:function(e,t){return new $n(e[4*t],e[4*t+1],e[4*t+2],e[4*t+3])}},Pv[Nv.Quat]={requiredUnits:4,compress:function(e,t,n){e[4*t]=n.x,e[4*t+1]=n.y,e[4*t+2]=n.z,e[4*t+3]=n.w},decompress:function(e,t){return new zn(e[4*t],e[4*t+1],e[4*t+2],e[4*t+3])}},Pv[Nv.Mat4]={requiredUnits:16,compress:function(e,t,n){jn.toArray(e,n,16*t)},decompress:function(e,t){return jn.fromArray(new jn,e,16*t)}},Pv);function tg(e){var t=e._prefab;if(t&&t.instance){if(!t.asset)return N(3701,e.name),void(t.instance=void 0);var n=e._objFlags,i=e._parent,o=e._id,r=e._prefab;c.game._isCloning=!0,t.asset._doInstantiate(e),c.game._isCloning=!1,e._objFlags=n,e._parent=i,e._id=o,e._prefab&&(e._prefab.instance=null==r?void 0:r.instance)}}function ng(e,t,n){var i;if(t){var o=t,r=null===(i=e._prefab)||void 0===i?void 0:i.instance;!n&&r&&(t[r.fileId]={},o=t[r.fileId]);var a=e._prefab;a&&(o[a.fileId]=e);for(var s=e.components,c=0;c<s.length;c++){var l=s[c];l.__prefab&&(o[l.__prefab.fileId]=l)}for(var u=0;u<e.children.length;u++)ng(e.children[u],o,!1)}}function ig(e,t){if(!e)return null;for(var n=t,i=0;i<e.length;i++){if(!n)return null;n=n[e[i]]}return n}function og(e,t,n){if(t)for(var i=0;i<t.length;i++){var o=t[i];if(o&&o.targetInfo){var r=ig(o.targetInfo.localID,n);if(!r)continue;var a=n,s=o.targetInfo.localID;if(s.length>0)for(var c=0;c<s.length-1;c++)a=a[s[c]];if(o.nodes)for(var l=0;l<o.nodes.length;l++){var u=o.nodes[l];u&&(r._children.push(u),u._parent=r,ng(u,a,!1),u._siblingIndex=r._children.length-1,u._onBatchCreated(!1))}}}}function rg(e,t,n){if(t)for(var i=0;i<t.length;i++){var o=t[i];if(o&&o.targetInfo){var r=ig(o.targetInfo.localID,n);if(!r)continue;if(o.components)for(var a=0;a<o.components.length;a++){var s=o.components[a];s&&(s.node=r,r._components.push(s))}}}}function ag(e,t,n){if(t)for(var i=0;i<t.length;i++){var o=t[i];if(o){var r=ig(o.localID,n);if(!r||!r.node)continue;var a=r.node.components.indexOf(r);a>=0&&r.node._components.splice(a,1)}}}function sg(e,t,n){if(!(t.length<=0))for(var i=null,o=0;o<t.length;o++){var r=t[o];if(r&&r.targetInfo){if(!(i=ig(r.targetInfo.localID,n)))continue;var a=i,s=r.propertyPath.slice();if(s.length>0){var c=s.pop();if(!c)continue;for(var l=0;l<s.length&&(a=a[s[l]]);l++);if(!a)continue;if(Array.isArray(a))if("length"===c)a[c]=r.value;else{var u=Number.parseInt(c);Number.isInteger(u)&&u<a.length&&(a[c]=r.value)}else a[c]=r.value}}}}function cg(e){var t,n=null===(t=e._prefab)||void 0===t?void 0:t.targetOverrides;if(n)for(var i=0;i<n.length;i++){var o,r,a=n[i],s=a.source,c=a.sourceInfo;if(c){var l,u,h=null===(l=a.source)||void 0===l||null===(u=l._prefab)||void 0===u?void 0:u.instance;h&&h.targetMap&&(s=ig(c.localID,h.targetMap))}if(s){var _,f=a.targetInfo;if(f){var d=null===(o=a.target)||void 0===o||null===(r=o._prefab)||void 0===r?void 0:r.instance;if(d&&d.targetMap&&(_=ig(f.localID,d.targetMap))){var p=a.propertyPath.slice(),m=s;if(p.length>0){var v=p.pop();if(!v)return;for(var g=0;g<p.length&&(m=m[p[g]]);g++);if(!m)continue;m[v]=_}}}}}}c._decorator=xv;var lg=new Rn,ug=new zn,hg=new zn,_g=new zn,fg=new Mn,dg=new Mn,pg=new jn,mg=[],vg=function(){function e(){this._chunkHandles=[],this._chunks=[],this._freelists=[],this._createChunk()}var t=e.prototype;return t.alloc=function(){for(var e=this._freelists.length,t=0;t<e;++t)if(this._freelists[t].length)return this._createView(t);return this._createChunk(),this._createView(e)},t.free=function(e,t){for(var n=this._freelists.length,i=0;i<n;++i)if(this._chunks[i]===e)return void this._freelists[i].push(t)},t.clear=function(){for(var e=this._chunks.length,t=0;t<e;++t)this._chunks[t].fill(0)},t._createChunk=function(){var t=Wo.alloc(4*e.CAPACITY_PER_CHUNK);this._chunkHandles.push(t),this._chunks.push(new Uint32Array(Wo.getBuffer(t)));for(var n=[],i=0;i<e.CAPACITY_PER_CHUNK;++i)n.push(i);this._freelists.push(n)},t._createView=function(t){var n=this._chunks[t],i=this._freelists[t].pop(),o=this._chunkHandles[t];return[n,i,o+=i<<e.BIT_SHIFT]},e}();vg.CAPACITY_PER_CHUNK=256,vg.BIT_SHIFT=16;var gg,yg,xg,Sg,Eg,Tg,Ag,Cg,wg,bg,Ig,Pg,Rg,Ng,Og,Dg,Mg,Lg,Fg,zg,Bg,Ug,Hg,Gg,kg,Vg,Wg,jg,qg,Yg,Xg,Kg,Qg,Zg,Jg,$g,ey,ty,ny,iy,oy,ry,ay,sy,cy,ly,uy,hy,_y,fy,dy,py,my,vy,gy,yy,xy,Sy,Ey,Ty,Ay,Cy,wy,by,Iy,Py,Ry,Ny,Oy,Dy=new vg,My=e("cJ",(Vv=U_("cc.Node"),Wv=pf(Rn),Vv(($v=Jv=function(e){function t(t){var n;(n=e.call(this,t)||this)._uiProps=new Ym(se(n)),n._static=!1,n._pos=new Rn,n._rot=new zn,n._scale=new Rn(1,1,1),n._mat=new jn,ue(n,"_lpos",Yv,se(n)),ue(n,"_lrot",Xv,se(n)),ue(n,"_lscale",Kv,se(n)),ue(n,"_layer",Qv,se(n)),ue(n,"_euler",Zv,se(n)),n._dirtyFlags=x_.NONE,n._hasChangedFlagsChunk=void 0,n._hasChangedFlagsOffset=void 0,n._eulerDirty=!1,n._poolHandle=No,n._poolHandle=pr.alloc(),pr.set(n._poolHandle,ur.LAYER,n._layer);var i=Dy.alloc(),o=i[0],r=i[1],a=i[2];return n._hasChangedFlagsChunk=o,n._hasChangedFlagsOffset=r,pr.set(n._poolHandle,ur.HAS_CHANGED_FLAGS,a),n}ie(t,e),t.isNode=function(e){return e instanceof t&&(e.constructor===t||!(e instanceof c.Scene))};var n=t.prototype;return n.destroy=function(){return this._poolHandle&&(pr.free(this._poolHandle),this._poolHandle=No),Dy.free(this._hasChangedFlagsChunk,this._hasChangedFlagsOffset),e.prototype.destroy.call(this)},n.setParent=function(t,n){void 0===n&&(n=!1),n&&this.updateWorldTransform(),e.prototype.setParent.call(this,t,n)},n._onSetParent=function(t,n){if(e.prototype._onSetParent.call(this,t,n),n){var i=this._parent;i?(i.updateWorldTransform(),jn.multiply(pg,jn.invert(pg,i._mat),this._mat),jn.toRTS(pg,this._lrot,this._lpos,this._lscale)):(Rn.copy(this._lpos,this._pos),zn.copy(this._lrot,this._rot),Rn.copy(this._lscale,this._scale)),this._eulerDirty=!0}this.invalidateChildren(x_.TRS)},n._onHierarchyChanged=function(t){this.eventProcessor.reattach(),e.prototype._onHierarchyChangedBase.call(this,t)},n._onBatchCreated=function(e){var t;pr.set(this._poolHandle,ur.LAYER,this._layer),pr.setVec3(this._poolHandle,ur.WORLD_SCALE,this._scale);var n=null===(t=this._prefab)||void 0===t?void 0:t.instance;!e&&n&&tg(this),this.hasChangedFlags=x_.TRS,this._dirtyFlags=x_.TRS,this._uiProps.uiTransformDirty=!0;for(var i=this._children.length,o=0;o<i;++o)this._children[o]._siblingIndex=o,this._children[o]._onBatchCreated(e);if(!e&&n){var r={};n.targetMap=r,ng(this,r,!0),og(0,n.mountedChildren,r),ag(0,n.removedComponents,r),rg(0,n.mountedComponents,r),sg(0,n.propertyOverrides,r)}cg(this)},n._onBeforeSerialize=function(){this.eulerAngles},n._onPostActivated=function(e){e?(ov.resumeTarget(this),this.invalidateChildren(x_.TRS)):ov.pauseTarget(this)},n.translate=function(e,t){var n=t||y_.LOCAL;if(n===y_.LOCAL)Rn.transformQuat(lg,e,this._lrot),this._lpos.x+=lg.x,this._lpos.y+=lg.y,this._lpos.z+=lg.z;else if(n===y_.WORLD)if(this._parent){zn.invert(ug,this._parent.worldRotation),Rn.transformQuat(lg,e,ug);var i=this.worldScale;this._lpos.x+=lg.x/i.x,this._lpos.y+=lg.y/i.y,this._lpos.z+=lg.z/i.z}else this._lpos.x+=e.x,this._lpos.y+=e.y,this._lpos.z+=e.z;this.invalidateChildren(x_.POSITION),1&this._eventMask&&this.emit(qm.TRANSFORM_CHANGED,x_.POSITION),pr.setVec3(this._poolHandle,ur.WORLD_POSITION,this.worldPosition)},n.rotate=function(e,t){var n=t||y_.LOCAL;if(zn.normalize(ug,e),n===y_.LOCAL)zn.multiply(this._lrot,this._lrot,ug);else if(n===y_.WORLD){var i=this.worldRotation;zn.multiply(hg,ug,i),zn.invert(ug,i),zn.multiply(hg,ug,hg),zn.multiply(this._lrot,this._lrot,hg)}this._eulerDirty=!0,this.invalidateChildren(x_.ROTATION),1&this._eventMask&&this.emit(qm.TRANSFORM_CHANGED,x_.ROTATION),pr.setVec4(this._poolHandle,ur.WORLD_ROTATION,this.worldRotation)},n.lookAt=function(e,t){this.getWorldPosition(lg),Rn.subtract(lg,lg,e),Rn.normalize(lg,lg),zn.fromViewUp(ug,lg,t),this.setWorldRotation(ug)},n.invalidateChildren=function(e){var t=e|x_.POSITION;mg[0]=this;for(var n=0;n>=0;){var i=mg[n--],o=i.hasChangedFlags;if(i.isValid&&(i._dirtyFlags&o&e)!==e){i._dirtyFlags|=e,i._uiProps.uiTransformDirty=!0,i._hasChangedFlagsChunk[i._hasChangedFlagsOffset]=o|e;for(var r=i._children,a=r.length,s=0;s<a;++s)mg[++n]=r[s]}e=t}},n.updateWorldTransform=function(){if(this._dirtyFlags){for(var e,t=this,n=0;t&&t._dirtyFlags;)mg[n++]=t,t=t._parent;for(var i,o,r,a,s=0;n;)s|=(e=mg[--n])._dirtyFlags,t?(s&x_.POSITION&&(i=e._mat,o=t._mat,r=e._pos,a=e._lpos,e._rot,Rn.transformMat4(r,a,o),i.m12=r.x,i.m13=r.y,i.m14=r.z,pr.setVec3(e._poolHandle,ur.WORLD_POSITION,r)),s&x_.RS&&(jn.fromRTS(e._mat,e._lrot,e._lpos,e._lscale),jn.multiply(e._mat,t._mat,e._mat),s&x_.ROTATION&&(zn.multiply(e._rot,t._rot,e._lrot),pr.setVec4(e._poolHandle,ur.WORLD_ROTATION,e._rot)),Mn.fromQuat(fg,zn.conjugate(_g,e._rot)),Mn.multiplyMat4(fg,fg,e._mat),e._scale.x=fg.m00,e._scale.y=fg.m04,e._scale.z=fg.m08,pr.setVec3(e._poolHandle,ur.WORLD_SCALE,e._scale))):(s&x_.POSITION&&(Rn.copy(e._pos,e._lpos),e._mat.m12=e._pos.x,e._mat.m13=e._pos.y,e._mat.m14=e._pos.z,pr.setVec3(e._poolHandle,ur.WORLD_POSITION,e._pos)),s&x_.RS&&(s&x_.ROTATION&&(zn.copy(e._rot,e._lrot),pr.setVec4(e._poolHandle,ur.WORLD_ROTATION,e._rot)),s&x_.SCALE&&(Rn.copy(e._scale,e._lscale),pr.setVec3(e._poolHandle,ur.WORLD_SCALE,e._scale),jn.fromRTS(e._mat,e._rot,e._pos,e._scale)))),s!==x_.NONE&&pr.setMat4(e._poolHandle,ur.WORLD_MATRIX,e._mat),e._dirtyFlags=x_.NONE,t=e}},n.setPosition=function(e,t,n){void 0===t&&void 0===n?Rn.copy(this._lpos,e):void 0===n?Rn.set(this._lpos,e,t,this._lpos.z):Rn.set(this._lpos,e,t,n),this.invalidateChildren(x_.POSITION),1&this._eventMask&&this.emit(qm.TRANSFORM_CHANGED,x_.POSITION)},n.getPosition=function(e){return e?Rn.set(e,this._lpos.x,this._lpos.y,this._lpos.z):Rn.copy(new Rn,this._lpos)},n.setRotation=function(e,t,n,i){void 0===t||void 0===n||void 0===i?zn.copy(this._lrot,e):zn.set(this._lrot,e,t,n,i),this._eulerDirty=!0,this.invalidateChildren(x_.ROTATION),1&this._eventMask&&this.emit(qm.TRANSFORM_CHANGED,x_.ROTATION)},n.setRotationFromEuler=function(e,t,n){var i=void 0===n?this._euler.z:n;void 0===t?(Rn.copy(this._euler,e),zn.fromEuler(this._lrot,e.x,e.y,e.z)):(Rn.set(this._euler,e,t,i),zn.fromEuler(this._lrot,e,t,i)),this._eulerDirty=!1,this.invalidateChildren(x_.ROTATION),1&this._eventMask&&this.emit(qm.TRANSFORM_CHANGED,x_.ROTATION)},n.getRotation=function(e){return e?zn.set(e,this._lrot.x,this._lrot.y,this._lrot.z,this._lrot.w):zn.copy(new zn,this._lrot)},n.setScale=function(e,t,n){void 0===t&&void 0===n?Rn.copy(this._lscale,e):void 0===n?Rn.set(this._lscale,e,t,this._lscale.z):Rn.set(this._lscale,e,t,n),this.invalidateChildren(x_.SCALE),1&this._eventMask&&this.emit(qm.TRANSFORM_CHANGED,x_.SCALE)},n.getScale=function(e){return e?Rn.set(e,this._lscale.x,this._lscale.y,this._lscale.z):Rn.copy(new Rn,this._lscale)},n.inverseTransformPoint=function(e,t){Rn.copy(e,t);for(var n=this,i=0;n._parent;)mg[i++]=n,n=n._parent;for(;i>=0;)Rn.transformInverseRTS(e,e,n._lrot,n._lpos,n._lscale),n=mg[--i];return e},n.setWorldPosition=function(e,t,n){void 0===t||void 0===n?Rn.copy(this._pos,e):Rn.set(this._pos,e,t,n),pr.setVec3(this._poolHandle,ur.WORLD_POSITION,this._pos);var i=this._parent,o=this._lpos;i?(i.updateWorldTransform(),Rn.transformMat4(o,this._pos,jn.invert(pg,i._mat))):Rn.copy(o,this._pos),this.invalidateChildren(x_.POSITION),1&this._eventMask&&this.emit(qm.TRANSFORM_CHANGED,x_.POSITION)},n.getWorldPosition=function(e){return this.updateWorldTransform(),e?Rn.copy(e,this._pos):Rn.copy(new Rn,this._pos)},n.setWorldRotation=function(e,t,n,i){void 0===t||void 0===n||void 0===i?zn.copy(this._rot,e):zn.set(this._rot,e,t,n,i),pr.setVec4(this._poolHandle,ur.WORLD_ROTATION,this._rot),this._parent?(this._parent.updateWorldTransform(),zn.multiply(this._lrot,zn.conjugate(this._lrot,this._parent._rot),this._rot)):zn.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(x_.ROTATION),1&this._eventMask&&this.emit(qm.TRANSFORM_CHANGED,x_.ROTATION)},n.setWorldRotationFromEuler=function(e,t,n){zn.fromEuler(this._rot,e,t,n),this._parent?(this._parent.updateWorldTransform(),zn.multiply(this._lrot,zn.conjugate(this._lrot,this._parent._rot),this._rot)):zn.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(x_.ROTATION),1&this._eventMask&&this.emit(qm.TRANSFORM_CHANGED,x_.ROTATION)},n.getWorldRotation=function(e){return this.updateWorldTransform(),e?zn.copy(e,this._rot):zn.copy(new zn,this._rot)},n.setWorldScale=function(e,t,n){void 0===t||void 0===n?Rn.copy(this._scale,e):Rn.set(this._scale,e,t,n),pr.setVec3(this._poolHandle,ur.WORLD_SCALE,this._scale);var i=this._parent;i?(i.updateWorldTransform(),Mn.fromQuat(fg,zn.conjugate(_g,i._rot)),Mn.multiplyMat4(fg,fg,i._mat),dg.m00=this._scale.x,dg.m04=this._scale.y,dg.m08=this._scale.z,Mn.multiply(fg,dg,Mn.invert(fg,fg)),this._lscale.x=Rn.set(lg,fg.m00,fg.m01,fg.m02).length(),this._lscale.y=Rn.set(lg,fg.m03,fg.m04,fg.m05).length(),this._lscale.z=Rn.set(lg,fg.m06,fg.m07,fg.m08).length()):Rn.copy(this._lscale,this._scale),this.invalidateChildren(x_.SCALE),1&this._eventMask&&this.emit(qm.TRANSFORM_CHANGED,x_.SCALE)},n.getWorldScale=function(e){return this.updateWorldTransform(),e?Rn.copy(e,this._scale):Rn.copy(new Rn,this._scale)},n.getWorldMatrix=function(e){this.updateWorldTransform();var t=e||new jn;return jn.copy(t,this._mat)},n.getWorldRS=function(e){this.updateWorldTransform();var t=e||new jn;return jn.copy(t,this._mat),t.m12=0,t.m13=0,t.m14=0,t},n.getWorldRT=function(e){this.updateWorldTransform();var t=e||new jn;return jn.fromRT(t,this._rot,this._pos)},n.setRTS=function(e,t,n){var i=0;e&&(i|=x_.ROTATION,void 0!==e.w?(zn.copy(this._lrot,e),this._eulerDirty=!0):(Rn.copy(this._euler,e),zn.fromEuler(this._lrot,e.x,e.y,e.z),this._eulerDirty=!1)),t&&(Rn.copy(this._lpos,t),i|=x_.POSITION),n&&(Rn.copy(this._lscale,n),i|=x_.SCALE),i&&(this.invalidateChildren(i),1&this._eventMask&&this.emit(qm.TRANSFORM_CHANGED,i))},n.pauseSystemEvents=function(e){ov.pauseTarget(this,e)},n.resumeSystemEvents=function(e){ov.resumeTarget(this,e)},t.resetHasChangedFlags=function(){Dy.clear()},t.clearNodeArray=function(){t.ClearFrame<t.ClearRound?t.ClearFrame++:(t.ClearFrame=0,mg.length=0)},n.syncToNativeTransform=function(){var e=this.hasChangedFlags;e&&(e&x_.POSITION&&pr.setVec3(this._poolHandle,ur.WORLD_POSITION,this.worldPosition),e&x_.ROTATION&&pr.setVec4(this._poolHandle,ur.WORLD_ROTATION,this.worldRotation),e&x_.SCALE&&pr.setVec3(this._poolHandle,ur.WORLD_SCALE,this.worldScale))},n.syncFromNativeTransform=function(){var e=this.hasChangedFlags;e&&(e&x_.POSITION&&(pr.getVec3(this._poolHandle,ur.WORLD_POSITION,lg),this.setWorldPosition(lg)),e&x_.ROTATION&&(pr.getVec4(this._poolHandle,ur.WORLD_ROTATION,ug),this.setWorldRotation(ug)),e&x_.SCALE&&(pr.getVec3(this._poolHandle,ur.WORLD_SCALE,lg),this.setWorldScale(lg)))},te(t,[{key:"handle",get:function(){return this._poolHandle}},{key:"position",get:function(){return this._lpos},set:function(e){this.setPosition(e)}},{key:"worldPosition",get:function(){return this.updateWorldTransform(),this._pos},set:function(e){this.setWorldPosition(e)}},{key:"rotation",get:function(){return this._lrot},set:function(e){this.setRotation(e)}},{key:"eulerAngles",get:function(){return this._eulerDirty&&(zn.toEuler(this._euler,this._lrot),this._eulerDirty=!1),this._euler},set:function(e){this.setRotationFromEuler(e.x,e.y,e.z)}},{key:"angle",get:function(){return this._euler.z},set:function(e){Rn.set(this._euler,0,0,e),zn.fromAngleZ(this._lrot,e),this._eulerDirty=!1,this.invalidateChildren(x_.ROTATION),1&this._eventMask&&this.emit(qm.TRANSFORM_CHANGED,x_.ROTATION)}},{key:"worldRotation",get:function(){return this.updateWorldTransform(),this._rot},set:function(e){this.setWorldRotation(e)}},{key:"scale",get:function(){return this._lscale},set:function(e){this.setScale(e)}},{key:"worldScale",get:function(){return this.updateWorldTransform(),this._scale},set:function(e){this.setWorldScale(e)}},{key:"matrix",set:function(e){jn.toRTS(e,this._lrot,this._lpos,this._lscale),this.invalidateChildren(x_.TRS),this._eulerDirty=!0,1&this._eventMask&&this.emit(qm.TRANSFORM_CHANGED,x_.TRS)}},{key:"worldMatrix",get:function(){return this.updateWorldTransform(),this._mat}},{key:"forward",get:function(){return Rn.transformQuat(new Rn,Rn.FORWARD,this.worldRotation)},set:function(e){var t=e.length();Rn.multiplyScalar(lg,e,-1/t),zn.fromViewUp(ug,lg),this.setWorldRotation(ug)}},{key:"layer",get:function(){return this._layer},set:function(e){this._layer=e,pr.set(this._poolHandle,ur.LAYER,this._layer),this.emit(qm.LAYER_CHANGED,this._layer)}},{key:"hasChangedFlags",get:function(){return this._hasChangedFlagsChunk[this._hasChangedFlagsOffset]},set:function(e){this._hasChangedFlagsChunk[this._hasChangedFlagsOffset]=e}}]),t}(yv),Jv.EventType=qm,Jv.NodeSpace=y_,Jv.TransformDirtyBit=x_,Jv.TransformBit=x_,Jv.ClearFrame=0,Jv.ClearRound=1e3,Yv=he((qv=$v).prototype,"_lpos",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Rn}}),Xv=he(qv.prototype,"_lrot",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zn}}),Kv=he(qv.prototype,"_lscale",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Rn(1,1,1)}}),Qv=he(qv.prototype,"_layer",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return qu.Enum.DEFAULT}}),Zv=he(qv.prototype,"_euler",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Rn}}),he(qv.prototype,"eulerAngles",[Wv],Object.getOwnPropertyDescriptor(qv.prototype,"eulerAngles"),qv.prototype),he(qv.prototype,"angle",[$_],Object.getOwnPropertyDescriptor(qv.prototype,"angle"),qv.prototype),he(qv.prototype,"layer",[$_],Object.getOwnPropertyDescriptor(qv.prototype,"layer"),qv.prototype),jv=qv))||jv));c.Node=My;var Ly=U_("cc.TargetInfo")((xg=he((yg=function(){ue(this,"localID",xg,this)}).prototype,"localID",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gg=yg))||gg,Fy=(Sg=U_("cc.TargetOverrideInfo"),Eg=pf(fi),Tg=pf(Ly),Ag=pf(My),Cg=pf(Ly),Sg((Ig=he((bg=function(){ue(this,"source",Ig,this),ue(this,"sourceInfo",Pg,this),ue(this,"propertyPath",Rg,this),ue(this,"target",Ng,this),ue(this,"targetInfo",Og,this)}).prototype,"source",[W_,Eg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pg=he(bg.prototype,"sourceInfo",[W_,Tg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Rg=he(bg.prototype,"propertyPath",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ng=he(bg.prototype,"target",[W_,Ag],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Og=he(bg.prototype,"targetInfo",[W_,Cg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wg=bg))||wg),zy=U_("cc.CompPrefabInfo")((Lg=he((Mg=function(){ue(this,"fileId",Lg,this)}).prototype,"fileId",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Dg=Mg))||Dg,By=(Fg=U_("CCPropertyOverrideInfo"),zg=pf(Ly),Fg((Vg=function(){function e(){ue(this,"targetInfo",Hg,this),ue(this,"propertyPath",Gg,this),ue(this,"value",kg,this)}return e.prototype.isTarget=function(){},e}(),Hg=he((Ug=Vg).prototype,"targetInfo",[W_,zg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gg=he(Ug.prototype,"propertyPath",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),kg=he(Ug.prototype,"value",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bg=Ug))||Bg),Uy=(Wg=U_("cc.MountedChildrenInfo"),jg=pf(Ly),qg=pf([My]),Wg((Zg=function(){function e(){ue(this,"targetInfo",Kg,this),ue(this,"nodes",Qg,this)}return e.prototype.isTarget=function(){},e}(),Kg=he((Xg=Zg).prototype,"targetInfo",[W_,jg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qg=he(Xg.prototype,"nodes",[W_,qg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Yg=Xg))||Yg),Hy=(Jg=U_("cc.MountedComponentsInfo"),$g=pf(Ly),ey=pf([fp]),Jg((ry=function(){function e(){ue(this,"targetInfo",iy,this),ue(this,"components",oy,this)}return e.prototype.isTarget=function(){},e}(),iy=he((ny=ry).prototype,"targetInfo",[W_,$g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oy=he(ny.prototype,"components",[W_,ey],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ty=ny))||ty),Gy=(ay=U_("cc.PrefabInstance"),sy=pf(My),cy=pf([Uy]),ly=pf([Hy]),uy=pf([By]),hy=pf([Ly]),ay((xy=function(){function e(){ue(this,"fileId",dy,this),ue(this,"prefabRootNode",py,this),ue(this,"mountedChildren",my,this),ue(this,"mountedComponents",vy,this),ue(this,"propertyOverrides",gy,this),ue(this,"removedComponents",yy,this),this.targetMap={}}var t=e.prototype;return t.findPropertyOverride=function(){},t.removePropertyOverride=function(){},e}(),dy=he((fy=xy).prototype,"fileId",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),py=he(fy.prototype,"prefabRootNode",[W_,sy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),my=he(fy.prototype,"mountedChildren",[W_,cy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vy=he(fy.prototype,"mountedComponents",[W_,ly],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gy=he(fy.prototype,"propertyOverrides",[W_,uy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yy=he(fy.prototype,"removedComponents",[W_,hy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_y=fy))||_y),ky=(Sy=U_("cc.PrefabInfo"),Ey=pf(My),Ty=pf(c.Prefab),Ay=pf(Gy),Cy=pf([Fy]),Sy((Iy=he((by=function(){ue(this,"root",Iy,this),ue(this,"asset",Py,this),ue(this,"fileId",Ry,this),ue(this,"instance",Ny,this),ue(this,"targetOverrides",Oy,this)}).prototype,"root",[W_,Ey],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Py=he(by.prototype,"asset",[W_,Ty],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ry=he(by.prototype,"fileId",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ny=he(by.prototype,"instance",[W_,Ay],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oy=he(by.prototype,"targetOverrides",[W_,Cy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wy=by))||wy);c._PrefabInfo=ky;var Vy,Wy,jy,qy,Yy,Xy,Ky,Qy,Zy,Jy,$y,ex,tx,nx=Object.freeze({__proto__:null,TargetInfo:Ly,TargetOverrideInfo:Fy,CompPrefabInfo:zy,PropertyOverrideInfo:By,MountedChildrenInfo:Uy,MountedComponentsInfo:Hy,PrefabInstance:Gy,PrefabInfo:ky,createNodeWithPrefab:tg,generateTargetMap:ng,getTarget:ig,applyMountedChildren:og,applyMountedComponents:rg,applyRemovedComponents:ag,applyPropertyOverrides:sg,applyTargetOverrides:cg}),ix=ct({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2}),ox=e("f9",U_("cc.Prefab")((Xy=Yy=function(e){function t(){var t;return ue(t=e.call(this)||this,"data",jy,se(t)),ue(t,"optimizationPolicy",qy,se(t)),t._createFunction=void 0,t._instantiatedTimes=void 0,t._createFunction=null,t._instantiatedTimes=0,t}ie(t,e);var n=t.prototype;return n.createNode=function(e){var t=c.instantiate(this);t.name=this.name,e(null,t)},n.compileCreateFunction=function(){var e,t;this._createFunction=(t=(e=this.data)instanceof c._BaseNode&&e,new Wm(e,t).result)},n._doInstantiate=function(e){return this.data._prefab||P(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(e)},n._instantiate=function(){var e;return this.optimizationPolicy!==ix.SINGLE_INSTANCE&&(this.optimizationPolicy===ix.MULTI_INSTANCE||this._instantiatedTimes+1>=t.OptimizationPolicyThreshold)?(e=this._doInstantiate(),this.data._instantiate(e)):e=this.data._instantiate(),++this._instantiatedTimes,e},n.initDefault=function(t){e.prototype.initDefault.call(this,t),this.data=new My,this.data.name="(Missing Node)";var n=new ky;n.asset=this,n.root=this.data,this.data._prefab=n},n.validate=function(){return!!this.data},t}(Yf),Yy.OptimizationPolicy=ix,Yy.OptimizationPolicyThreshold=3,jy=he((Wy=Xy).prototype,"data",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qy=he(Wy.prototype,"optimizationPolicy",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ix.AUTO}}),Vy=Wy))||Vy);at.value(ox,"_utils",nx),c.Prefab=ox,Oe(c,"cc._Prefab","Prefab"),e("eZ",(Ky=U_("cc.PrefabLink"),Qy=pf(ox),Zy=ef(),Ky((tx=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return ue(t=e.call.apply(e,[this].concat(i))||this,"prefab",ex,se(t)),t}return ie(t,e),t}(fp),ex=he(($y=tx).prototype,"prefab",[Qy,W_,Zy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jy=$y))||Jy));var rx=new Rn;function ax(e,t,n,i){i||(i=new Rn),e.convertToUINode(t,n,i);var o=n.position;return i.add(o),i}function sx(e,t,n){return n||(n=new Rn),e.worldToScreen(t,n),n.x/=c.view.getScaleX(),n.y/=c.view.getScaleY(),n}var cx=e("f1",{WorldNode3DToLocalNodeUI:ax,WorldNode3DToWorldNodeUI:sx});c.pipelineUtils=cx,q(c.pipelineUtils,"cc.pipelineUtils",[{name:"WorldNode3DToLocalNodeUI",newName:"convertToUINode",targetName:"cc.Camera.prototype",customFunction:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0],o=t[3]||rx;return i.convertToUINode(t[1],t[2],o),o.add(t[2].position),t[3]||o.clone()}}]),q(qm,"Node.EventType",[{name:"POSITION_PART",newName:"TRANSFORM_CHANGED"},{name:"ROTATION_PART",newName:"TRANSFORM_CHANGED"},{name:"SCALE_PART",newName:"TRANSFORM_CHANGED"}]);var lx=function(){function e(){this.support=void 0,this._intervalInMileseconds=200,this._accelTimer=0,this._eventTarget=new Ni,this._deviceEventName=void 0,this._globalEventClass=void 0,this._didAccelerateFunc=void 0,this.support=void 0!==window.DeviceMotionEvent||void 0!==window.DeviceOrientationEvent,this._globalEventClass=window.DeviceMotionEvent||window.DeviceOrientationEvent,Di.browserType===Ai.MOBILE_QQ&&(this._globalEventClass=window.DeviceOrientationEvent),this._deviceEventName=this._globalEventClass===window.DeviceMotionEvent?"devicemotion":"deviceorientation",this._didAccelerateFunc=this._didAccelerate.bind(this)}var t=e.prototype;return t._registerEvent=function(){this._accelTimer=performance.now(),window.addEventListener(this._deviceEventName,this._didAccelerateFunc,!1)},t._unregisterEvent=function(){this._accelTimer=0,window.removeEventListener(this._deviceEventName,this._didAccelerateFunc,!1)},t._didAccelerate=function(e){var t=performance.now();if(!(t-this._accelTimer<this._intervalInMileseconds)){this._accelTimer=t;var n=0,i=0,o=0;if(this._globalEventClass===window.DeviceMotionEvent){var r=e.accelerationIncludingGravity;n=.1*((null==r?void 0:r.x)||0),i=.1*((null==r?void 0:r.y)||0),o=.1*((null==r?void 0:r.z)||0)}else{var a=e;n=(a.gamma||0)/90*.981,i=-(a.beta||0)/90*.981,o=(a.alpha||0)/90*.981}if(c.view._isRotated)if(90==c.view._rotateAngle){var s=n;n=-i,i=s}else{var l=n;n=i,i=l}var u=n;90===window.orientation?(n=-i,i=u):-90===window.orientation?(n=i,i=-u):180===window.orientation&&(n=-n,i=-i),Di.os===Ii.ANDROID&&Di.browserType!==Ai.MOBILE_QQ&&(n=-n,i=-i);var h={type:qm.DEVICEMOTION,x:n,y:i,z:o,timestamp:performance.now()};this._eventTarget.emit(qm.DEVICEMOTION,h)}},t.start=function(){this._registerEvent()},t.stop=function(){this._unregisterEvent()},t.setInterval=function(e){this._intervalInMileseconds=e},t.onChange=function(e){this._eventTarget.on(qm.DEVICEMOTION,e)},e}(),ux=function(){function e(){this.support=void 0,this.support=!0}var t=e.prototype;return t.show=function(){throw new Error("Method not implemented.")},t.hide=function(){throw new Error("Method not implemented.")},t.onChange=function(){throw new Error("Method not implemented.")},t.onComplete=function(){throw new Error("Method not implemented.")},t.offChange=function(){throw new Error("Method not implemented.")},t.offComplete=function(){throw new Error("Method not implemented.")},e}(),hx=function(){function e(){this.support=void 0,this._eventTarget=new Ni,this.support=void 0!==document.documentElement.onkeyup,this._registerEvent()}var t=e.prototype;return t._registerEvent=function(){var e=document.getElementById("GameCanvas");null==e||e.addEventListener("keydown",this._createCallback(qm.KEY_DOWN)),null==e||e.addEventListener("keyup",this._createCallback(qm.KEY_UP))},t._createCallback=function(e){var t=this;return function(n){var i={type:e,code:n.keyCode,timestamp:performance.now()};n.stopPropagation(),n.preventDefault(),t._eventTarget.emit(e,i)}},t.onDown=function(e){this._eventTarget.on(qm.KEY_DOWN,e)},t.onUp=function(e){this._eventTarget.on(qm.KEY_UP,e)},e}(),_x=function(){function e(){this.support=void 0,this._canvas=void 0,this._eventTarget=new Ni,this._pointLocked=!1,this._isPressed=!1,this._preMousePos=new Kn,this.support=void 0!==document.documentElement.onmouseup,this.support&&(this._canvas=document.getElementById("GameCanvas"),this._canvas||console.warn("failed to access canvas"),this._registerEvent())}var t=e.prototype;return t._getCanvasRect=function(){var e=this._canvas,t=null==e?void 0:e.getBoundingClientRect();return t?new oi(t.x,t.y,t.width,t.height):new oi(0,0,0,0)},t._getLocation=function(e){return new Kn(e.clientX,e.clientY)},t._registerEvent=function(){var e,t,n,i,o=this;window.addEventListener("mousedown",(function(){o._isPressed=!0})),null===(e=this._canvas)||void 0===e||e.addEventListener("mousedown",this._createCallback(qm.MOUSE_DOWN)),null===(t=this._canvas)||void 0===t||t.addEventListener("mousemove",this._createCallback(qm.MOUSE_MOVE)),window.addEventListener("mouseup",this._createCallback(qm.MOUSE_UP)),null===(n=this._canvas)||void 0===n||n.addEventListener("mouseup",this._createCallback(qm.MOUSE_UP)),null===(i=this._canvas)||void 0===i||i.addEventListener("wheel",(function(e){var t=o._getCanvasRect(),n=o._getLocation(e),i={type:qm.MOUSE_WHEEL,x:n.x-t.x,y:t.y+t.height-n.y,button:e.button,deltaX:5*e.deltaX,deltaY:5*-e.deltaY,timestamp:performance.now(),movementX:e.movementX,movementY:e.movementY};e.stopPropagation(),e.preventDefault(),o._eventTarget.emit(qm.MOUSE_WHEEL,i)})),this._registerPointerLockEvent()},t._registerPointerLockEvent=function(){var e=this,t=function(){var t=e._canvas;document.pointerLockElement===t||document.mozPointerLockElement===t?e._pointLocked=!0:e._pointLocked=!1};"onpointerlockchange"in document?document.addEventListener("pointerlockchange",t,!1):"onmozpointerlockchange"in document&&document.addEventListener("mozpointerlockchange",t,!1)},t._createCallback=function(e){var t=this;return function(n){var i,o=t._getCanvasRect(),r=t._getLocation(n),a=n.button;switch(n.type){case"mousedown":null===(i=t._canvas)||void 0===i||i.focus(),t._isPressed=!0;break;case"mouseup":t._isPressed=!1;break;case"mousemove":t._isPressed||(a=-1)}var s=r.x-o.x,l=o.y+o.height-r.y;if(c.view._isRotated)if(90==c.view._rotateAngle){var u=s;s=o.height-l,l=u}else{var h=s;s=l,l=o.width-h}var _={type:e,x:t._pointLocked?t._preMousePos.x+n.movementX:s,y:t._pointLocked?t._preMousePos.y-n.movementY:l,button:a,timestamp:performance.now(),movementX:n.movementX,movementY:n.movementY};t._preMousePos.set(_.x,_.y),n.stopPropagation(),n.target===t._canvas&&n.preventDefault(),t._eventTarget.emit(e,_)}},t.onDown=function(e){this._eventTarget.on(qm.MOUSE_DOWN,e)},t.onMove=function(e){this._eventTarget.on(qm.MOUSE_MOVE,e)},t.onUp=function(e){this._eventTarget.on(qm.MOUSE_UP,e)},t.onWheel=function(e){this._eventTarget.on(qm.MOUSE_WHEEL,e)},e}(),fx=function(){function e(){this.support=void 0,this._canvas=void 0,this._eventTarget=new Ni,this.support=void 0!==document.documentElement.ontouchstart||void 0!==document.ontouchstart||navigator.msPointerEnabled,this.support&&(this._canvas=document.getElementById("GameCanvas"),this._canvas||console.warn("failed to access canvas"),this._registerEvent())}var t=e.prototype;return t._registerEvent=function(){var e,t,n,i;null===(e=this._canvas)||void 0===e||e.addEventListener("touchstart",this._createCallback(qm.TOUCH_START)),null===(t=this._canvas)||void 0===t||t.addEventListener("touchmove",this._createCallback(qm.TOUCH_MOVE)),null===(n=this._canvas)||void 0===n||n.addEventListener("touchend",this._createCallback(qm.TOUCH_END)),null===(i=this._canvas)||void 0===i||i.addEventListener("touchcancel",this._createCallback(qm.TOUCH_CANCEL))},t._createCallback=function(e){var t=this;return function(n){for(var i=t._getCanvasRect(),o=[],r=n.changedTouches.length,a=0;a<r;++a){var s=n.changedTouches[a],l=t._getLocation(s),u=l.x-i.x,h=i.y+i.height-l.y;if(c.view._isRotated)if(90==c.view._rotateAngle){var _=u;u=i.height-h,h=_}else{var f=u;u=h,h=i.width-f}var d={identifier:s.identifier,x:u,y:h,force:s.force};o.push(d)}var p,m={type:e,changedTouches:o,timestamp:performance.now()};n.stopPropagation(),n.target===t._canvas&&n.preventDefault(),"touchstart"===n.type&&(null===(p=t._canvas)||void 0===p||p.focus()),t._eventTarget.emit(e,m)}},t._getCanvasRect=function(){var e=this._canvas,t=null==e?void 0:e.getBoundingClientRect();return t?new oi(t.x,t.y,t.width,t.height):new oi(0,0,0,0)},t._getLocation=function(e){return new Kn(e.clientX,e.clientY)},t.onStart=function(e){this._eventTarget.on(qm.TOUCH_START,e)},t.onMove=function(e){this._eventTarget.on(qm.TOUCH_MOVE,e)},t.onEnd=function(e){this._eventTarget.on(qm.TOUCH_END,e)},t.onCancel=function(e){this._eventTarget.on(qm.TOUCH_CANCEL,e)},e}(),dx=new(function(){function e(){this._touch=new fx,this._mouse=new _x,this._keyboard=new hx,this._accelerometer=new lx,this._inputBox=new ux,this._inputEventList=[],this._registerEvent()}var t=e.prototype;return t._registerEvent=function(){},t._pushEvent=function(e){this._inputEventList.push(e)},t.pollEvent=function(){return this._inputEventList.shift()},e}()),px=new Kn,mx=e("fp",function(e){function t(n,i,o){var r;return(r=e.call(this,qf.MOUSE,i)||this).movementX=0,r.movementY=0,r.eventType=void 0,r._button=t.BUTTON_MISSING,r._x=0,r._y=0,r._prevX=0,r._prevY=0,r._scrollX=0,r._scrollY=0,r.eventType=n,o&&(r._prevX=o.x,r._prevY=o.y),r}ie(t,e);var n=t.prototype;return n.setScrollData=function(e,t){this._scrollX=e,this._scrollY=t},n.getScrollX=function(){return this._scrollX},n.getScrollY=function(){return this._scrollY},n.setLocation=function(e,t){this._x=e,this._y=t},n.getLocation=function(e){return e||(e=new Kn),Kn.set(e,this._x,this._y),e},n.getLocationInView=function(e){return e||(e=new Kn),Kn.set(e,this._x,c.view._designResolutionSize.height-this._y),e},n.getUILocation=function(e){return e||(e=new Kn),Kn.set(e,this._x,this._y),c.view._convertPointWithScale(e),e},n.getPreviousLocation=function(e){return e||(e=new Kn),Kn.set(e,this._prevX,this._prevY),e},n.getUIPreviousLocation=function(e){return e||(e=new Kn),Kn.set(e,this._prevX,this._prevY),c.view._convertPointWithScale(e),e},n.getDelta=function(e){return e||(e=new Kn),Kn.set(e,this._x-this._prevX,this._y-this._prevY),e},n.getDeltaX=function(){return this._x-this._prevX},n.getDeltaY=function(){return this._y-this._prevY},n.getUIDelta=function(e){return e||(e=new Kn),Kn.set(e,(this._x-this._prevX)/c.view.getScaleX(),(this._y-this._prevY)/c.view.getScaleY()),e},n.getUIDeltaX=function(){return(this._x-this._prevX)/c.view.getScaleX()},n.getUIDeltaY=function(){return(this._y-this._prevY)/c.view.getScaleY()},n.setButton=function(e){this._button=e},n.getButton=function(){return this._button},n.getLocationX=function(){return this._x},n.getLocationY=function(){return this._y},n.getUILocationX=function(){var e=c.view.getViewportRect();return(this._x-e.x)/c.view.getScaleX()},n.getUILocationY=function(){var e=c.view.getViewportRect();return(this._y-e.y)/c.view.getScaleY()},t}(qf));mx.BUTTON_MISSING=-1,mx.BUTTON_LEFT=0,mx.BUTTON_RIGHT=2,mx.BUTTON_MIDDLE=1,mx.BUTTON_4=3,mx.BUTTON_5=4,mx.BUTTON_6=5,mx.BUTTON_7=6,mx.BUTTON_8=7;var vx=e("dN",function(e){function t(t,n,i,o){var r;return(r=e.call(this,qf.TOUCH,n)||this).touch=null,r.simulate=!1,r._eventCode=void 0,r._touches=void 0,r._allTouches=void 0,r._eventCode=i||"",r._touches=t||[],r._allTouches=o||[],r}ie(t,e);var n=t.prototype;return n.getEventCode=function(){return this._eventCode},n.getTouches=function(){return this._touches},n.getAllTouches=function(){return this._allTouches},n.setLocation=function(e,t){this.touch&&this.touch.setTouchInfo(this.touch.getID(),e,t)},n.getLocation=function(e){return this.touch?this.touch.getLocation(e):new Kn},n.getUILocation=function(e){return this.touch?this.touch.getUILocation(e):new Kn},n.getLocationInView=function(e){return this.touch?this.touch.getLocationInView(e):new Kn},n.getPreviousLocation=function(e){return this.touch?this.touch.getPreviousLocation(e):new Kn},n.getStartLocation=function(e){return this.touch?this.touch.getStartLocation(e):new Kn},n.getUIStartLocation=function(e){return this.touch?this.touch.getUIStartLocation(e):new Kn},n.getID=function(){return this.touch?this.touch.getID():null},n.getDelta=function(e){return this.touch?this.touch.getDelta(e):new Kn},n.getUIDelta=function(e){return this.touch?this.touch.getUIDelta(e):new Kn},n.getDeltaX=function(){return this.touch?this.touch.getDelta(px).x:0},n.getDeltaY=function(){return this.touch?this.touch.getDelta(px).y:0},n.getLocationX=function(){return this.touch?this.touch.getLocationX():0},n.getLocationY=function(){return this.touch?this.touch.getLocationY():0},t}(qf));vx.MAX_TOUCHES=5;var gx=e("fq",function(e){function t(t,n){var i;return(i=e.call(this,qf.ACCELERATION,n)||this).acc=void 0,i.acc=t,i}return ie(t,e),t}(qf)),yx=e("fr",function(e){function t(t,n,i){var o;return(o=e.call(this,qf.KEYBOARD,i)||this).keyCode=void 0,o.rawEvent=void 0,o.isPressed=void 0,"number"==typeof t?o.keyCode=t:(o.keyCode=t.keyCode,o.rawEvent=t),o.isPressed=n,o}return ie(t,e),t}(qf));qf.EventMouse=mx,qf.EventTouch=vx,qf.EventAcceleration=gx,qf.EventKeyboard=yx;var xx=new Kn,Sx=e("fs",function(){function e(e,t,n){void 0===n&&(n=0),this._point=new Kn,this._prevPoint=new Kn,this._lastModified=0,this._id=0,this._startPoint=new Kn,this._startPointCaptured=!1,this.setTouchInfo(n,e,t)}var t=e.prototype;return t.getLocation=function(e){return e||(e=new Kn),e.set(this._point.x,this._point.y),e},t.getLocationX=function(){return this._point.x},t.getLocationY=function(){return this._point.y},t.getUILocation=function(e){return e||(e=new Kn),e.set(this._point.x,this._point.y),c.view._convertPointWithScale(e),e},t.getUILocationX=function(){var e=c.view.getViewportRect();return(this._point.x-e.x)/c.view.getScaleX()},t.getUILocationY=function(){var e=c.view.getViewportRect();return(this._point.y-e.y)/c.view.getScaleY()},t.getPreviousLocation=function(e){return e||(e=new Kn),e.set(this._prevPoint.x,this._prevPoint.y),e},t.getUIPreviousLocation=function(e){return e||(e=new Kn),e.set(this._prevPoint.x,this._prevPoint.y),c.view._convertPointWithScale(e),e},t.getStartLocation=function(e){return e||(e=new Kn),e.set(this._startPoint.x,this._startPoint.y),e},t.getUIStartLocation=function(e){return e||(e=new Kn),e.set(this._startPoint.x,this._startPoint.y),c.view._convertPointWithScale(e),e},t.getDelta=function(e){return e||(e=new Kn),e.set(this._point),e.subtract(this._prevPoint),e},t.getUIDelta=function(e){return e||(e=new Kn),xx.set(this._point),xx.subtract(this._prevPoint),e.set(c.view.getScaleX(),c.view.getScaleY()),Kn.divide(e,xx,e),e},t.getLocationInView=function(e){return e||(e=new Kn),e.set(this._point.x,c.view._designResolutionSize.height-this._point.y),e},t.getPreviousLocationInView=function(e){return e||(e=new Kn),e.set(this._prevPoint.x,c.view._designResolutionSize.height-this._prevPoint.y),e},t.getStartLocationInView=function(e){return e||(e=new Kn),e.set(this._startPoint.x,c.view._designResolutionSize.height-this._startPoint.y),e},t.getID=function(){return this._id},t.setTouchInfo=function(e,t,n){void 0===e&&(e=0),this._prevPoint=this._point,this._point=new Kn(t||0,n||0),this._id=e,this._startPointCaptured||(this._startPoint=new Kn(this._point),this._startPointCaptured=!0)},t.setPoint=function(e,t){"object"==typeof e?(this._point.x=e.x,this._point.y=e.y):(this._point.x=e||0,this._point.y=t||0),this._lastModified=c.director.getCurrentTime()},t.setPrevPoint=function(e,t){this._prevPoint="object"==typeof e?new Kn(e.x,e.y):new Kn(e||0,t||0),this._lastModified=c.director.getCurrentTime()},te(e,[{key:"lastModified",get:function(){return this._lastModified}}]),e}());c.Touch=Sx;var Ex=function(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=void 0,this.y=void 0,this.z=void 0,this.timestamp=void 0,this.x=e,this.y=t,this.z=n,this.timestamp=i},Tx=ft.TOUCH_TIMEOUT,Ax=new Kn,Cx=new Kn,wx=new(function(){function e(){this._isRegisterEvent=!1,this._preTouchPoint=new Kn,this._prevMousePoint=new Kn,this._preTouchPool=[],this._preTouchPoolPointer=0,this._touches=[],this._touchesIntegerDict={},this._indexBitsUsed=0,this._maxTouches=8,this._glView=null}var t=e.prototype;return t.handleTouchesBegin=function(e){for(var t=[],n=this._touchesIntegerDict,i=0;i<e.length;++i){var o=e[i],r=o.getID();if(null!==r&&void 0===n[r]){var a=this._getUnUsedIndex();if(-1===a){b(2300,a);continue}o.getLocation(Ax);var s=new Sx(Ax.x,Ax.y,r);this._touches[a]=s,o.getPreviousLocation(Ax),s.setPrevPoint(Ax),n[r]=a,t.push(s)}}if(t.length>0){var c=new vx(t,!1,qm.TOUCH_START,ft.ENABLE_MULTI_TOUCH?this._getUsefulTouches():t);ov.dispatchEvent(c)}},t.handleTouchesMove=function(e){for(var t=[],n=this._touches,i=0;i<e.length;++i){var o=e[i],r=o.getID();if(null!==r){var a=this._touchesIntegerDict[r];void 0!==a&&n[a]&&(o.getLocation(Ax),n[a].setPoint(Ax),o.getPreviousLocation(Ax),n[a].setPrevPoint(Ax),t.push(n[a]))}}if(t.length>0){var s=new vx(t,!1,qm.TOUCH_MOVE,ft.ENABLE_MULTI_TOUCH?this._getUsefulTouches():t);ov.dispatchEvent(s)}},t.handleTouchesEnd=function(e){var t=this.getSetOfTouchesEndOrCancel(e);if(t.length>0){var n=new vx(t,!1,qm.TOUCH_END,ft.ENABLE_MULTI_TOUCH?this._getUsefulTouches():t);ov.dispatchEvent(n)}this._preTouchPool.length=0},t.handleTouchesCancel=function(e){var t=this.getSetOfTouchesEndOrCancel(e);if(t.length>0){var n=new vx(t,!1,qm.TOUCH_CANCEL,ft.ENABLE_MULTI_TOUCH?this._getUsefulTouches():t);ov.dispatchEvent(n)}this._preTouchPool.length=0},t.getSetOfTouchesEndOrCancel=function(e){for(var t=[],n=this._touches,i=this._touchesIntegerDict,o=0;o<e.length;++o){var r=e[o],a=r.getID();if(null!==a){var s=i[a];void 0!==s&&n[s]&&(r.getLocation(Ax),n[s].setPoint(Ax),r.getPreviousLocation(Ax),n[s].setPrevPoint(Ax),t.push(n[s]),this._removeUsedIndexBit(s),delete i[a])}}return t},t._getPreTouch=function(e){for(var t=null,n=this._preTouchPool,i=e.getID(),o=n.length-1;o>=0;o--)if(n[o].getID()===i){t=n[o];break}return t||(t=e),t},t._setPreTouch=function(e){for(var t=!1,n=this._preTouchPool,i=e.getID(),o=n.length-1;o>=0;o--)if(n[o].getID()===i){n[o]=e,t=!0;break}t||(n.length<=50?n.push(e):(n[this._preTouchPoolPointer]=e,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},t._getViewPixelRatio=function(){return this._glView?this._glView._devicePixelRatio:1},t._getTouch=function(e){var t=this._preTouchPoint,n=this._getViewPixelRatio(),i=e.x*n,o=e.y*n,r=new Sx(i,o,0);return r.setPrevPoint(t.x,t.y),t.x=i,t.y=o,r},t._getMouseEvent=function(e){var t=this._prevMousePoint,n=new mx(e.type,!1,t),i=this._getViewPixelRatio();return t.x=e.x*i,t.y=e.y*i,c.GAME_VIEW&&(t.x/=c.gameView.canvas.width/c.game.canvas.width,t.y/=c.gameView.canvas.height/c.game.canvas.height),n.setLocation(t.x,t.y),n.setButton(e.button),e.movementX&&(n.movementX=e.movementX),e.movementY&&(n.movementY=e.movementY),n},t._getTouchList=function(e){for(var t=[],n=this._preTouchPoint,i=e.changedTouches.length,o=this._getViewPixelRatio(),r=0;r<i;r++){var a=e.changedTouches[r],s=a.x*o,c=a.y*o,l=new Sx(s,c,a.identifier);if(this._getPreTouch(l).getLocation(Cx),l.setPrevPoint(Cx.x,Cx.y),this._setPreTouch(l),n.x=s,n.y=c,t.push(l),!ft.ENABLE_MULTI_TOUCH)break}return t},t._getUnUsedIndex=function(){for(var e=this._indexBitsUsed,t=c.director.getCurrentTime(),n=0;n<this._maxTouches;n++){if(!(1&e))return this._indexBitsUsed|=1<<n,n;var i=this._touches[n];if(t-i.lastModified>Tx){this._removeUsedIndexBit(n);var o=i.getID();return null!==o&&delete this._touchesIntegerDict[o],n}e>>=1}return-1},t._removeUsedIndexBit=function(e){if(!(e<0||e>=this._maxTouches)){var t=1<<e;t=~t,this._indexBitsUsed&=t}},t._getUsefulTouches=function(){var e=[],t=this._touchesIntegerDict;for(var n in t){var i=t[parseInt(n)];if(null!=i){var o=this._touches[i];e.push(o)}}return e},t.setAccelerometerEnabled=function(e){e?dx._accelerometer.start():dx._accelerometer.stop()},t.setAccelerometerInterval=function(e){dx._accelerometer.setInterval(e)},t.registerSystemEvent=function(){this._isRegisterEvent||(this._glView=c.view,dx._mouse.support&&this._registerMouseEvents(),dx._touch.support&&this._registerTouchEvents(),dx._keyboard.support&&this._registerKeyboardEvent(),dx._accelerometer.support&&this._registerAccelerometerEvent(),this._isRegisterEvent=!0)},t._registerMouseEvents=function(){var e=this;dx._mouse.onDown((function(t){var n=e._getMouseEvent(t),i=e._getTouch(t);e.handleTouchesBegin([i]),ov.dispatchEvent(n)})),dx._mouse.onMove((function(t){var n=e._getMouseEvent(t),i=e._getTouch(t);e.handleTouchesMove([i]),ov.dispatchEvent(n)})),dx._mouse.onUp((function(t){var n=e._getMouseEvent(t),i=e._getTouch(t);e.handleTouchesEnd([i]),ov.dispatchEvent(n)})),dx._mouse.onWheel((function(t){var n=e._getMouseEvent(t);n.setScrollData(t.deltaX,t.deltaY),ov.dispatchEvent(n)}))},t._registerTouchEvents=function(){var e=this;dx._touch.onStart((function(t){var n=e._getTouchList(t);e.handleTouchesBegin(n)})),dx._touch.onMove((function(t){var n=e._getTouchList(t);e.handleTouchesMove(n)})),dx._touch.onEnd((function(t){var n=e._getTouchList(t);e.handleTouchesEnd(n)})),dx._touch.onCancel((function(t){var n=e._getTouchList(t);e.handleTouchesCancel(n)}))},t._registerKeyboardEvent=function(){dx._keyboard.onDown((function(e){ov.dispatchEvent(new yx(e.code,!0))})),dx._keyboard.onUp((function(e){ov.dispatchEvent(new yx(e.code,!1))}))},t._registerAccelerometerEvent=function(){dx._accelerometer.onChange((function(e){var t=e.x,n=e.y,i=e.z,o=e.timestamp;ov.dispatchEvent(new gx(new Ex(t,n,i,o)))}))},e}());c.internal.inputManager=wx;var bx=null,Ix=null,Px=null,Rx=null,Nx=e("fn",function(e){function t(){return e.call(this)||this}ie(t,e);var n=t.prototype;return n.setAccelerometerEnabled=function(e){e&&window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then((function(e){b(3520,e),wx.setAccelerometerEnabled("granted"===e)})).catch((function(e){P(3521,e.message),wx.setAccelerometerEnabled(!1)})):wx.setAccelerometerEnabled(e)},n.setAccelerometerInterval=function(e){wx.setAccelerometerInterval(e)},n.on=function(t,n,i,o){return e.prototype.on.call(this,t,n,i,o),t!==qm.KEY_DOWN&&t!==qm.KEY_UP||bx||(bx=Xm.create({event:Xm.KEYBOARD,onKeyPressed:function(e,t){t.type=qm.KEY_DOWN,Ox.emit(t.type,t)},onKeyReleased:function(e,t){t.type=qm.KEY_UP,Ox.emit(t.type,t)}}),ov.addListener(bx,256)),t===qm.DEVICEMOTION&&(Ix||(Ix=Xm.create({event:Xm.ACCELERATION,callback:function(e,t){t.type=qm.DEVICEMOTION,c.systemEvent.emit(t.type,t)}}),ov.addListener(Ix,256))),t!==qm.TOUCH_START&&t!==qm.TOUCH_MOVE&&t!==qm.TOUCH_END&&t!==qm.TOUCH_CANCEL||Px||(Px=Xm.create({event:Xm.TOUCH_ONE_BY_ONE,onTouchBegan:function(e,t){return t.type=qm.TOUCH_START,c.systemEvent.emit(t.type,e,t),!0},onTouchMoved:function(e,t){t.type=qm.TOUCH_MOVE,c.systemEvent.emit(t.type,e,t)},onTouchEnded:function(e,t){t.type=qm.TOUCH_END,c.systemEvent.emit(t.type,e,t)},onTouchCancelled:function(e,t){t.type=qm.TOUCH_CANCEL,c.systemEvent.emit(t.type,e,t)}}),ov.addListener(Px,256)),t!==qm.MOUSE_DOWN&&t!==qm.MOUSE_MOVE&&t!==qm.MOUSE_UP&&t!==qm.MOUSE_WHEEL||Rx||(Rx=Xm.create({event:Xm.MOUSE,onMouseDown:function(e){e.type=qm.MOUSE_DOWN,c.systemEvent.emit(e.type,e)},onMouseMove:function(e){e.type=qm.MOUSE_MOVE,c.systemEvent.emit(e.type,e)},onMouseUp:function(e){e.type=qm.MOUSE_UP,c.systemEvent.emit(e.type,e)},onMouseScroll:function(e){e.type=qm.MOUSE_WHEEL,c.systemEvent.emit(e.type,e)}}),ov.addListener(Rx,256)),n},n.off=function(t,n,i){if(e.prototype.off.call(this,t,n,i),bx&&(t===qm.KEY_DOWN||t===qm.KEY_UP)){var o=this.hasEventListener(qm.KEY_DOWN),r=this.hasEventListener(qm.KEY_UP);o||r||(ov.removeListener(bx),bx=null)}if(Ix&&t===qm.DEVICEMOTION&&(ov.removeListener(Ix),Ix=null),Px&&(t===qm.TOUCH_START||t===qm.TOUCH_MOVE||t===qm.TOUCH_END||t===qm.TOUCH_CANCEL)){var a=this.hasEventListener(qm.TOUCH_START),s=this.hasEventListener(qm.TOUCH_MOVE),c=this.hasEventListener(qm.TOUCH_END),l=this.hasEventListener(qm.TOUCH_CANCEL);a||s||c||l||(ov.removeListener(Px),Px=null)}if(Rx&&(t===qm.MOUSE_DOWN||t===qm.MOUSE_MOVE||t===qm.MOUSE_UP||t===qm.MOUSE_WHEEL)){var u=this.hasEventListener(qm.MOUSE_DOWN),h=this.hasEventListener(qm.MOUSE_MOVE),_=this.hasEventListener(qm.MOUSE_UP),f=this.hasEventListener(qm.MOUSE_WHEEL);u||h||_||f||(ov.removeListener(Rx),Rx=null)}},t}(Ni));Nx.EventType=qm,c.SystemEvent=Nx;var Ox=e("fo",new Nx);c.systemEvent=Ox;var Dx,Mx,Lx,Fx,zx,Bx,Ux,Hx,Gx,kx,Vx=Di.getViewSize(),Wx=Di.pixelRatio,jx=e("bt",{NetworkType:bi,Language:wi,OS:Ii,Platform:Ri,BrowserType:Ai,isNative:Di.isNative,isBrowser:Di.isBrowser,isMobile:Di.isMobile,isLittleEndian:Di.isLittleEndian,platform:Di.platform,language:Di.language,languageCode:Di.nativeLanguage,os:Di.os,osVersion:Di.osVersion,osMainVersion:Di.osMainVersion,browserType:Di.browserType,browserVersion:Di.browserVersion,windowPixelResolution:{width:Vx.width*Wx,height:Vx.height*Wx},capabilities:{canvas:Di.supportCapability.canvas,opengl:Di.supportCapability.gl,webp:Di.supportCapability.webp,imageBitmap:Di.supportCapability.imageBitmap,touches:!1,mouse:!1,keyboard:!1,accelerometer:!1},localStorage:null,getNetworkType:function(){return Di.networkType},getBatteryLevel:function(){return Di.getBatteryLevel()},garbageCollect:function(){Di.triggerGC()},isObjectValid:function(e){return null!=e},dump:function(){var e="";e+="isMobile : "+this.isMobile+"\r\n",e+="language : "+this.language+"\r\n",e+="browserType : "+this.browserType+"\r\n",e+="browserVersion : "+this.browserVersion+"\r\n",e+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n",e+="os : "+this.os+"\r\n",e+="osVersion : "+this.osVersion+"\r\n",e+="platform : "+this.platform+"\r\n",g(e+="Using "+(c.game.renderType===c.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n")},openURL:function(e){Di.openURL(e)},now:function(){return Di.now()},restartVM:function(){Di.restartJSVM()},getSafeAreaRect:function(){var e=c.view,t=Di.getSafeAreaEdge(),n=Di.getViewSize(),i=new Kn(t.left,n.height-t.bottom),o=new Kn(n.width-t.right,t.top),r={left:0,top:0,width:n.width,height:n.height};e.convertToLocationInView(i.x,i.y,r,i),e.convertToLocationInView(o.x,o.y,r,o),e._convertPointWithScale(i),e._convertPointWithScale(o);var a=i.x,s=i.y,l=o.x-i.x,u=o.y-i.y;return new oi(a,s,l,u)},__init:function(){try{var e=jx.localStorage=window.localStorage;e.setItem("storage",""),e.removeItem("storage"),e=null}catch(e){var t=function(){P(5200)};jx.localStorage={getItem:t,setItem:t,removeItem:t,clear:t}}var n=window,i=n.navigator,o=document,r=o.documentElement,a=jx.capabilities;(void 0!==r.ontouchstart||void 0!==o.ontouchstart||i.msPointerEnabled)&&(a.touches=!0),void 0!==r.onmouseup&&(a.mouse=!0),void 0!==r.onkeyup&&(a.keyboard=!0),(n.DeviceMotionEvent||n.DeviceOrientationEvent)&&(a.accelerometer=!0),jx.__isWebIOS14OrIPadOS14Env=(jx.os===Ii.IOS||jx.os===Ii.OSX)&&Di.isBrowser&&/(OS 1[4-9])|(Version\/1[4-9])/.test(window.navigator.userAgent),Di.onViewResize((function(){var e=Di.getViewSize();jx.windowPixelResolution={width:Math.round(e.width*Wx),height:Math.round(e.height*Wx)}}))}});jx.__init(),c.sys=jx;var qx,Yx,Xx,Kx,Qx,Zx,Jx,$x,eS,tS,nS,iS,oS,rS=e("fx",(Dx=U_("RenderStage"),Mx=lf(),Lx=lf(),Fx=lf(),Dx((kx=function(){function e(){ue(this,"_name",Ux,this),ue(this,"_priority",Hx,this),ue(this,"_tag",Gx,this)}var t=e.prototype;return t.initialize=function(e){return this._name=e.name,this._priority=e.priority,e.tag&&(this._tag=e.tag),!0},t.activate=function(e,t){this._pipeline=e,this._flow=t},te(e,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}}]),e}(),Ux=he((Bx=kx).prototype,"_name",[Mx,W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Hx=he(Bx.prototype,"_priority",[Lx,W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Gx=he(Bx.prototype,"_tag",[Fx,W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zx=Bx))||zx));c.RenderStage=rS;var aS,sS,cS,lS,uS,hS,_S,fS,dS=e("fw",(qx=U_("RenderFlow"),Yx=lf(),Xx=lf(),Kx=lf(),Qx=lf(),Zx=pf([rS]),qx((oS=function(){function e(){ue(this,"_name",eS,this),ue(this,"_priority",tS,this),ue(this,"_tag",nS,this),ue(this,"_stages",iS,this)}var t=e.prototype;return t.initialize=function(e){return this._name=e.name,this._priority=e.priority,this._stages=e.stages,e.tag&&(this._tag=e.tag),!0},t.activate=function(e){this._pipeline=e,this._stages.sort((function(e,t){return e.priority-t.priority}));for(var t=0,n=this._stages.length;t<n;t++)this._stages[t].activate(e,this)},t.render=function(e){for(var t=0,n=this._stages.length;t<n;t++)this._stages[t].render(e)},t.destroy=function(){for(var e=0,t=this._stages.length;e<t;e++)this._stages[e].destroy();this._stages.length=0},te(e,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}},{key:"stages",get:function(){return this._stages}},{key:"pipeline",get:function(){return this._pipeline}}]),e}(),eS=he(($x=oS).prototype,"_name",[Yx,W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),tS=he($x.prototype,"_priority",[Xx,W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),nS=he($x.prototype,"_tag",[Kx,W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),iS=he($x.prototype,"_stages",[Qx,Zx,W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Jx=$x))||Jx));c.RenderFlow=dS;var pS,mS,vS,gS,yS,xS,SS,ES,TS,AS,CS=e("er",U_("cc.EffectAsset")((fS=_S=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return ue(t=e.call.apply(e,[this].concat(i))||this,"techniques",cS,se(t)),ue(t,"shaders",lS,se(t)),ue(t,"combinations",uS,se(t)),ue(t,"hideInEditor",hS,se(t)),t}ie(t,e),t.register=function(e){t._effects[e.name]=e},t.remove=function(e){if(t._effects[e])delete t._effects[e];else for(var n in t._effects)if(t._effects[n]._uuid===e)return void delete t._effects[n]},t.get=function(e){if(t._effects[e])return t._effects[e];for(var n in t._effects)if(t._effects[n]._uuid===e)return t._effects[n];return null},t.getAll=function(){return t._effects};var n=t.prototype;return n.onLoaded=function(){lm.register(this),t.register(this),c.game.once(c.Game.EVENT_ENGINE_INITED,this._precompile,this)},n._precompile=function(){for(var e=this,t=c.director.root,n=function(n){var i=e.shaders[n],o=e.combinations[n];if(!o)return"continue";Object.keys(o).reduce((function(e,t){return e.reduce((function(e,n){for(var i=o[t],r=0;r<i.length;++r){var a=ne({},n);a[t]=i[r],e.push(a)}return e}),[])}),[{}]).forEach((function(e){return lm.getGFXShader(t.device,i.name,e,t.pipeline)}))},i=0;i<this.shaders.length;i++)n(i)},n.destroy=function(){return t.remove(this.name),e.prototype.destroy.call(this)},n.initDefault=function(n){e.prototype.initDefault.call(this,n);var i=t.get("unlit");this.name="unlit",this.shaders=i.shaders,this.combinations=i.combinations,this.techniques=i.techniques},n.validate=function(){return this.techniques.length>0&&this.shaders.length>0},t}(Yf),_S._effects={},cS=he((sS=fS).prototype,"techniques",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lS=he(sS.prototype,"shaders",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),uS=he(sS.prototype,"combinations",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),hS=he(sS.prototype,"hideInEditor",[W_,j_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),aS=sS))||aS);c.EffectAsset=CS;var wS=new ge("RenderTex"),bS=new Qs;bS.endAccesses=[ts.FRAGMENT_SHADER_READ_TEXTURE];var IS,PS,RS,NS,OS,DS,MS,LS,FS,zS,BS=new Zs,US=new $s([bS],BS),HS={width:1,height:1,renderPassInfo:US},GS=e("dc",(pS=U_("cc.RenderTexture"),mS=rf(),vS=af(),gS=rf(),yS=af(),pS((AS=function(e){function t(){var t;return ue(t=e.call(this)||this,"_width",ES,se(t)),ue(t,"_height",TS,se(t)),t._textureHash=0,t._id=void 0,t._window=null,t._id=wS.getNewId(),t._textureHash=Mc(t._id,666),t}ie(t,e);var n=t.prototype;return n.getHash=function(){return this._textureHash},n.initialize=function(e){this._name=e.name||"",this._width=e.width,this._height=e.height,this._initWindow(e)},n.reset=function(e){this.initialize(e)},n.destroy=function(){return this._window&&(c.director.root.destroyWindow(this._window),this._window=null),e.prototype.destroy.call(this)},n.resize=function(e,t){this._width=e,this._height=t,this._window&&this._window.resize(e,t),this.emit("resize",this._window)},n.getGFXTexture=function(){return this._window&&this._window.framebuffer.colorTextures[0]},n.getGFXSampler=function(){var e=c.director.root;return Td.getSampler(e.device,ad)},n.getSamplerHash=function(){return ad},n.onLoaded=function(){this._initWindow(),this.loaded=!0,this.emit("load")},n._initWindow=function(e){var t=c.director.root;HS.title=this._name,HS.width=this._width,HS.height=this._height,HS.renderPassInfo=e&&e.passInfo?e.passInfo:US,this._window?(this._window.destroy(),this._window.initialize(t.device,HS)):this._window=t.createWindow(HS)},n.initDefault=function(t){e.prototype.initDefault.call(this,t),this._width=this._height=1,this._initWindow()},n.validate=function(){return this.width>=1&&this.width<=2048&&this.height>=1&&this.height<=2048},te(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"window",get:function(){return this._window}}]),t}(Yf),ES=he((SS=AS).prototype,"_width",[W_,mS,vS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),TS=he(SS.prototype,"_height",[W_,gS,yS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),xS=SS))||xS));c.RenderTexture=GS;var kS=e("cK",(IS=U_("cc.Material"),PS=pf(CS),IS((zS=function(e){function t(){var t;return ue(t=e.call(this)||this,"_effectAsset",OS,se(t)),ue(t,"_techIdx",DS,se(t)),ue(t,"_defines",MS,se(t)),ue(t,"_states",LS,se(t)),ue(t,"_props",FS,se(t)),t._passes=[],t._hash=0,t.loaded=!1,t}ie(t,e),t.getHash=function(e){for(var t,n=0,i=le(e.passes);!(t=i()).done;)n^=t.value.hash;return n};var n=t.prototype;return n.initialize=function(e){this._passes.length?P(12005):(this._defines||(this._defines=[]),this._states||(this._states=[]),this._props||(this._props=[]),void 0!==e.technique&&(this._techIdx=e.technique),e.effectAsset?this._effectAsset=e.effectAsset:e.effectName&&(this._effectAsset=CS.get(e.effectName)),e.defines&&this._prepareInfo(e.defines,this._defines),e.states&&this._prepareInfo(e.states,this._states),this._update())},n.reset=function(e){this.initialize(e)},n.destroy=function(){return this._doDestroy(),e.prototype.destroy.call(this)},n.recompileShaders=function(){console.warn("Shaders in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},n.overridePipelineStates=function(){console.warn("Pipeline states in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},n.onLoaded=function(){this._update(),this.loaded=!0,this.emit("load")},n.resetUniforms=function(e){void 0===e&&(e=!0),this._props.length=this._passes.length;for(var t=0;t<this._props.length;t++)this._props[t]={};if(e)for(var n,i=le(this._passes);!(n=i()).done;){var o=n.value;o.resetUBOs(),o.resetTextures()}},n.setProperty=function(e,t,n){var i=!1;if(void 0===n)for(var o=this._passes,r=o.length,a=0;a<r;a++){var s=o[a];this._uploadProperty(s,e,t)&&(this._props[s.propertyIndex][e]=t,i=!0)}else{if(n>=this._passes.length)return void console.warn("illegal pass index: "+n+".");var c=this._passes[n];this._uploadProperty(c,e,t)&&(this._props[c.propertyIndex][e]=t,i=!0)}i||console.warn("illegal property name: "+e+".")},n.getProperty=function(e,t){if(void 0===t)for(var n=this._props,i=n.length,o=0;o<i;o++){var r=n[o];if(e in r)return r[e]}else{if(t>=this._props.length)return console.warn("illegal pass index: "+t+"."),null;var a=this._props[this._passes[t].propertyIndex];if(e in a)return a[e]}return null},n.copy=function(e){this._techIdx=e._techIdx,this._props.length=e._props.length;for(var t=0;t<e._props.length;t++)this._props[t]=ne({},e._props[t]);this._defines.length=e._defines.length;for(var n=0;n<e._defines.length;n++)this._defines[n]=ne({},e._defines[n]);this._states.length=e._states.length;for(var i=0;i<e._states.length;i++)this._states[i]=ne({},e._states[i]);this._effectAsset=e._effectAsset,this._update()},n._prepareInfo=function(e,t){var n=e;if(!Array.isArray(n)){var i=this._effectAsset?this._effectAsset.techniques[this._techIdx].passes.length:1;n=Array(i).fill(n)}for(var o=0;o<n.length;++o)Object.assign(t[o]||(t[o]={}),n[o])},n._createPasses=function(){var e=this._effectAsset.techniques[this._techIdx||0];if(!e)return[];for(var t=e.passes.length,n=[],i=0;i<t;++i){var o=e.passes[i],r=o.passIndex=i,a=o.defines=this._defines[r]||(this._defines[r]={}),s=o.stateOverrides=this._states[r]||(this._states[r]={});if(void 0!==o.propertyIndex&&(Object.assign(a,this._defines[o.propertyIndex]),Object.assign(s,this._states[o.propertyIndex])),void 0!==o.embeddedMacros&&Object.assign(a,o.embeddedMacros),!o.switch||a[o.switch]){var l=new xm(c.director.root);l.initialize(o),n.push(l)}}return n},n._update=function(e){var n=this;if(void 0===e&&(e=!0),this._effectAsset){this._passes=this._createPasses();var i=this._effectAsset.techniques[this._techIdx].passes.length;if(this._props.length=i,e)this._passes.forEach((function(e,t){var i=n._props[t];for(var o in i||(i=n._props[t]={}),void 0!==e.propertyIndex&&Object.assign(i,n._props[e.propertyIndex]),i)n._uploadProperty(e,o,i[o])}));else for(var o=0;o<this._props.length;o++)this._props[o]={}}this._hash=t.getHash(this)},n._uploadProperty=function(e,t,n){var i=e.getHandle(t);if(!i)return!1;var o=xm.getPropertyTypeFromHandle(i);if(o===Up.BUFFER)Array.isArray(n)?e.setUniformArray(i,n):null!==n?e.setUniform(i,n):e.resetUniform(t);else if(o===Up.TEXTURE)if(Array.isArray(n))for(var r=0;r<n.length;r++)this._bindTexture(e,i,n[r],r);else n?this._bindTexture(e,i,n):e.resetTexture(t);return!0},n._bindTexture=function(e,t,n,i){var o=xm.getBindingFromHandle(t);if(n instanceof Kc)e.bindTexture(o,n,i);else if(n instanceof Cd||n instanceof GS){var r=n.getGFXTexture();if(!r||!r.width||!r.height)return;e.bindTexture(o,r,i),e.bindSampler(o,n.getGFXSampler(),i)}},n._doDestroy=function(){if(this._passes&&this._passes.length)for(var e,t=le(this._passes);!(e=t()).done;)e.value.destroy();this._passes.length=0},n.initDefault=function(t){e.prototype.initDefault.call(this,t),this.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),this.setProperty("mainColor",new In("#ff00ff"))},n.validate=function(){return!!this._effectAsset&&!this._effectAsset.isDefault&&this.passes.length>0},te(t,[{key:"effectAsset",get:function(){return this._effectAsset}},{key:"effectName",get:function(){return this._effectAsset?this._effectAsset.name:""}},{key:"technique",get:function(){return this._techIdx}},{key:"passes",get:function(){return this._passes}},{key:"hash",get:function(){return this._hash}},{key:"parent",get:function(){return null}},{key:"owner",get:function(){return null}}]),t}(Yf),OS=he((NS=zS).prototype,"_effectAsset",[PS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),DS=he(NS.prototype,"_techIdx",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),MS=he(NS.prototype,"_defines",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),LS=he(NS.prototype,"_states",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),FS=he(NS.prototype,"_props",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),RS=NS))||RS));c.Material=kS;var VS=ct({Planar:0,ShadowMap:1}),WS=ct({HARD:0,SOFT:1,SOFT_2X:2}),jS=VS.ShadowMap+1,qS=function(){function e(){this.sphere=new fs(0,0,0,.01),this.maxReceived=4,this._normal=new Rn(0,1,0),this._shadowColor=new In(0,0,0,76),this._matLight=new jn,this._material=null,this._instancingMaterial=null,this._size=new Kn(512,512),this._handle=No,this._handle=Fr.alloc()}var t=e.prototype;return t.getPlanarShader=function(e){return this._material||(this._material=new kS,this._material.initialize({effectName:"planar-shadow"}),Fr.set(this._handle,Or.PLANAR_PASS,this._material.passes[0].handle)),this._material.passes[0].getShaderVariant(e)},t.getPlanarInstanceShader=function(e){return this._instancingMaterial||(this._instancingMaterial=new kS,this._instancingMaterial.initialize({effectName:"planar-shadow",defines:{USE_INSTANCING:!0}}),Fr.set(this._handle,Or.INSTANCE_PASS,this._instancingMaterial.passes[0].handle)),this._instancingMaterial.passes[0].getShaderVariant(e)},t.initialize=function(e){Fr.set(this._handle,Or.TYPE,e.enabled?e.type:jS),Fr.set(this._handle,Or.NEAR,e.near),Fr.set(this._handle,Or.FAR,e.far),Fr.set(this._handle,Or.ASPECT,e.aspect),Fr.set(this._handle,Or.ORTHO_SIZE,e.orthoSize),this._size=e.shadowMapSize,Fr.setVec2(this._handle,Or.SIZE,this._size),Fr.set(this._handle,Or.PCF_TYPE,e.pcf),Rn.copy(this._normal,e.normal),Fr.setVec3(this._handle,Or.NORMAL,this._normal),Fr.set(this._handle,Or.DISTANCE,e.distance),this._shadowColor.set(e.shadowColor),Fr.setVec4(this._handle,Or.COLOR,this._shadowColor),Fr.set(this._handle,Or.BIAS,e.bias),Fr.set(this._handle,Or.PACKING,e.packing?1:0),Fr.set(this._handle,Or.LINEAR,e.linear?1:0),Fr.set(this._handle,Or.SELF_SHADOW,e.selfShadow?1:0),Fr.set(this._handle,Or.NORMAL_BIAS,e.normalBias),Fr.set(this._handle,Or.ENABLE,e.enabled?1:0),this.maxReceived=e.maxReceived,Fr.set(this._handle,Or.AUTO_ADAPT,e.autoAdapt?1:0)},t.activate=function(){if(this.enabled)this.type===VS.ShadowMap?this._updatePipeline():this._updatePlanarInfo();else{var e=c.director.root;e.pipeline.macros.CC_RECEIVE_SHADOW=0,e.onGlobalPipelineStateChanged()}},t._updatePlanarInfo=function(){this._material||(this._material=new kS,this._material.initialize({effectName:"planar-shadow"}),Fr.set(this._handle,Or.PLANAR_PASS,this._material.passes[0].handle)),this._instancingMaterial||(this._instancingMaterial=new kS,this._instancingMaterial.initialize({effectName:"planar-shadow",defines:{USE_INSTANCING:!0}}),Fr.set(this._handle,Or.INSTANCE_PASS,this._instancingMaterial.passes[0].handle));var e=c.director.root;e.pipeline.macros.CC_RECEIVE_SHADOW=0,e.onGlobalPipelineStateChanged()},t._updatePipeline=function(){var e=c.director.root;e.pipeline.macros.CC_RECEIVE_SHADOW=1,e.onGlobalPipelineStateChanged()},t.destroy=function(){this._material&&this._material.destroy(),this._instancingMaterial&&this._instancingMaterial.destroy(),this._handle&&(Fr.free(this._handle),this._handle=No),this.sphere.destroy()},te(e,[{key:"enabled",get:function(){return!!Fr.get(this._handle,Or.ENABLE)},set:function(e){Fr.set(this._handle,Or.ENABLE,e?1:0),e||Fr.set(this._handle,Or.TYPE,jS),this.activate()}},{key:"normal",get:function(){return this._normal},set:function(e){Rn.copy(this._normal,e),Fr.setVec3(this._handle,Or.NORMAL,this._normal)}},{key:"distance",get:function(){return Fr.get(this._handle,Or.DISTANCE)},set:function(e){Fr.set(this._handle,Or.DISTANCE,e)}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(e){this._shadowColor=e,Fr.setVec4(this._handle,Or.COLOR,e)}},{key:"type",get:function(){return Fr.get(this._handle,Or.TYPE)},set:function(e){Fr.set(this._handle,Or.TYPE,this.enabled?e:jS),this.activate()}},{key:"near",get:function(){return Fr.get(this._handle,Or.NEAR)},set:function(e){Fr.set(this._handle,Or.NEAR,e)}},{key:"far",get:function(){return Fr.get(this._handle,Or.FAR)},set:function(e){Fr.set(this._handle,Or.FAR,e)}},{key:"aspect",get:function(){return Fr.get(this._handle,Or.ASPECT)},set:function(e){Fr.set(this._handle,Or.ASPECT,e)}},{key:"orthoSize",get:function(){return Fr.get(this._handle,Or.ORTHO_SIZE)},set:function(e){Fr.set(this._handle,Or.ORTHO_SIZE,e)}},{key:"size",get:function(){return this._size},set:function(e){this._size=e,Fr.setVec2(this._handle,Or.SIZE,this._size)}},{key:"pcf",get:function(){return Fr.get(this._handle,Or.PCF_TYPE)},set:function(e){Fr.set(this._handle,Or.PCF_TYPE,e)}},{key:"shadowMapDirty",get:function(){return!!Fr.get(this._handle,Or.SHADOW_MAP_DIRTY)},set:function(e){Fr.set(this._handle,Or.SHADOW_MAP_DIRTY,e?1:0)}},{key:"bias",get:function(){return Fr.get(this._handle,Or.BIAS)},set:function(e){Fr.set(this._handle,Or.BIAS,e)}},{key:"packing",get:function(){return!!Fr.get(this._handle,Or.PACKING)},set:function(e){Fr.set(this._handle,Or.PACKING,e?1:0)}},{key:"linear",get:function(){return!!Fr.get(this._handle,Or.LINEAR)},set:function(e){Fr.set(this._handle,Or.LINEAR,e?1:0)}},{key:"selfShadow",get:function(){return!!Fr.get(this._handle,Or.SELF_SHADOW)},set:function(e){Fr.set(this._handle,Or.SELF_SHADOW,e?1:0)}},{key:"normalBias",get:function(){return Fr.get(this._handle,Or.NORMAL_BIAS)},set:function(e){Fr.set(this._handle,Or.NORMAL_BIAS,e)}},{key:"autoAdapt",get:function(){return!!Fr.get(this._handle,Or.AUTO_ADAPT)},set:function(e){Fr.set(this._handle,Or.AUTO_ADAPT,e?1:0)}},{key:"matLight",get:function(){return this._matLight}},{key:"material",get:function(){return this._material}},{key:"instancingMaterial",get:function(){return this._instancingMaterial}},{key:"handle",get:function(){return this._handle}}]),e}();qS.MAX_FAR=2e3,qS.COEFFICIENT_OF_EXPANSION=2*Math.sqrt(3),c.Shadows=qS;var YS=new Rn,XS=new Rn,KS=new Rn,QS=new jn,ZS=new vu,JS=!1,$S=[],eE=fs.create(0,0,0,1),tE=new ci((function(){return{model:null,depth:0}}),128),nE=new ci((function(){return{model:null,depth:0}}),128);function iE(e,t){var n=0;e.node&&(Rn.subtract(YS,e.node.worldPosition,t.position),n=Rn.dot(YS,t.forward));var i=tE.alloc();return i.model=e,i.depth=n,i}function oE(e,t){var n=0;e.node&&(Rn.subtract(YS,e.node.worldPosition,t.position),n=Rn.dot(YS,t.forward));var i=nE.alloc();return i.model=e,i.depth=n,i}function rE(e,t,n,i){var o=e.pipelineSceneData.shadows;Rn.negate(XS,n);var r=o.sphere.radius*qS.COEFFICIENT_OF_EXPANSION;return Rn.multiplyScalar(KS,XS,r),Rn.add(KS,KS,o.sphere.center),i.set(KS),jn.fromRT(QS,t,KS),QS}function aE(e,t,n){var i=t.direction,o=e.normal,r=e.distance+.001,a=1/Rn.dot(o,i),s=i.x*a,c=i.y*a,l=i.z*a,u=o.x,h=o.y,_=o.z,f=e.matLight;f.m00=1-u*s,f.m01=-u*c,f.m02=-u*l,f.m03=0,f.m04=-h*s,f.m05=1-h*c,f.m06=-h*l,f.m07=0,f.m08=-_*s,f.m09=-_*c,f.m10=1-_*l,f.m11=0,f.m12=s*r,f.m13=c*r,f.m14=l*r,f.m15=1,jn.toArray(n,f,hh.MAT_LIGHT_PLANE_PROJ_OFFSET)}function sE(e,t){var n=t.scene,i=n.mainLight,o=e.pipelineSceneData,r=o.shadows,a=o.skybox,s=o.renderObjects;tE.freeArray(s),s.length=0;var c=null;JS=!1,r.enabled&&(e.pipelineUBO.updateShadowUBORange(hh.SHADOW_COLOR_OFFSET,r.shadowColor),r.type===VS.ShadowMap&&(c=e.pipelineSceneData.shadowObjects,nE.freeArray(c),c.length=0)),i&&r.type===VS.Planar&&function(e,t){var n=e.pipelineSceneData.shadows,i=t.direction,o=n.normal,r=n.distance+.001,a=1/Rn.dot(o,i),s=i.x*a,c=i.y*a,l=i.z*a,u=o.x,h=o.y,_=o.z,f=n.matLight;f.m00=1-u*s,f.m01=-u*c,f.m02=-u*l,f.m03=0,f.m04=-h*s,f.m05=1-h*c,f.m06=-h*l,f.m07=0,f.m08=-_*s,f.m09=-_*c,f.m10=1-_*l,f.m11=0,f.m12=s*r,f.m13=c*r,f.m14=l*r,f.m15=1,e.pipelineUBO.updateShadowUBORange(hh.MAT_LIGHT_PLANE_PROJ_OFFSET,n.matLight)}(e,i),a.enabled&&a.model&&t.clearFlag&b_&&s.push(iE(a.model,t));for(var l=n.models,u=t.visibility,h=0;h<l.length;h++){var _=l[h];if(_.enabled&&(_.node&&(u&_.node.layer)===_.node.layer||u&_.visFlags)){if(null!=c&&_.castShadow&&_.worldBounds&&(JS||(ZS.copy(_.worldBounds),JS=!0),vu.merge(ZS,ZS,_.worldBounds),c.push(oE(_,t))),_.worldBounds&&!ru.aabbFrustum(_.worldBounds,t.frustum))continue;s.push(iE(_,t))}}ZS&&vu.toBoundingSphere(r.sphere,ZS)}var cE=new jn,lE=new jn,uE=new Rn,hE=new $n,_E=function(){function e(){this._globalUBO=new Float32Array(lh.COUNT),this._cameraUBO=new Float32Array(uh.COUNT),this._shadowUBO=new Float32Array(hh.COUNT)}e.updateGlobalUBOView=function(e,t){var n=e.device,i=c.director.root,o=t,r=Math.floor(n.width),a=Math.floor(n.height);o[lh.TIME_OFFSET]=i.cumulativeTime,o[lh.TIME_OFFSET+1]=i.frameTime,o[lh.TIME_OFFSET+2]=c.director.getTotalFrames(),o[lh.SCREEN_SIZE_OFFSET]=n.width,o[lh.SCREEN_SIZE_OFFSET+1]=n.height,o[lh.SCREEN_SIZE_OFFSET+2]=1/n.width,o[lh.SCREEN_SIZE_OFFSET+3]=1/n.height,o[lh.NATIVE_SIZE_OFFSET]=r,o[lh.NATIVE_SIZE_OFFSET+1]=a,o[lh.NATIVE_SIZE_OFFSET+2]=1/o[lh.NATIVE_SIZE_OFFSET],o[lh.NATIVE_SIZE_OFFSET+3]=1/o[lh.NATIVE_SIZE_OFFSET+1]},e.updateCameraUBOView=function(e,t,n){var i=e.device,o=(n.scene?n.scene:c.director.getScene().renderScene).mainLight,r=e.pipelineSceneData,a=r.ambient,s=r.fog,l=Math.floor(i.width),u=Math.floor(i.height),h=t,_=n.exposure,f=r.isHDR,d=r.shadingScale,p=r.fpScale;if(h[uh.SCREEN_SCALE_OFFSET]=n.width/l*d,h[uh.SCREEN_SCALE_OFFSET+1]=n.height/u*d,h[uh.SCREEN_SCALE_OFFSET+2]=1/h[uh.SCREEN_SCALE_OFFSET],h[uh.SCREEN_SCALE_OFFSET+3]=1/h[uh.SCREEN_SCALE_OFFSET+1],h[uh.EXPOSURE_OFFSET]=_,h[uh.EXPOSURE_OFFSET+1]=1/_,h[uh.EXPOSURE_OFFSET+2]=f?1:0,h[uh.EXPOSURE_OFFSET+3]=p/_,o){if(Rn.toArray(h,o.direction,uh.MAIN_LIT_DIR_OFFSET),Rn.toArray(h,o.color,uh.MAIN_LIT_COLOR_OFFSET),o.useColorTemperature){var m=o.colorTemperatureRGB;h[uh.MAIN_LIT_COLOR_OFFSET]*=m.x,h[uh.MAIN_LIT_COLOR_OFFSET+1]*=m.y,h[uh.MAIN_LIT_COLOR_OFFSET+2]*=m.z}h[uh.MAIN_LIT_COLOR_OFFSET+3]=f?o.illuminance*p:o.illuminance*_}else Rn.toArray(h,Rn.UNIT_Z,uh.MAIN_LIT_DIR_OFFSET),$n.toArray(h,$n.ZERO,uh.MAIN_LIT_COLOR_OFFSET);var v=a.colorArray;v[3]=f?a.skyIllum*p:a.skyIllum*_,h.set(v,uh.AMBIENT_SKY_OFFSET),h.set(a.albedoArray,uh.AMBIENT_GROUND_OFFSET),jn.toArray(h,n.matView,uh.MAT_VIEW_OFFSET),jn.toArray(h,n.node.worldMatrix,uh.MAT_VIEW_INV_OFFSET),Rn.toArray(h,n.position,uh.CAMERA_POS_OFFSET),jn.toArray(h,n.matProj,uh.MAT_PROJ_OFFSET),jn.toArray(h,n.matProjInv,uh.MAT_PROJ_INV_OFFSET),jn.toArray(h,n.matViewProj,uh.MAT_VIEW_PROJ_OFFSET),jn.toArray(h,n.matViewProjInv,uh.MAT_VIEW_PROJ_INV_OFFSET),h[uh.CAMERA_POS_OFFSET+3]=this.getCombineSignY(),h.set(s.colorArray,uh.GLOBAL_FOG_COLOR_OFFSET),h[uh.GLOBAL_FOG_BASE_OFFSET]=s.fogStart,h[uh.GLOBAL_FOG_BASE_OFFSET+1]=s.fogEnd,h[uh.GLOBAL_FOG_BASE_OFFSET+2]=s.fogDensity,h[uh.GLOBAL_FOG_ADD_OFFSET]=s.fogTop,h[uh.GLOBAL_FOG_ADD_OFFSET+1]=s.fogRange,h[uh.GLOBAL_FOG_ADD_OFFSET+2]=s.fogAtten},e.updateShadowUBOView=function(e,t,n){var i=e.device,o=n.scene.mainLight,r=e.pipelineSceneData.shadows,a=t;if(r.enabled){if(o&&r.type===VS.ShadowMap){var s,c=0,l=0,u=0;if(r.autoAdapt){s=rE(e,o.node.getWorldRotation(),o.direction,uE);var h=r.sphere.radius;c=h*r.aspect,l=h;var _=Rn.distance(r.sphere.center,uE);u=Math.min(_*qS.COEFFICIENT_OF_EXPANSION,qS.MAX_FAR)}else s=o.node.getWorldMatrix(),c=r.orthoSize*r.aspect,l=r.orthoSize,u=r.far;jn.toArray(a,s,hh.MAT_LIGHT_VIEW_OFFSET),jn.invert(cE,s),jn.ortho(lE,-c,c,-l,l,r.near,u,i.capabilities.clipSpaceMinZ,i.capabilities.clipSpaceSignY),jn.multiply(lE,lE,cE),jn.toArray(a,lE,hh.MAT_LIGHT_VIEW_PROJ_OFFSET);var f=g_(i),d=r.linear&&f?1:0;a[hh.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET+0]=r.near,a[hh.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET+1]=u,a[hh.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET+2]=d,a[hh.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET+3]=r.selfShadow?1:0,a[hh.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+0]=r.size.x,a[hh.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+1]=r.size.y,a[hh.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+2]=r.pcf,a[hh.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+3]=r.bias;var p=r.packing?1:f?0:1;a[hh.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+0]=0,a[hh.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+1]=p,a[hh.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+2]=r.normalBias,a[hh.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+3]=0}else o&&r.type===VS.Planar&&aE(r,o,a);In.toArray(a,r.shadowColor,hh.SHADOW_COLOR_OFFSET)}},e.updateShadowUBOLightView=function(e,t,n){var i,o=e.device,r=e.pipelineSceneData.shadows,a=t,s=g_(o),c=r.linear&&s?1:0,l=r.packing?1:s?0:1,u=0,h=0,_=0;switch(n.type){case Em.DIRECTIONAL:if(n.update(),r.autoAdapt){var f=n.node;f&&(i=rE(e,f.getWorldRotation(),n.direction,uE));var d=r.sphere.radius;u=d*r.aspect,h=d;var p=Rn.distance(r.sphere.center,uE);_=Math.min(p*qS.COEFFICIENT_OF_EXPANSION,qS.MAX_FAR)}else i=n.node.getWorldMatrix(),u=r.orthoSize*r.aspect,h=r.orthoSize,_=r.far;jn.toArray(a,i,hh.MAT_LIGHT_VIEW_OFFSET),jn.invert(cE,i),hE.set(r.near,_,c,r.selfShadow?1:0),$n.toArray(a,hE,hh.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET),hE.set(0,l,r.normalBias,0),$n.toArray(a,hE,hh.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET),jn.ortho(lE,-u,u,-h,h,r.near,_,o.capabilities.clipSpaceMinZ,o.capabilities.clipSpaceSignY);break;case Em.SPOT:jn.toArray(a,n.node.getWorldMatrix(),hh.MAT_LIGHT_VIEW_OFFSET),jn.invert(cE,n.node.getWorldMatrix()),hE.set(.01,n.range,c,r.selfShadow?1:0),$n.toArray(a,hE,hh.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET),hE.set(1,l,r.normalBias,0),$n.toArray(a,hE,hh.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET),jn.perspective(lE,n.spotAngle,n.aspect,.001,n.range)}jn.multiply(lE,lE,cE),jn.toArray(a,lE,hh.MAT_LIGHT_VIEW_PROJ_OFFSET),hE.set(r.size.x,r.size.y,r.pcf,r.bias),$n.toArray(a,hE,hh.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET),In.toArray(a,r.shadowColor,hh.SHADOW_COLOR_OFFSET)},e.getCombineSignY=function(){return e._combineSignY};var t=e.prototype;return t._initCombineSignY=function(){var t=this._device;e._combineSignY=.5*t.capabilities.screenSpaceSignY+.5<<1|.5*t.capabilities.clipSpaceSignY+.5},t.activate=function(e,t){this._device=e,this._pipeline=t;var n=this._pipeline.descriptorSet;this._initCombineSignY();var i=e.createBuffer(new Rs(za.UNIFORM|za.TRANSFER_DST,Ha.HOST|Ha.DEVICE,lh.SIZE,lh.SIZE));n.bindBuffer(lh.BINDING,i);var o=e.createBuffer(new Rs(za.UNIFORM|za.TRANSFER_DST,Ha.HOST|Ha.DEVICE,uh.SIZE,uh.SIZE));n.bindBuffer(uh.BINDING,o);var r=e.createBuffer(new Rs(za.UNIFORM|za.TRANSFER_DST,Ha.HOST|Ha.DEVICE,hh.SIZE,hh.SIZE));n.bindBuffer(hh.BINDING,r)},t.updateGlobalUBO=function(){var t=this._pipeline.globalDSManager,n=this._pipeline.descriptorSet,i=this._pipeline.commandBuffers;n.update(),e.updateGlobalUBOView(this._pipeline,this._globalUBO),i[0].updateBuffer(n.getBuffer(lh.BINDING),this._globalUBO),t.bindBuffer(lh.BINDING,n.getBuffer(lh.BINDING)),t.update()},t.updateCameraUBO=function(t){var n=this._pipeline.globalDSManager,i=this._pipeline.descriptorSet,o=this._pipeline.commandBuffers;e.updateCameraUBOView(this._pipeline,this._cameraUBO,t),o[0].updateBuffer(i.getBuffer(uh.BINDING),this._cameraUBO),n.bindBuffer(uh.BINDING,i.getBuffer(uh.BINDING)),n.update()},t.updateShadowUBO=function(t){var n=this._pipeline.pipelineSceneData;if(n.shadows.enabled){var i=this._pipeline.descriptorSet,o=this._pipeline.commandBuffers,r=n.shadowFrameBufferMap,a=t.scene.mainLight;i.update(),a&&r.has(a)&&i.bindTexture(_h,r.get(a).colorTextures[0]),e.updateShadowUBOView(this._pipeline,this._shadowUBO,t),o[0].updateBuffer(i.getBuffer(hh.BINDING),this._shadowUBO)}},t.updateShadowUBOLight=function(t){var n=this._pipeline.descriptorSet;e.updateShadowUBOLightView(this._pipeline,this._shadowUBO,t),n.getBuffer(hh.BINDING).update(this._shadowUBO)},t.updateShadowUBORange=function(e,t){t instanceof jn?jn.toArray(this._shadowUBO,t,e):t instanceof In&&In.toArray(this._shadowUBO,t,e)},t.destroy=function(){},e}();_E._combineSignY=0;var fE=ct({LINEAR:0,EXP:1,EXP_SQUARED:2,LAYERED:3}),dE=fE.LAYERED+1,pE=function(){function e(){this._fogColor=new In("#C8C8C8"),this._colorArray=new Float32Array([.2,.2,.2,1]),this._handle=No,this._handle=Dr.alloc()}var t=e.prototype;return t.initialize=function(e){Dr.set(this._handle,Ir.ENABLE,e.enabled?1:0),Dr.set(this._handle,Ir.TYPE,e.enabled?e.type:dE),this._fogColor.set(e.fogColor),In.toArray(this._colorArray,this._fogColor),Dr.setVec4(this._handle,Ir.COLOR,this._fogColor),Dr.set(this._handle,Ir.DENSITY,e.fogDensity),Dr.set(this._handle,Ir.START,e.fogStart),Dr.set(this._handle,Ir.END,e.fogEnd),Dr.set(this._handle,Ir.ATTEN,e.fogAtten),Dr.set(this._handle,Ir.TOP,e.fogTop),Dr.set(this._handle,Ir.RANGE,e.fogRange)},t.activate=function(){this._updatePipeline()},t._updatePipeline=function(){var e=c.director.root,t=this.enabled?this.type:dE,n=e.pipeline;n.macros.CC_USE_FOG!==t&&(n.macros.CC_USE_FOG=t,e.onGlobalPipelineStateChanged())},t.destroy=function(){this._handle&&(Dr.free(this._handle),this._handle=No)},te(e,[{key:"enabled",get:function(){return Dr.get(this._handle,Ir.ENABLE)},set:function(e){Dr.set(this._handle,Ir.ENABLE,e?1:0),e||Dr.set(this._handle,Ir.TYPE,dE),e?this.activate():this._updatePipeline()}},{key:"fogColor",get:function(){return this._fogColor},set:function(e){this._fogColor.set(e),In.toArray(this._colorArray,this._fogColor),Dr.setVec4(this._handle,Ir.COLOR,this._fogColor)}},{key:"type",get:function(){return Dr.get(this._handle,Ir.TYPE)},set:function(e){Dr.set(this._handle,Ir.TYPE,this.enabled?e:dE),this.enabled&&this._updatePipeline()}},{key:"fogDensity",get:function(){return Dr.get(this._handle,Ir.DENSITY)},set:function(e){Dr.set(this._handle,Ir.DENSITY,e)}},{key:"fogStart",get:function(){return Dr.get(this._handle,Ir.START)},set:function(e){Dr.set(this._handle,Ir.START,e)}},{key:"fogEnd",get:function(){return Dr.get(this._handle,Ir.END)},set:function(e){Dr.set(this._handle,Ir.END,e)}},{key:"fogAtten",get:function(){return Dr.get(this._handle,Ir.ATTEN)},set:function(e){Dr.set(this._handle,Ir.ATTEN,e)}},{key:"fogTop",get:function(){return Dr.get(this._handle,Ir.TOP)},set:function(e){Dr.set(this._handle,Ir.TOP,e)}},{key:"fogRange",get:function(){return Dr.get(this._handle,Ir.RANGE)},set:function(e){Dr.set(this._handle,Ir.RANGE,e)}},{key:"colorArray",get:function(){return this._colorArray}},{key:"handle",get:function(){return this._handle}}]),e}();c.Fog=pE;var mE=function(e){function t(t,n){var i;(i=e.call(this,t.root)||this)._parent=void 0,i._owner=void 0,i._dontNotify=!1,i._parent=t,i._owner=n,i._doInit(i._parent,!0);for(var o=0;o<i._shaderInfo.blocks.length;o++){var r=i._shaderInfo.blocks[o],a=i._blocks[r.binding],s=i._parent.blocks[r.binding];a.set(s)}i._rootBufferDirty=!0;for(var c=i._parent,l=0;l<i._shaderInfo.samplerTextures.length;l++)for(var u=i._shaderInfo.samplerTextures[l],h=0;h<u.count;h++){var _=c._descriptorSet.getSampler(u.binding,h),f=c._descriptorSet.getTexture(u.binding,h);i._descriptorSet.bindSampler(u.binding,_,h),i._descriptorSet.bindTexture(u.binding,f,h)}return e.prototype.tryCompile.call(se(i)),i}ie(t,e);var n=t.prototype;return n.overridePipelineStates=function(e,t){this._bs.reset(),this._rs.reset(),this._dss.reset(),xm.fillPipelineInfo(this,e),xm.fillPipelineInfo(this,t),this._onStateChange()},n.tryCompile=function(t){if(t&&!tm(this._defines,t))return!1;var n=e.prototype.tryCompile.call(this);return this._onStateChange(),n},n.beginChangeStatesSilently=function(){this._dontNotify=!0},n.endChangeStatesSilently=function(){this._dontNotify=!1},n._syncBatchingScheme=function(){this._defines.USE_BATCHING=this._defines.USE_INSTANCING=!1,this.batchingScheme=0},n._onStateChange=function(){this.hash=xm.getPassHash(this,this._hShaderDefault),this._owner.onPassStateChange(this._dontNotify)},te(t,[{key:"parent",get:function(){return this._parent}}]),t}(xm),vE=e("d8",function(e){function t(t){var n;return(n=e.call(this)||this)._passes=[],n._parent=void 0,n._owner=void 0,n._subModelIdx=0,n._parent=t.parent,n._owner=t.owner||null,n._subModelIdx=t.subModelIdx||0,n.copy(n._parent),n}ie(t,e);var n=t.prototype;return n.recompileShaders=function(e,t){if(this._passes&&this.effectAsset)if(void 0===t)for(var n,i=le(this._passes);!(n=i()).done;)n.value.tryCompile(e);else this._passes[t].tryCompile(e)},n.overridePipelineStates=function(e,t){if(this._passes&&this.effectAsset){var n=this.effectAsset.techniques[this.technique].passes;if(void 0===t)for(var i=0;i<this._passes.length;i++){var o=this._passes[i],r=this._states[i]||(this._states[i]={});for(var a in e)r[a]=e[a];o.overridePipelineStates(n[o.passIndex],r)}else{var s=this._states[t]||(this._states[t]={});for(var c in e)s[c]=e[c];this._passes[t].overridePipelineStates(n[t],s)}}},n.destroy=function(){return this._doDestroy(),!0},n.onPassStateChange=function(e){this._hash=kS.getHash(this),!e&&this._owner&&this._owner._onRebuildPSO(this._subModelIdx,this)},n._createPasses=function(){var e=[],t=this._parent.passes;if(!t)return e;for(var n=0;n<t.length;++n)e.push(new mE(t[n],this));return e},te(t,[{key:"parent",get:function(){return this._parent}},{key:"owner",get:function(){return this._owner}}]),t}(kS)),gE=null,yE=null,xE=function(){function e(){this._envmap=null,this._globalDSManager=null,this._model=null,this._default=null,this._handle=No,this._handle=Rr.alloc()}var t=e.prototype;return t.initialize=function(e){Rr.set(this._handle,wr.ENABLE,e.enabled?1:0),Rr.set(this._handle,wr.USE_IBL,e.useIBL?1:0),Rr.set(this._handle,wr.IS_RGBE,e.isRGBE?1:0),this._envmap=e.envmap},t.activate=function(){var e=c.director.root.pipeline,t=e.pipelineSceneData.ambient;if(this._globalDSManager=e.globalDSManager,this._default=pm.get("default-cube-texture"),this._model||(this._model=c.director.root.createModel(c.renderer.scene.Model),this._model._initLocalDescriptors=function(){}),Rr.set(this._handle,wr.MODEL,this._model.handle),this._envmap||(this._envmap=this._default),t.albedoArray[3]=this._envmap.mipmapLevel,yE)yE.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE});else{var n=new kS;n.initialize({effectName:"skybox",defines:{USE_RGBE_CUBEMAP:this.isRGBE}}),yE=new vE({parent:n})}this.enabled&&(gE||(gE=c.utils.createMesh(c.primitives.box({width:2,height:2,length:2}))),this._model.initSubModel(0,gE.renderingSubMeshes[0],yE)),this._updateGlobalBinding(),this._updatePipeline()},t._updatePipeline=function(){var e=this.useIBL?this.isRGBE?2:1:0,t=c.director.root,n=t.pipeline;n.macros.CC_USE_IBL!==e&&(n.macros.CC_USE_IBL=e,t.onGlobalPipelineStateChanged())},t._updateGlobalBinding=function(){var e=this.envmap.getGFXTexture(),t=Td.getSampler(c.director._device,this.envmap.getSamplerHash());this._globalDSManager.bindSampler(Rh,t),this._globalDSManager.bindTexture(Rh,e),this._globalDSManager.update()},t.destroy=function(){this._handle&&(Rr.free(this._handle),this._handle=No)},te(e,[{key:"model",get:function(){return this._model}},{key:"enabled",get:function(){return Rr.get(this._handle,wr.ENABLE)},set:function(e){Rr.set(this._handle,wr.ENABLE,e?1:0),e?this.activate():this._updatePipeline()}},{key:"useIBL",get:function(){return Rr.get(this._handle,wr.USE_IBL)},set:function(e){Rr.set(this._handle,wr.USE_IBL,e?1:0),this._updatePipeline()}},{key:"isRGBE",get:function(){return Rr.get(this._handle,wr.IS_RGBE)},set:function(e){e&&(yE&&yE.recompileShaders({USE_RGBE_CUBEMAP:e}),this._model&&this._model.setSubModelMaterial(0,yE)),Rr.set(this._handle,wr.IS_RGBE,e?1:0),this._updatePipeline()}},{key:"envmap",get:function(){return this._envmap},set:function(e){this._envmap=e||this._default,this._envmap&&(c.director.root.pipeline.pipelineSceneData.ambient.albedoArray[3]=this._envmap.mipmapLevel,this._updateGlobalBinding())}},{key:"handle",get:function(){return this._handle}}]),e}();c.Skybox=xE;var SE,EE,TE,AE,CE,wE,bE,IE,PE,RE,NE,OE=function(){function e(){this.fog=new pE,this.ambient=new ca,this.skybox=new xE,this.shadows=new qS,this.renderObjects=[],this.shadowObjects=[],this.shadowFrameBufferMap=new Map,this._handle=Ur.alloc(),Ur.set(this._handle,Lr.AMBIENT,this.ambient.handle),Ur.set(this._handle,Lr.SKYBOX,this.skybox.handle),Ur.set(this._handle,Lr.FOG,this.fog.handle),Ur.set(this._handle,Lr.SHADOW,this.shadows.handle),Ur.set(this._handle,Lr.IS_HDR,0),Ur.set(this._handle,Lr.SHADING_SCALE,1),Ur.set(this._handle,Lr.FP_SCALE,1/1024)}var t=e.prototype;return t.initDeferredPassInfo=function(){var e=pm.get("builtin-deferred-material");if(e){var t=e.passes[0];t.beginChangeStatesSilently(),t.tryCompile(),t.endChangeStatesSilently()}var n=pm.get("builtin-post-process-material");if(n){var i=n.passes[0];i.beginChangeStatesSilently(),i.tryCompile(),i.endChangeStatesSilently()}if(e){var o=e.passes[0];Ur.set(this._handle,Lr.DEFERRED_LIGHT_PASS,o.handle),Ur.set(this._handle,Lr.DEFERRED_LIGHT_PASS_SHADER,o.getShaderVariant())}if(n){var r=n.passes[0];Ur.set(this._handle,Lr.DEFERRED_POST_PASS,r.handle),Ur.set(this._handle,Lr.DEFERRED_POST_PASS_SHADER,r.getShaderVariant())}},t.activate=function(e,t){return this._device=e,this._pipeline=t,this.initDeferredPassInfo(),!0},t.destroy=function(){this.ambient.destroy(),this.skybox.destroy(),this.fog.destroy(),this.shadows.destroy(),this._handle&&Ur.free(this._handle)},te(e,[{key:"handle",get:function(){return this._handle}},{key:"isHDR",get:function(){return Ur.get(this._handle,Lr.IS_HDR)},set:function(e){Ur.set(this._handle,Lr.IS_HDR,e?1:0)}},{key:"shadingScale",get:function(){return Ur.get(this._handle,Lr.SHADING_SCALE)},set:function(e){Ur.set(this._handle,Lr.SHADING_SCALE,e)}},{key:"fpScale",get:function(){return Ur.get(this._handle,Lr.FP_SCALE)},set:function(e){Ur.set(this._handle,Lr.FP_SCALE,e)}},{key:"deferredLightPassHandle",get:function(){return Ur.get(this._handle,Lr.DEFERRED_LIGHT_PASS)}},{key:"deferredLightPassShaderHandle",get:function(){return Ur.get(this._handle,Lr.DEFERRED_LIGHT_PASS_SHADER)}},{key:"deferredPostPassHandle",get:function(){return Ur.get(this._handle,Lr.DEFERRED_POST_PASS)}},{key:"deferredPostPassShaderHandle",get:function(){return Ur.get(this._handle,Lr.DEFERRED_POST_PASS_SHADER)}}]),e}(),DE=[ja.LINEAR,ja.LINEAR,ja.NONE,qa.CLAMP,qa.CLAMP,qa.CLAMP],ME=[ja.POINT,ja.POINT,ja.NONE,qa.CLAMP,qa.CLAMP,qa.CLAMP],LE=function(){function e(e){this._device=void 0,this._descriptorSetMap=new Map,this._globalDescriptorSet=void 0,this._descriptorSetLayout=void 0,this._linearSampler=void 0,this._pointSampler=void 0,this._device=e.device;var t=ld(DE);this._linearSampler=Td.getSampler(this._device,t);var n=ld(ME);this._pointSampler=Td.getSampler(this._device,n);var i=new oc(eh.bindings);this._descriptorSetLayout=this._device.createDescriptorSetLayout(i),this._globalDescriptorSet=this._device.createDescriptorSet(new rc(this._descriptorSetLayout))}var t=e.prototype;return t.bindBuffer=function(e,t){this._globalDescriptorSet.bindBuffer(e,t);for(var n=this._descriptorSetMap.values(),i=n.next();!i.done;)i.value.bindBuffer(e,t),i=n.next()},t.bindSampler=function(e,t){this._globalDescriptorSet.bindSampler(e,t);for(var n=this._descriptorSetMap.values(),i=n.next();!i.done;)i.value.bindSampler(e,t),i=n.next()},t.bindTexture=function(e,t){this._globalDescriptorSet.bindTexture(e,t);for(var n=this._descriptorSetMap.values(),i=n.next();!i.done;)i.value.bindTexture(e,t),i=n.next()},t.update=function(){this._globalDescriptorSet.update();for(var e=this._descriptorSetMap.values(),t=e.next();!t.done;)t.value.update(),t=e.next()},t.getOrCreateDescriptorSet=function(e){var t=this._device;if(!this._descriptorSetMap.has(e)){var n=this._globalDescriptorSet,i=t.createDescriptorSet(new rc(this._descriptorSetLayout));this._descriptorSetMap.set(e,i);for(var o=$u.UBO_GLOBAL;o<$u.COUNT;o++)i.bindBuffer(o,n.getBuffer(o)),i.bindSampler(o,n.getSampler(o)),i.bindTexture(o,n.getTexture(o));var r=t.createBuffer(new Rs(za.UNIFORM|za.TRANSFER_DST,Ha.HOST|Ha.DEVICE,hh.SIZE,hh.SIZE));i.bindBuffer(hh.BINDING,r),i.update()}return this._descriptorSetMap.get(e)},t.destroy=function(){this._descriptorSetLayout.destroy(),this._linearSampler.destroy(),this._pointSampler.destroy()},te(e,[{key:"descriptorSetMap",get:function(){return this._descriptorSetMap}},{key:"linearSampler",get:function(){return this._linearSampler}},{key:"pointSampler",get:function(){return this._pointSampler}},{key:"descriptorSetLayout",get:function(){return this._descriptorSetLayout}},{key:"globalDescriptorSet",get:function(){return this._globalDescriptorSet}}]),e}(),FE=e("fv",(SE=U_("cc.RenderPipeline"),EE=lf(),TE=lf(),AE=pf([dS]),SE((PE=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return ue(t=e.call.apply(e,[this].concat(i))||this,"_tag",bE,se(t)),ue(t,"_flows",IE,se(t)),t._commandBuffers=[],t._pipelineUBO=new _E,t._pipelineSceneData=new OE,t._macros={},t._constantMacros="",t}ie(t,e);var n=t.prototype;return n.initialize=function(e){return this._flows=e.flows,e.tag&&(this._tag=e.tag),!0},n.generateRenderArea=function(e){var t=new xs,n=e.viewport,i=this.pipelineSceneData,o=e.window.hasOnScreenAttachments&&this.device.surfaceTransform%2?e.height:e.width,r=e.window.hasOnScreenAttachments&&this.device.surfaceTransform%2?e.width:e.height;return t.x=n.x*o,t.y=n.y*r,t.width=n.width*o*i.shadingScale,t.height=n.height*r*i.shadingScale,t},n.activate=function(){this._device=c.director.root.device,this._globalDSManager=new LE(this),this._descriptorSet=this._globalDSManager.globalDescriptorSet,this._pipelineUBO.activate(this._device,this),this._pipelineSceneData.activate(this._device,this);for(var e=0;e<this._flows.length;e++)this._flows[e].activate(this);return this._macros.CC_USE_HDR=this._pipelineSceneData.isHDR,this._generateConstantMacros(),!0},n.render=function(e){for(var t=0;t<this.flows.length;t++)for(var n=0;n<e.length;n++){var i=e[n];this.flows[t].render(i)}},n.destroy=function(){for(var t=0;t<this._flows.length;t++)this._flows[t].destroy();this._flows.length=0,this._descriptorSet&&this._descriptorSet.destroy(),this._globalDSManager.destroy();for(var n=0;n<this._commandBuffers.length;n++)this._commandBuffers[n].destroy();return this._commandBuffers.length=0,this._pipelineUBO.destroy(),this._pipelineSceneData.destroy(),e.prototype.destroy.call(this)},n.resize=function(){},n._generateConstantMacros=function(){var e="";e+="#define CC_DEVICE_SUPPORT_FLOAT_TEXTURE "+(this.device.hasFeature(Da.TEXTURE_FLOAT)?1:0)+"\n",e+="#define CC_DEVICE_MAX_VERTEX_UNIFORM_VECTORS "+this.device.capabilities.maxVertexUniformVectors+"\n",e+="#define CC_DEVICE_MAX_FRAGMENT_UNIFORM_VECTORS "+this.device.capabilities.maxFragmentUniformVectors+"\n",this._constantMacros=e},te(t,[{key:"tag",get:function(){return this._tag}},{key:"flows",get:function(){return this._flows}},{key:"constantMacros",get:function(){return this._constantMacros}},{key:"macros",get:function(){return this._macros}},{key:"device",get:function(){return this._device}},{key:"globalDSManager",get:function(){return this._globalDSManager}},{key:"descriptorSetLayout",get:function(){return this._globalDSManager.descriptorSetLayout}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"commandBuffers",get:function(){return this._commandBuffers}},{key:"pipelineUBO",get:function(){return this._pipelineUBO}},{key:"pipelineSceneData",get:function(){return this._pipelineSceneData}}]),t}(Yf),bE=he((wE=PE).prototype,"_tag",[EE,W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),IE=he(wE.prototype,"_flows",[TE,AE,W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),CE=wE))||CE));c.RenderPipeline=FE,function(e){e[e.FORWARD=10]="FORWARD",e[e.UI=20]="UI"}(RE||(RE={})),function(e){e[e.SHADOW=0]="SHADOW",e[e.FORWARD=1]="FORWARD",e[e.UI=10]="UI"}(NE||(NE={}));var zE,BE,UE,HE,GE,kE,VE,WE,jE,qE,YE,XE,KE,QE,ZE,JE,$E,eT,tT,nT,iT,oT,rT,aT,sT,cT,lT,uT,hT,_T,fT,dT,pT,mT,vT,gT,yT,xT,ST,ET,TT,AT,CT,wT,bT,IT,PT,RT,NT,OT,DT,MT,LT,FT,zT,BT,UT,HT,GT,kT,VT,WT,jT,qT,YT,XT,KT,QT,ZT,JT,$T,eA,tA,nA,iA,oA,rA,aA,sA,cA,lA=e("fK",function(){function e(){}return e.getOrCreatePipelineState=function(e,t,n,i,o){var r=t.hash^i.hash^o.attributesHash^n.id,a=this._PSOHashMap.get(r);if(!a){var s=new sc(o.attributes),c=new Vc(n,t.pipelineLayout,i,s,t.rasterizerState,t.depthStencilState,t.blendState,t.primitive,t.dynamicStates);a=e.createPipelineState(c),this._PSOHashMap.set(r,a)}return a},e}());lA._PSOHashMap=new Map,ht(Ga),ht(ka),ht(es),ht($a),ht(ts),function(e){e[e.SCENE=0]="SCENE",e[e.POSTPROCESS=1]="POSTPROCESS",e[e.UI=2]="UI"}(cA||(cA={})),ht(cA),zE=U_("RenderTextureDesc"),BE=pf(Ga),UE=pf(ka),HE=pf(Ma),zE((kE=he((GE=function(){ue(this,"name",kE,this),ue(this,"type",VE,this),ue(this,"usage",WE,this),ue(this,"format",jE,this),ue(this,"width",qE,this),ue(this,"height",YE,this)}).prototype,"name",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),VE=he(GE.prototype,"type",[BE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ga.TEX2D}}),WE=he(GE.prototype,"usage",[UE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ka.COLOR_ATTACHMENT}}),jE=he(GE.prototype,"format",[HE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ma.UNKNOWN}}),qE=he(GE.prototype,"width",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),YE=he(GE.prototype,"height",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),GE));var uA,hA=(XE=U_("RenderTextureConfig"),KE=pf(GS),XE((JE=he((ZE=function(){ue(this,"name",JE,this),ue(this,"texture",$E,this)}).prototype,"name",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),$E=he(ZE.prototype,"texture",[KE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),QE=ZE))||QE),_A=(eT=U_("MaterialConfig"),tT=pf(kS),eT((oT=he((iT=function(){ue(this,"name",oT,this),ue(this,"material",rT,this)}).prototype,"name",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),rT=he(iT.prototype,"material",[tT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nT=iT))||nT),fA=(aT=U_("FrameBufferDesc"),sT=pf([Bt]),cT=pf(GS),aT((uT=he((lT=function(){ue(this,"name",uT,this),ue(this,"renderPass",hT,this),ue(this,"colorTextures",_T,this),ue(this,"depthStencilTexture",fT,this),ue(this,"texture",dT,this)}).prototype,"name",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),hT=he(lT.prototype,"renderPass",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_T=he(lT.prototype,"colorTextures",[sT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fT=he(lT.prototype,"depthStencilTexture",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),dT=he(lT.prototype,"texture",[cT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lT)),pT=U_("ColorDesc"),mT=pf(Ma),vT=pf($a),gT=pf(es),yT=pf([ts]),xT=pf([ts]),pT((TT=he((ET=function(){ue(this,"format",TT,this),ue(this,"loadOp",AT,this),ue(this,"storeOp",CT,this),ue(this,"sampleCount",wT,this),ue(this,"beginAccesses",bT,this),ue(this,"endAccesses",IT,this)}).prototype,"format",[mT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ma.UNKNOWN}}),AT=he(ET.prototype,"loadOp",[vT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return $a.CLEAR}}),CT=he(ET.prototype,"storeOp",[gT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return es.STORE}}),wT=he(ET.prototype,"sampleCount",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),bT=he(ET.prototype,"beginAccesses",[yT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),IT=he(ET.prototype,"endAccesses",[xT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[ts.PRESENT]}}),ST=ET))||ST),dA=(PT=U_("DepthStencilDesc"),RT=pf(Ma),NT=pf($a),OT=pf(es),DT=pf($a),MT=pf(es),LT=pf([ts]),FT=pf([ts]),PT((UT=he((BT=function(){ue(this,"format",UT,this),ue(this,"depthLoadOp",HT,this),ue(this,"depthStoreOp",GT,this),ue(this,"stencilLoadOp",kT,this),ue(this,"stencilStoreOp",VT,this),ue(this,"sampleCount",WT,this),ue(this,"beginAccesses",jT,this),ue(this,"endAccesses",qT,this)}).prototype,"format",[RT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ma.UNKNOWN}}),HT=he(BT.prototype,"depthLoadOp",[NT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return $a.CLEAR}}),GT=he(BT.prototype,"depthStoreOp",[OT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return es.STORE}}),kT=he(BT.prototype,"stencilLoadOp",[DT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return $a.CLEAR}}),VT=he(BT.prototype,"stencilStoreOp",[MT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return es.STORE}}),WT=he(BT.prototype,"sampleCount",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),jT=he(BT.prototype,"beginAccesses",[LT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qT=he(BT.prototype,"endAccesses",[FT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[ts.DEPTH_STENCIL_ATTACHMENT_WRITE]}}),zT=BT))||zT);YT=U_("RenderPassDesc"),XT=pf([fA]),KT=pf(dA),YT((ZT=he((QT=function(){ue(this,"index",ZT,this),ue(this,"colorAttachments",JT,this),ue(this,"depthStencilAttachment",$T,this)}).prototype,"index",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),JT=he(QT.prototype,"colorAttachments",[XT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$T=he(QT.prototype,"depthStencilAttachment",[KT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new dA}}),QT)),function(e){e[e.FRONT_TO_BACK=0]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=1]="BACK_TO_FRONT"}(uA||(uA={})),ht(uA);var pA=(eA=U_("RenderQueueDesc"),tA=pf(uA),nA=pf([Bt]),eA((rA=he((oA=function(){ue(this,"isTransparent",rA,this),ue(this,"sortMode",aA,this),ue(this,"stages",sA,this)}).prototype,"isTransparent",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),aA=he(oA.prototype,"sortMode",[tA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return uA.FRONT_TO_BACK}}),sA=he(oA.prototype,"stages",[nA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),iA=oA))||iA);function mA(e,t){return e.hash-t.hash||e.depth-t.depth||e.shaderId-t.shaderId}function vA(e,t){return e.hash-t.hash||t.depth-e.depth||e.shaderId-t.shaderId}var gA=function(){function e(e){this.queue=void 0,this._passDesc=void 0,this._passPool=void 0,this._passDesc=e,this._passPool=new li((function(){return{hash:0,depth:0,shaderId:0,subModel:null,passIdx:0}}),64),this.queue=new ui(64,this._passDesc.sortFunc)}var t=e.prototype;return t.clear=function(){this.queue.clear(),this._passPool.reset()},t.insertRenderPass=function(e,t,n){var i=e.model.subModels[t],o=i.passes[n];if(o.blendState.targets[0].blend!==this._passDesc.isTransparent||!(o.phase&this._passDesc.phases))return!1;var r=0|o.priority<<16|i.priority<<8|n,a=this._passPool.add();return a.hash=r,a.depth=e.depth||0,a.shaderId=Zo.get(i.handle,qo.SHADER_0+n),a.subModel=i,a.passIdx=n,this.queue.push(a),!0},t.sort=function(){this.queue.sort()},t.recordCommandBuffer=function(e,t,n){for(var i=0;i<this.queue.length;++i){var o=this.queue.array[i],r=o.subModel,a=o.passIdx,s=r.inputAssembler,c=r.handle,l=r.passes[a],u=Oo.get(Zo.get(c,qo.SHADER_0+a)),h=lA.getOrCreatePipelineState(e,l,u,t,s);n.bindPipelineState(h),n.bindDescriptorSet(rh.MATERIAL,l.descriptorSet),n.bindDescriptorSet(rh.LOCAL,r.descriptorSet),n.bindInputAssembler(s),n.draw(s)}},e}();function yA(e){for(var t=0,n=0;n<e.stages.length;n++)t|=mm(e.stages[n]);var i=mA;switch(e.sortMode){case uA.BACK_TO_FRONT:i=vA;break;case uA.FRONT_TO_BACK:i=mA}return new gA({isTransparent:e.isTransparent,phases:t,sortFunc:i})}function xA(e){e.clear()}function SA(e){e.sort()}function EA(e,t){e.x=t.x*t.x,e.y=t.y*t.y,e.z=t.z*t.z}var TA=function(){function e(){this.queue=new Set}var t=e.prototype;return t.clear=function(){for(var e=this.queue.values(),t=e.next();!t.done;)t.value.clear(),t=e.next();this.queue.clear()},t.uploadBuffers=function(e){for(var t=this.queue.values(),n=t.next();!n.done;){for(var i=0;i<n.value.batches.length;++i){var o=n.value.batches[i];if(o.mergeCount){for(var r=0;r<o.vbs.length;++r)o.vbs[r].update(o.vbDatas[r]);e.updateBuffer(o.vbIdx,o.vbIdxData.buffer),e.updateBuffer(o.ubo,o.uboData)}}n=t.next()}},t.recordCommandBuffer=function(e,t,n){for(var i=this.queue.values(),o=i.next();!o.done;){for(var r=!1,a=0;a<o.value.batches.length;++a){var s=o.value.batches[a];if(s.mergeCount){if(!r){var c=Oo.get(s.hShader),l=lA.getOrCreatePipelineState(e,s.pass,c,t,s.ia);n.bindPipelineState(l),n.bindDescriptorSet(rh.MATERIAL,s.pass.descriptorSet),r=!0}n.bindDescriptorSet(rh.LOCAL,s.descriptorSet,o.value.dynamicOffsets),n.bindInputAssembler(s.ia),n.draw(s.ia)}}o=i.next()}},e}(),AA=function(){function e(){this.queue=new Set}var t=e.prototype;return t.clear=function(){for(var e=this.queue.values(),t=e.next();!t.done;)t.value.clear(),t=e.next();this.queue.clear()},t.uploadBuffers=function(e){for(var t=this.queue.values(),n=t.next();!n.done;)n.value.hasPendingModels&&n.value.uploadBuffers(e),n=t.next()},t.recordCommandBuffer=function(e,t,n){for(var i=this.queue.values(),o=i.next();!o.done;){var r=o.value,a=r.instances,s=r.pass;if(r.hasPendingModels){n.bindDescriptorSet(rh.MATERIAL,s.descriptorSet);for(var c=null,l=0;l<a.length;++l){var u=a[l];if(u.count){var h=Oo.get(u.hShader),_=lA.getOrCreatePipelineState(e,s,h,t,u.ia);c!==_&&(n.bindPipelineState(_),c=_),n.bindDescriptorSet(rh.LOCAL,Do.get(u.hDescriptorSet),o.value.dynamicOffsets),n.bindInputAssembler(u.ia),n.draw(u.ia)}}}o=i.next()}},e}(),CA=function(){function e(e){this.batches=[],this.dynamicOffsets=[],this._device=void 0,this._device=e.device}e.get=function(t,n){void 0===n&&(n=0);var i=e._buffers;i.has(t)||i.set(t,{});var o=i.get(t);return o[n]||(o[n]=new e(t))};var t=e.prototype;return t.destroy=function(){for(var e=0;e<this.batches.length;++e){for(var t=this.batches[e],n=0;n<t.vbs.length;++n)t.vbs[n].destroy();t.vbIdx.destroy(),t.ia.destroy(),t.ubo.destroy()}this.batches.length=0},t.merge=function(e,t,n){var i=e.subMesh.flatBuffers;if(0!==i.length){for(var o=0,r=0,a=i[0].count,s=e.passes[t],c=Zo.get(e.handle,qo.SHADER_0+t),l=e.descriptorSet,u=!1,h=0;h<this.batches.length;++h){var _=this.batches[h];if(_.vbs.length===i.length&&_.mergeCount<Bh.BATCHING_COUNT){u=!0;for(var f=0;f<_.vbs.length;++f)if(_.vbs[f].stride!==i[f].stride){u=!1;break}if(u){for(var d=0;d<_.vbs.length;++d){var p=i[d],m=_.vbs[d],v=_.vbDatas[d];(o=(a+_.vbCount)*p.stride)>m.size&&(m.resize(o),_.vbDatas[d]=new Uint8Array(o),_.vbDatas[d].set(v)),_.vbDatas[d].set(p.buffer,_.vbCount*p.stride)}var g=_.vbIdxData;(r=4*(a+_.vbCount))>_.vbIdx.size&&(_.vbIdx.resize(r),_.vbIdxData=new Float32Array(r/Float32Array.BYTES_PER_ELEMENT),_.vbIdxData.set(g),g=_.vbIdxData);var y=_.vbCount,x=y+a,S=_.mergeCount;if(g[y]!==S||g[x-1]!==S)for(var E=y;E<x;E++)g[E]=S+.1;return jn.toArray(_.uboData,n.transform.worldMatrix,Bh.MAT_WORLDS_OFFSET+16*_.mergeCount),_.mergeCount||(l.bindBuffer(Bh.BINDING,_.ubo),l.update(),_.pass=s,_.hShader=c,_.descriptorSet=l),++_.mergeCount,_.vbCount+=a,void(_.ia.vertexCount+=a)}}}for(var T=[],A=[],C=[],w=0;w<i.length;++w){var b=i[w],I=this._device.createBuffer(new Rs(za.VERTEX|za.TRANSFER_DST,Ha.HOST|Ha.DEVICE,b.count*b.stride,b.stride));I.update(b.buffer.buffer),T.push(I),A.push(new Uint8Array(I.size)),C.push(I)}var P=this._device.createBuffer(new Rs(za.VERTEX|za.TRANSFER_DST,Ha.HOST|Ha.DEVICE,4*a,4)),R=new Float32Array(a);R.fill(0),P.update(R),C.push(P);for(var N=e.inputAssembler.attributes,O=new Array(N.length+1),D=0;D<N.length;++D)O[D]=N[D];O[N.length]=new Ys("a_dyn_batch_id",Ma.R32F,!1,i.length);var M=new Ks(O,C),L=this._device.createInputAssembler(M),F=this._device.createBuffer(new Rs(za.UNIFORM|za.TRANSFER_DST,Ha.HOST|Ha.DEVICE,Bh.SIZE,Bh.SIZE));l.bindBuffer(Bh.BINDING,F),l.update();var z=new Float32Array(Bh.COUNT);jn.toArray(z,n.transform.worldMatrix,Bh.MAT_WORLDS_OFFSET),this.batches.push({mergeCount:1,vbs:T,vbDatas:A,vbIdx:P,vbIdxData:R,vbCount:a,ia:L,ubo:F,uboData:z,pass:s,hShader:c,descriptorSet:l})}},t.clear=function(){for(var e=0;e<this.batches.length;++e){var t=this.batches[e];t.vbCount=0,t.mergeCount=0,t.ia.vertexCount=0}},e}();CA._buffers=new Map;var wA=e("fJ",function(){function e(e){this.instances=[],this.pass=void 0,this.hasPendingModels=!1,this.dynamicOffsets=[],this._device=void 0,this._device=e.device,this.pass=e}e.get=function(t,n){void 0===n&&(n=0);var i=e._buffers;i.has(t)||i.set(t,{});var o=i.get(t);return o[n]||(o[n]=new e(t))};var t=e.prototype;return t.destroy=function(){for(var e=0;e<this.instances.length;++e){var t=this.instances[e];t.vb.destroy(),t.ia.destroy()}this.instances.length=0},t.merge=function(e,t,n,i){void 0===i&&(i=null);var o=t.buffer.length;if(o){var r=e.inputAssembler,a=e.descriptorSet.getTexture(o_),s=i;s||(s=Zo.get(e.handle,qo.SHADER_0+n));for(var c=Zo.get(e.handle,qo.DESCRIPTOR_SET),l=0;l<this.instances.length;++l){var u=this.instances[l];if(!(u.ia.indexBuffer!==r.indexBuffer||u.count>=1024)&&u.lightingMap===a){if(u.stride!==o)return;if(u.count>=u.capacity){u.capacity<<=1;var h=u.stride*u.capacity,_=u.data;u.data=new Uint8Array(h),u.data.set(_),u.vb.resize(h)}return u.hShader!==s&&(u.hShader=s),u.hDescriptorSet!==c&&(u.hDescriptorSet=c),u.data.set(t.buffer,u.stride*u.count++),void(this.hasPendingModels=!0)}}for(var f=this._device.createBuffer(new Rs(za.VERTEX|za.TRANSFER_DST,Ha.HOST|Ha.DEVICE,32*o,o)),d=new Uint8Array(32*o),p=r.vertexBuffers.slice(),m=r.attributes.slice(),v=r.indexBuffer,g=0;g<t.attributes.length;g++){var y=t.attributes[g],x=new Ys(y.name,y.format,y.isNormalized,p.length,!0);m.push(x)}d.set(t.buffer),p.push(f);var S=new Ks(m,p,v),E=this._device.createInputAssembler(S);this.instances.push({count:1,capacity:32,vb:f,data:d,ia:E,stride:o,hShader:s,hDescriptorSet:c,lightingMap:a}),this.hasPendingModels=!0}},t.uploadBuffers=function(e){for(var t=0;t<this.instances.length;++t){var n=this.instances[t];n.count&&(n.ia.instanceCount=n.count,e.updateBuffer(n.vb,n.data))}},t.clear=function(){for(var e=0;e<this.instances.length;++e)this.instances[e].count=0;this.hasPendingModels=!1},e}());wA._buffers=new Map;var bA=new ci((function(){return{subModel:null,passIdx:-1,dynamicOffsets:[],lights:[]}}),16),IA=new Float32Array(4),PA=fs.create(0,0,0,1),RA=[],NA=[],OA=new jn,DA=new jn;function MA(e,t){return!(!t.worldBounds||ru.aabbWithAABB(t.worldBounds,e.aabb))}function LA(e,t){return!(!t.worldBounds||ru.aabbWithAABB(t.worldBounds,e.aabb)&&ru.aabbFrustum(t.worldBounds,e.frustum))}var FA=mm("forward-add"),zA=[];function BA(e,t){t.length=0;for(var n=!1,i=0;i<e.length;i++){for(var o=e[i].passes,r=-1,a=0;a<o.length;a++)if(o[a].phase===FA){r=a,n=!0;break}t.push(r)}return n}var UA,HA,GA,kA,VA,WA,jA,qA,YA,XA,KA,QA=function(){function e(e){this._pipeline=void 0,this._device=void 0,this._validLights=[],this._lightPasses=[],this._shadowUBO=new Float32Array(hh.COUNT),this._lightBufferCount=16,this._lightBufferStride=void 0,this._lightBufferElementCount=void 0,this._lightBuffer=void 0,this._firstLightBufferView=void 0,this._lightBufferData=void 0,this._instancedQueue=void 0,this._batchedQueue=void 0,this._lightMeterScale=1e4,this._pipeline=e,this._device=e.device,this._instancedQueue=new AA,this._batchedQueue=new TA;var t=this._device.capabilities.uboOffsetAlignment;this._lightBufferStride=Math.ceil(Uh.SIZE/t)*t,this._lightBufferElementCount=this._lightBufferStride/Float32Array.BYTES_PER_ELEMENT,this._lightBuffer=this._device.createBuffer(new Rs(za.UNIFORM|za.TRANSFER_DST,Ha.HOST|Ha.DEVICE,this._lightBufferStride*this._lightBufferCount,this._lightBufferStride)),this._firstLightBufferView=this._device.createBuffer(new Ns(this._lightBuffer,0,Uh.SIZE)),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount)}var t=e.prototype;return t.clear=function(){this._instancedQueue.clear(),this._batchedQueue.clear(),this._validLights.length=0;for(var e=0;e<this._lightPasses.length;e++){var t=this._lightPasses[e];t.dynamicOffsets.length=0,t.lights.length=0}bA.freeArray(this._lightPasses),this._lightPasses.length=0},t.destroy=function(){for(var e=this._pipeline.globalDSManager.descriptorSetMap,t=e.keys,n=0;n<t.length;n++){var i=t[n],o=e.get(i);o&&(o.getBuffer(hh.BINDING).destroy(),o.getSampler(_h).destroy(),o.getSampler(Dh).destroy(),o.getTexture(_h).destroy(),o.getTexture(Dh).destroy(),o.destroy()),e.delete(i)}},t.gatherLightPasses=function(e,t){var n=this._validLights;if(this.clear(),this._gatherValidLights(e,n),n.length){this._updateUBOs(e,t),this._updateLightDescriptorSet(e,t);for(var i=this._pipeline.pipelineSceneData.renderObjects,o=0;o<i.length;o++){var r=i[o].model,a=r.subModels;if(BA(a,zA)&&(NA.length=0,this._lightCulling(r,n),NA.length))for(var s=0;s<a.length;s++){var c=zA[s];if(!(c<0)){var l=a[s],u=l.passes[c];l.descriptorSet.bindBuffer(Uh.BINDING,this._firstLightBufferView),l.descriptorSet.update(),this._addRenderQueue(u,l,r,c,n)}}}this._instancedQueue.uploadBuffers(t),this._batchedQueue.uploadBuffers(t)}},t.recordCommandBuffer=function(e,t,n){this._instancedQueue.recordCommandBuffer(e,t,n),this._batchedQueue.recordCommandBuffer(e,t,n);for(var i=this._pipeline.globalDSManager,o=0;o<this._lightPasses.length;o++){var r=this._lightPasses[o],a=r.subModel,s=r.passIdx,c=r.dynamicOffsets,l=r.lights,u=Oo.get(Zo.get(a.handle,qo.SHADER_0+s)),h=a.passes[s],_=a.inputAssembler,f=lA.getOrCreatePipelineState(e,h,u,t,_),d=Do.get(Xo.get(h.handle,Ro.DESCRIPTOR_SET)),p=a.descriptorSet;n.bindPipelineState(f),n.bindDescriptorSet(rh.MATERIAL,d),n.bindInputAssembler(_);for(var m=0;m<c.length;++m){var v=l[m],g=i.getOrCreateDescriptorSet(v);RA[0]=c[m],n.bindDescriptorSet(rh.GLOBAL,g),n.bindDescriptorSet(rh.LOCAL,p,RA),n.draw(_)}}},t._gatherValidLights=function(e,t){for(var n=e.scene.sphereLights,i=0;i<n.length;i++){var o=n[i];o.baked||(fs.set(PA,o.position.x,o.position.y,o.position.z,o.range),ru.sphereFrustum(PA,e.frustum)&&t.push(o))}for(var r=e.scene.spotLights,a=0;a<r.length;a++){var s=r[a];s.baked||(fs.set(PA,s.position.x,s.position.y,s.position.z,s.range),ru.sphereFrustum(PA,e.frustum)&&t.push(s))}},t._lightCulling=function(e,t){for(var n=0;n<t.length;n++){var i=t[n],o=!1;switch(i.type){case Em.SPHERE:o=MA(i,e);break;case Em.SPOT:o=LA(i,e)}o||NA.push(n)}},t._addRenderQueue=function(e,t,n,i){var o=e.batchingScheme;if(o===_m.INSTANCING)for(var r=0;r<NA.length;r++){var a=NA[r],s=wA.get(e,a);s.merge(t,n.instancedAttributes,i),s.dynamicOffsets[0]=this._lightBufferStride*a,this._instancedQueue.queue.add(s)}else if(o===_m.VB_MERGING)for(var c=0;c<NA.length;c++){var l=NA[c],u=CA.get(e,l);u.merge(t,i,n),u.dynamicOffsets[0]=this._lightBufferStride*l,this._batchedQueue.queue.add(u)}else{var h=bA.alloc();h.subModel=t,h.passIdx=i;for(var _=0;_<NA.length;_++){var f=NA[_];h.lights.push(f),h.dynamicOffsets.push(this._lightBufferStride*f)}this._lightPasses.push(h)}},t._updateLightDescriptorSet=function(e,t){for(var n=this._pipeline.device,i=this._pipeline.pipelineSceneData,o=i.shadows,r=i.shadowFrameBufferMap,a=e.scene.mainLight,s=g_(n),c=o.linear&&s?1:0,l=o.packing?1:s?0:1,u=this._pipeline.globalDSManager,h=0;h<this._validLights.length;h++){var _=this._validLights[h],f=u.getOrCreateDescriptorSet(h);if(f){switch(_.type){case Em.SPHERE:a&&aE(o,a,this._shadowUBO),this._shadowUBO[hh.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+0]=o.size.x,this._shadowUBO[hh.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+1]=o.size.y,this._shadowUBO[hh.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+2]=o.pcf,this._shadowUBO[hh.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+3]=o.bias,this._shadowUBO[hh.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+0]=2,this._shadowUBO[hh.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+1]=l,this._shadowUBO[hh.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+2]=o.normalBias,this._shadowUBO[hh.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+3]=0,In.toArray(this._shadowUBO,o.shadowColor,hh.SHADOW_COLOR_OFFSET);break;case Em.SPOT:if(a&&aE(o,a,this._shadowUBO),jn.toArray(this._shadowUBO,_.node.getWorldMatrix(),hh.MAT_LIGHT_VIEW_OFFSET),jn.invert(OA,_.node.getWorldMatrix()),jn.perspective(DA,_.spotAngle,_.aspect,.001,_.range),jn.multiply(DA,DA,OA),jn.toArray(this._shadowUBO,DA,hh.MAT_LIGHT_VIEW_PROJ_OFFSET),this._shadowUBO[hh.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET+0]=.01,this._shadowUBO[hh.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET+1]=_.range,this._shadowUBO[hh.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET+2]=c,this._shadowUBO[hh.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET+3]=o.selfShadow?1:0,this._shadowUBO[hh.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+0]=o.size.x,this._shadowUBO[hh.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+1]=o.size.y,this._shadowUBO[hh.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+2]=o.pcf,this._shadowUBO[hh.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+3]=o.bias,this._shadowUBO[hh.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+0]=1,this._shadowUBO[hh.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+1]=l,this._shadowUBO[hh.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+2]=o.normalBias,this._shadowUBO[hh.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+3]=0,In.toArray(this._shadowUBO,o.shadowColor,hh.SHADOW_COLOR_OFFSET),r.has(_)){var d,p=null===(d=r.get(_))||void 0===d?void 0:d.colorTextures[0];p&&f.bindTexture(Dh,p)}}f.update(),t.updateBuffer(f.getBuffer(hh.BINDING),this._shadowUBO)}}},t._updateUBOs=function(e,t){var n=e.exposure,i=this._pipeline.pipelineSceneData,o=i.isHDR,r=i.fpScale;this._validLights.length>this._lightBufferCount&&(this._firstLightBufferView.destroy(),this._lightBufferCount=Sn(this._validLights.length),this._lightBuffer.resize(this._lightBufferStride*this._lightBufferCount),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount),this._firstLightBufferView.initialize(new Ns(this._lightBuffer,0,Uh.SIZE)));for(var a=0,s=0;a<this._validLights.length;a++,s+=this._lightBufferElementCount){var c=this._validLights[a];switch(c.type){case Em.SPHERE:if(Rn.toArray(IA,c.position),IA[3]=0,this._lightBufferData.set(IA,s+Uh.LIGHT_POS_OFFSET),IA[0]=c.size,IA[1]=c.range,IA[2]=0,this._lightBufferData.set(IA,s+Uh.LIGHT_SIZE_RANGE_ANGLE_OFFSET),Rn.toArray(IA,c.color),c.useColorTemperature){var l=c.colorTemperatureRGB;IA[0]*=l.x,IA[1]*=l.y,IA[2]*=l.z}IA[3]=o?c.luminance*r*this._lightMeterScale:c.luminance*n*this._lightMeterScale,this._lightBufferData.set(IA,s+Uh.LIGHT_COLOR_OFFSET);break;case Em.SPOT:if(Rn.toArray(IA,c.position),IA[3]=1,this._lightBufferData.set(IA,s+Uh.LIGHT_POS_OFFSET),IA[0]=c.size,IA[1]=c.range,IA[2]=c.spotAngle,this._lightBufferData.set(IA,s+Uh.LIGHT_SIZE_RANGE_ANGLE_OFFSET),Rn.toArray(IA,c.direction),this._lightBufferData.set(IA,s+Uh.LIGHT_DIR_OFFSET),Rn.toArray(IA,c.color),c.useColorTemperature){var u=c.colorTemperatureRGB;IA[0]*=u.x,IA[1]*=u.y,IA[2]*=u.z}IA[3]=o?c.luminance*r*this._lightMeterScale:c.luminance*n*this._lightMeterScale,this._lightBufferData.set(IA,s+Uh.LIGHT_COLOR_OFFSET)}}t.updateBuffer(this._lightBuffer,this._lightBufferData)},e}(),ZA=new vu,JA=function(){function e(e){this._pendingModels=[],this._instancedQueue=new AA,this._pipeline=void 0,this._pipeline=e}var t=e.prototype;return t.gatherShadowPasses=function(e,t){var n=this._pipeline.pipelineSceneData,i=this._pipeline.pipelineUBO,o=n.shadows;if(this._instancedQueue.clear(),this._pendingModels.length=0,o.enabled&&o.type===VS.Planar){i.updateShadowUBO(e);var r=e.scene,a=e.frustum,s=0!=(e.visibility&qu.BitMask.DEFAULT);if(r.mainLight&&s){var c=n.renderObjects,l=wA.get(o.instancingMaterial.passes[0]);this._instancedQueue.queue.add(l);for(var u=0;u<c.length;u++){var h=c[u].model;if(h.enabled&&h.node&&h.castShadow&&(!h.worldBounds||(vu.transform(ZA,h.worldBounds,o.matLight),ru.aabbFrustum(ZA,a))))if(h.isInstancingEnabled)for(var _=h.subModels,f=0;f<_.length;f++){var d=_[f];l.merge(d,h.instancedAttributes,0,d.planarInstanceShaderHandle)}else this._pendingModels.push(h)}this._instancedQueue.uploadBuffers(t)}}},t.recordCommandBuffer=function(e,t,n){var i=this._pipeline.pipelineSceneData.shadows;if(i.enabled&&i.type===VS.Planar&&(this._instancedQueue.recordCommandBuffer(e,t,n),this._pendingModels.length)){var o=i.material.passes[0],r=Do.get(Xo.get(o.handle,Ro.DESCRIPTOR_SET));n.bindDescriptorSet(rh.MATERIAL,r);for(var a=this._pendingModels.length,s=0;s<a;s++)for(var c=this._pendingModels[s],l=0;l<c.subModels.length;l++){var u=c.subModels[l],h=Oo.get(u.planarShaderHandle),_=u.inputAssembler,f=lA.getOrCreatePipelineState(e,o,h,t,_);n.bindPipelineState(f),n.bindDescriptorSet(rh.LOCAL,u.descriptorSet),n.bindInputAssembler(_),n.draw(_)}}},e}(),$A=function(){function e(){this._phaseID=mm("default")}var t=e.prototype;return t.activate=function(e){this._pipeline=e},t.render=function(e,t){for(var n=this._pipeline,i=n.device,o=n.commandBuffers[0],r=e.scene.batches,a=0;a<r.length;a++){var s=r[a],c=!1;if(e.visibility&s.visFlags&&(c=!0),c)for(var l=s.handle,u=ir.get(l,Jo.PASS_COUNT),h=0;h<u;h++){var _=s.passes[h];if(_.phase===this._phaseID){var f=ir.get(l,Jo.SHADER_0+h),d=Oo.get(f),p=Mo.get(s.hInputAssembler),m=Do.get(s.hDescriptorSet),v=lA.getOrCreatePipelineState(i,_,d,t,p);o.bindPipelineState(v),o.bindDescriptorSet(rh.MATERIAL,_.descriptorSet),o.bindDescriptorSet(rh.LOCAL,m),o.bindInputAssembler(p),o.draw(p)}}}},e}(),eC=[new Is(0,0,0,1)],tC=e("fA",(UA=U_("ForwardStage"),HA=pf([pA]),GA=lf(),UA((qA=jA=function(e){function t(){var t;return ue(t=e.call(this)||this,"renderQueues",WA,se(t)),t._renderQueues=[],t._renderArea=new xs,t._batchedQueue=void 0,t._instancedQueue=void 0,t._phaseID=mm("default"),t._clearFlag=4294967295,t._batchedQueue=new TA,t._instancedQueue=new AA,t._uiPhase=new $A,t}ie(t,e);var n=t.prototype;return n.initialize=function(t){return e.prototype.initialize.call(this,t),t.renderQueues&&(this.renderQueues=t.renderQueues),!0},n.activate=function(t,n){e.prototype.activate.call(this,t,n);for(var i=0;i<this.renderQueues.length;i++)this._renderQueues[i]=yA(this.renderQueues[i]);this._additiveLightQueue=new QA(this._pipeline),this._planarQueue=new JA(this._pipeline),this._uiPhase.activate(t)},n.destroy=function(){},n.render=function(e){this._instancedQueue.clear(),this._batchedQueue.clear();var t=this._pipeline,n=t.device;this._renderQueues.forEach(xA);for(var i=t.pipelineSceneData.renderObjects,o=0,r=0,a=0,s=0;s<i.length;++s){var c=i[s],l=c.model.subModels;for(o=0;o<l.length;++o){var u=l[o],h=u.passes;for(r=0;r<h.length;++r){var _=h[r];if(_.phase===this._phaseID){var f=_.batchingScheme;if(f===_m.INSTANCING){var d=wA.get(_);d.merge(u,c.model.instancedAttributes,r),this._instancedQueue.queue.add(d)}else if(f===_m.VB_MERGING){var p=CA.get(_);p.merge(u,r,c.model),this._batchedQueue.queue.add(p)}else for(a=0;a<this._renderQueues.length;a++)this._renderQueues[a].insertRenderPass(c,o,r)}}}}this._renderQueues.forEach(SA);var m=t.commandBuffers[0];this._instancedQueue.uploadBuffers(m),this._batchedQueue.uploadBuffers(m),this._additiveLightQueue.gatherLightPasses(e,m),this._planarQueue.gatherShadowPasses(e,m);var v=t.pipelineSceneData;if(this._renderArea=t.generateRenderArea(e),e.clearFlag&_s.COLOR)if(v.isHDR){EA(eC[0],e.clearColor);var g=v.fpScale/e.exposure;eC[0].x*=g,eC[0].y*=g,eC[0].z*=g}else eC[0].x=e.clearColor.x,eC[0].y=e.clearColor.y,eC[0].z=e.clearColor.z;eC[0].w=e.clearColor.w;var y=e.window.framebuffer,x=y.colorTextures[0]?y.renderPass:t.getRenderPass(e.clearFlag&this._clearFlag);m.beginRenderPass(x,y,this._renderArea,eC,e.clearDepth,e.clearStencil),m.bindDescriptorSet(rh.GLOBAL,t.descriptorSet),this._renderQueues[0].recordCommandBuffer(n,x,m),this._instancedQueue.recordCommandBuffer(n,x,m),this._batchedQueue.recordCommandBuffer(n,x,m),this._additiveLightQueue.recordCommandBuffer(n,x,m),this._planarQueue.recordCommandBuffer(n,x,m),this._renderQueues[1].recordCommandBuffer(n,x,m),this._uiPhase.render(e,x),m.endRenderPass()},t}(rS),jA.initInfo={name:"ForwardStage",priority:RE.FORWARD,tag:0,renderQueues:[{isTransparent:!1,sortMode:uA.FRONT_TO_BACK,stages:["default"]},{isTransparent:!0,sortMode:uA.BACK_TO_FRONT,stages:["default","planarShadow"]}]},WA=he((VA=qA).prototype,"renderQueues",[HA,W_,GA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),kA=VA))||kA)),nC=e("fz",U_("ForwardFlow")((KA=XA=function(e){function t(){return e.apply(this,arguments)||this}ie(t,e);var n=t.prototype;return n.initialize=function(t){if(e.prototype.initialize.call(this,t),0===this._stages.length){var n=new tC;n.initialize(tC.initInfo),this._stages.push(n)}return!0},n.activate=function(t){e.prototype.activate.call(this,t)},n.render=function(t){e.prototype.render.call(this,t)},n.destroy=function(){e.prototype.destroy.call(this)},t}(dS),XA.initInfo={name:Zu,priority:NE.FORWARD,stages:[]},YA=KA))||YA),iC=mm("shadow-caster"),oC=[];function rC(e,t){t.length=0;for(var n=!1,i=0;i<e.length;i++){for(var o=e[i].passes,r=-1,a=0;a<o.length;a++)if(o[a].phase===iC){r=a,n=!0;break}t.push(r)}return n}var aC,sC,cC,lC,uC,hC,_C,fC,dC,pC,mC,vC,gC,yC,xC,SC,EC,TC,AC,CC,wC,bC,IC,PC,RC,NC,OC=function(){function e(e){this._pipeline=void 0,this._subModelsArray=[],this._passArray=[],this._shaderArray=[],this._instancedQueue=void 0,this._batchedQueue=void 0,this._pipeline=e,this._instancedQueue=new AA,this._batchedQueue=new TA}var t=e.prototype;return t.gatherLightPasses=function(e,t){this.clear();var n=this._pipeline.pipelineSceneData.shadows,i=this._pipeline.pipelineSceneData.shadowObjects;if(e&&n.enabled&&n.type===VS.ShadowMap){this._pipeline.pipelineUBO.updateShadowUBOLight(e);for(var o=0;o<i.length;o++){var r=i[o].model;if(rC(r.subModels,oC))switch(e.type){case Em.DIRECTIONAL:this.add(r,t,oC);break;case Em.SPOT:if(r.worldBounds&&(!ru.aabbWithAABB(r.worldBounds,e.aabb)||!ru.aabbFrustum(r.worldBounds,e.frustum)))continue;this.add(r,t,oC)}}}},t.clear=function(){this._subModelsArray.length=0,this._shaderArray.length=0,this._passArray.length=0,this._instancedQueue.clear(),this._batchedQueue.clear()},t.add=function(e,t,n){for(var i=e.subModels,o=0;o<i.length;o++){var r=i[o],a=n[o],s=r.passes[a];if(s.batchingScheme===_m.INSTANCING){var c=wA.get(s);c.merge(r,e.instancedAttributes,a),this._instancedQueue.queue.add(c)}else if(s.batchingScheme===_m.VB_MERGING){var l=CA.get(s);l.merge(r,a,e),this._batchedQueue.queue.add(l)}else{var u=Oo.get(Zo.get(r.handle,qo.SHADER_0+a));this._subModelsArray.push(r),this._shaderArray.push(u),this._passArray.push(s)}}this._instancedQueue.uploadBuffers(t),this._batchedQueue.uploadBuffers(t)},t.recordCommandBuffer=function(e,t,n){this._instancedQueue.recordCommandBuffer(e,t,n),this._batchedQueue.recordCommandBuffer(e,t,n);for(var i=0;i<this._subModelsArray.length;++i){var o=this._subModelsArray[i],r=this._shaderArray[i],a=this._passArray[i],s=o.inputAssembler,c=lA.getOrCreatePipelineState(e,a,r,t,s),l=a.descriptorSet;n.bindPipelineState(c),n.bindDescriptorSet(rh.MATERIAL,l),n.bindDescriptorSet(rh.LOCAL,o.descriptorSet),n.bindInputAssembler(s),n.draw(s)}},e}(),DC=[new Is(1,1,1,1)],MC=e("fI",U_("ShadowStage")((cC=sC=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this)._shadowFrameBuffer=null,t._renderArea=new xs,t._light=null,t}ie(t,e);var n=t.prototype;return n.setUsage=function(e,t){this._light=e,this._shadowFrameBuffer=t},n.destroy=function(){this._additiveShadowQueue.clear()},n.clearFramebuffer=function(e){if(this._light&&this._shadowFrameBuffer){DC[0].w=e.clearColor.w;var t=this._pipeline.commandBuffers[0],n=this._shadowFrameBuffer.renderPass;t.beginRenderPass(n,this._shadowFrameBuffer,this._renderArea,DC,e.clearDepth,e.clearStencil),t.endRenderPass()}},n.render=function(e){var t=this._pipeline,n=t.pipelineSceneData,i=n.shadows,o=n.shadingScale,r=t.commandBuffers[0];if(this._light&&this._shadowFrameBuffer){this._additiveShadowQueue.gatherLightPasses(this._light,r);var a=e.viewport,s=i.size;this._renderArea.x=a.x*s.x,this._renderArea.y=a.y*s.y,this._renderArea.width=a.width*s.x*o,this._renderArea.height=a.height*s.y*o;var c=t.device,l=this._shadowFrameBuffer.renderPass;r.beginRenderPass(l,this._shadowFrameBuffer,this._renderArea,DC,e.clearDepth,e.clearStencil),r.bindDescriptorSet(rh.GLOBAL,t.descriptorSet),this._additiveShadowQueue.recordCommandBuffer(c,l,r),r.endRenderPass()}},n.activate=function(t,n){e.prototype.activate.call(this,t,n),this._additiveShadowQueue=new OC(t)},t}(rS),sC.initInfo={name:"ShadowStage",priority:RE.FORWARD,tag:0},aC=cC))||aC),LC=e("fH",U_("ShadowFlow")((hC=uC=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this)._shadowRenderPass=null,t}ie(t,e);var n=t.prototype;return n.initialize=function(t){if(e.prototype.initialize.call(this,t),0===this._stages.length){var n=new MC;n.initialize(MC.initInfo),this._stages.push(n)}return!0},n.render=function(e){var t=this._pipeline,n=t.pipelineSceneData.shadows,i=t.pipelineSceneData.shadowFrameBufferMap,o=t.pipelineSceneData.shadowObjects;if(n.enabled&&n.type===VS.ShadowMap){var r=function(e,t){$S.length=0;var n=e.scene;$S.push(n.mainLight);for(var i=n.spotLights,o=0;o<i.length;o++){var r=i[o];fs.set(eE,r.position.x,r.position.y,r.position.z,r.range),ru.sphereFrustum(eE,e.frustum)&&t>$S.length&&$S.push(r)}return $S}(e,n.maxReceived);if(0!==o.length){for(var a=0;a<r.length;a++){var s=r[a];i.has(s)||this._initShadowFrameBuffer(t,s);var c=i.get(s);n.shadowMapDirty&&this.resizeShadowMap(s,n);for(var l=0;l<this._stages.length;l++){var u=this._stages[l];u.setUsage(s,c),u.render(e)}}t.pipelineUBO.updateShadowUBO(e)}else this.clearShadowMap(r,e)}},n.destroy=function(){e.prototype.destroy.call(this);for(var t=this._pipeline.pipelineSceneData.shadowFrameBufferMap,n=Array.from(t.values()),i=0;i<n.length;i++){var o=n[i];if(o){for(var r=o.colorTextures,a=0;a<r.length;a++){var s=r[i];s&&s.destroy()}r.length=0;var c=o.depthStencilTexture;c&&c.destroy(),o.destroy()}}t.clear(),this._shadowRenderPass&&this._shadowRenderPass.destroy()},n._initShadowFrameBuffer=function(e,t){var n=e.device,i=e.pipelineSceneData.shadows,o=i.size,r=e.pipelineSceneData.shadowFrameBufferMap,a=g_(n)?i.packing?Ma.RGBA8:Ma.RGBA16F:Ma.RGBA8;if(!this._shadowRenderPass){var s=new Qs;s.format=a,s.loadOp=$a.CLEAR,s.storeOp=es.STORE,s.sampleCount=1;var c=new Zs;c.format=n.depthStencilFormat,c.depthLoadOp=$a.CLEAR,c.depthStoreOp=es.DISCARD,c.stencilLoadOp=$a.CLEAR,c.stencilStoreOp=es.DISCARD,c.sampleCount=1;var l=new $s([s],c);this._shadowRenderPass=n.createRenderPass(l)}var u=[];u.push(n.createTexture(new Ls(Ga.TEX2D,ka.COLOR_ATTACHMENT|ka.SAMPLED,a,o.x,o.y)));var h=n.createTexture(new Ls(Ga.TEX2D,ka.DEPTH_STENCIL_ATTACHMENT,n.depthStencilFormat,o.x,o.y)),_=n.createFramebuffer(new nc(this._shadowRenderPass,u,h));r.set(t,_)},n.clearShadowMap=function(e,t){for(var n=this._pipeline.pipelineSceneData,i=0;i<e.length;i++){var o=e[i],r=n.shadowFrameBufferMap.get(o);if(n.shadowFrameBufferMap.has(o))for(var a=0;a<this._stages.length;a++){var s=this._stages[a];s.setUsage(o,r),s.clearFramebuffer(t)}}},n.resizeShadowMap=function(e,t){var n=t.size.x,i=t.size.y,o=this._pipeline,r=o.device,a=o.pipelineSceneData.shadowFrameBufferMap,s=g_(r)?t.packing?Ma.RGBA8:Ma.RGBA16F:Ma.RGBA8;if(a.has(e)){var c=a.get(e);if(!c)return;var l=[];l.push(o.device.createTexture(new Ls(Ga.TEX2D,ka.COLOR_ATTACHMENT|ka.SAMPLED,s,n,i)));var u=c.depthStencilTexture;u&&u.resize(n,i);var h=c.renderPass;c.destroy(),c.initialize(new nc(h,l,u))}t.shadowMapDirty=!1},t}(dS),uC.initInfo={name:Ju,priority:NE.SHADOW,tag:cA.SCENE,stages:[]},lC=hC))||lC),FC=[ja.POINT,ja.POINT,ja.NONE,qa.CLAMP,qa.CLAMP,qa.CLAMP],zC=e("fy",(_C=U_("ForwardPipeline"),fC=pf([hA]),dC=lf(),pC=pf([_A]),mC=lf(),_C((SC=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return ue(t=e.call.apply(e,[this].concat(i))||this,"renderTextures",yC,se(t)),ue(t,"materials",xC,se(t)),t._renderPasses=new Map,t}ie(t,e);var n=t.prototype;return n.initialize=function(t){if(e.prototype.initialize.call(this,t),0===this._flows.length){var n=new LC;n.initialize(LC.initInfo),this._flows.push(n);var i=new nC;i.initialize(nC.initInfo),this._flows.push(i)}return!0},n.activate=function(){return!(!e.prototype.activate.call(this)||!this._activeRenderer()&&(N(2402),1))},n.render=function(e){this._commandBuffers[0].begin(),this._pipelineUBO.updateGlobalUBO();for(var t=0;t<e.length;t++){var n=e[t];if(n.scene){sE(this,n),this._pipelineUBO.updateCameraUBO(n);for(var i=0;i<this._flows.length;i++)this._flows[i].render(n)}}this._commandBuffers[0].end(),this._device.flushCommands(this._commandBuffers),this._device.queue.submit(this._commandBuffers)},n.getRenderPass=function(e){var t=this._renderPasses.get(e);if(t)return t;var n=this.device,i=new Qs,o=new Zs;i.format=n.colorFormat,o.format=n.depthStencilFormat,o.stencilStoreOp=es.DISCARD,o.depthStoreOp=es.DISCARD,e&_s.COLOR||(e&b_?i.loadOp=$a.DISCARD:(i.loadOp=$a.LOAD,i.beginAccesses=[ts.PRESENT])),(e&_s.DEPTH_STENCIL)!==_s.DEPTH_STENCIL&&(e&_s.DEPTH||(o.depthLoadOp=$a.LOAD),e&_s.STENCIL||(o.stencilLoadOp=$a.LOAD),o.beginAccesses=[ts.DEPTH_STENCIL_ATTACHMENT_WRITE]);var r=new $s([i],o);return t=n.createRenderPass(r),this._renderPasses.set(e,t),t},n._activeRenderer=function(){var e=this.device;this._commandBuffers.push(e.commandBuffer);var t=ld(FC),n=Td.getSampler(e,t);return this._descriptorSet.bindSampler(_h,n),this._descriptorSet.bindTexture(_h,pm.get("default-texture").getGFXTexture()),this._descriptorSet.bindSampler(Dh,n),this._descriptorSet.bindTexture(Dh,pm.get("default-texture").getGFXTexture()),this._descriptorSet.update(),!0},n.destroyUBOs=function(){this._descriptorSet&&(this._descriptorSet.getBuffer(lh.BINDING).destroy(),this._descriptorSet.getBuffer(hh.BINDING).destroy(),this._descriptorSet.getBuffer(uh.BINDING).destroy(),this._descriptorSet.getSampler(_h).destroy(),this._descriptorSet.getSampler(Dh).destroy(),this._descriptorSet.getTexture(_h).destroy(),this._descriptorSet.getTexture(Dh).destroy())},n.destroy=function(){this.destroyUBOs();for(var t=this._renderPasses.values(),n=t.next();!n.done;)n.value.destroy(),n=t.next();return this._commandBuffers.length=0,e.prototype.destroy.call(this)},t}(FE),yC=he((gC=SC).prototype,"renderTextures",[fC,W_,dC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xC=he(gC.prototype,"materials",[pC,W_,mC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vC=gC))||vC));!function(e){e[e.GBUFFER=10]="GBUFFER",e[e.LIGHTING=15]="LIGHTING",e[e.TRANSPARENT=18]="TRANSPARENT",e[e.POSTPROCESS=19]="POSTPROCESS",e[e.UI=20]="UI"}(EC||(EC={})),function(e){e[e.SHADOW=0]="SHADOW",e[e.GBUFFER=1]="GBUFFER",e[e.LIGHTING=5]="LIGHTING",e[e.UI=10]="UI"}(TC||(TC={}));var BC,UC,HC,GC,kC,VC,WC,jC,qC,YC,XC,KC,QC,ZC,JC,$C,ew,tw,nw,iw,ow,rw,aw,sw,cw,lw,uw,hw,_w,fw,dw,pw,mw,vw,gw,yw=[new Is(0,0,0,0),new Is(0,0,0,0),new Is(0,0,0,0),new Is(0,0,0,0)],xw=e("fD",(AC=U_("GbufferStage"),CC=pf([pA]),wC=lf(),AC((NC=RC=function(e){function t(){var t;return ue(t=e.call(this)||this,"renderQueues",PC,se(t)),t._renderQueues=[],t._renderArea=new xs,t._batchedQueue=void 0,t._instancedQueue=void 0,t._phaseID=mm("deferred"),t._batchedQueue=new TA,t._instancedQueue=new AA,t}ie(t,e);var n=t.prototype;return n.initialize=function(t){return e.prototype.initialize.call(this,t),t.renderQueues&&(this.renderQueues=t.renderQueues),!0},n.activate=function(t,n){e.prototype.activate.call(this,t,n);for(var i=0;i<this.renderQueues.length;i++)this._renderQueues[i]=yA(this.renderQueues[i])},n.destroy=function(){},n.render=function(e){this._instancedQueue.clear(),this._batchedQueue.clear();var t=this._pipeline,n=t.device;this._renderQueues.forEach(xA);var i=t.pipelineSceneData.renderObjects;if(0!==i.length){for(var o=0,r=0,a=0,s=0;s<i.length;++s){var c=i[s],l=c.model.subModels;for(o=0;o<l.length;++o){var u=l[o],h=u.passes;for(r=0;r<h.length;++r){var _=h[r];if(_.phase===this._phaseID){var f=_.batchingScheme;if(f===_m.INSTANCING){var d=wA.get(_);d.merge(u,c.model.instancedAttributes,r),this._instancedQueue.queue.add(d)}else if(f===_m.VB_MERGING){var p=CA.get(_);p.merge(u,r,c.model),this._batchedQueue.queue.add(p)}else for(a=0;a<this._renderQueues.length;a++)this._renderQueues[a].insertRenderPass(c,o,r)}}}}this._renderQueues.forEach(SA);var m=t.commandBuffers[0];if(this._instancedQueue.uploadBuffers(m),this._batchedQueue.uploadBuffers(m),this._renderArea=t.generateRenderArea(e),t.updateQuadVertexData(this._renderArea),e.clearFlag&_s.COLOR)if(t.pipelineSceneData.isHDR){EA(yw[0],e.clearColor);var v=t.pipelineSceneData.fpScale/e.exposure;yw[0].x*=v,yw[0].y*=v,yw[0].z*=v}else yw[0].x=e.clearColor.x,yw[0].y=e.clearColor.y,yw[0].z=e.clearColor.z;yw[0].w=e.clearColor.w;var g=t.getDeferredRenderData(e).gbufferFrameBuffer,y=g.renderPass;m.beginRenderPass(y,g,this._renderArea,yw,e.clearDepth,e.clearStencil),m.bindDescriptorSet(rh.GLOBAL,t.descriptorSet);for(var x=0;x<this.renderQueues.length;x++)this._renderQueues[x].recordCommandBuffer(n,y,m);this._instancedQueue.recordCommandBuffer(n,y,m),this._batchedQueue.recordCommandBuffer(n,y,m),m.endRenderPass()}},t}(rS),RC.initInfo={name:"GbufferStage",priority:EC.GBUFFER,tag:0,renderQueues:[{isTransparent:!1,sortMode:uA.FRONT_TO_BACK,stages:["default"]},{isTransparent:!0,sortMode:uA.BACK_TO_FRONT,stages:["default"]}]},PC=he((IC=NC).prototype,"renderQueues",[CC,W_,wC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bC=IC))||bC)),Sw=e("fC",U_("GbufferFlow")((HC=UC=function(e){function t(){return e.apply(this,arguments)||this}ie(t,e);var n=t.prototype;return n.initialize=function(t){if(e.prototype.initialize.call(this,t),0===this._stages.length){var n=new xw;n.initialize(xw.initInfo),this._stages.push(n)}return!0},n.activate=function(t){e.prototype.activate.call(this,t)},n.render=function(t){e.prototype.render.call(this,t)},n.destroy=function(){e.prototype.destroy.call(this)},t}(dS),UC.initInfo={name:Ku,priority:TC.GBUFFER,stages:[]},BC=HC))||BC),Ew=[new Is(0,0,0,1)],Tw=e("fF",(GC=U_("LightingStage"),kC=pf(kS),VC=lf(),WC=pf([pA]),jC=lf(),GC((ZC=QC=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this)._deferredLitsBufs=null,t._maxDeferredLights=Hh.LIGHTS_PER_PASS,t._lightMeterScale=1e4,t._descriptorSet=null,t._renderArea=new xs,ue(t,"_deferredMaterial",XC,se(t)),ue(t,"renderQueues",KC,se(t)),t._phaseID=mm("default"),t._defPhaseID=mm("deferred"),t._renderQueues=[],t}ie(t,e);var n=t.prototype;return n.initialize=function(t){return e.prototype.initialize.call(this,t),!0},n.gatherLights=function(e){for(var t=this._pipeline,n=t.commandBuffers[0],i=e.scene.sphereLights,o=e.scene.spotLights,r=fs.create(0,0,0,1),a=new Float32Array(4),s=e.exposure,c=0,l=$n.length,u=l*this._maxDeferredLights,h=0;h<i.length&&c<this._maxDeferredLights;h++,++c){var _=i[h];if(fs.set(r,_.position.x,_.position.y,_.position.z,_.range),ru.sphereFrustum(r,e.frustum)){if(Rn.toArray(a,_.position),a[3]=0,this._lightBufferData.set(a,c*l),Rn.toArray(a,_.color),_.useColorTemperature){var f=_.colorTemperatureRGB;a[0]*=f.x,a[1]*=f.y,a[2]*=f.z}t.pipelineSceneData.isHDR?a[3]=_.luminance*t.pipelineSceneData.fpScale*this._lightMeterScale:a[3]=_.luminance*s*this._lightMeterScale,this._lightBufferData.set(a,c*l+1*u),a[0]=_.size,a[1]=_.range,a[2]=0,this._lightBufferData.set(a,c*l+2*u)}}for(var d=0;d<o.length&&c<this._maxDeferredLights;d++,++c){var p=o[d];if(fs.set(r,p.position.x,p.position.y,p.position.z,p.range),ru.sphereFrustum(r,e.frustum)){if(Rn.toArray(a,p.position),a[3]=1,this._lightBufferData.set(a,c*l+0*u),Rn.toArray(a,p.color),p.useColorTemperature){var m=p.colorTemperatureRGB;a[0]*=m.x,a[1]*=m.y,a[2]*=m.z}t.pipelineSceneData.isHDR?a[3]=p.luminance*t.pipelineSceneData.fpScale*this._lightMeterScale:a[3]=p.luminance*s*this._lightMeterScale,this._lightBufferData.set(a,c*l+1*u),a[0]=p.size,a[1]=p.range,a[2]=p.spotAngle,this._lightBufferData.set(a,c*l+2*u),Rn.toArray(a,p.direction),this._lightBufferData.set(a,c*l+3*u)}}var v=3*u+3;this._lightBufferData.set([c],v),n.updateBuffer(this._deferredLitsBufs,this._lightBufferData)},n.activate=function(t,n){e.prototype.activate.call(this,t,n);for(var i=t.device,o=0;o<this.renderQueues.length;o++)this._renderQueues[o]=yA(this.renderQueues[o]);var r=16*Float32Array.BYTES_PER_ELEMENT*this._maxDeferredLights;r=Math.ceil(r/i.capabilities.uboOffsetAlignment)*i.capabilities.uboOffsetAlignment,this._deferredLitsBufs=i.createBuffer(new Rs(za.UNIFORM|za.TRANSFER_DST,Ha.HOST|Ha.DEVICE,r,i.capabilities.uboOffsetAlignment));var a=i.createBuffer(new Ns(this._deferredLitsBufs,0,r));this._lightBufferData=new Float32Array(r/Float32Array.BYTES_PER_ELEMENT);var s=new oc(th.bindings);this._descriptorSetLayout=i.createDescriptorSetLayout(s),this._descriptorSet=i.createDescriptorSet(new rc(this._descriptorSetLayout)),this._descriptorSet.bindBuffer(Uh.BINDING,a),this._planarQueue=new JA(this._pipeline)},n.destroy=function(){this._deferredLitsBufs.destroy(),this._deferredLitsBufs=null,this._descriptorSet=null},n.render=function(e){var t=this._pipeline,n=t.device,i=t.commandBuffers[0],o=t.pipelineSceneData.renderObjects;if(0!==o.length){if(this.gatherLights(e),this._descriptorSet.update(),this._planarQueue.gatherShadowPasses(e,i),i.bindDescriptorSet(rh.LOCAL,this._descriptorSet,[0]),this._renderArea=t.generateRenderArea(e),e.clearFlag&_s.COLOR)if(t.pipelineSceneData.isHDR){EA(Ew[0],e.clearColor);var r=t.pipelineSceneData.fpScale/e.exposure;Ew[0].x*=r,Ew[0].y*=r,Ew[0].z*=r}else Ew[0].x=e.clearColor.x,Ew[0].y=e.clearColor.y,Ew[0].z=e.clearColor.z;Ew[0].w=0;var a,s,c=t.getDeferredRenderData(e).lightingFrameBuffer,l=c.renderPass;i.beginRenderPass(l,c,this._renderArea,Ew,e.clearDepth,e.clearStencil),i.bindDescriptorSet(rh.GLOBAL,t.descriptorSet);var u=pm.get("builtin-deferred-material");u?(a=u.passes[0],s=Oo.get(a.getShaderVariant())):(a=this._deferredMaterial.passes[1],s=Oo.get(this._deferredMaterial.passes[1].getShaderVariant()));var h=t.quadIAOffscreen,_=null;null!=a&&null!=s&&null!=h&&(_=lA.getOrCreatePipelineState(n,a,s,l,h)),null!=_&&(i.bindPipelineState(_),i.bindInputAssembler(h),i.draw(h)),this._renderQueues.forEach(xA);for(var f=0,d=0,p=0,m=0;m<o.length;++m){var v=o[m],g=v.model.subModels;for(f=0;f<g.length;++f){var y=g[f].passes;for(d=0;d<y.length;++d){var x=y[d];if(x.phase===this._phaseID||x.phase===this._defPhaseID)for(p=0;p<this._renderQueues.length;p++)this._renderQueues[p].insertRenderPass(v,f,d)}}}this._renderQueues.forEach(SA);for(var S=0;S<this._renderQueues.length;S++)this._renderQueues[S].recordCommandBuffer(n,l,i);this._planarQueue.recordCommandBuffer(n,l,i),i.endRenderPass()}},te(t,[{key:"material",set:function(e){this._deferredMaterial!==e&&(this._deferredMaterial=e)}}]),t}(rS),QC.initInfo={name:"LightingStage",priority:EC.LIGHTING,tag:0},XC=he((YC=ZC).prototype,"_deferredMaterial",[kC,W_,VC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),KC=he(YC.prototype,"renderQueues",[WC,W_,jC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qC=YC))||qC)),Aw=e("fE",U_("LightingFlow")((ew=$C=function(e){function t(){return e.apply(this,arguments)||this}ie(t,e);var n=t.prototype;return n.initialize=function(t){if(e.prototype.initialize.call(this,t),0===this._stages.length){var n=new Tw;n.initialize(Tw.initInfo),this._stages.push(n)}return!0},n.activate=function(t){e.prototype.activate.call(this,t)},n.render=function(t){e.prototype.render.call(this,t)},n.destroy=function(){e.prototype.destroy.call(this)},t}(dS),$C.initInfo={name:Qu,priority:TC.LIGHTING,stages:[]},JC=ew))||JC),Cw=ld([ja.POINT,ja.POINT,ja.NONE,qa.CLAMP,qa.CLAMP,qa.CLAMP]),ww=function(){this.quadIB=null,this.quadVB=null,this.quadIA=null},bw=function(){this.gbufferFrameBuffer=null,this.gbufferRenderTargets=[],this.lightingFrameBuffer=null,this.lightingRenderTargets=[],this.depthTex=null},Iw=e("fB",(tw=U_("DeferredPipeline"),nw=pf([hA]),iw=lf(),ow=pf([_A]),rw=lf(),tw((uw=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this)._quadIB=null,t._quadVBOnscreen=null,t._quadVBOffscreen=null,t._quadIAOnscreen=null,t._quadIAOffscreen=null,t._deferredRenderData=null,t._gbufferRenderPass=null,t._lightingRenderPass=null,t._width=0,t._height=0,t._lastUsedRenderArea=new xs,ue(t,"renderTextures",cw,se(t)),ue(t,"materials",lw,se(t)),t._renderPasses=new Map,t}ie(t,e);var n=t.prototype;return n.initialize=function(t){if(e.prototype.initialize.call(this,t),0===this._flows.length){var n=new LC;n.initialize(LC.initInfo),this._flows.push(n);var i=new Sw;i.initialize(Sw.initInfo),this._flows.push(i);var o=new Aw;o.initialize(Aw.initInfo),this._flows.push(o)}return!0},n.activate=function(){return this._macros.CC_PIPELINE_TYPE=1,!(!e.prototype.activate.call(this)||!this._activeRenderer()&&(N(2402),1))},n.render=function(e){if(0!==e.length){this._commandBuffers[0].begin(),this._pipelineUBO.updateGlobalUBO();for(var t=0;t<e.length;t++){var n=e[t];if(n.scene){sE(this,n),this._pipelineUBO.updateCameraUBO(n);for(var i=0;i<this._flows.length;i++)this._flows[i].render(n)}}this._commandBuffers[0].end(),this._device.queue.submit(this._commandBuffers)}},n.getRenderPass=function(e){var t=this._renderPasses.get(e);if(t)return t;var n=this.device,i=new Qs,o=new Zs;i.format=n.colorFormat,o.format=n.depthStencilFormat,o.stencilStoreOp=es.DISCARD,o.depthStoreOp=es.DISCARD,e&_s.COLOR||(e&b_?i.loadOp=$a.DISCARD:(i.loadOp=$a.LOAD,i.beginAccesses=[ts.PRESENT])),(e&_s.DEPTH_STENCIL)!==_s.DEPTH_STENCIL&&(e&_s.DEPTH||(o.depthLoadOp=$a.LOAD),e&_s.STENCIL||(o.stencilLoadOp=$a.LOAD),o.beginAccesses=[ts.DEPTH_STENCIL_ATTACHMENT_WRITE]);var r=new $s([i],o);return t=n.createRenderPass(r),this._renderPasses.set(e,t),t},n.getDeferredRenderData=function(){return this._deferredRenderData||this._generateDeferredRenderData(),this._deferredRenderData},n._activeRenderer=function(){var e=this.device;this._commandBuffers.push(e.commandBuffer);var t=Td.getSampler(e,Cw);this._descriptorSet.bindSampler(_h,t),this._descriptorSet.bindTexture(_h,pm.get("default-texture").getGFXTexture()),this._descriptorSet.bindSampler(Dh,t),this._descriptorSet.bindTexture(Dh,pm.get("default-texture").getGFXTexture()),this._descriptorSet.update();var n=new ww;if(!(n=this.createQuadInputAssembler(Oa.IDENTITY)).quadIB||!n.quadVB||!n.quadIA)return!1;this._quadIB=n.quadIB,this._quadVBOffscreen=n.quadVB,this._quadIAOffscreen=n.quadIA;var i=this.createQuadInputAssembler(e.surfaceTransform);if(!i.quadIB||!i.quadVB||!i.quadIA)return!1;if(this._quadVBOnscreen=i.quadVB,this._quadIAOnscreen=i.quadIA,!this._gbufferRenderPass){var o=new Qs;o.format=Ma.RGBA16F,o.loadOp=$a.CLEAR,o.storeOp=es.STORE;var r=new Qs;r.format=Ma.RGBA16F,r.loadOp=$a.CLEAR,r.storeOp=es.STORE;var a=new Qs;a.format=Ma.RGBA16F,a.loadOp=$a.CLEAR,a.storeOp=es.STORE;var s=new Qs;s.format=Ma.RGBA16F,s.loadOp=$a.CLEAR,s.storeOp=es.STORE;var c=new Zs;c.format=e.depthStencilFormat,c.depthLoadOp=$a.CLEAR,c.depthStoreOp=es.STORE,c.stencilLoadOp=$a.CLEAR,c.stencilStoreOp=es.STORE;var l=new $s([o,r,a,s],c);this._gbufferRenderPass=e.createRenderPass(l)}if(!this._lightingRenderPass){var u=new Qs;u.format=Ma.RGBA16F,u.loadOp=$a.CLEAR,u.storeOp=es.STORE,u.endAccesses=[ts.COLOR_ATTACHMENT_WRITE];var h=new Zs;h.format=e.depthStencilFormat,h.depthLoadOp=$a.LOAD,h.depthStoreOp=es.DISCARD,h.stencilLoadOp=$a.LOAD,h.stencilStoreOp=es.DISCARD,h.beginAccesses=[ts.DEPTH_STENCIL_ATTACHMENT_WRITE],h.endAccesses=[ts.DEPTH_STENCIL_ATTACHMENT_WRITE];var _=new $s([u],h);this._lightingRenderPass=e.createRenderPass(_)}return this._width=e.width,this._height=e.height,this._generateDeferredRenderData(),e.surfaceTransform===Oa.IDENTITY||e.surfaceTransform===Oa.ROTATE_180?(this._width=e.width,this._height=e.height):(this._width=e.height,this._height=e.width),!0},n.destroyUBOs=function(){this._descriptorSet&&(this._descriptorSet.getBuffer(lh.BINDING).destroy(),this._descriptorSet.getBuffer(hh.BINDING).destroy(),this._descriptorSet.getBuffer(uh.BINDING).destroy(),this._descriptorSet.getSampler(_h).destroy(),this._descriptorSet.getSampler(Dh).destroy(),this._descriptorSet.getTexture(_h).destroy(),this._descriptorSet.getTexture(Dh).destroy())},n.destroyDeferredData=function(){var e=this._deferredRenderData;if(e){e.gbufferFrameBuffer&&e.gbufferFrameBuffer.destroy(),e.lightingFrameBuffer&&e.lightingFrameBuffer.destroy(),e.depthTex&&e.depthTex.destroy();for(var t=0;t<e.gbufferRenderTargets.length;t++)e.gbufferRenderTargets[t].destroy();e.gbufferRenderTargets.length=0;for(var n=0;n<e.lightingRenderTargets.length;n++)e.lightingRenderTargets[n].destroy();e.lightingRenderTargets.length=0}this._deferredRenderData=null},n.destroy=function(){this.destroyUBOs(),this.destroyQuadInputAssembler(),this.destroyDeferredData();for(var t=this._renderPasses.values(),n=t.next();!n.done;)n.value.destroy(),n=t.next();return this._commandBuffers.length=0,e.prototype.destroy.call(this)},n.resize=function(e,t){this._width===e&&this._height===t||(this._width=e,this._height=t,this.destroyDeferredData(),this._generateDeferredRenderData())},n.createQuadInputAssembler=function(){var e=new ww,t=4*Float32Array.BYTES_PER_ELEMENT,n=4*t,i=this._device.createBuffer(new Rs(za.VERTEX|za.TRANSFER_DST,Ha.HOST|Ha.DEVICE,n,t));if(!i)return e;var o=Uint8Array.BYTES_PER_ELEMENT,r=6*o,a=this._device.createBuffer(new Rs(za.INDEX|za.TRANSFER_DST,Ha.HOST|Ha.DEVICE,r,o));if(!a)return e;var s=new Uint8Array(6);s[0]=0,s[1]=1,s[2]=2,s[3]=1,s[4]=3,s[5]=2,a.update(s);var c=new Array(2);c[0]=new Ys("a_position",Ma.RG32F),c[1]=new Ys("a_texCoord",Ma.RG32F);var l=this._device.createInputAssembler(new Ks(c,[i],a));return e.quadIB=a,e.quadVB=i,e.quadIA=l,e},n.updateQuadVertexData=function(e){if(this._lastUsedRenderArea!==e){this._lastUsedRenderArea=e;var t=this.genQuadVertexData(Oa.IDENTITY,e);this._quadVBOffscreen.update(t);var n=this.genQuadVertexData(this.device.surfaceTransform,e);this._quadVBOnscreen.update(n)}},n.genQuadVertexData=function(e,t){var n=new Float32Array(16),i=t.x/this.device.width,o=(t.x+t.width)/this.device.width,r=t.y/this.device.height,a=(t.y+t.height)/this.device.height;if(this.device.capabilities.screenSpaceSignY>0){var s=a;a=r,r=s}var c=0;switch(e){case Oa.IDENTITY:c=0,n[c++]=-1,n[c++]=-1,n[c++]=i,n[c++]=a,n[c++]=1,n[c++]=-1,n[c++]=o,n[c++]=a,n[c++]=-1,n[c++]=1,n[c++]=i,n[c++]=r,n[c++]=1,n[c++]=1,n[c++]=o,n[c++]=r;break;case Oa.ROTATE_90:c=0,n[c++]=-1,n[c++]=-1,n[c++]=o,n[c++]=a,n[c++]=1,n[c++]=-1,n[c++]=o,n[c++]=r,n[c++]=-1,n[c++]=1,n[c++]=i,n[c++]=a,n[c++]=1,n[c++]=1,n[c++]=i,n[c++]=r;break;case Oa.ROTATE_180:c=0,n[c++]=-1,n[c++]=-1,n[c++]=i,n[c++]=r,n[c++]=1,n[c++]=-1,n[c++]=o,n[c++]=r,n[c++]=-1,n[c++]=1,n[c++]=i,n[c++]=a,n[c++]=1,n[c++]=1,n[c++]=o,n[c++]=a;break;case Oa.ROTATE_270:c=0,n[c++]=-1,n[c++]=-1,n[c++]=i,n[c++]=r,n[c++]=1,n[c++]=-1,n[c++]=i,n[c++]=a,n[c++]=-1,n[c++]=1,n[c++]=o,n[c++]=r,n[c++]=1,n[c++]=1,n[c++]=o,n[c++]=a}return n},n.destroyQuadInputAssembler=function(){this._quadIB&&(this._quadIB.destroy(),this._quadIB=null),this._quadVBOnscreen&&(this._quadVBOnscreen.destroy(),this._quadVBOnscreen=null),this._quadVBOffscreen&&(this._quadVBOffscreen.destroy(),this._quadVBOffscreen=null),this._quadIAOnscreen&&(this._quadIAOnscreen.destroy(),this._quadIAOnscreen=null),this._quadIAOffscreen&&(this._quadIAOffscreen.destroy(),this._quadIAOffscreen=null)},n._generateDeferredRenderData=function(){var e=this.device,t=this._deferredRenderData=new bw;t.gbufferRenderTargets.push(e.createTexture(new Ls(Ga.TEX2D,ka.COLOR_ATTACHMENT|ka.SAMPLED,Ma.RGBA16F,this._width,this._height))),t.gbufferRenderTargets.push(e.createTexture(new Ls(Ga.TEX2D,ka.COLOR_ATTACHMENT|ka.SAMPLED,Ma.RGBA16F,this._width,this._height))),t.gbufferRenderTargets.push(e.createTexture(new Ls(Ga.TEX2D,ka.COLOR_ATTACHMENT|ka.SAMPLED,Ma.RGBA16F,this._width,this._height))),t.gbufferRenderTargets.push(e.createTexture(new Ls(Ga.TEX2D,ka.COLOR_ATTACHMENT|ka.SAMPLED,Ma.RGBA16F,this._width,this._height))),t.depthTex=e.createTexture(new Ls(Ga.TEX2D,ka.DEPTH_STENCIL_ATTACHMENT,e.depthStencilFormat,this._width,this._height)),t.gbufferFrameBuffer=e.createFramebuffer(new nc(this._gbufferRenderPass,t.gbufferRenderTargets,t.depthTex)),t.lightingRenderTargets.push(e.createTexture(new Ls(Ga.TEX2D,ka.COLOR_ATTACHMENT|ka.SAMPLED,Ma.RGBA16F,this._width,this._height))),t.lightingFrameBuffer=e.createFramebuffer(new nc(this._lightingRenderPass,t.lightingRenderTargets,t.depthTex)),this._descriptorSet.bindTexture(ph,t.gbufferFrameBuffer.colorTextures[0]),this._descriptorSet.bindTexture(gh,t.gbufferFrameBuffer.colorTextures[1]),this._descriptorSet.bindTexture(Sh,t.gbufferFrameBuffer.colorTextures[2]),this._descriptorSet.bindTexture(bh,t.gbufferFrameBuffer.colorTextures[3]),this._descriptorSet.bindTexture(Ah,t.lightingFrameBuffer.colorTextures[0]);var n=Td.getSampler(e,Cw);this._descriptorSet.bindSampler(ph,n),this._descriptorSet.bindSampler(gh,n),this._descriptorSet.bindSampler(Sh,n),this._descriptorSet.bindSampler(bh,n),this._descriptorSet.bindSampler(Ah,n)},te(t,[{key:"quadIAOnscreen",get:function(){return this._quadIAOnscreen}},{key:"quadIAOffscreen",get:function(){return this._quadIAOffscreen}}]),t}(FE),cw=he((sw=uw).prototype,"renderTextures",[nw,W_,iw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lw=he(sw.prototype,"materials",[ow,W_,rw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),aw=sw))||aw)),Pw=[new Is(0,0,0,1)];function Rw(){var e=new zC;return e.initialize({flows:[]}),e}e("fG",(hw=U_("PostprocessStage"),_w=pf(kS),fw=lf(),hw((gw=vw=function(e){function t(){var t;return ue(t=e.call(this)||this,"_postprocessMaterial",mw,se(t)),t._renderArea=new xs,t._uiPhase=void 0,t._uiPhase=new $A,t}ie(t,e);var n=t.prototype;return n.initialize=function(t){return e.prototype.initialize.call(this,t),!0},n.activate=function(t,n){e.prototype.activate.call(this,t,n),this._uiPhase.activate(t)},n.destroy=function(){},n.render=function(e){var t=this._pipeline,n=t.device,i=t.commandBuffers[0];t.pipelineUBO.updateCameraUBO(e);var o=e.viewport;this._renderArea.x=o.x*e.width,this._renderArea.y=o.y*e.height,this._renderArea.width=o.width*e.width*t.pipelineSceneData.shadingScale,this._renderArea.height=o.height*e.height*t.pipelineSceneData.shadingScale;var r,a,s=e.window.framebuffer,c=s.colorTextures[0]?s.renderPass:t.getRenderPass(e.clearFlag);e.clearFlag&_s.COLOR&&(Pw[0].x=e.clearColor.x,Pw[0].y=e.clearColor.y,Pw[0].z=e.clearColor.z),Pw[0].w=e.clearColor.w,i.beginRenderPass(c,s,this._renderArea,Pw,e.clearDepth,e.clearStencil),i.bindDescriptorSet(rh.GLOBAL,t.descriptorSet);var l=pm.get("builtin-post-process-material");l?(r=l.passes[0],a=Oo.get(r.getShaderVariant())):(r=this._postprocessMaterial.passes[0],a=Oo.get(this._postprocessMaterial.passes[0].getShaderVariant()));var u=e.window.hasOffScreenAttachments?t.quadIAOffscreen:t.quadIAOnscreen,h=null;null!=r&&null!=a&&null!=u&&(h=lA.getOrCreatePipelineState(n,r,a,c,u));var _=t.pipelineSceneData.renderObjects;null!=h&&_.length>0&&(i.bindPipelineState(h),i.bindInputAssembler(u),i.draw(u)),this._uiPhase.render(e,c),i.endRenderPass()},te(t,[{key:"material",set:function(e){this._postprocessMaterial!==e&&(this._postprocessMaterial=e)}}]),t}(rS),vw.initInfo={name:"PostprocessStage",priority:EC.POSTPROCESS,tag:0},mw=he((pw=gw).prototype,"_postprocessMaterial",[_w,W_,fw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dw=pw))||dw));var Nw=e("da",function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).frame=null,t.container=null,t.canvas=null,t.renderType=-1,t.eventTargetOn=e.prototype.on,t.eventTargetOnce=e.prototype.once,t.config={},t.onStart=null,t.collisionMatrix=[],t.groupList=[],t._persistRootNodes={},t._paused=!0,t._configLoaded=!1,t._isCloning=!1,t._inited=!1,t._engineInited=!1,t._rendererInitialized=!1,t._gfxDevice=null,t._intervalId=null,t}ie(t,e);var n=t.prototype;return n.setFrameRate=function(e){var t=this.config;"number"!=typeof e&&(e=parseInt(e,10),Number.isNaN(e)&&(e=60)),t.frameRate=e,this._paused=!0,this._setAnimFrame(),this._runMainLoop()},n.getFrameRate=function(){return this.config.frameRate||0},n.step=function(){c.director.mainLoop()},n.pause=function(){this._paused||(this._paused=!0,this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0))},n.resume=function(){this._paused&&this._runMainLoop()},n.isPaused=function(){return this._paused},n.restart=function(){var e=this;return new Promise((function(e){return c.director.once(c.Director.EVENT_AFTER_DRAW,(function(){return e()}))})).then((function(){for(var n in e._persistRootNodes)e.removePersistRootNode(e._persistRootNodes[n]);return c.director.getScene().destroy(),c.Object._deferredDestroy(),c.director.reset(),e.pause(),e._setRenderPipelineNShowSplash().then((function(){e.resume(),e._safeEmit(t.EVENT_RESTART)}))}))},n.end=function(){this._gfxDevice&&(this._gfxDevice.destroy(),this._gfxDevice=null),window.close()},n.on=function(e,n,i,o){return(this._engineInited&&e===t.EVENT_ENGINE_INITED||this._inited&&e===t.EVENT_GAME_INITED||this._rendererInitialized&&e===t.EVENT_RENDERER_INITED)&&n.call(i),this.eventTargetOn(e,n,i,o)},n.once=function(e,n,i){return this._engineInited&&e===t.EVENT_ENGINE_INITED?n.call(i):this.eventTargetOnce(e,n,i)},n.init=function(e){var t=this;return this._initConfig(e),this.config.assetOptions&&c.assetManager.init(this.config.assetOptions),this._initEngine().then((function(){return t._initEvents(),c.director.root.dataPoolManager&&c.director.root.dataPoolManager.jointTexturePool.registerCustomTextureLayouts(e.customJointTextureLayouts),t._engineInited}))},n.run=function(e,t){var n,i=this;return"function"!=typeof e&&e?(n=this.init(e),this.onStart=null!=t?t:null):this.onStart=null!=e?e:null,Promise.resolve(n).then((function(){return Ow.config.registerSystemEvent&&wx.registerSystemEvent(),i._setRenderPipelineNShowSplash()}))},n.addPersistRootNode=function(e){if(c.Node.isNode(e)&&e.uuid){var t=e.uuid;if(!this._persistRootNodes[t]){var n=c.director._scene;if(c.isValid(n))if(e.parent){if(!(e.parent instanceof c.Scene))return void P(3801);if(e.parent!==n)return void P(3802);e._originalSceneId=n.uuid}else e.parent=n;this._persistRootNodes[t]=e,e._persistNode=!0,c.assetManager._releaseManager._addPersistNodeRef(e)}}else P(3800)},n.removePersistRootNode=function(e){var t=e.uuid||"";e===this._persistRootNodes[t]&&(delete this._persistRootNodes[t],e._persistNode=!1,e._originalSceneId="",c.assetManager._releaseManager._removePersistNodeRef(e))},n.isPersistRootNode=function(e){return!!e._persistNode},n._initEngine=function(){var e=this;return this._initDevice(),Promise.resolve(c.director._init()).then((function(){g("Cocos Creator v"+l),e.emit(t.EVENT_ENGINE_INITED),e._engineInited=!0,c.internal.dynamicAtlasManager.enabled=!ft.CLEANUP_IMAGE_CACHE}))},n._setAnimFrame=function(){this._lastTime=performance.now();var e=this.config.frameRate;this._frameTime=1e3/e,this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0);var t=window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;60!==e&&30!==e?(window.rAF=t?this._stTimeWithRAF:this._stTime,window.cAF=this._ctTime):(window.rAF=t||this._stTime,window.cAF=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.ocancelAnimationFrame||this._ctTime)},n._stTimeWithRAF=function(e){var t=performance.now(),n=Math.max(0,t-Ow._lastTime),i=Math.max(0,Ow._frameTime-n),o=window.setTimeout((function(){window.requestAnimationFrame(e)}),i);return Ow._lastTime=t+i,o},n._stTime=function(e){var t=performance.now(),n=Math.max(0,t-Ow._lastTime),i=Math.max(0,Ow._frameTime-n),o=window.setTimeout(e,i);return Ow._lastTime=t+i,o},n._ctTime=function(e){window.clearTimeout(e)},n._runMainLoop=function(){var e=this;if(this._inited&&!i){var t,n=this.config,o=c.director,r=n.frameRate;if(z(!!n.showFPS),o.startAnimation(),30===r){var a=!0;t=function(n){e._intervalId=window.rAF(t),(a=!a)||o.mainLoop(n)}}else t=function(n){e._intervalId=window.rAF(t),o.mainLoop(n)};this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0),this._intervalId=window.rAF(t),this._paused=!1}},n._initConfig=function(e){"number"!=typeof e.debugMode&&(e.debugMode=O.NONE),e.exposeClassName=!!e.exposeClassName,"number"!=typeof e.frameRate&&(e.frameRate=60);var t=e.renderMode;("number"!=typeof t||t>2||t<0)&&(e.renderMode=0),"boolean"!=typeof e.registerSystemEvent&&(e.registerSystemEvent=!0),e.showFPS=!!e.showFPS,this.collisionMatrix=e.collisionMatrix||[],this.groupList=e.groupList||[],T(e.debugMode),this.config=e,this._configLoaded=!0,this._setAnimFrame()},n._determineRenderType=function(){var e=this.config,n=parseInt(e.renderMode,10);this.renderType=t.RENDER_TYPE_CANVAS;var i=!1;if(0===n?c.sys.capabilities.opengl?(this.renderType=t.RENDER_TYPE_WEBGL,i=!0):c.sys.capabilities.canvas&&(this.renderType=t.RENDER_TYPE_CANVAS,i=!0):1===n&&c.sys.capabilities.canvas?(this.renderType=t.RENDER_TYPE_CANVAS,i=!0):2===n&&c.sys.capabilities.opengl&&(this.renderType=t.RENDER_TYPE_WEBGL,i=!0),!i)throw new Error(L(3820,n))},n._initDevice=function(){if(!this._rendererInitialized){if(this.canvas=this.config.adapter.canvas,this.frame=this.config.adapter.frame,this.container=this.config.adapter.container,this._determineRenderType(),this.renderType===t.RENDER_TYPE_WEBGL){var e=[],n=!!window.WebGL2RenderingContext,i=window.navigator.userAgent.toLowerCase();(-1!==i.indexOf("safari")&&-1===i.indexOf("chrome")||Di.browserType===Ai.UC)&&(n=!1),n&&c.WebGL2Device&&e.push(c.WebGL2Device),c.WebGLDevice&&e.push(c.WebGLDevice);for(var o=new pc(this.canvas,ft.ENABLE_WEBGL_ANTIALIAS,!1,window.devicePixelRatio,jx.windowPixelResolution.width,jx.windowPixelResolution.height,ch),r=0;r<e.length&&(this._gfxDevice=new e[r],!this._gfxDevice.initialize(o));r++);}if(!this._gfxDevice)return x("can not support canvas rendering in 3D"),void(this.renderType=t.RENDER_TYPE_CANVAS);this.canvas.oncontextmenu=function(){return!1}}},n._initEvents=function(){Di.onShow(this._onShow.bind(this)),Di.onHide(this._onHide.bind(this))},n._onHide=function(){this.emit(t.EVENT_HIDE),this.pause()},n._onShow=function(){this.emit(t.EVENT_SHOW),this.resume()},n._setRenderPipelineNShowSplash=function(){var e=this;return Promise.resolve(this._setupRenderPipeline()).then((function(){return Promise.resolve(e._showSplashScreen()).then((function(){e._inited=!0,e._setAnimFrame(),e._runMainLoop(),e._safeEmit(t.EVENT_GAME_INITED),e.onStart&&e.onStart()}))}))},n._setupRenderPipeline=function(){var e=this,t=this.config.renderPipeline;return t?new Promise((function(e,n){c.assetManager.loadAny(t,(function(t,i){return!t&&i instanceof FE?e(i):n(t)}))})).then((function(t){e._setRenderPipeline(t)})).catch((function(n){y(n),y("Failed load render pipeline: "+t+", engine failed to initialize, will fallback to default pipeline"),e._setRenderPipeline()})):this._setRenderPipeline()},n._showSplashScreen=function(){if(c.internal.SplashScreen){var e=c.internal.SplashScreen.instance;return e.main(c.director.root),new Promise((function(t){e.setOnFinish((function(){return t()})),e.loadFinish=!0}))}return null},n._setRenderPipeline=function(e){c.director.root.setRenderPipeline(e)||this._setRenderPipeline(),this._rendererInitialized=!0,this._safeEmit(t.EVENT_RENDERER_INITED)},n._safeEmit=function(e){this.emit(e)},te(t,[{key:"inited",get:function(){return this._inited}},{key:"frameTime",get:function(){return this._frameTime}}]),t}(Ni));Nw.EVENT_HIDE="game_on_hide",Nw.EVENT_SHOW="game_on_show",Nw.EVENT_LOW_MEMORY="game_on_low_memory",Nw.EVENT_GAME_INITED="game_inited",Nw.EVENT_ENGINE_INITED="engine_inited",Nw.EVENT_RENDERER_INITED="renderer_inited",Nw.EVENT_RESTART="game_on_restart",Nw.RENDER_TYPE_CANVAS=0,Nw.RENDER_TYPE_WEBGL=1,Nw.RENDER_TYPE_OPENGL=2,c.Game=Nw;var Ow=e("dg",c.game=new Nw),Dw=e("df",{topLeft:c.v2(0,0),topRight:c.v2(0,0),top:c.v2(0,0),bottomLeft:c.v2(0,0),bottomRight:c.v2(0,0),bottom:c.v2(0,0),center:c.v2(0,0),left:c.v2(0,0),right:c.v2(0,0),width:0,height:0,init:function(e){var t=this.width=e.width,n=this.height=e.height,i=e.x,o=e.y,r=o+n,a=i+t;this.topLeft.x=i,this.topLeft.y=r,this.topRight.x=a,this.topRight.y=r,this.top.x=i+t/2,this.top.y=r,this.bottomLeft.x=i,this.bottomLeft.y=o,this.bottomRight.x=a,this.bottomRight.y=o,this.bottom.x=i+t/2,this.bottom.y=o,this.center.x=i+t/2,this.center.y=o+n/2,this.left.x=i,this.left.y=o+n/2,this.right.x=a,this.right.y=o+n/2}});c.visibleRect=Dw;var Mw=new(function(){function e(){this.html=void 0,this.meta={width:"device-width"},this.adaptationType=c.sys.browserType}var t=e.prototype;return t.init=function(){this.html=document.getElementsByTagName("html")[0]},t.availWidth=function(e){return c.sys.isMobile||!e||e===this.html?window.innerWidth:e.clientWidth},t.availHeight=function(e){return c.sys.isMobile||!e||e===this.html?window.innerHeight:e.clientHeight},e}());switch(Di.os===Ii.IOS&&(Mw.adaptationType=Ai.SAFARI),Mw.adaptationType){case Ai.SAFARI:Mw.meta["minimal-ui"]="true",Mw.availWidth=function(e){return e.clientWidth},Mw.availHeight=function(e){return e.clientHeight};break;case Ai.SOUGOU:case Ai.UC:Mw.availWidth=function(e){return e.clientWidth},Mw.availHeight=function(e){return e.clientHeight}}var Lw=e("dS",function(e){function t(){var t;(t=e.call(this)||this)._resizeWithBrowserSize=void 0,t._designResolutionSize=void 0,t._originalDesignResolutionSize=void 0,t._frameSize=void 0,t._scaleX=void 0,t._scaleY=void 0,t._viewportRect=void 0,t._visibleRect=void 0,t._autoFullScreen=void 0,t._devicePixelRatio=void 0,t._maxPixelRatio=void 0,t._retinaEnabled=void 0,t._resizeCallback=void 0,t._resizing=void 0,t._orientationChanging=void 0,t._isRotated=void 0,t._rotateAngle=void 0,t._orientation=void 0,t._isAdjustViewport=void 0,t._resolutionPolicy=void 0,t._rpExactFit=void 0,t._rpShowAll=void 0,t._rpNoBorder=void 0,t._rpFixedHeight=void 0,t._rpFixedWidth=void 0;var n=Fw,i=zw;return t._frameSize=new ni(0,0),t._designResolutionSize=new ni(0,0),t._originalDesignResolutionSize=new ni(0,0),t._scaleX=1,t._scaleY=1,t._viewportRect=new oi(0,0,0,0),t._visibleRect=new oi(0,0,0,0),t._autoFullScreen=!1,t._devicePixelRatio=1,t._maxPixelRatio=2,t._retinaEnabled=!1,t._resizeCallback=null,t._resizing=!1,t._resizeWithBrowserSize=!1,t._orientationChanging=!0,t._isRotated=!1,t._rotateAngle=90,t._orientation=c.macro.ORIENTATION_AUTO,t._isAdjustViewport=!0,t._rpExactFit=new Bw(n.EQUAL_TO_FRAME,i.EXACT_FIT),t._rpShowAll=new Bw(n.EQUAL_TO_FRAME,i.SHOW_ALL),t._rpNoBorder=new Bw(n.EQUAL_TO_FRAME,i.NO_BORDER),t._rpFixedHeight=new Bw(n.EQUAL_TO_FRAME,i.FIXED_HEIGHT),t._rpFixedWidth=new Bw(n.EQUAL_TO_FRAME,i.FIXED_WIDTH),t._resolutionPolicy=t._rpShowAll,c.game.once(c.Game.EVENT_ENGINE_INITED,t.init,se(t)),t}ie(t,e);var n=t.prototype;return n.init=function(){Mw.init(),this._initFrameSize();var e=c.game.canvas.width,t=c.game.canvas.height;this._designResolutionSize.width=e,this._designResolutionSize.height=t,this._originalDesignResolutionSize.width=e,this._originalDesignResolutionSize.height=t,this._viewportRect.width=e,this._viewportRect.height=t,this._visibleRect.width=e,this._visibleRect.height=t,c.winSize.width=this._visibleRect.width,c.winSize.height=this._visibleRect.height,c.visibleRect&&c.visibleRect.init(this._visibleRect)},n.resizeWithBrowserSize=function(e){e?this._resizeWithBrowserSize||(this._resizeWithBrowserSize=!0,Di.onViewResize(this._resizeEvent),Di.onOrientationChange(this._orientationChange)):this._resizeWithBrowserSize&&(this._resizeWithBrowserSize=!1,Di.offViewResize(this._resizeEvent),Di.offOrientationChange(this._orientationChange))},n.setResizeCallback=function(e){"function"!=typeof e&&null!=e||(this._resizeCallback=e)},n.setOrientation=function(e){(e&=c.macro.ORIENTATION_AUTO)&&this._orientation!==e&&(this._orientation=e)},n.adjustViewportMeta=function(e){this._isAdjustViewport=e},n.enableRetina=function(e){this._retinaEnabled=!!e},n.isRetinaEnabled=function(){return this._retinaEnabled},n.enableAutoFullScreen=function(e){e&&e!==this._autoFullScreen&&c.sys.isMobile&&Di.browserType!==Ai.WECHAT?(this._autoFullScreen=!0,c.screen.autoFullScreen(c.game.frame)):this._autoFullScreen=!1},n.isAutoFullScreenEnabled=function(){return this._autoFullScreen},n.setCanvasSize=function(e,t){var n=c.game.canvas,i=c.game.container;this._devicePixelRatio=window.devicePixelRatio,n.width=jx.windowPixelResolution.width,n.height=jx.windowPixelResolution.height,n.style.width=e+"px",n.style.height=t+"px",i.style.width=e+"px",i.style.height=t+"px",this._resizeEvent()},n.getCanvasSize=function(){return new ni(c.game.canvas.width,c.game.canvas.height)},n.getFrameSize=function(){return new ni(this._frameSize.width,this._frameSize.height)},n.setFrameSize=function(e,t){this._frameSize.width=e,this._frameSize.height=t,c.game.frame.style.width=e+"px",c.game.frame.style.height=t+"px",this._resizeEvent()},n.getVisibleSize=function(){return new ni(this._visibleRect.width,this._visibleRect.height)},n.getVisibleSizeInPixel=function(){return new ni(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},n.getVisibleOrigin=function(){return new Kn(this._visibleRect.x,this._visibleRect.y)},n.getVisibleOriginInPixel=function(){return new Kn(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},n.getResolutionPolicy=function(){return this._resolutionPolicy},n.setResolutionPolicy=function(e){if(e instanceof Bw)this._resolutionPolicy=e;else{var t=Bw;e===t.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit),e===t.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll),e===t.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder),e===t.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight),e===t.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}},n.setDesignResolutionSize=function(e,t,n){if(e>0&&t>0){this.setResolutionPolicy(n);var i=this._resolutionPolicy;if(i&&i.preApply(this),c.sys.isMobile&&this._adjustViewportMeta(),this._orientationChanging=!0,this._resizing||this._initFrameSize(),i){this._originalDesignResolutionSize.width=this._designResolutionSize.width=e,this._originalDesignResolutionSize.height=this._designResolutionSize.height=t;var o=i.apply(this,this._designResolutionSize);if(o.scale&&2===o.scale.length&&(this._scaleX=o.scale[0],this._scaleY=o.scale[1]),o.viewport){var r=this._viewportRect,a=this._visibleRect,s=o.viewport;r.x=s.x,r.y=s.y,r.width=s.width,r.height=s.height,a.x=0,a.y=0,a.width=s.width/this._scaleX,a.height=s.height/this._scaleY}i.postApply(this),c.winSize.width=this._visibleRect.width,c.winSize.height=this._visibleRect.height,Dw&&Dw.init(this._visibleRect),this.emit("design-resolution-changed")}else b(2201)}else N(2200)},n.getDesignResolutionSize=function(){return new ni(this._designResolutionSize.width,this._designResolutionSize.height)},n.setRealPixelResolution=function(e,t,n){this._setViewportMeta({width:e},!0),document.documentElement.style.width=e+"px",document.body.style.width=e+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(e,t,n)},n.getViewportRect=function(){return this._viewportRect},n.getScaleX=function(){return this._scaleX},n.getScaleY=function(){return this._scaleY},n.getDevicePixelRatio=function(){return this._devicePixelRatio},n.convertToLocationInView=function(e,t,n,i){var o=i||new Kn,r=this._devicePixelRatio*(e-n.left),a=this._devicePixelRatio*(n.top+n.height-t);return this._isRotated?90==this._rotateAngle?(o.x=c.game.canvas.width-a,o.y=r):(o.x=a,o.y=c.game.canvas.height-r):(o.x=r,o.y=a),c.GAME_VIEW&&(o.x/=c.gameView.canvas.width/c.game.canvas.width,o.y/=c.gameView.canvas.height/c.game.canvas.height),o},n.setRotateAngle=function(e){this._rotateAngle=e,this._resizeEvent()},n.isRotate=function(){return this._isRotated},n._convertPointWithScale=function(e){var t=this._viewportRect;e.x=(e.x-t.x)/this._scaleX,e.y=(e.y-t.y)/this._scaleY},n._resizeEvent=function(){var e=c.view,t=e._frameSize.width,n=e._frameSize.height,i=e._isRotated;if(c.sys.isMobile){var o=c.game.container.style,r=o.margin;o.margin="0",o.display="none",e._initFrameSize(),o.margin=r,o.display="block"}else e._initFrameSize();if(e._orientationChanging||e._isRotated!==i||e._frameSize.width!==t||e._frameSize.height!==n){var a=e._originalDesignResolutionSize.width,s=e._originalDesignResolutionSize.height;e._resizing=!0,a>0&&e.setDesignResolutionSize(a,s,e._resolutionPolicy),e._resizing=!1,e.emit("canvas-resize"),e._resizeCallback&&e._resizeCallback.call()}},n._orientationChange=function(){c.view._orientationChanging=!0,c.view._resizeEvent()},n._initFrameSize=function(){var e=this._frameSize,t=Mw.availWidth(c.game.frame),n=Mw.availHeight(c.game.frame),i=t>=n;i&&this._orientation&c.macro.ORIENTATION_LANDSCAPE||!i&&this._orientation&c.macro.ORIENTATION_PORTRAIT?(e.width=t,e.height=n,c.game.container.style["-webkit-transform"]="rotate(0deg)",c.game.container.style.transform="rotate(0deg)",this._isRotated=!1):(e.width=n,e.height=t,c.game.container.style["-webkit-transform"]="rotate("+this._rotateAngle+"deg)",c.game.container.style.transform="rotate("+this._rotateAngle+"deg)",c.game.container.style["-webkit-transform-origin"]="0px 0px 0px",c.game.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0,c.game.canvas.style["-webkit-transform"]="translateZ(0px)",c.game.canvas.style.transform="translateZ(0px)"),this._orientationChanging&&setTimeout((function(){c.view._orientationChanging=!1}),1e3)},n._adjustSizeKeepCanvasSize=function(){var e=this._originalDesignResolutionSize.width,t=this._originalDesignResolutionSize.height;e>0&&this.setDesignResolutionSize(e,t,this._resolutionPolicy)},n._setViewportMeta=function(e,t){var n=document.getElementById("cocosMetaElement");n&&t&&document.head.removeChild(n);var i,o,r,a=document.getElementsByName("viewport"),s=a?a[0]:null;for(o in i=s?s.content:"",(n=n||document.createElement("meta")).id="cocosMetaElement",n.name="viewport",n.content="",e)-1===i.indexOf(o)?i+=","+o+"="+e[o]:t&&(r=new RegExp(o+"s*=s*[^,]+"),i=i.replace(r,o+"="+e[o]));/^,/.test(i)&&(i=i.substr(1)),n.content=i,s&&(s.content=i),document.head.appendChild(n)},n._adjustViewportMeta=function(){!this._isAdjustViewport||a||o||r||(this._setViewportMeta(Mw.meta,!1),this._isAdjustViewport=!1)},n._convertMouseToLocation=function(e,t){e.x=this._devicePixelRatio*(e.x-t.left),e.y=this._devicePixelRatio*(t.top+t.height-e.y),c.GAME_VIEW&&(e.x/=c.gameView.canvas.width/c.game.canvas.width,e.y/=c.gameView.canvas.height/c.game.canvas.height)},n._convertTouchWidthScale=function(e){var t=this._viewportRect,n=this._scaleX,i=this._scaleY;e._point.x=(e._point.x-t.x)/n,e._point.y=(e._point.y-t.y)/i,e._prevPoint.x=(e._prevPoint.x-t.x)/n,e._prevPoint.y=(e._prevPoint.y-t.y)/i},n._convertTouchesWithScale=function(e){for(var t,n,i=this._viewportRect,o=this._scaleX,r=this._scaleY,a=0;a<e.length;a++){var s=e[a];t=s._point,n=s._prevPoint,t.x=(t.x-i.x)/o,t.y=(t.y-i.y)/r,n.x=(n.x-i.x)/o,n.y=(n.y-i.y)/r}},t}(Ni));Lw.instance=void 0;var Fw=function(){function e(){this.name="ContainerStrategy"}var t=e.prototype;return t.preApply=function(){},t.apply=function(){},t.postApply=function(){},t._setupContainer=function(e,t,n){var i=c.game.canvas,o=c.game.container;Di.os===Ii.ANDROID&&(document.body.style.width=(e._isRotated?n:t)+"px",document.body.style.height=(e._isRotated?t:n)+"px"),o.style.width=i.style.width=t+"px",o.style.height=i.style.height=n+"px",e._devicePixelRatio=1,e.isRetinaEnabled()&&(e._devicePixelRatio=Math.min(e._maxPixelRatio,window.devicePixelRatio||1)),i.width=t*e._devicePixelRatio,i.height=n*e._devicePixelRatio},t._fixContainer=function(){document.body.insertBefore(c.game.container,document.body.firstChild);var e=document.body.style;e.width=window.innerWidth+"px",e.height=window.innerHeight+"px",e.overflow="hidden";var t=c.game.container.style;t.position="fixed",t.left=t.top="0px",document.body.scrollTop=0},e}();Fw.EQUAL_TO_FRAME=void 0,Fw.PROPORTION_TO_FRAME=void 0;var zw=function(){function e(){this.name="ContentStrategy",this._result=void 0,this._result={scale:[1,1],viewport:null}}var t=e.prototype;return t.preApply=function(){},t.apply=function(){return{scale:[1,1]}},t.postApply=function(){},t._buildResult=function(e,t,n,i,o,r){Math.abs(e-n)<2&&(n=e),Math.abs(t-i)<2&&(i=t);var a=new oi(Math.round((e-n)/2),Math.round((t-i)/2),n,i);return this._result.scale=[o,r],this._result.viewport=a,this._result},e}();zw.EXACT_FIT=void 0,zw.SHOW_ALL=void 0,zw.NO_BORDER=void 0,zw.FIXED_HEIGHT=void 0,zw.FIXED_WIDTH=void 0,function(){var e=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).name="EqualToFrame",t}return ie(t,e),t.prototype.apply=function(e){var t=e._frameSize.width,n=e._frameSize.height,i=c.game.container.style;this._setupContainer(e,e._frameSize.width,e._frameSize.height),e._isRotated?90==e._rotateAngle?i.margin="0 0 0 "+n+"px":i.margin=t+"px 0 0 0":i.margin="0px",i.padding="0px"},t}(Fw),t=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).name="ProportionalToFrame",t}return ie(t,e),t.prototype.apply=function(e,t){var n,i,o=e._frameSize.width,r=e._frameSize.height,a=c.game.container.style,s=t.width,l=t.height,u=o/s,h=r/l;u<h?(n=o,i=l*u):(n=s*h,i=r);var _=Math.round((o-n)/2),f=Math.round((r-i)/2);n=o-2*_,i=r-2*f,this._setupContainer(e,n,i),e._isRotated?90==e._rotateAngle?a.margin="0 0 0 "+r+"px":a.margin=o+"px 0 0 0":a.margin="0px",a.paddingLeft=_+"px",a.paddingRight=_+"px",a.paddingTop=f+"px",a.paddingBottom=f+"px"},t}(Fw),n=("undefined"==typeof window?global:window).__globalAdapter;n&&(n.adaptContainerStrategy&&n.adaptContainerStrategy(Fw.prototype),n.adaptView&&n.adaptView(Lw.prototype)),Fw.EQUAL_TO_FRAME=new e,Fw.PROPORTION_TO_FRAME=new t;var i=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).name="ExactFit",t}return ie(t,e),t.prototype.apply=function(e,t){var n=c.game.canvas.width,i=c.game.canvas.height,o=n/t.width,r=i/t.height;return this._buildResult(n,i,n,i,o,r)},t}(zw),o=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).name="ShowAll",t}return ie(t,e),t.prototype.apply=function(e,t){var n,i,o=c.game.canvas.width,r=c.game.canvas.height,a=t.width,s=t.height,l=o/a,u=r/s,h=0;return l<u?(n=o,i=s*(h=l)):(n=a*(h=u),i=r),this._buildResult(o,r,n,i,h,h)},t}(zw),r=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).name="NoBorder",t}return ie(t,e),t.prototype.apply=function(e,t){var n,i,o,r=c.game.canvas.width,a=c.game.canvas.height,s=t.width,l=t.height,u=r/s,h=a/l;return u<h?(i=s*(n=h),o=a):(i=r,o=l*(n=u)),this._buildResult(r,a,i,o,n,n)},t}(zw),a=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).name="FixedHeight",t}return ie(t,e),t.prototype.apply=function(e,t){var n=c.game.canvas.width,i=c.game.canvas.height,o=i/t.height,r=n,a=i;return this._buildResult(n,i,r,a,o,o)},t}(zw),s=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).name="FixedWidth",t}return ie(t,e),t.prototype.apply=function(e,t){var n=c.game.canvas.width,i=c.game.canvas.height,o=n/t.width,r=n,a=i;return this._buildResult(n,i,r,a,o,o)},t}(zw);zw.EXACT_FIT=new i,zw.SHOW_ALL=new o,zw.NO_BORDER=new r,zw.FIXED_HEIGHT=new a,zw.FIXED_WIDTH=new s}();var Bw=e("fl",function(){function e(e,t){this.name="ResolutionPolicy",this._containerStrategy=void 0,this._contentStrategy=void 0,this._containerStrategy=null,this._contentStrategy=null,this.setContainerStrategy(e),this.setContentStrategy(t)}var t=e.prototype;return t.preApply=function(e){this._containerStrategy.preApply(e),this._contentStrategy.preApply(e)},t.apply=function(e,t){return this._containerStrategy.apply(e,t),this._contentStrategy.apply(e,t)},t.postApply=function(e){this._containerStrategy.postApply(e),this._contentStrategy.postApply(e)},t.setContainerStrategy=function(e){e instanceof Fw&&(this._containerStrategy=e)},t.setContentStrategy=function(e){e instanceof zw&&(this._contentStrategy=e)},te(e,[{key:"canvasSize",get:function(){return new Kn(c.game.canvas.width,c.game.canvas.height)}}]),e}());Bw.EXACT_FIT=0,Bw.NO_BORDER=1,Bw.SHOW_ALL=2,Bw.FIXED_HEIGHT=3,Bw.FIXED_WIDTH=4,Bw.UNKNOWN=5,Bw.ContainerStrategy=Fw,Bw.ContentStrategy=zw,c.ResolutionPolicy=Bw;var Uw=e("dh",Lw.instance=c.view=new Lw);c.winSize=new ni,Y(Lw.prototype,"View.prototype",[{name:"isAntiAliasEnabled",suggest:"The API of Texture2d have been largely modified, no alternative"},{name:"enableAntiAlias",suggest:"The API of Texture2d have been largely modified, no alternative"}]),q(mx,"EventMouse",["DOWN","UP","MOVE"].map((function(e){return{name:e,newName:"MOUSE_"+e,target:Nx.EventType,targetName:"SystemEvent.EventType"}}))),q(mx,"EventMouse",[{name:"SCROLL",newName:"MOUSE_WHEEL",target:Nx.EventType,targetName:"SystemEvent.EventType"}]),q(vx,"EventTouch",[{name:"BEGAN",newName:"TOUCH_START",target:Nx.EventType,targetName:"SystemEvent.EventType"}]),q(vx,"EventTouch",[{name:"MOVED",newName:"TOUCH_MOVE",target:Nx.EventType,targetName:"SystemEvent.EventType"}]),q(vx,"EventTouch",[{name:"ENDED",newName:"TOUCH_END",target:Nx.EventType,targetName:"SystemEvent.EventType"}]),q(vx,"EventTouch",[{name:"CANCELLED",newName:"TOUCH_CANCEL",target:Nx.EventType,targetName:"SystemEvent.EventType"}]),q(jx,"sys",["UNKNOWN","ENGLISH","CHINESE","FRENCH","ITALIAN","GERMAN","SPANISH","DUTCH","RUSSIAN","KOREAN","JAPANESE","HUNGARIAN","PORTUGUESE","ARABIC","NORWEGIAN","POLISH","TURKISH","UKRAINIAN","ROMANIAN","BULGARIAN"].map((function(e){return{name:"LANGUAGE_"+e,newName:e,target:jx.Language,targetName:"sys.Language"}}))),q(jx,"sys",["UNKNOWN","IOS","ANDROID","WINDOWS","LINUX","OSX"].map((function(e){return{name:"OS_"+e,newName:e,target:jx.OS,targetName:"sys.OS"}}))),q(jx,"sys",["UNKNOWN","WECHAT","ANDROID","IE","EDGE","QQ","MOBILE_QQ","UC","UCBS","BAIDU_APP","BAIDU","MAXTHON","OPERA","OUPENG","MIUI","FIREFOX","SAFARI","CHROME","LIEBAO","QZONE","SOUGOU","HUAWEI"].map((function(e){return{name:"BROWSER_TYPE_"+e,newName:e,target:jx.BrowserType,targetName:"sys.BrowserType"}}))),q(jx,"sys",[{name:"BROWSER_TYPE_360",newName:"BROWSER_360",target:jx.BrowserType,targetName:"sys.BrowserType"}]),q(jx,"sys",["UNKNOWN","EDITOR_PAGE","EDITOR_CORE","MOBILE_BROWSER","DESKTOP_BROWSER","WIN32","MACOS","IOS","ANDROID","WECHAT_GAME","BAIDU_MINI_GAME","XIAOMI_QUICK_GAME","ALIPAY_MINI_GAME","BYTEDANCE_MINI_GAME","OPPO_MINI_GAME","VIVO_MINI_GAME","HUAWEI_QUICK_GAME","COCOSPLAY","LINKSURE_MINI_GAME","QTT_MINI_GAME"].map((function(e){return{name:e,target:jx.Platform,targetName:"sys.Platform"}}))),q(jx,"sys",[{name:"IPHONE",newName:"IOS",target:jx.Platform,targetName:"sys.Platform"},{name:"IPAD",newName:"IOS",target:jx.Platform,targetName:"sys.Platform"}]),Y(jx,"sys",["LINUX","BLACKBERRY","NACL","EMSCRIPTEN","TIZEN","WINRT","WP8","QQ_PLAY","FB_PLAYABLE_ADS"].map((function(e){return{name:e}})));var Hw=e("dI",{_supportsFullScreen:!1,_onfullscreenchange:null,_onfullscreenerror:null,_preOnFullScreenError:null,_preOnTouch:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){var e,t,n;this._fn={};var i,o=this._fnMap;for(e=0,t=o.length;e<t;e++)if((n=o[e])&&void 0!==document[n[1]]){for(e=0,i=n.length;e<i;e++)this._fn[o[0][e]]=n[e];break}this._supportsFullScreen=void 0!==this._fn.requestFullscreen,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},get supportsFullScreen(){return this._supportsFullScreen},fullScreen:function(){return!!this._supportsFullScreen&&void 0!==document[this._fn.fullscreenElement]&&null!==document[this._fn.fullscreenElement]},requestFullScreen:function(e,t,n){if(this._supportsFullScreen){if(e=e||document.documentElement,t){var i=this._fn.fullscreenchange;this._onfullscreenchange&&document.removeEventListener(i,this._onfullscreenchange),this._onfullscreenchange=t,document.addEventListener(i,t,!1)}if(n){var o=this._fn.fullscreenerror;this._onfullscreenerror&&document.removeEventListener(o,this._onfullscreenerror),this._onfullscreenerror=n,document.addEventListener(o,n,{once:!0})}var r=e[this._fn.requestFullscreen]();return window.Promise&&r instanceof Promise&&r.catch((function(){})),r}},exitFullScreen:function(){var e;return this.fullScreen()&&(e=document[this._fn.exitFullscreen]()).catch((function(){})),e},autoFullScreen:function(e,t){e=e||document.body,this._ensureFullScreen(e,t),this.requestFullScreen(e,t)},disableAutoFullScreen:function(e){if(this._preOnTouch){var t=c.game.canvas||e,n=this._touchEvent;t.removeEventListener(n,this._preOnTouch),this._preOnTouch=null}},_ensureFullScreen:function(e,t){var n=this,i=c.game.canvas||e,o=this._fn.fullscreenerror,r=this._touchEvent,a=function(){n._preOnFullScreenError=null,n._preOnTouch&&i.removeEventListener(r,n._preOnTouch),n._preOnTouch=function(){n._preOnTouch=null,n.requestFullScreen(e,t)},i.addEventListener(r,n._preOnTouch,{once:!0})};this._preOnFullScreenError&&e.removeEventListener(o,this._preOnFullScreenError),this._preOnFullScreenError=a,e.addEventListener(o,a,{once:!0})}});Hw.init(),c.screen=Hw;var Gw,kw=new rc(null),Vw=function(){function e(){this._device=null,this._passes=null,this._subMesh=null,this._patches=null,this._handle=No,this._priority=Xu.DEFAULT,this._inputAssembler=null,this._descriptorSet=null}var t=e.prototype;return t.initialize=function(e,t,n){void 0===n&&(n=null),this._device=c.director.root.device,this._subMesh=e,this._patches=n,this._passes=t,this._handle=Zo.alloc(),this._flushPassInfo(),t[0].batchingScheme===_m.VB_MERGING&&this._subMesh.genFlatBuffers(),kw.layout=t[0].localSetLayout;var i=Do.alloc(this._device,kw),o=Mo.alloc(this._device,e.iaInfo);Zo.set(this._handle,qo.PRIORITY,Xu.DEFAULT),Zo.set(this._handle,qo.INPUT_ASSEMBLER,o),Zo.set(this._handle,qo.DESCRIPTOR_SET,i),Zo.set(this._handle,qo.SUB_MESH,e.handle),this._inputAssembler=Mo.get(o),this._descriptorSet=Do.get(i)},t.initPlanarShadowShader=function(){var e=c.director.root.pipeline.pipelineSceneData.shadows.getPlanarShader(this._patches);Zo.set(this._handle,qo.PLANAR_SHADER,e)},t.initPlanarShadowInstanceShader=function(){var e=c.director.root.pipeline.pipelineSceneData.shadows.getPlanarInstanceShader(this._patches);Zo.set(this._handle,qo.PLANAR_INSTANCE_SHADER,e)},t.destroy=function(){Do.free(Zo.get(this._handle,qo.DESCRIPTOR_SET)),Mo.free(Zo.get(this._handle,qo.INPUT_ASSEMBLER)),Zo.free(this._handle),this._descriptorSet=null,this._inputAssembler=null,this._priority=Xu.DEFAULT,this._handle=No,this._patches=null,this._subMesh=null,this._passes=null},t.update=function(){for(var e=0;e<this._passes.length;++e)this._passes[e].update();this._descriptorSet.update()},t.onPipelineStateChanged=function(){var e=this._passes;if(e){for(var t=0;t<e.length;t++){var n=e[t];n.beginChangeStatesSilently(),n.tryCompile(),n.endChangeStatesSilently()}this._flushPassInfo()}},t.onMacroPatchesStateChanged=function(e){this._patches=e;var t=this._passes;if(t){for(var n=0;n<t.length;n++){var i=t[n];i.beginChangeStatesSilently(),i.tryCompile(),i.endChangeStatesSilently()}this._flushPassInfo()}},t._flushPassInfo=function(){var e=this._passes;if(e){Zo.set(this._handle,qo.PASS_COUNT,e.length);for(var t=qo.PASS_0,n=qo.SHADER_0,i=0;i<e.length;i++,t++,n++)Zo.set(this._handle,t,e[i].handle),Zo.set(this._handle,n,e[i].getShaderVariant(this._patches))}},te(e,[{key:"passes",get:function(){return this._passes},set:function(e){if(e.length>8)N(12004,8);else if(this._passes=e,this._flushPassInfo(),this._descriptorSet){Do.free(Zo.get(this._handle,qo.DESCRIPTOR_SET)),kw.layout=e[0].localSetLayout;var t=Do.alloc(this._device,kw);Zo.set(this._handle,qo.DESCRIPTOR_SET,t),this._descriptorSet=Do.get(t)}}},{key:"subMesh",get:function(){return this._subMesh},set:function(e){this._subMesh=e,this._inputAssembler.destroy(),this._inputAssembler.initialize(e.iaInfo),this._passes[0].batchingScheme===_m.VB_MERGING&&this._subMesh.genFlatBuffers(),Zo.set(this._handle,qo.SUB_MESH,e.handle)}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e,Zo.set(this._handle,qo.PRIORITY,e)}},{key:"handle",get:function(){return this._handle}},{key:"inputAssembler",get:function(){return this._inputAssembler}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"patches",get:function(){return this._patches}},{key:"planarShaderHandle",get:function(){return Zo.get(this._handle,qo.PLANAR_SHADER)}},{key:"planarInstanceShaderHandle",get:function(){return Zo.get(this._handle,qo.PLANAR_INSTANCE_SHADER)}}]),e}(),Ww=new wo(Ao.ATTRIBUTE,(function(e,t){return t||new Ys})),jw=new jn,qw=new ci((function(){return new Vw}),32),Yw=[{name:"CC_RECEIVE_SHADOW",value:!0}];!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.SKINNING=1]="SKINNING",e[e.BAKED_SKINNING=2]="BAKED_SKINNING",e[e.BATCH_2D=3]="BATCH_2D",e[e.PARTICLE_BATCH=4]="PARTICLE_BATCH",e[e.LINE=5]="LINE"}(Gw||(Gw=e("cF",{})));var Xw,Kw,Qw=ld([ja.LINEAR,ja.LINEAR,ja.NONE,qa.CLAMP,qa.CLAMP,qa.CLAMP]),Zw=ld([ja.LINEAR,ja.LINEAR,ja.LINEAR,qa.CLAMP,qa.CLAMP,qa.CLAMP]),Jw=e("bZ",function(){function e(){this.type=Gw.DEFAULT,this.scene=null,this.isDynamicBatching=!1,this.instancedAttributes={buffer:null,views:[],attributes:[]},this._enabled=!0,this._worldBounds=null,this._modelBounds=null,this._subModels=[],this._node=null,this._transform=null,this._visFlags=qu.Enum.NONE,this._device=void 0,this._inited=!1,this._descriptorSetCount=1,this._updateStamp=-1,this._transformUpdated=!0,this._handle=No,this._hWorldBounds=No,this._localData=new Float32Array(Fh.COUNT),this._localBuffer=null,this._instMatWorldIdx=-1,this._lightmap=null,this._lightmapUVParam=new $n,this._device=c.director.root.device}var t=e.prototype;return t.initialize=function(){if(!this._inited){this._handle=er.alloc();var e=zo.alloc(),t=Uo.alloc();er.set(this._handle,Ko.INSTANCED_ATTR_ARRAY,t),er.set(this._handle,Ko.SUB_MODEL_ARRAY,e),er.set(this._handle,Ko.VIS_FLAGS,qu.Enum.NONE),er.set(this._handle,Ko.ENABLED,1),er.set(this._handle,Ko.RECEIVE_SHADOW,1),er.set(this._handle,Ko.CAST_SHADOW,0),this._inited=!0}},t.destroy=function(){for(var e=this._subModels,t=0;t<e.length;t++){var n=this._subModels[t];n.destroy(),qw.free(n)}if(this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._worldBounds=null,this._modelBounds=null,this._subModels.length=0,this._inited=!1,this._transformUpdated=!0,this._transform=null,this._node=null,this.isDynamicBatching=!1,this._handle){var i=er.get(this._handle,Ko.SUB_MODEL_ARRAY);i&&zo.free(i);var o=er.get(this._handle,Ko.INSTANCED_BUFFER);o&&Wo.free(o);var r=er.get(this._handle,Ko.INSTANCED_ATTR_ARRAY);r&&Po(r,Uo,Ww),er.free(this._handle),this._handle=No}this._hWorldBounds&&(ar.free(this._hWorldBounds),this._hWorldBounds=No)},t.attachToScene=function(e){this.scene=e},t.detachFromScene=function(){this.scene=null},t.updateTransform=function(){var e=this.transform;if(e.hasChangedFlags||e._dirtyFlags){e.updateWorldTransform(),this._transformUpdated=!0;var t=this._worldBounds;this._modelBounds&&t&&(this._modelBounds.transform(e._mat,e._pos,e._rot,e._scale,t),ar.setVec3(this._hWorldBounds,tr.CENTER,t.center),ar.setVec3(this._hWorldBounds,tr.HALF_EXTENSION,t.halfExtents))}},t.updateWorldBound=function(){var e=this.transform;if(null!==e){e.updateWorldTransform(),this._transformUpdated=!0;var t=this._worldBounds;this._modelBounds&&t&&(this._modelBounds.transform(e._mat,e._pos,e._rot,e._scale,t),ar.setVec3(this._hWorldBounds,tr.CENTER,t.center),ar.setVec3(this._hWorldBounds,tr.HALF_EXTENSION,t.halfExtents))}},t.updateUBOs=function(e){for(var t=this._subModels,n=0;n<t.length;n++)t[n].update();if(this._updateStamp=e,this._transformUpdated){this._transformUpdated=!1;var i=this.transform._mat,o=this._instMatWorldIdx;if(o>=0){var r=this.instancedAttributes.views;!function(e,t,n,i){t[0]=e.m00,t[1]=e.m01,t[2]=e.m02,t[3]=e.m12,n[0]=e.m04,n[1]=e.m05,n[2]=e.m06,n[3]=e.m13,i[0]=e.m08,i[1]=e.m09,i[2]=e.m10,i[3]=e.m14}(i,r[o],r[o+1],r[o+2])}else this._localBuffer&&(jn.toArray(this._localData,i,Fh.MAT_WORLD_OFFSET),jn.inverseTranspose(jw,i),jn.toArray(this._localData,jw,Fh.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData))}},t.createBoundingShape=function(e,t){e&&t&&(this._modelBounds=vu.fromPoints(vu.create(),e,t),this._worldBounds=vu.clone(this._modelBounds),this._hWorldBounds===No&&(this._hWorldBounds=ar.alloc(),er.set(this._handle,Ko.WORLD_BOUNDS,this._hWorldBounds)),ar.setVec3(this._hWorldBounds,tr.CENTER,this._worldBounds.center),ar.setVec3(this._hWorldBounds,tr.HALF_EXTENSION,this._worldBounds.halfExtents))},t.initSubModel=function(e,t,n){this.initialize();var i=!1;if(null==this._subModels[e]?(this._subModels[e]=qw.alloc(),i=!0):this._subModels[e].destroy(),this._subModels[e].initialize(t,n.passes,this.getMacroPatches(e)),this._subModels[e].initPlanarShadowShader(),this._subModels[e].initPlanarShadowInstanceShader(),this._updateAttributesAndBinding(e),i){var o=er.get(this._handle,Ko.SUB_MODEL_ARRAY);zo.assign(o,e,this._subModels[e].handle)}},t.setSubModelMesh=function(e,t){this._subModels[e]&&(this._subModels[e].subMesh=t)},t.setSubModelMaterial=function(e,t){this._subModels[e]&&(this._subModels[e].passes=t.passes,this._updateAttributesAndBinding(e))},t.onGlobalPipelineStateChanged=function(){for(var e=this._subModels,t=0;t<e.length;t++)e[t].onPipelineStateChanged()},t.onMacroPatchesStateChanged=function(){for(var e=this._subModels,t=0;t<e.length;t++)e[t].onMacroPatchesStateChanged(this.getMacroPatches(t))},t.updateLightingmap=function(e,t){$n.toArray(this._localData,t,Fh.LIGHTINGMAP_UVPARAM),this._lightmap=e,this._lightmapUVParam=t,null===e&&(e=pm.get("empty-texture"));var n=e.getGFXTexture();if(n)for(var i=Td.getSampler(this._device,e.mipmaps.length>1?Zw:Qw),o=this._subModels,r=0;r<o.length;r++){var a=o[r].descriptorSet;a.bindTexture(o_,n),a.bindSampler(o_,i),a.update()}},t.getMacroPatches=function(){return this.receiveShadow?Yw:null},t._updateAttributesAndBinding=function(e){var t=this._subModels[e];if(t){this._initLocalDescriptors(e),this._updateLocalDescriptors(e,t.descriptorSet);var n=Oo.get(Zo.get(t.handle,qo.SHADER_0));this._updateInstancedAttributes(n.attributes,t.passes[0])}},t._getInstancedAttributeIndex=function(e){for(var t=this.instancedAttributes.attributes,n=0;n<t.length;n++)if(t[n].name===e)return n;return-1},t._updateInstancedAttributes=function(e,t){if(t.device.hasFeature(Da.INSTANCED_ARRAYS)){var n=er.get(this._handle,Ko.INSTANCED_BUFFER);n&&Wo.free(n);var i=er.get(this._handle,Ko.INSTANCED_ATTR_ARRAY);i&&Po(i,Uo,Ww,!1);for(var o=0,r=0;r<e.length;r++){var a=e[r];a.isInstanced&&(o+=mc[a.format].size)}var s=Wo.alloc(o),c=Wo.getBuffer(s);er.set(this._handle,Ko.INSTANCED_BUFFER,s);var l=this.instancedAttributes;l.buffer=new Uint8Array(c),l.views.length=l.attributes.length=0;for(var u=0,h=0;h<e.length;h++){var _=e[h];if(_.isInstanced){var f=Ww.alloc(),d=Ww.get(f);d.format=_.format,d.name=_.name,d.isNormalized=_.isNormalized,d.location=_.location,l.attributes.push(d),Uo.push(i,f);var p=mc[_.format];l.views.push(new(wc(p))(c,u,p.count)),u+=p.size}}t.batchingScheme===_m.INSTANCING&&wA.get(t).destroy(),this._instMatWorldIdx=this._getInstancedAttributeIndex(zh),this._transformUpdated=!0}},t._initLocalDescriptors=function(){this._localBuffer||(this._localBuffer=this._device.createBuffer(new Rs(za.UNIFORM|za.TRANSFER_DST,Ha.HOST|Ha.DEVICE,Fh.SIZE,Fh.SIZE)))},t._updateLocalDescriptors=function(e,t){this._localBuffer&&t.bindBuffer(Fh.BINDING,this._localBuffer)},te(e,[{key:"subModels",get:function(){return this._subModels}},{key:"inited",get:function(){return this._inited}},{key:"worldBounds",get:function(){return this._worldBounds}},{key:"modelBounds",get:function(){return this._modelBounds}},{key:"localBuffer",get:function(){return this._localBuffer}},{key:"updateStamp",get:function(){return this._updateStamp}},{key:"isInstancingEnabled",get:function(){return this._instMatWorldIdx>=0}},{key:"receiveShadow",get:function(){return!!er.get(this._handle,Ko.RECEIVE_SHADOW)},set:function(e){er.set(this._handle,Ko.RECEIVE_SHADOW,e?1:0),this.onMacroPatchesStateChanged()}},{key:"castShadow",get:function(){return!!er.get(this._handle,Ko.CAST_SHADOW)},set:function(e){er.set(this._handle,Ko.CAST_SHADOW,e?1:0)}},{key:"handle",get:function(){return this._handle}},{key:"node",get:function(){return this._node},set:function(e){this._node=e,er.set(this._handle,Ko.NODE,e.handle)}},{key:"transform",get:function(){return this._transform},set:function(e){this._transform=e,er.set(this._handle,Ko.TRANSFORM,e.handle)}},{key:"visFlags",get:function(){return this._visFlags},set:function(e){this._visFlags=e,er.set(this._handle,Ko.VIS_FLAGS,e)}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e,er.set(this._handle,Ko.ENABLED,e?1:0)}}]),e}()),$w=e("cq",function(e){function t(){var t;return(t=e.call(this)||this)._needUpdate=!1,t._pos=void 0,t._aabb=void 0,t._hAABB=No,t._aabb=vu.create(),t._pos=new Rn,t}ie(t,e);var n=t.prototype;return n.initialize=function(){e.prototype.initialize.call(this),this._hAABB=ar.alloc(),kr.set(this._handle,zr.TYPE,Em.SPHERE),kr.set(this._handle,zr.SIZE,.15),kr.set(this._handle,zr.RANGE,1),kr.set(this._handle,zr.AABB,this._hAABB),kr.set(this._handle,zr.ILLUMINANCE,1700/Cm(.15))},n.update=function(){if(this._node&&(this._node.hasChangedFlags||this._needUpdate)){this._node.getWorldPosition(this._pos);var e=kr.get(this._handle,zr.RANGE);vu.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,e,e,e),this._needUpdate=!1,kr.setVec3(this._handle,zr.POSITION,this._pos),ar.setVec3(this._hAABB,tr.CENTER,this._aabb.center),ar.setVec3(this._hAABB,tr.HALF_EXTENSION,this._aabb.halfExtents)}},n.destroy=function(){return this._hAABB&&(ar.free(this._hAABB),this._hAABB=No),e.prototype.destroy.call(this)},te(t,[{key:"position",get:function(){return this._pos}},{key:"size",get:function(){return kr.get(this._handle,zr.SIZE)},set:function(e){kr.set(this._handle,zr.SIZE,e)}},{key:"range",get:function(){return kr.get(this._handle,zr.RANGE)},set:function(e){kr.set(this._handle,zr.RANGE,e),this._needUpdate=!0}},{key:"luminance",get:function(){return kr.get(this._handle,zr.ILLUMINANCE)},set:function(e){kr.set(this._handle,zr.ILLUMINANCE,e)}},{key:"aabb",get:function(){return this._aabb}}]),t}(wm)),eb=new Rn(0,0,-1),tb=new zn,nb=new jn,ib=new jn,ob=new jn,rb=new jn,ab=e("cs",function(e){function t(){var t;return(t=e.call(this)||this)._dir=new Rn(1,-1,-1),t._range=5,t._spotAngle=Math.cos(Math.PI/6),t._pos=void 0,t._aabb=void 0,t._frustum=void 0,t._angle=0,t._needUpdate=!1,t._hAABB=No,t._hFrustum=No,t._aabb=vu.create(),t._frustum=bu.create(),t._pos=new Rn,t}ie(t,e);var n=t.prototype;return n.initialize=function(){e.prototype.initialize.call(this),this._hAABB=ar.alloc(),this._hFrustum=Ar.alloc(),kr.set(this._handle,zr.TYPE,Em.SPOT),kr.set(this._handle,zr.SIZE,.15),kr.set(this._handle,zr.AABB,this._hAABB),kr.set(this._handle,zr.ILLUMINANCE,1700/Cm(.15)),kr.set(this._handle,zr.RANGE,Math.cos(Math.PI/6)),kr.set(this._handle,zr.ASPECT,1),kr.setVec3(this._handle,zr.DIRECTION,this._dir),kr.set(this._handle,zr.FRUSTUM,this._hFrustum)},n.update=function(){this._node&&(this._node.hasChangedFlags||this._needUpdate)&&(this._node.getWorldPosition(this._pos),Rn.transformQuat(this._dir,eb,this._node.getWorldRotation(tb)),Rn.normalize(this._dir,this._dir),kr.setVec3(this._handle,zr.DIRECTION,this._dir),vu.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,this._range,this._range,this._range),this._node.getWorldRT(nb),jn.invert(nb,nb),jn.perspective(ib,this._angle,1,.001,this._range),jn.multiply(ob,ib,nb),this._frustum.update(ob,rb),this._needUpdate=!1,kr.setVec3(this._handle,zr.POSITION,this._pos),ar.setVec3(this._hAABB,tr.CENTER,this._aabb.center),ar.setVec3(this._hAABB,tr.HALF_EXTENSION,this._aabb.halfExtents),Iu(this._hFrustum,this._frustum))},n.destroy=function(){return this._hAABB&&(ar.free(this._hAABB),this._hAABB=No),this._hFrustum&&(Ar.free(this._hFrustum),this._hFrustum=No),e.prototype.destroy.call(this)},te(t,[{key:"position",get:function(){return this._pos}},{key:"size",get:function(){return kr.get(this._handle,zr.SIZE)},set:function(e){kr.set(this._handle,zr.SIZE,e)}},{key:"range",get:function(){return kr.get(this._handle,zr.RANGE)},set:function(e){this._range=e,kr.set(this._handle,zr.RANGE,e),this._needUpdate=!0}},{key:"luminance",get:function(){return kr.get(this._handle,zr.ILLUMINANCE)},set:function(e){kr.set(this._handle,zr.ILLUMINANCE,e)}},{key:"direction",get:function(){return this._dir}},{key:"spotAngle",get:function(){return kr.get(this._handle,zr.SPOT_ANGLE)},set:function(e){this._angle=e,kr.set(this._handle,zr.SPOT_ANGLE,Math.cos(.5*e)),this._needUpdate=!0}},{key:"aspect",get:function(){return kr.get(this._handle,zr.ASPECT)},set:function(e){kr.set(this._handle,zr.ASPECT,e),this._needUpdate=!0}},{key:"aabb",get:function(){return this._aabb}},{key:"frustum",get:function(){return this._frustum}}]),t}(wm)),sb=Object.freeze({__proto__:null,Ambient:ca,get CameraFOVAxis(){return u_},get CameraProjection(){return h_},get CameraAperture(){return __},get CameraISO(){return f_},get CameraShutter(){return d_},SKYBOX_FLAG:b_,Camera:P_,CameraVisFlags:Sm,VisibilityFlags:Tm,DirectionalLight:Pm,ColorTemperatureToRGB:Am,get LightType(){return Em},nt2lm:Cm,Light:wm,get ModelType(){return Gw},Model:Jw,ShadowType:VS,PCFType:WS,Shadows:qS,RenderScene:R_,Skybox:xE,SphereLight:$w,SpotLight:ab,SubModel:Vw});function cb(e){return--e,e|=e>>16,e|=e>>8,e|=e>>4,e|=e>>2,e|=e>>1,++e}function lb(e,t){return Math.ceil(e/t)*t}!function(e){e[e.OPAQUE=0]="OPAQUE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OVERLAY=2]="OVERLAY"}(Xw||(Xw={})),function(e){e[e.DEFAULT=1]="DEFAULT",e[e.FORWARD=2]="FORWARD",e[e.SHADOWCAST=4]="SHADOWCAST"}(Kw||(Kw={}));var ub=e("cx",function(){function e(e){this._device=void 0,this._format=Ma.UNKNOWN,this._formatSize=0,this._chunks=[],this._chunkCount=0,this._handles=[],this._region0=new ws,this._region1=new ws,this._region2=new ws,this._roundUpFn=null,this._bufferViewCtor=Uint8Array,this._channels=4,this._alignment=1,this._device=e}var t=e.prototype;return t.initialize=function(e){var t=mc[e.format];this._format=e.format,this._formatSize=t.size,this._channels=t.count,this._bufferViewCtor=wc(t),this._roundUpFn=e.roundUpFn||null,this._alignment=e.alignment||1,e.inOrderFree&&(this.alloc=this._McDonaldAlloc)},t.destroy=function(){for(var e=0;e<this._chunkCount;++e)this._chunks[e].texture.destroy();this._chunks.length=0,this._handles.length=0},t.alloc=function(e,t){e=lb(e,this._alignment);var n=-1,i=-1;if(void 0!==t&&(n=t,i=this._findAvailableSpace(e,n)),i<0)for(var o=0;o<this._chunkCount&&(n=o,!((i=this._findAvailableSpace(e,n))>=0));++o);if(i>=0){var r=this._chunks[n];r.start+=e;var a={chunkIdx:n,start:i,end:i+e,texture:r.texture};return this._handles.push(a),a}var s=Math.sqrt(e/this._formatSize),c=this._roundUpFn&&this._roundUpFn(s,this._formatSize)||Math.max(1024,cb(s)),l=this._chunks[this.createChunk(c)];l.start+=e;var u={chunkIdx:this._chunkCount-1,start:0,end:e,texture:l.texture};return this._handles.push(u),u},t.free=function(e){for(var t=0;t<this._handles.length;++t)if(this._handles[t]===e)return this._chunks[e.chunkIdx].end=e.end,void this._handles.splice(t,1)},t.createChunk=function(e){var t=e*e*this._formatSize;console.info("TextureBufferPool: Allocate chunk "+this._chunkCount+", size: "+t+", format: "+this._format);var n={texture:this._device.createTexture(new Ls(Ga.TEX2D,ka.SAMPLED|ka.TRANSFER_DST,this._format,e,e,Va.IMMUTABLE)),size:t,start:0,end:t};return this._chunks[this._chunkCount]=n,this._chunkCount++},t.update=function(e,t){var n=[],i=[],o=e.start/this._formatSize,r=t.byteLength/this._formatSize,a=o%e.texture.width,s=Math.floor(o/e.texture.width),c=Math.min(e.texture.width-a,r),l=0;a>0&&(this._region0.texOffset.x=a,this._region0.texOffset.y=s,this._region0.texExtent.width=c,this._region0.texExtent.height=1,n.push(new this._bufferViewCtor(t,l*this._formatSize,c*this._channels)),i.push(this._region0),a=0,s+=1,r-=c,l+=c),r>0&&(this._region1.texOffset.x=a,this._region1.texOffset.y=s,r>e.texture.width?(this._region1.texExtent.width=e.texture.width,this._region1.texExtent.height=Math.floor(r/e.texture.width),c=this._region1.texExtent.width*this._region1.texExtent.height):(c=r,this._region1.texExtent.width=c,this._region1.texExtent.height=1),n.push(new this._bufferViewCtor(t,l*this._formatSize,c*this._channels)),i.push(this._region1),a=0,s+=this._region1.texExtent.height,r-=c,l+=c),r>0&&(this._region2.texOffset.x=a,this._region2.texOffset.y=s,this._region2.texExtent.width=r,this._region2.texExtent.height=1,n.push(new this._bufferViewCtor(t,l*this._formatSize,r*this._channels)),i.push(this._region2)),this._device.copyBuffersToTexture(n,e.texture,i)},t._findAvailableSpace=function(e,t){var n=this._chunks[t],i=!1,o=n.start;if(o+e<=n.size)i=!0;else{o=0;for(var r=this._handles.filter((function(e){return e.chunkIdx===t})).sort((function(e,t){return e.start-t.start})),a=0;a<r.length;a++){var s=r[a];if(o+e<=s.start){i=!0;break}o=s.end}!i&&o+e<=n.size&&(i=!0)}return i?o:-1},t._McDonaldAlloc=function(e){e=lb(e,this._alignment);for(var t=0;t<this._chunkCount;++t){var n=this._chunks[t],i=!1,o=n.start;if(o+e<=n.end?i=!0:o>n.end?o+e<=n.size?i=!0:e<=n.end&&(n.start=o=0,i=!0):o===n.end&&(n.start=o=0,n.end=n.size,e<=n.end&&(i=!0)),i){n.start+=e;var r={chunkIdx:t,start:o,end:o+e,texture:n.texture};return this._handles.push(r),r}}var a=Math.sqrt(e/this._formatSize),s=this._roundUpFn&&this._roundUpFn(a,this._formatSize)||Math.max(1024,cb(a)),c=this._chunks[this.createChunk(s)];c.start+=e;var l={chunkIdx:this._chunkCount,start:0,end:e,texture:c.texture};return this._handles.push(l),l},e}()),hb=function(e){if(void 0===xo[e]){var t=1<<yo;xo[e]=t,yo+=1}},_b=Object.freeze({__proto__:null,addStage:hb,scene:sb,createIA:function(e,t){if(!t.positions)return console.error("The data must have positions field"),null;for(var n=[],i=t.positions.length/3,o=0;o<i;++o)n.push(t.positions[3*o],t.positions[3*o+1],t.positions[3*o+2]),t.normals&&n.push(t.normals[3*o],t.normals[3*o+1],t.normals[3*o+2]),t.uvs&&n.push(t.uvs[2*o],t.uvs[2*o+1]),t.colors&&n.push(t.colors[3*o],t.colors[3*o+1],t.colors[3*o+2]);var r=[];r.push(new Ys(ms.ATTR_POSITION,Ma.RGB32F)),t.normals&&r.push(new Ys(ms.ATTR_NORMAL,Ma.RGB32F)),t.uvs&&r.push(new Ys(ms.ATTR_TEX_COORD,Ma.RG32F)),t.colors&&r.push(new Ys(ms.ATTR_COLOR,Ma.RGB32F));var a=e.createBuffer(new Rs(za.VERTEX|za.TRANSFER_DST,Ha.HOST|Ha.DEVICE,4*n.length,4*n.length/i));a.update(new Float32Array(n));var s=null;return t.indices&&(s=e.createBuffer(new Rs(za.INDEX|za.TRANSFER_DST,Ha.HOST|Ha.DEVICE,2*t.indices.length,2))).update(new Uint16Array(t.indices)),e.createInputAssembler(new Ks(r,[a],s))},get RenderQueue(){return Xw},get PassStage(){return Kw},get PropertyType(){return Up},genHandle:jp,getPropertyTypeFromHandle:qp,getTypeFromHandle:Yp,getSetIndexFromHandle:function(e){return(e&Vp)>>>20},getBindingFromHandle:Xp,getOffsetFromHandle:Kp,customizeType:Qp,type2reader:Zp,type2writer:Jp,getDefaultFromType:em,overrideMacros:tm,get BatchingSchemes(){return _m},Pass:xm,getDeviceShaderVersion:cm,programLib:lm,get SamplerInfoIndex(){return id},defaultSamplerHash:ad,genSamplerHash:ld,samplerLib:Td,nearestPOT:cb,TextureBufferPool:ub,MaterialInstance:vE,PassInstance:mE,ObjectPool:wo,freeHandleArray:Po,get PoolType(){return Ao},NULL_HANDLE:No,ShaderPool:Oo,DSPool:Do,IAPool:Mo,PipelineLayoutPool:Lo,FramebufferPool:Fo,SubModelArrayPool:zo,ModelArrayPool:Bo,AttributeArrayPool:Uo,FlatBufferArrayPool:Ho,LightArrayPool:Go,BlendTargetArrayPool:ko,UIBatchArrayPool:Vo,RawBufferPool:Wo,RawObjectPool:jo,get PassView(){return Ro},PassPool:Xo,get SubModelView(){return qo},SubModelPool:Zo,get ModelView(){return Ko},ModelPool:er,get BatchView2D(){return Jo},BatchPool2D:ir,get AABBView(){return tr},AABBPool:ar,get SceneView(){return or},ScenePool:lr,get CameraView(){return sr},CameraPool:_r,get NodeView(){return ur},NodePool:pr,get RootView(){return dr},RootPool:gr,get RenderWindowView(){return mr},RenderWindowPool:Sr,get FrustumView(){return yr},FrustumPool:Ar,get AmbientView(){return Er},AmbientPool:br,get SkyboxView(){return wr},SkyboxPool:Rr,get FogView(){return Ir},FogPool:Dr,get ShadowsView(){return Or},ShadowsPool:Fr,get PipelineSceneDataView(){return Lr},PipelineSceneDataPool:Ur,get LightView(){return zr},LightPool:kr,get SphereView(){return Hr},SpherePool:jr,get FlatBufferView(){return Wr},FlatBufferPool:Xr,get SubMeshView(){return qr},SubMeshPool:Zr,get RasterizerStateView(){return Kr},RasterizerStatePool:ea,get DepthStencilStateView(){return Jr},DepthStencilStatePool:ia,get BlendTargetView(){return ta},BlendTargetPool:ra,get BlendStateView(){return oa},BlendStatePool:sa});function fb(e){return e*e}function db(e){return e*(2-e)}function pb(e){return e*e*e}function mb(e){return--e*e*e+1}function vb(e){return e*e*e*e}function gb(e){return 1- --e*e*e*e}function yb(e){return e*e*e*e*e}function xb(e){return--e*e*e*e*e+1}function Sb(e){return 1===e?1:1-Math.cos(e*Math.PI/2)}function Eb(e){return Math.sin(e*Math.PI/2)}function Tb(e){return 0===e?0:Math.pow(1024,e-1)}function Ab(e){return 1===e?1:1-Math.pow(2,-10*e)}function Cb(e){return 1-Math.sqrt(1-e*e)}function wb(e){return Math.sqrt(1- --e*e)}function bb(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/.4))}function Ib(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin(2*(e-t)*Math.PI/.4)+1)}function Pb(e){if(1===e)return 1;var t=1.70158;return e*e*((t+1)*e-t)}function Rb(e){if(0===e)return 0;var t=1.70158;return--e*e*((t+1)*e+t)+1}function Nb(e){return 1-Ob(1-e)}function Ob(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}e("eA",_b);var Db=Vb(fb,db),Mb=Vb(pb,mb),Lb=Vb(vb,gb),Fb=Vb(yb,xb),zb=Vb(Sb,Eb),Bb=Vb(Tb,Ab),Ub=Vb(Cb,wb),Hb=Vb(bb,Ib),Gb=Vb(Pb,Rb),kb=Vb(Nb,Ob);function Vb(e,t){return function(n){return n<.5?t(2*n)/2:e(2*n-1)/2+.5}}var Wb=Object.freeze({__proto__:null,constant:function(){return 0},linear:function(e){return e},quadIn:fb,quadOut:db,quadInOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},cubicIn:pb,cubicOut:mb,cubicInOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},quartIn:vb,quartOut:gb,quartInOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},quintIn:yb,quintOut:xb,quintInOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},sineIn:Sb,sineOut:Eb,sineInOut:function(e){return.5*(1-Math.cos(Math.PI*e))},expoIn:Tb,expoOut:Ab,expoInOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))},circIn:Cb,circOut:wb,circInOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},elasticIn:bb,elasticOut:Ib,elasticInOut:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),(e*=2)<1?n*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/.4)*-.5:n*Math.pow(2,-10*(e-=1))*Math.sin(2*(e-t)*Math.PI/.4)*.5+1)},backIn:Pb,backOut:Rb,backInOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)},bounceIn:Nb,bounceOut:Ob,bounceInOut:function(e){return e<.5?.5*Nb(2*e):.5*Ob(2*e-1)+.5},smooth:function(e){return e<=0?0:e>=1?1:e*e*(3-2*e)},fade:function(e){return e<=0?0:e>=1?1:e*e*e*(e*(6*e-15)+10)},quadOutIn:Db,cubicOutIn:Mb,quartOutIn:Lb,quintOutIn:Fb,sineOutIn:zb,expoOutIn:Bb,circOutIn:Ub,elasticOutIn:Hb,backOutIn:Gb,bounceOutIn:kb});e("ep",Wb);var jb=new Kn,qb=function(){var e=t.prototype;function t(){this.handle=0,this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this._splashFinish=!1,this._loadFinish=!1,this._directCall=!1}return e.main=function(e){if(null!=e){if(window._CCSettings&&window._CCSettings.splashScreen){var t=this.settings=window._CCSettings.splashScreen;t.totalTime=null!=this.settings.totalTime?this.settings.totalTime:3e3,t.base64src=this.settings.base64src||"",t.effect=this.settings.effect||"FADE-INOUT",t.clearColor=this.settings.clearColor||new Is(.88,.88,.88,1),t.displayRatio=null!=this.settings.displayRatio?this.settings.displayRatio:.4,t.displayWatermark=null==this.settings.displayWatermark||this.settings.displayWatermark}else this.settings={totalTime:3e3,base64src:"",effect:"FADE-INOUT",clearColor:new Is(.88,.88,.88,1),displayRatio:.4,displayWatermark:!0};if(""===this.settings.base64src||this.settings.totalTime<=0)this.callBack&&this.callBack(),this.callBack=null,this.settings=null,this._directCall=!0;else{c.view.enableRetina(!0),c.view.resizeWithBrowserSize(!0);var n=window._CCSettings.designResolution;n?c.view.setDesignResolutionSize(n.width,n.height,n.policy):c.view.setDesignResolutionSize(960,640,4),this.root=e,this.device=e.device,c.game.once(c.Game.EVENT_GAME_INITED,(function(){c.director._lateUpdate=performance.now()}),c.director),this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this.preInit(),this.logoImage=new Image,this.logoImage.onload=this.init.bind(this),this.logoImage.src=this.settings.base64src}}else x("RENDER ROOT IS NULL.")},e.setOnFinish=function(e){if(this._directCall&&e)return t._ins=void 0,void e();this.callBack=e},e._tryToStart=function(){this._splashFinish&&this._loadFinish&&this.callBack&&(this.callBack(),this.hide(),c.game.resume())},e.preInit=function(){var e=this.settings.clearColor;this.clearColors=[new Is(e.x,e.y,e.z,e.w)];var t=this.device;this.renderArea=new xs(0,0,t.width,t.height),this.framebuffer=this.root.mainWindow.framebuffer,this.cmdBuff=t.commandBuffer;var n=new Float32Array([.5,.5,1,0,-.5,.5,0,0,.5,-.5,1,1,-.5,-.5,0,1]),i=4*Float32Array.BYTES_PER_ELEMENT,o=4*i;this.vertexBuffers=t.createBuffer(new Rs(za.VERTEX|za.TRANSFER_DST,Ha.HOST|Ha.DEVICE,o,i)),this.vertexBuffers.update(n);var r=new Uint16Array([0,1,2,1,3,2]),a=Uint16Array.BYTES_PER_ELEMENT,s=6*a;this.indicesBuffers=t.createBuffer(new Rs(za.INDEX|za.TRANSFER_DST,Ha.HOST|Ha.DEVICE,s,a)),this.indicesBuffers.update(r);var c=[new Ys("a_position",Ma.RG32F),new Ys("a_texCoord",Ma.RG32F)],l=new Ks(c,[this.vertexBuffers],this.indicesBuffers);this.quadAssmebler=t.createInputAssembler(l),this.projection=new jn,jn.ortho(this.projection,-1,1,-1,1,-1,1,t.capabilities.clipSpaceMinZ,t.capabilities.clipSpaceSignY,t.surfaceTransform)},e.init=function(){var e=this;this.initLogo(),this.settings.displayWatermark&&this.initWarterMark(),c.game.pause(),this.handle=requestAnimationFrame((function t(n){if(!e.cancelAnimate){var i=e.settings,o=e.device;jn.ortho(e.projection,-1,1,-1,1,-1,1,o.capabilities.clipSpaceMinZ,o.capabilities.clipSpaceSignY,o.surfaceTransform);var r=o.width,a=o.height,s=r<a?r:a;e.startTime<0&&(e.startTime=n);var c=n-e.startTime,l=mb(hn(c/i.totalTime));"NONE"===i.effect&&(l=1);var u=e.logoTexture.width,h=e.logoTexture.height,_=s*i.displayRatio,f=_*u/h,d=_;if(o.surfaceTransform!==Oa.ROTATE_90&&o.surfaceTransform!==Oa.ROTATE_270||(f=_*r/a,d=_*h/u*a/r),e.logoMat.setProperty("resolution",jb.set(r,a),0),e.logoMat.setProperty("scale",jb.set(f,d),0),e.logoMat.setProperty("translate",jb.set(.5*r,.5*a),0),e.logoMat.setProperty("precent",l),e.logoMat.setProperty("u_projection",e.projection),e.logoMat.passes[0].update(),i.displayWatermark&&e.watermarkMat){var p=.5*s,m=e.watermarkTexture.width,v=p,g=p*e.watermarkTexture.height/m;o.surfaceTransform!==Oa.ROTATE_90&&o.surfaceTransform!==Oa.ROTATE_270||(v=.5*p,g=p*r/a*.5),e.watermarkMat.setProperty("resolution",jb.set(r,a),0),e.watermarkMat.setProperty("scale",jb.set(v,g),0),e.watermarkMat.setProperty("translate",jb.set(.5*r,.1*a),0),e.watermarkMat.setProperty("precent",l),e.watermarkMat.setProperty("u_projection",e.projection),e.watermarkMat.passes[0].update()}e.frame(),c>i.totalTime&&(e.splashFinish=!0),requestAnimationFrame(t)}}))},e.hide=function(){cancelAnimationFrame(this.handle),this.cancelAnimate=!0,setTimeout(this.destroy.bind(this))},e.initLogo=function(){var e=this.device;this.logoMat=new kS,this.logoMat.initialize({effectName:"splash-screen"});var t=new zs;t.addressU=qa.CLAMP,t.addressV=qa.CLAMP,t.addressW=qa.CLAMP,this.sampler=e.createSampler(t),this.logoTexture=e.createTexture(new Ls(Ga.TEX2D,ka.SAMPLED|ka.TRANSFER_DST,Ma.RGBA8,this.logoImage.width,this.logoImage.height));var n=this.logoMat.passes[0],i=n.getBinding("mainTexture");n.bindTexture(i,this.logoTexture),this.shader=Oo.get(n.getShaderVariant());var o=Do.get(Xo.get(n.handle,Ro.DESCRIPTOR_SET));o.bindSampler(i,this.sampler),o.update();var r=new ws;r.texExtent.width=this.logoImage.width,r.texExtent.height=this.logoImage.height,r.texExtent.depth=1,e.copyTexImagesToTexture([this.logoImage],this.logoTexture,[r])},e.initWarterMark=function(){var e=document.createElement("canvas");e.width=330,e.height=30,e.style.width=""+e.width,e.style.height=""+e.height;var t=e.getContext("2d");t.font="18px Arial",t.textBaseline="top",t.textAlign="left",t.fillStyle="`#424242`";var n="Powered by Cocos Creator",i=t.measureText(n);t.fillText(n,(330-i.width)/2,6);var o=new ws;o.texExtent.width=e.width,o.texExtent.height=e.height,o.texExtent.depth=1,this.watermarkTexture=this.device.createTexture(new Ls(Ga.TEX2D,ka.SAMPLED|ka.TRANSFER_DST,Ma.RGBA8,e.width,e.height)),this.device.copyTexImagesToTexture([e],this.watermarkTexture,[o]),this.watermarkMat=new kS,this.watermarkMat.initialize({effectName:"splash-screen"});var r=this.watermarkMat.passes[0],a=r.getBinding("mainTexture");r.bindTexture(a,this.watermarkTexture),Do.get(Xo.get(r.handle,Ro.DESCRIPTOR_SET)).update()},e.frame=function(){var e=this.device;e.acquire();var t=this.cmdBuff,n=this.framebuffer,i=this.renderArea;i.width=e.width,i.height=e.height,t.begin(),t.beginRenderPass(n.renderPass,n,i,this.clearColors,1,0);var o=this.logoMat.passes[0],r=lA.getOrCreatePipelineState(e,o,this.shader,n.renderPass,this.quadAssmebler);if(t.bindPipelineState(r),t.bindDescriptorSet(rh.MATERIAL,o.descriptorSet),t.bindInputAssembler(this.quadAssmebler),t.draw(this.quadAssmebler),this.settings.displayWatermark&&this.watermarkMat){var a=this.watermarkMat.passes[0],s=lA.getOrCreatePipelineState(e,a,this.shader,n.renderPass,this.quadAssmebler);t.bindPipelineState(s),t.bindDescriptorSet(rh.MATERIAL,a.descriptorSet),t.bindInputAssembler(this.quadAssmebler),t.draw(this.quadAssmebler)}t.endRenderPass(),t.end(),e.flushCommands([t]),e.queue.submit([t]),e.present()},e.destroy=function(){this.callBack=null,this.root=null,this.device=null,this.clearColors=null,this.logoImage.destroy&&this.logoImage.destroy(),this.logoImage=null,this.framebuffer=null,this.renderArea=null,this.cmdBuff=null,this.shader=null,this.logoMat.destroy(),this.logoMat=null,this.logoTexture.destroy(),this.logoTexture=null,this.quadAssmebler.destroy(),this.quadAssmebler=null,this.vertexBuffers.destroy(),this.vertexBuffers=null,this.indicesBuffers.destroy(),this.indicesBuffers=null,this.sampler.destroy(),this.sampler=null,this.watermarkTexture&&(this.watermarkMat.destroy(),this.watermarkMat=null,this.watermarkTexture.destroy(),this.watermarkTexture=null),this.settings=null,t._ins=void 0},te(t,[{key:"splashFinish",set:function(e){this._splashFinish=e,this._tryToStart()}},{key:"loadFinish",set:function(e){this._loadFinish=e,this._tryToStart()}}],[{key:"instance",get:function(){return t._ins||(t._ins=new t),t._ins}}]),t}();qb._ins=void 0,c.internal.SplashScreen=qb;var Yb=e("e7",function(){function e(){this._id="",this._priority=0,this._executeInEditMode=!1}e.sortByPriority=function(e,t){return e._priority<t._priority?1:e._priority>t.priority?-1:0};var t=e.prototype;return t.init=function(){},t.update=function(){},t.postUpdate=function(){},te(e,[{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e}},{key:"id",get:function(){return this._id},set:function(e){this._id=e}}]),e}()),Xb=new ge("Scheduler"),Kb=function(e,t,n,i){this.target=void 0,this.priority=void 0,this.paused=void 0,this.markedForDeletion=void 0,this.target=e,this.priority=t,this.paused=n,this.markedForDeletion=i};Kb.get=function(e,t,n,i){var o=Kb._listEntries.pop();return o?(o.target=e,o.priority=t,o.paused=n,o.markedForDeletion=i):o=new Kb(e,t,n,i),o},Kb.put=function(e){Kb._listEntries.length<20&&(e.target=null,Kb._listEntries.push(e))},Kb._listEntries=[];var Qb=function(e,t,n,i){this.list=void 0,this.entry=void 0,this.target=void 0,this.callback=void 0,this.list=e,this.entry=t,this.target=n,this.callback=i};Qb.get=function(e,t,n,i){var o=Qb._hashUpdateEntries.pop();return o?(o.list=e,o.entry=t,o.target=n,o.callback=i):o=new Qb(e,t,n,i),o},Qb.put=function(e){Qb._hashUpdateEntries.length<20&&(e.list=e.entry=e.target=e.callback=null,Qb._hashUpdateEntries.push(e))},Qb._hashUpdateEntries=[];var Zb=function(e,t,n,i,o,r){this.timers=void 0,this.target=void 0,this.timerIndex=void 0,this.currentTimer=void 0,this.currentTimerSalvaged=void 0,this.paused=void 0,this.timers=e,this.target=t,this.timerIndex=n,this.currentTimer=i,this.currentTimerSalvaged=o,this.paused=r};Zb.get=function(e,t,n,i,o,r){var a=Zb._hashTimerEntries.pop();return a?(a.timers=e,a.target=t,a.timerIndex=n,a.currentTimer=i,a.currentTimerSalvaged=o,a.paused=r):a=new Zb(e,t,n,i,o,r),a},Zb.put=function(e){Zb._hashTimerEntries.length<20&&(e.timers=e.target=e.currentTimer=null,Zb._hashTimerEntries.push(e))},Zb._hashTimerEntries=[];var Jb=function(){function e(){this._lock=void 0,this._scheduler=void 0,this._elapsed=void 0,this._runForever=void 0,this._useDelay=void 0,this._timesExecuted=void 0,this._repeat=void 0,this._delay=void 0,this._interval=void 0,this._target=void 0,this._callback=void 0,this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}var t=e.prototype;return t.initWithCallback=function(e,t,n,i,o,r){return this._lock=!1,this._scheduler=e,this._target=n,this._callback=t,this._elapsed=-1,this._interval=i,this._delay=r,this._useDelay=this._delay>0,this._repeat=o,this._runForever=this._repeat===c.macro.REPEAT_FOREVER,!0},t.getInterval=function(){return this._interval},t.setInterval=function(e){this._interval=e},t.update=function(e){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=e,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},t.getCallback=function(){return this._callback},t.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},t.cancel=function(){this._scheduler.unschedule(this._callback,this._target)},e}();Jb._timers=[],Jb.get=function(){return Jb._timers.pop()||new Jb},Jb.put=function(e){Jb._timers.length<20&&!e._lock&&(e._scheduler=e._target=e._callback=null,Jb._timers.push(e))};var $b=e("ey",function(e){function t(){var t;return(t=e.call(this)||this)._timeScale=void 0,t._updatesNegList=void 0,t._updates0List=void 0,t._updatesPosList=void 0,t._hashForUpdates=void 0,t._hashForTimers=void 0,t._currentTarget=void 0,t._currentTargetSalvaged=void 0,t._updateHashLocked=void 0,t._arrayForTimers=void 0,t._timeScale=1,t._updatesNegList=[],t._updates0List=[],t._updatesPosList=[],t._hashForUpdates=Re(!0),t._hashForTimers=Re(!0),t._currentTarget=null,t._currentTargetSalvaged=!1,t._updateHashLocked=!1,t._arrayForTimers=[],t}ie(t,e),t.enableForTarget=function(e){var t=!1;(e.uuid||e.id)&&(t=!0),t||(e.__instanceId?P(1513):e.id=Xb.getNewId())};var n=t.prototype;return n.setTimeScale=function(e){this._timeScale=e},n.getTimeScale=function(){return this._timeScale},n.update=function(e){var t,n,i,o,r;for(this._updateHashLocked=!0,1!==this._timeScale&&(e*=this._timeScale),t=0,i=(n=this._updatesNegList).length;t<i;t++)(o=n[t]).paused||o.markedForDeletion||o.target.update(e);for(t=0,i=(n=this._updates0List).length;t<i;t++)(o=n[t]).paused||o.markedForDeletion||o.target.update(e);for(t=0,i=(n=this._updatesPosList).length;t<i;t++)(o=n[t]).paused||o.markedForDeletion||o.target.update(e);var a=this._arrayForTimers;for(t=0;t<a.length;t++){if(r=a[t],this._currentTarget=r,this._currentTargetSalvaged=!1,!r.paused)for(r.timerIndex=0;r.timerIndex<r.timers.length;++r.timerIndex)r.currentTimer=r.timers[r.timerIndex],r.currentTimerSalvaged=!1,r.currentTimer.update(e),r.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--t)}for(t=0,n=this._updatesNegList;t<n.length;)(o=n[t]).markedForDeletion?this._removeUpdateFromHash(o):t++;for(t=0,n=this._updates0List;t<n.length;)(o=n[t]).markedForDeletion?this._removeUpdateFromHash(o):t++;for(t=0,n=this._updatesPosList;t<n.length;)(o=n[t]).markedForDeletion?this._removeUpdateFromHash(o):t++;this._updateHashLocked=!1,this._currentTarget=null},n.schedule=function(e,t,n,i,o,r){if("function"!=typeof e){var a=e;e=t,t=a}3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(r=!!i,i=c.macro.REPEAT_FOREVER,o=0),M(t,1502);var s=t.uuid||t.id;if(s){var l,u,h=this._hashForTimers[s];if(h?h.paused!==r&&P(1511):(h=Zb.get(null,t,0,null,null,r),this._arrayForTimers.push(h),this._hashForTimers[s]=h),null==h.timers)h.timers=[];else for(u=0;u<h.timers.length;++u)if((l=h.timers[u])&&e===l._callback)return b(1507,l.getInterval(),n),void(l._interval=n);(l=Jb.get()).initWithCallback(this,e,t,n,i,o),h.timers.push(l),this._currentTarget===h&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)}else N(1510)},n.scheduleUpdate=function(e,t,n){var i=e.uuid||e.id;if(i){var o=this._hashForUpdates[i];if(o&&o.entry){if(o.entry.priority===t)return o.entry.markedForDeletion=!1,void(o.entry.paused=n);if(this._updateHashLocked)return b(1506),o.entry.markedForDeletion=!1,void(o.entry.paused=n);this.unscheduleUpdate(e)}var r,a=Kb.get(e,t,n,!1);0===t?(r=this._updates0List,this._appendIn(r,a)):(r=t<0?this._updatesNegList:this._updatesPosList,this._priorityIn(r,a,t)),this._hashForUpdates[i]=Qb.get(r,a,e,null)}else N(1510)},n.unschedule=function(e,t){if(t&&e){var n=t.uuid||t.id;if(n){var i=this,o=i._hashForTimers[n];if(o)for(var r=o.timers,a=0,s=r.length;a<s;a++){var c=r[a];if(e===c._callback)return c!==o.currentTimer||o.currentTimerSalvaged||(o.currentTimerSalvaged=!0),r.splice(a,1),Jb.put(c),o.timerIndex>=a&&o.timerIndex--,void(0===r.length&&(i._currentTarget===o?i._currentTargetSalvaged=!0:i._removeHashElement(o)))}}else N(1510)}},n.unscheduleUpdate=function(e){if(e){var t=e.uuid||e.id;if(t){var n=this._hashForUpdates[t];n&&(this._updateHashLocked?n.entry.markedForDeletion=!0:this._removeUpdateFromHash(n.entry))}else N(1510)}},n.unscheduleAllForTarget=function(e){if(e){var t=e.uuid||e.id;if(t){var n=this._hashForTimers[t];if(n){var i=n.timers;i.indexOf(n.currentTimer)>-1&&!n.currentTimerSalvaged&&(n.currentTimerSalvaged=!0);for(var o=0,r=i.length;o<r;o++)Jb.put(i[o]);i.length=0,this._currentTarget===n?this._currentTargetSalvaged=!0:this._removeHashElement(n)}this.unscheduleUpdate(e)}else N(1510)}},n.unscheduleAll=function(){this.unscheduleAllWithMinPriority(c.Scheduler.PRIORITY_SYSTEM)},n.unscheduleAllWithMinPriority=function(e){var t,n,i,o=this._arrayForTimers;for(t=o.length-1;t>=0;t--)n=o[t],this.unscheduleAllForTarget(n.target);var r=0;if(e<0)for(t=0;t<this._updatesNegList.length;)r=this._updatesNegList.length,(i=this._updatesNegList[t])&&i.priority>=e&&this.unscheduleUpdate(i.target),r===this._updatesNegList.length&&t++;if(e<=0)for(t=0;t<this._updates0List.length;)r=this._updates0List.length,(i=this._updates0List[t])&&this.unscheduleUpdate(i.target),r===this._updates0List.length&&t++;for(t=0;t<this._updatesPosList.length;)r=this._updatesPosList.length,(i=this._updatesPosList[t])&&i.priority>=e&&this.unscheduleUpdate(i.target),r===this._updatesPosList.length&&t++},n.isScheduled=function(e,t){M(e,1508),M(t,1509);var n=t.uuid||t.id;if(n){var i=this._hashForTimers[n];if(!i)return!1;if(null==i.timers)return!1;for(var o=i.timers,r=0;r<o.length;++r)if(e===o[r]._callback)return!0;return!1}N(1510)},n.pauseAllTargets=function(){return this.pauseAllTargetsWithMinPriority(c.Scheduler.PRIORITY_SYSTEM)},n.pauseAllTargetsWithMinPriority=function(e){var t,n,i,o,r=[],a=this._arrayForTimers;for(n=0,i=a.length;n<i;n++)(t=a[n])&&(t.paused=!0,r.push(t.target));if(e<0)for(n=0;n<this._updatesNegList.length;n++)(o=this._updatesNegList[n])&&o.priority>=e&&(o.paused=!0,r.push(o.target));if(e<=0)for(n=0;n<this._updates0List.length;n++)(o=this._updates0List[n])&&(o.paused=!0,r.push(o.target));for(n=0;n<this._updatesPosList.length;n++)(o=this._updatesPosList[n])&&o.priority>=e&&(o.paused=!0,r.push(o.target));return r},n.resumeTargets=function(e){if(e)for(var t=0;t<e.length;t++)this.resumeTarget(e[t])},n.pauseTarget=function(e){M(e,1503);var t=e.uuid||e.id;if(t){var n=this._hashForTimers[t];n&&(n.paused=!0);var i=this._hashForUpdates[t];i&&(i.entry.paused=!0)}else N(1510)},n.resumeTarget=function(e){M(e,1504);var t=e.uuid||e.id;if(t){var n=this._hashForTimers[t];n&&(n.paused=!1);var i=this._hashForUpdates[t];i&&(i.entry.paused=!1)}else N(1510)},n.isTargetPaused=function(e){M(e,1505);var t=e.uuid||e.id;if(!t)return N(1510),!1;var n=this._hashForTimers[t];if(n)return n.paused;var i=this._hashForUpdates[t];return!!i&&i.entry.paused},n._removeHashElement=function(e){var t=e.target.uuid||e.target.id;delete this._hashForTimers[t];for(var n=this._arrayForTimers,i=0,o=n.length;i<o;i++)if(n[i]===e){n.splice(i,1);break}Zb.put(e)},n._removeUpdateFromHash=function(e){var t=e.target.uuid||e.target.id,n=this._hashForUpdates[t];if(n){for(var i=n.list,o=n.entry,r=0,a=i.length;r<a;r++)if(i[r]===o){i.splice(r,1);break}delete this._hashForUpdates[t],Kb.put(o),Qb.put(n)}},n._priorityIn=function(e,t,n){for(var i=0;i<e.length;i++)if(n<e[i].priority)return void e.splice(i,0,t);e.push(t)},n._appendIn=function(e,t){e.push(t)},t}(Yb));$b.PRIORITY_SYSTEM=1<<31,$b.PRIORITY_NON_SYSTEM=$b.PRIORITY_SYSTEM+1,$b.ID="scheduler",c.Scheduler=$b;var eI=function(){function e(){this._title="",this._width=1,this._height=1,this._nativeWidth=1,this._nativeHeight=1,this._renderPass=null,this._colorTextures=[],this._depthStencilTexture=null,this._swapchainBufferIndices=0,this._shouldSyncSizeWithSwapchain=!1,this._poolHandle=No,this._cameras=[]}e.registerCreateFunc=function(t){t._createWindowFun=function(t){return new e(t)}};var t=e.prototype;return t.initialize=function(e,t){this._poolHandle=Sr.alloc(),void 0!==t.title&&(this._title=t.title),void 0!==t.swapchainBufferIndices&&(this._swapchainBufferIndices=t.swapchainBufferIndices),void 0!==t.shouldSyncSizeWithSwapchain&&(this._shouldSyncSizeWithSwapchain=t.shouldSyncSizeWithSwapchain),this._width=t.width,this._height=t.height,this._nativeWidth=this._width,this._nativeHeight=this._height;for(var n=t.renderPassInfo,i=n.colorAttachments,o=n.depthStencilAttachment,r=0;r<i.length;r++)i[r].format===Ma.UNKNOWN&&(i[r].format=e.colorFormat);o&&o.format===Ma.UNKNOWN&&(o.format=e.depthStencilFormat),this._renderPass=e.createRenderPass(t.renderPassInfo);for(var a=0;a<i.length;a++){var s=null;this._swapchainBufferIndices&1<<a?Sr.set(this._poolHandle,mr.HAS_ON_SCREEN_ATTACHMENTS,1):(s=e.createTexture(new Ls(Ga.TEX2D,ka.COLOR_ATTACHMENT|ka.SAMPLED,i[a].format,this._width,this._height)),Sr.set(this._poolHandle,mr.HAS_OFF_SCREEN_ATTACHMENTS,1)),this._colorTextures.push(s)}o&&(this._swapchainBufferIndices>=0?(this._depthStencilTexture=e.createTexture(new Ls(Ga.TEX2D,ka.DEPTH_STENCIL_ATTACHMENT|ka.SAMPLED,o.format,this._width,this._height)),Sr.set(this._poolHandle,mr.HAS_OFF_SCREEN_ATTACHMENTS,1)):Sr.set(this._poolHandle,mr.HAS_ON_SCREEN_ATTACHMENTS,1));var c=Fo.alloc(e,new nc(this._renderPass,this._colorTextures,this._depthStencilTexture));return Sr.set(this._poolHandle,mr.FRAMEBUFFER,c),!0},t.destroy=function(){this.clearCameras(),this._depthStencilTexture&&(this._depthStencilTexture.destroy(),this._depthStencilTexture=null);for(var e=0;e<this._colorTextures.length;e++){var t=this._colorTextures[e];t&&t.destroy()}this._colorTextures.length=0,this._poolHandle&&(Fo.get(Sr.get(this._poolHandle,mr.FRAMEBUFFER)).destroy(),this._poolHandle=No)},t.resize=function(e,t){if(this._width=e,this._height=t,e>this._nativeWidth||t>this._nativeHeight){this._nativeWidth=e,this._nativeHeight=t;var n=!1;this._depthStencilTexture&&(this._depthStencilTexture.resize(e,t),n=!0);for(var i=0;i<this._colorTextures.length;i++){var o=this._colorTextures[i];o&&(o.resize(e,t),n=!0)}var r=Fo.get(Sr.get(this._poolHandle,mr.FRAMEBUFFER));n&&r&&(r.destroy(),r.initialize(new nc(this._renderPass,this._colorTextures,this._depthStencilTexture)))}for(var a,s=le(this._cameras);!(a=s()).done;){var c=a.value;c.isWindowSize&&c.resize(e,t)}},t.extractRenderCameras=function(e){for(var t=0;t<this._cameras.length;t++){var n=this._cameras[t];n.enabled&&(n.update(),e.push(n))}},t.attachCamera=function(e){for(var t=0;t<this._cameras.length;t++)if(this._cameras[t]===e)return;this._cameras.push(e),this.sortCameras()},t.detachCamera=function(e){for(var t=0;t<this._cameras.length;++t)if(this._cameras[t]===e)return void this._cameras.splice(t,1)},t.clearCameras=function(){this._cameras.length=0},t.sortCameras=function(){this._cameras.sort((function(e,t){return e.priority-t.priority}))},te(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"framebuffer",get:function(){return Fo.get(Sr.get(this._poolHandle,mr.FRAMEBUFFER))}},{key:"shouldSyncSizeWithSwapchain",get:function(){return this._shouldSyncSizeWithSwapchain}},{key:"hasOnScreenAttachments",get:function(){return 1===Sr.get(this._poolHandle,mr.HAS_ON_SCREEN_ATTACHMENTS)}},{key:"hasOffScreenAttachments",get:function(){return 1===Sr.get(this._poolHandle,mr.HAS_OFF_SCREEN_ATTACHMENTS)}},{key:"handle",get:function(){return this._poolHandle}},{key:"cameras",get:function(){return this._cameras}}]),e}(),tI=function(){function e(e){var t=this;this._createSceneFun=null,this._createWindowFun=null,this._device=void 0,this._windows=[],this._mainWindow=null,this._curWindow=null,this._tempWindow=null,this._pipeline=null,this._batcher=null,this._dataPoolMgr=void 0,this._scenes=[],this._modelPools=new Map,this._cameraPool=null,this._lightPools=new Map,this._fpsTime=0,this._frameCount=0,this._fps=0,this._fixedFPS=0,this._fixedFPSFrameTime=0,this._poolHandle=No,this._useDeferredPipeline=!1,this._device=e,this._dataPoolMgr=c.internal.DataPoolManager&&new c.internal.DataPoolManager(e),R_.registerCreateFunc(this),eI.registerCreateFunc(this),this._cameraPool=new ci((function(){return new P_(t._device)}),4)}var t=e.prototype;return t.initialize=function(){var e=this;this._poolHandle=gr.alloc();var t=new Qs,n=new Zs;n.depthStoreOp=es.DISCARD,n.stencilStoreOp=es.DISCARD;var i=new $s([t],n);return this._mainWindow=this.createWindow({title:"rootMainWindow",width:this._device.width,height:this._device.height,renderPassInfo:i,swapchainBufferIndices:-1}),this._curWindow=this._mainWindow,Promise.resolve(pm.initBuiltinRes(this._device)).then((function(){c.view.on("design-resolution-changed",(function(){var t=c.game.canvas.width,n=c.game.canvas.height;e.resize(t,n)}),e)}))},t.destroy=function(){this.destroyScenes(),this._pipeline&&(this._pipeline.destroy(),this._pipeline=null),this._batcher&&(this._batcher.destroy(),this._batcher=null),this._curWindow=null,this._mainWindow=null,this.dataPoolManager.clear(),this._poolHandle&&(gr.free(this._poolHandle),this._poolHandle=No)},t.resize=function(e,t){this._device.resize(e,t),this._mainWindow.resize(e,t);for(var n,i=le(this._windows);!(n=i()).done;){var o=n.value;o.shouldSyncSizeWithSwapchain&&o.resize(e,t)}this._pipeline&&this._pipeline.resize(e,t)},t.setRenderPipeline=function(e){if(e instanceof Iw&&(this._useDeferredPipeline=!0),e||(e=Rw()),this._pipeline=e,!this._pipeline.activate())return!1;var t=c.director.getScene();return t&&t.globals.activate(),this.onGlobalPipelineStateChanged(),!(!this._batcher&&c.internal.Batcher2D&&(this._batcher=new c.internal.Batcher2D(this),!this._batcher.initialize())&&(this.destroy(),1))},t.onGlobalPipelineStateChanged=function(){for(var e=0;e<this._scenes.length;e++)this._scenes[e].onGlobalPipelineStateChanged();this._pipeline.pipelineSceneData.initDeferredPassInfo()},t.activeWindow=function(e){this._curWindow=e},t.resetCumulativeTime=function(){gr.set(this._poolHandle,dr.CUMULATIVE_TIME,0)},t.frameMove=function(e){gr.set(this._poolHandle,dr.FRAME_TIME,e),++this._frameCount,gr.set(this._poolHandle,dr.CUMULATIVE_TIME,gr.get(this._poolHandle,dr.CUMULATIVE_TIME)+e),this._fpsTime+=e,this._fpsTime>1&&(this._fps=this._frameCount,this._frameCount=0,this._fpsTime=0);for(var t=0;t<this._scenes.length;++t)this._scenes[t].removeBatches();this._batcher&&this._batcher.update();for(var n=this._windows,i=[],o=0;o<n.length;o++)n[o].extractRenderCameras(i);if(this._pipeline&&i.length>0){this._device.acquire();var r=this._scenes,a=c.director.getTotalFrames();this._batcher&&this._batcher.uploadBuffers();for(var s=0;s<r.length;s++)r[s].update(a);c.director.emit(c.Director.EVENT_BEFORE_COMMIT),i.sort((function(e,t){return e.priority-t.priority})),this._pipeline.render(i),this._device.present()}this._batcher&&this._batcher.reset()},t.createWindow=function(e){var t=this._createWindowFun(this);return t.initialize(this.device,e),this._windows.push(t),t},t.destroyWindow=function(e){for(var t=0;t<this._windows.length;++t)if(this._windows[t]===e)return e.destroy(),void this._windows.splice(t,1)},t.destroyWindows=function(){for(var e,t=le(this._windows);!(e=t()).done;)e.value.destroy();this._windows=[]},t.createScene=function(e){var t=this._createSceneFun(this);return t.initialize(e),this._scenes.push(t),t},t.destroyScene=function(e){for(var t=0;t<this._scenes.length;++t)if(this._scenes[t]===e)return e.destroy(),void this._scenes.splice(t,1)},t.destroyScenes=function(){for(var e,t=le(this._scenes);!(e=t()).done;)e.value.destroy();this._scenes=[]},t.createModel=function(e){var t=this._modelPools.get(e);t||(this._modelPools.set(e,new ci((function(){return new e}),10)),t=this._modelPools.get(e));var n=t.alloc();return n.initialize(),n},t.destroyModel=function(e){var t=this._modelPools.get(e.constructor);t?(t.free(e),e.destroy(),e.scene&&e.scene.removeModel(e)):P(1300,e.constructor.name)},t.createCamera=function(){return this._cameraPool.alloc()},t.createLight=function(e){var t=this._lightPools.get(e);t||(this._lightPools.set(e,new ci((function(){return new e}),4)),t=this._lightPools.get(e));var n=t.alloc();return n.initialize(),n},t.destroyLight=function(e){var t=this._lightPools.get(e.constructor);if(e.destroy(),t&&(t.free(e),e.scene))switch(e.type){case Em.SPHERE:e.scene.removeSphereLight(e);break;case Em.SPOT:e.scene.removeSpotLight(e)}},te(e,[{key:"device",get:function(){return this._device}},{key:"mainWindow",get:function(){return this._mainWindow}},{key:"curWindow",get:function(){return this._curWindow},set:function(e){this._curWindow=e}},{key:"tempWindow",get:function(){return this._tempWindow},set:function(e){this._tempWindow=e}},{key:"windows",get:function(){return this._windows}},{key:"pipeline",get:function(){return this._pipeline}},{key:"batcher2D",get:function(){return this._batcher}},{key:"scenes",get:function(){return this._scenes}},{key:"cumulativeTime",get:function(){return gr.get(this._poolHandle,dr.CUMULATIVE_TIME)}},{key:"frameTime",get:function(){return gr.get(this._poolHandle,dr.FRAME_TIME)}},{key:"frameCount",get:function(){return this._frameCount}},{key:"fps",get:function(){return this._fps}},{key:"fixedFPS",get:function(){return this._fixedFPS},set:function(e){e>0?(this._fixedFPS=e,this._fixedFPSFrameTime=1e3/e):this._fixedFPSFrameTime=0}},{key:"dataPoolManager",get:function(){return this._dataPoolMgr}},{key:"handle",get:function(){return this._poolHandle}},{key:"useDeferredPipeline",get:function(){return this._useDeferredPipeline}}]),e}();c.Root=tI;var nI,iI,oI={};q(oI,"vmath",[{name:"vec2",newName:"Vec2",target:ai,targetName:"math"},{name:"vec3",newName:"Vec3",target:ai,targetName:"math"},{name:"vec4",newName:"Vec4",target:ai,targetName:"math"},{name:"quat",newName:"Quat",target:ai,targetName:"math"},{name:"mat3",newName:"Mat3",target:ai,targetName:"math"},{name:"mat4",newName:"Mat4",target:ai,targetName:"math"},{name:"color4",newName:"Color",target:ai,targetName:"math"},{name:"rect",newName:"Rect",target:ai,targetName:"math"},{name:"approx",newName:"approx",target:ai,targetName:"math"},{name:"EPSILON",newName:"EPSILON",target:ai,targetName:"math"},{name:"equals",newName:"equals",target:ai,targetName:"math"},{name:"clamp",newName:"clamp",target:ai,targetName:"math"},{name:"clamp01",newName:"clamp01",target:ai,targetName:"math"},{name:"lerp",newName:"lerp",target:ai,targetName:"math"},{name:"toRadian",newName:"toRadian",target:ai,targetName:"math"},{name:"toDegree",newName:"toDegree",target:ai,targetName:"math"},{name:"random",newName:"random",target:ai,targetName:"math"},{name:"randomRange",newName:"randomRange",target:ai,targetName:"math"},{name:"randomRangeInt",newName:"randomRangeInt",target:ai,targetName:"math"},{name:"pseudoRandom",newName:"pseudoRandom",target:ai,targetName:"math"},{name:"pseudoRandomRangeInt",newName:"pseudoRandomRangeInt",target:ai,targetName:"math"},{name:"nextPow2",newName:"nextPow2",target:ai,targetName:"math"},{name:"repeat",newName:"repeat",target:ai,targetName:"math"},{name:"pingPong",newName:"pingPong",target:ai,targetName:"math"},{name:"inverseLerp",newName:"inverseLerp",target:ai,targetName:"math"}]),c.vmath=oI,q($b.prototype,"Scheduler.prototype",[{name:"enableForTarget",newName:"enableForTarget",target:$b,targetName:"Scheduler"}]),q(vx.prototype,"EventTouch.prototype",[{name:"getUILocationInView",newName:"getLocationInView",target:vx,targetName:"EventTouch"}]),q(Vw.prototype,"SubModel.prototype",[{name:"subMeshData",newName:"subMesh"}]),Y(Vw.prototype,"SubModel.prototype",[{name:"getSubModel",suggest:"Use `subModels[i]` instead"},{name:"subModelNum",suggest:"Use `subModels.length` instead"}]),q(tI.prototype,"Root.prototype",[{name:"ui",newName:"batcher2D"}]),Y(Cd.prototype,"TextureBase.prototype",[{name:"hasPremultipliedAlpha"},{name:"setPremultiplyAlpha"},{name:"setFlipY"}]),q(GS.prototype,"RenderTexture.prototype",[{name:"getGFXWindow",customFunction:function(){return this._window}}]);var rI,aI=e("f8",U_("cc.BufferAsset")((he((iI=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this)._buffer=null,t}ie(t,e);var n=t.prototype;return n.buffer=function(){return this._buffer},n.validate=function(){return!!this.buffer},te(t,[{key:"_nativeAsset",get:function(){return this._buffer},set:function(e){e instanceof ArrayBuffer?this._buffer=e:this._buffer=e.buffer}}]),t}(Yf)).prototype,"_nativeAsset",[mf],Object.getOwnPropertyDescriptor(iI.prototype,"_nativeAsset"),iI.prototype),nI=iI))||nI);c.BufferAsset=aI;var sI=((rI={})[La.UNORM]="Uint",rI[La.SNORM]="Int",rI[La.UINT]="Uint",rI[La.INT]="Int",rI[La.UFLOAT]="Float",rI[La.FLOAT]="Float",rI.default="Uint",rI);function cI(e){return""+(sI[e.type]||sI.default)+e.size/e.count*8}function lI(e,t,n,i,o,r,a){void 0===n&&(n=Ma.R32F),void 0===i&&(i=0),void 0===o&&(o=e.byteLength-i),void 0===r&&(r=0),a||(a=new DataView(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)));var s=mc[n];r||(r=s.size);for(var c="set"+cI(s),l="get"+cI(s),u=s.size/s.count,h=Math.floor(o/r),_=jx.isLittleEndian,f=0;f<h;++f)for(var d=i+r*f,p=0;p<s.count;++p){var m=d+u*p,v=e[l](m,_);a[c](m,t(v,p,e),_)}return a}e("bT",function(){function e(e,t,n,i,o){void 0===i&&(i=null),void 0===o&&(o=null),this.mesh=void 0,this.subMeshIdx=void 0,this._flatBuffers=[],this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0,this._vertexIdChannel=void 0,this._geometricInfo=void 0,this._vertexBuffers=void 0,this._attributes=void 0,this._indexBuffer=null,this._indirectBuffer=null,this._primitiveMode=void 0,this._iaInfo=void 0,this._handle=No,this._attributes=t,this._vertexBuffers=e,this._indexBuffer=i,this._indirectBuffer=o,this._primitiveMode=n,this._iaInfo=new Ks(t,e,i,o),this._handle=Zr.alloc();var r=Ho.alloc();Zr.set(this._handle,qr.FLAT_BUFFER_ARRAY,r)}var t=e.prototype;return t.genFlatBuffers=function(){if(!this._flatBuffers.length&&this.mesh&&void 0!==this.subMeshIdx){var e=this.mesh,t=0,n=e.struct.primitives[this.subMeshIdx],i=Zr.get(this._handle,qr.FLAT_BUFFER_ARRAY);n.indexView&&(t=n.indexView.count);for(var o=0;o<n.vertexBundelIndices.length;o++){var r=n.vertexBundelIndices[o],a=e.struct.vertexBundles[r],s=n.indexView?n.indexView.count:a.view.count,c=a.view.stride,l=c*s,u=new Uint8Array(e.data.buffer,a.view.offset,a.view.length),h=Wo.alloc(n.indexView?l:a.view.length),_=Xr.alloc();Xr.set(_,Wr.STRIDE,c),Xr.set(_,Wr.AMOUNT,s),Xr.set(_,Wr.BUFFER,h),Ho.push(i,_);var f=Wo.getBuffer(h),d=new Uint8Array(f);if(n.indexView){for(var p=e.readIndices(this.subMeshIdx),m=0;m<t;++m)for(var v=m*c,g=p[m]*c,y=0;y<c;++y)d[v+y]=u[g+y];this._flatBuffers.push({stride:c,count:s,buffer:d})}else d.set(e.data.subarray(a.view.offset,a.view.offset+a.view.length)),this._flatBuffers.push({stride:c,count:s,buffer:d})}}},t.destroy=function(){for(var e=0;e<this.vertexBuffers.length;e++)this.vertexBuffers[e].destroy();if(this.vertexBuffers.length=0,this._indexBuffer&&(this._indexBuffer.destroy(),this._indexBuffer=null),this._jointMappedBuffers&&this._jointMappedBufferIndices){for(var t=0;t<this._jointMappedBufferIndices.length;t++)this._jointMappedBuffers[this._jointMappedBufferIndices[t]].destroy();this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0}this._indirectBuffer&&(this._indirectBuffer.destroy(),this._indirectBuffer=null),this._handle&&(Po(Zr.get(this._handle,qr.FLAT_BUFFER_ARRAY),Ho,Xr),Zr.free(this._handle),this._handle=No)},t.enableVertexIdChannel=function(e){if(!this._vertexIdChannel){var t=this.vertexBuffers.length,n=this.attributes.length,i=this._allocVertexIdBuffer(e);this._vertexBuffers.push(i),this._attributes.push(new Ys("a_vertexId",Ma.R32F,!1,t)),this._iaInfo.attributes=this._attributes,this._iaInfo.vertexBuffers=this._vertexBuffers,this._vertexIdChannel={stream:t,index:n}}},t._allocVertexIdBuffer=function(e){for(var t=0===this.vertexBuffers.length||0===this.vertexBuffers[0].stride?0:this.vertexBuffers[0].size/this.vertexBuffers[0].stride,n=new Float32Array(t),i=0;i<t;++i)n[i]=i+.5;var o=e.createBuffer(new Rs(za.VERTEX|za.TRANSFER_DST,Ha.DEVICE,n.byteLength,n.BYTES_PER_ELEMENT));return o.update(n),o},te(e,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}},{key:"primitiveMode",get:function(){return this._primitiveMode}},{key:"geometricInfo",get:function(){if(this._geometricInfo)return this._geometricInfo;if(void 0===this.mesh)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:Rn.ZERO,max:Rn.ZERO}};if(void 0===this.subMeshIdx)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:Rn.ZERO,max:Rn.ZERO}};var e=this.mesh,t=this.subMeshIdx,n=e.readAttribute(t,ms.ATTR_POSITION),i=e.readIndices(t),o=new Rn,r=new Rn,a=this.attributes.find((function(e){return e.name===ms.ATTR_POSITION}));if(a){var s=mc[a.format].count;2===s?(o.set(n[0],n[1],0),r.set(n[0],n[1],0)):(o.set(n[0],n[1],n[2]),r.set(n[0],n[1],n[2]));for(var c=0;c<n.length;c+=s)2===s?(o.x=n[c]>o.x?n[c]:o.x,o.y=n[c+1]>o.y?n[c+1]:o.y,r.x=n[c]<r.x?n[c]:r.x,r.y=n[c+1]<r.y?n[c+1]:r.y):(o.x=n[c]>o.x?n[c]:o.x,o.y=n[c+1]>o.y?n[c+1]:o.y,o.z=n[c+2]>o.z?n[c+2]:o.z,r.x=n[c]<r.x?n[c]:r.x,r.y=n[c+1]<r.y?n[c+1]:r.y,r.z=n[c+2]<r.z?n[c+2]:r.z)}return this._geometricInfo={positions:n,indices:i,boundingBox:{max:o,min:r}},this._geometricInfo}},{key:"flatBuffers",get:function(){return this._flatBuffers}},{key:"jointMappedBuffers",get:function(){var e=this;if(this._jointMappedBuffers)return this._jointMappedBuffers;var t=this._jointMappedBuffers=[],n=this._jointMappedBufferIndices=[];if(!this.mesh||void 0===this.subMeshIdx)return this._jointMappedBuffers=this.vertexBuffers;var i,o,r=this.mesh.struct,a=r.primitives[this.subMeshIdx];if(!r.jointMaps||void 0===a.jointMapIndex||!r.jointMaps[a.jointMapIndex])return this._jointMappedBuffers=this.vertexBuffers;for(var s=c.director.root.device,l=0;l<a.vertexBundelIndices.length;l++){var u=r.vertexBundles[a.vertexBundelIndices[l]];o=0,i=Ma.UNKNOWN;for(var h=0;h<u.attributes.length;h++){var _=u.attributes[h];if(_.name===ms.ATTR_JOINTS){i=_.format;break}o+=mc[_.format].size}i?function(){var c=new Uint8Array(e.mesh.data.buffer,u.view.offset,u.view.length),h=new DataView(c.slice().buffer),_=r.jointMaps[a.jointMapIndex];lI(h,(function(e){return _.indexOf(e)}),i,o,u.view.length,u.view.stride,h);var f=s.createBuffer(new Rs(za.VERTEX|za.TRANSFER_DST,Ha.DEVICE,u.view.length,u.view.stride));f.update(h.buffer),t.push(f),n.push(l)}():t.push(this.vertexBuffers[a.vertexBundelIndices[l]])}return this._vertexIdChannel&&t.push(this._allocVertexIdBuffer(s)),t}},{key:"iaInfo",get:function(){return this._iaInfo}},{key:"handle",get:function(){return this._handle}}]),e}());var uI=new Array(16),hI=null,_I=new Kn,fI=[qm.TOUCH_START.toString(),qm.TOUCH_MOVE.toString(),qm.TOUCH_END.toString(),qm.TOUCH_CANCEL.toString()],dI=[qm.MOUSE_DOWN.toString(),qm.MOUSE_ENTER.toString(),qm.MOUSE_MOVE.toString(),qm.MOUSE_LEAVE.toString(),qm.MOUSE_UP.toString(),qm.MOUSE_WHEEL.toString()];function pI(e,t){var n=this.owner;return!(!n||!n._uiProps.uiTransformComp||(e.getUILocation(_I),!n._uiProps.uiTransformComp.isHit(_I,this)||(t.type=qm.TOUCH_START.toString(),t.touch=e,t.bubbles=!0,n.dispatchEvent(t),0)))}function mI(e,t){var n=this.owner;return!(!n||!n._uiProps.uiTransformComp||(t.type=qm.TOUCH_MOVE.toString(),t.touch=e,t.bubbles=!0,n.dispatchEvent(t),0))}function vI(e,t){var n=this.owner;n&&n._uiProps.uiTransformComp&&(e.getUILocation(_I),n._uiProps.uiTransformComp.isHit(_I,this)?t.type=qm.TOUCH_END.toString():t.type=qm.TOUCH_CANCEL.toString(),t.touch=e,t.bubbles=!0,n.dispatchEvent(t))}function gI(e,t){var n=this.owner;n&&n._uiProps.uiTransformComp&&(t.type=qm.TOUCH_CANCEL.toString(),t.touch=e,t.bubbles=!0,n.dispatchEvent(t))}function yI(e){var t=this.owner;t&&t._uiProps.uiTransformComp&&(_I=e.getUILocation(),t._uiProps.uiTransformComp.isHit(_I,this)&&(e.type=qm.MOUSE_DOWN.toString(),e.bubbles=!0,t.dispatchEvent(e)))}function xI(e){var t=this.owner;if(t&&t._uiProps.uiTransformComp){if(_I=e.getUILocation(),t._uiProps.uiTransformComp.isHit(_I,this))this._previousIn||(hI&&hI.eventProcessor.mouseListener&&(e.type=qm.MOUSE_LEAVE,hI.dispatchEvent(e),hI.eventProcessor.mouseListener&&(hI.eventProcessor.mouseListener._previousIn=!1)),hI=t,e.type=qm.MOUSE_ENTER.toString(),t.dispatchEvent(e),this._previousIn=!0),e.type=qm.MOUSE_MOVE.toString(),e.bubbles=!0,t.dispatchEvent(e);else{if(!this._previousIn)return;e.type=qm.MOUSE_LEAVE.toString(),t.dispatchEvent(e),this._previousIn=!1,hI=null}e.propagationStopped=!0}}function SI(e){var t=this.owner;t&&t._uiProps.uiTransformComp&&(_I=e.getUILocation(),t._uiProps.uiTransformComp.isHit(_I,this)&&(e.type=qm.MOUSE_UP.toString(),e.bubbles=!0,t.dispatchEvent(e),e.propagationStopped=!0))}function EI(e){var t=this.owner;t&&t._uiProps.uiTransformComp&&(_I=e.getUILocation(),t._uiProps.uiTransformComp.isHit(_I,this)&&(e.type=qm.MOUSE_WHEEL.toString(),e.bubbles=!0,t.dispatchEvent(e),e.propagationStopped=!0))}function TI(e,t){if(t){for(var n=0,i=[],o=e;o&&My.isNode(o);o=o.parent,++n){var r=o.getComponent(t);if(r){var a={index:n,comp:r};i?i.push(a):i=[a]}}return i.length>0?i:null}return null}function AI(e,t){if(!e._persistNode){if(e.eventProcessor.bubblingTargets)for(var n=0;n<t.length;++n)if(e.eventProcessor.bubblingTargets.hasEventListener(t[n]))return!0;if(e.eventProcessor.capturingTargets)for(var i=0;i<t.length;++i)if(e.eventProcessor.capturingTargets.hasEventListener(t[i]))return!0;return!1}return!0}var CI,wI=e("d9",function(){function e(e){this.bubblingTargets=null,this.capturingTargets=null,this.touchListener=null,this.mouseListener=null,this._node=void 0,this._node=e}var t=e.prototype;return t.reattach=function(){var t;this.node.walk((function(n){t||(t=TI(n,e._comp)),n.eventProcessor.touchListener&&(n.eventProcessor.touchListener.mask=t),n.eventProcessor.mouseListener&&(n.eventProcessor.mouseListener.mask=t)}))},t.destroy=function(){hI===this._node&&(hI=null),(this.touchListener||this.mouseListener)&&(ov.removeListeners(this._node),this.touchListener&&(this.touchListener.owner=null,this.touchListener.mask=null,this.touchListener=null),this.mouseListener&&(this.mouseListener.owner=null,this.mouseListener.mask=null,this.mouseListener=null)),this.capturingTargets&&this.capturingTargets.clear(),this.bubblingTargets&&this.bubblingTargets.clear()},t.on=function(e,t,n,i){return this._checknSetupSysEvent(e)?this._onDispatch(e,t,n,i):(this.bubblingTargets||(this.bubblingTargets=new Ei),this.bubblingTargets.on(e,t,n))},t.once=function(e,t,n,i){var o,r=this;(o=this._checknSetupSysEvent(e)&&i?this.capturingTargets=this.capturingTargets||new Ei:this.bubblingTargets=this.bubblingTargets||new Ei).on(e,t,n,!0),o.on(e,(function(){r.off(e,t,n)}),void 0,!0)},t.off=function(e,t,n,i){var o=-1!==fI.indexOf(e),r=!o&&-1!==dI.indexOf(e);o||r?(this._offDispatch(e,t,n,i),o?this.touchListener&&!AI(this._node,fI)&&(ov.removeListener(this.touchListener),this.touchListener=null):r&&this.mouseListener&&!AI(this._node,dI)&&(ov.removeListener(this.mouseListener),this.mouseListener=null)):this.bubblingTargets&&this.bubblingTargets.off(e,t,n)},t.emit=function(e,t,n,i,o,r){this.bubblingTargets&&this.bubblingTargets.emit(e,t,n,i,o,r)},t.dispatchEvent=function(e){!function(e,t){var n,i=0;for(t.target=e,uI.length=0,e.eventProcessor.getCapturingTargets(t.type,uI),t.eventPhase=1,i=uI.length-1;i>=0;--i)if((n=uI[i])&&n.eventProcessor.capturingTargets&&(t.currentTarget=n,n.eventProcessor.capturingTargets.emit(t.type,t,uI),t.propagationStopped))return void(uI.length=0);if(uI.length=0,t.eventPhase=2,t.currentTarget=e,e.eventProcessor.capturingTargets&&e.eventProcessor.capturingTargets.emit(t.type,t),!t.propagationImmediateStopped&&e.eventProcessor.bubblingTargets&&e.eventProcessor.bubblingTargets.emit(t.type,t),!t.propagationStopped&&t.bubbles)for(e.eventProcessor.getBubblingTargets(t.type,uI),t.eventPhase=3,i=0;i<uI.length;++i)if((n=uI[i]).eventProcessor.bubblingTargets&&(t.currentTarget=n,n.eventProcessor.bubblingTargets.emit(t.type,t),t.propagationStopped))return void(uI.length=0);uI.length=0}(this._node,e),uI.length=0},t.hasEventListener=function(e,t,n){var i=!1;return this.bubblingTargets&&(i=this.bubblingTargets.hasEventListener(e,t,n)),!i&&this.capturingTargets&&(i=this.capturingTargets.hasEventListener(e,t,n)),i},t.targetOff=function(e){this.capturingTargets&&this.capturingTargets.removeAll(e),this.bubblingTargets&&this.bubblingTargets.removeAll(e),this.touchListener&&!AI(this.node,fI)&&(ov.removeListener(this.touchListener),this.touchListener=null),this.mouseListener&&!AI(this.node,dI)&&(ov.removeListener(this.mouseListener),this.mouseListener=null)},t.getCapturingTargets=function(e,t){for(var n=this._node.parent;n;)n.eventProcessor.capturingTargets&&n.eventProcessor.capturingTargets.hasEventListener(e)&&t.push(n),n=n.parent},t.getBubblingTargets=function(e,t){for(var n=this._node.parent;n;)n.eventProcessor.bubblingTargets&&n.eventProcessor.bubblingTargets.hasEventListener(e)&&t.push(n),n=n.parent},t._checknSetupSysEvent=function(t){var n=this,i=!1,o=!1;return-1!==fI.indexOf(t)?(this.touchListener||(this.touchListener=c.EventListener.create({event:c.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,owner:this._node,mask:TI(this._node,e._comp),onTouchBegan:pI,onTouchMoved:mI,onTouchEnded:vI,onTouchCancelled:gI}),ov.addListener(this.touchListener,this._node),i=!0),o=!0):-1!==dI.indexOf(t)&&(this.mouseListener||(this.mouseListener=c.EventListener.create({event:c.EventListener.MOUSE,_previousIn:!1,owner:this._node,mask:TI(this._node,e._comp),onMouseDown:yI,onMouseMove:xI,onMouseUp:SI,onMouseScroll:EI}),ov.addListener(this.mouseListener,this._node),i=!0),o=!0),i&&!this._node.activeInHierarchy&&c.director.getScheduler().schedule((function(){n._node.activeInHierarchy||ov.pauseTarget(n._node)}),this._node,0,0,0,!1),o},t._onDispatch=function(e,t,n,i){if("boolean"==typeof n?(i=n,n=void 0):i=!!i,t){var o=null;return(o=i?this.capturingTargets=this.capturingTargets||new Ei:this.bubblingTargets=this.bubblingTargets||new Ei).hasEventListener(e,t,n)||o.on(e,t,n),t}N(6800)},t._offDispatch=function(e,t,n,i){if("boolean"==typeof n?(i=n,n=void 0):i=!!i,t){var o=i?this.capturingTargets:this.bubblingTargets;o&&o.off(e,t,n)}else this.capturingTargets&&this.capturingTargets.removeAll(e),this.bubblingTargets&&this.bubblingTargets.removeAll(e)},te(e,[{key:"node",get:function(){return this._node}}]),e}());wI._comp=null,c.NodeEventProcessor=wI,q(yv.prototype,"BaseNode",[{name:"childrenCount",newName:"children.length",customGetter:function(){return this.children.length}}]),q(My.prototype,"Node",[{name:"width",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.width},customSetter:function(e){this._uiProps.uiTransformComp.width=e}},{name:"height",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.height},customSetter:function(e){this._uiProps.uiTransformComp.height=e}},{name:"anchorX",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorX},customSetter:function(e){this._uiProps.uiTransformComp.anchorX=e}},{name:"anchorY",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorY},customSetter:function(e){this._uiProps.uiTransformComp.anchorY=e}},{name:"getAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(e){return e||(e=new Kn),e.set(this._uiProps.uiTransformComp.anchorPoint),e}},{name:"setAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(e,t){this._uiProps.uiTransformComp.setAnchorPoint(e,t)}},{name:"getContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(e){return e||(e=new ni),e.set(this._uiProps.uiTransformComp.contentSize),e}},{name:"setContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(e,t){"number"==typeof e?this._uiProps.uiTransformComp.setContentSize(e,t):this._uiProps.uiTransformComp.setContentSize(e)}}]),Y(My.prototype,"Node.prototype",[{name:"addLayer"},{name:"removeLayer"}]),Y(qu,"Layers",[{name:"All"},{name:"RaycastMask"},{name:"check"}]),q(qu,"Layers",[{name:"Default",newName:"DEFAULT",target:qu.Enum,targetName:"Layers.Enum"},{name:"Always",newName:"ALWAYS",target:qu.Enum,targetName:"Layers.Enum"},{name:"IgnoreRaycast",newName:"IGNORE_RAYCAST",target:qu.Enum,targetName:"Layers.Enum"},{name:"Gizmos",newName:"GIZMOS",target:qu.Enum,targetName:"Layers.Enum"},{name:"Editor",newName:"EDITOR",target:qu.Enum,targetName:"Layers.Enum"},{name:"UI",newName:"UI_3D",target:qu.Enum,targetName:"Layers.Enum"},{name:"UI2D",newName:"UI_2D",target:qu.Enum,targetName:"Layers.Enum"},{name:"SceneGizmo",newName:"SCENE_GIZMO",target:qu.Enum,targetName:"Layers.Enum"},{name:"makeInclusiveMask",newName:"makeMaskInclude",target:qu,targetName:"Layers"},{name:"makeExclusiveMask",newName:"makeMaskExclude",target:qu,targetName:"Layers"}]),Y(qu.Enum,"Layers.Enum",[{name:"ALWAYS"}]),Y(qu.BitMask,"Layers.BitMask",[{name:"ALWAYS"}]);var bI,II,PI,RI,NI,OI,DI,MI,LI,FI,zI,BI,UI,HI,GI,kI,VI,WI,jI,qI,YI,XI,KI,QI,ZI,JI,$I,eP,tP,nP,iP,oP,rP,aP,sP,cP,lP,uP,hP,_P,fP,dP,pP,mP,vP,gP,yP,xP,SP,EP,TP,AP,CP,wP,bP,IP,PP,RP,NP,OP,DP,MP,LP,FP,zP,BP,UP,HP,GP,kP,VP,WP,jP,qP,YP,XP,KP,QP,ZP,JP,$P,eR,tR,nR,iR,oR,rR,aR,sR,cR,lR,uR,hR,_R,fR,dR,pR,mR,vR,gR,yR,xR,SR,ER,TR,AR,CR,wR,bR,IR,PR,RR,NR,OR,DR,MR,LR,FR,zR,BR=fi.Flags.HideInHierarchy,UR=fi.Flags.DontSave,HR=e("fU",U_("cc.PrivateNode")(CI=function(e){function t(t){var n;return P(12003,(n=e.call(this,t)||this).name),n.hideFlags|=UR|BR,n}return ie(t,e),t}(My))||CI);c.PrivateNode=HR;var GR=new Rn(0,1,0),kR=new Rn,VR=new zn,WR=(bI=U_("cc.AmbientInfo"),II=pf(Ft),bI((MI=function(){function e(){ue(this,"_skyColor",NI,this),ue(this,"_skyIllum",OI,this),ue(this,"_groundAlbedo",DI,this),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this)},te(e,[{key:"skyColor",get:function(){return this._skyColor},set:function(e){this._skyColor.set(e),this._resource&&(this._resource.skyColor=this._skyColor)}},{key:"skyIllum",get:function(){return this._skyIllum},set:function(e){this._skyIllum=e,this._resource&&(this._resource.skyIllum=this.skyIllum)}},{key:"groundAlbedo",get:function(){return this._groundAlbedo},set:function(e){this._groundAlbedo.set(e),this._resource&&(this._resource.groundAlbedo=this._groundAlbedo)}}]),e}(),NI=he((RI=MI).prototype,"_skyColor",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new In(51,128,204,1)}}),OI=he(RI.prototype,"_skyIllum",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ca.SKY_ILLUM}}),DI=he(RI.prototype,"_groundAlbedo",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new In(51,51,51,255)}}),he(RI.prototype,"skyColor",[$_],Object.getOwnPropertyDescriptor(RI.prototype,"skyColor"),RI.prototype),he(RI.prototype,"skyIllum",[$_,II],Object.getOwnPropertyDescriptor(RI.prototype,"skyIllum"),RI.prototype),he(RI.prototype,"groundAlbedo",[$_],Object.getOwnPropertyDescriptor(RI.prototype,"groundAlbedo"),RI.prototype),PI=RI))||PI);c.AmbientInfo=WR;var jR=(LI=U_("cc.SkyboxInfo"),FI=pf(Lp),zI=pf(Lp),LI((WI=function(){function e(){ue(this,"_envmap",HI,this),ue(this,"_isRGBE",GI,this),ue(this,"_enabled",kI,this),ue(this,"_useIBL",VI,this),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this),this._resource.activate()},te(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=this._enabled))}},{key:"useIBL",get:function(){return this._useIBL},set:function(e){this._useIBL=e,this._resource&&(this._resource.useIBL=this._useIBL)}},{key:"envmap",get:function(){return this._envmap},set:function(e){this._envmap=e,this._resource&&(this._resource.envmap=this._envmap)}},{key:"isRGBE",get:function(){return this._isRGBE},set:function(e){this._isRGBE=e,this._resource&&(this._resource.isRGBE=this._isRGBE)}}]),e}(),HI=he((UI=WI).prototype,"_envmap",[FI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),GI=he(UI.prototype,"_isRGBE",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),kI=he(UI.prototype,"_enabled",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),VI=he(UI.prototype,"_useIBL",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),he(UI.prototype,"enabled",[$_],Object.getOwnPropertyDescriptor(UI.prototype,"enabled"),UI.prototype),he(UI.prototype,"useIBL",[$_],Object.getOwnPropertyDescriptor(UI.prototype,"useIBL"),UI.prototype),he(UI.prototype,"envmap",[$_,zI],Object.getOwnPropertyDescriptor(UI.prototype,"envmap"),UI.prototype),he(UI.prototype,"isRGBE",[$_],Object.getOwnPropertyDescriptor(UI.prototype,"isRGBE"),UI.prototype),BI=UI))||BI);c.SkyboxInfo=jR;var qR=(jI=U_("cc.FogInfo"),qI=pf(fE),YI=ef(),XI=pf(Ft),KI=of(),QI=sf(),ZI=lf(),JI=ef(),$I=pf(Ft),eP=sf(),tP=lf(),nP=ef(),iP=pf(Ft),oP=sf(),rP=lf(),aP=ef(),sP=pf(Ft),cP=rf(),lP=sf(),uP=lf(),hP=ef(),_P=pf(Ft),fP=sf(),dP=lf(),pP=ef(),mP=pf(Ft),vP=sf(),gP=lf(),jI((NP=RP=function(){function e(){ue(this,"_type",SP,this),ue(this,"_fogColor",EP,this),ue(this,"_enabled",TP,this),ue(this,"_fogDensity",AP,this),ue(this,"_fogStart",CP,this),ue(this,"_fogEnd",wP,this),ue(this,"_fogAtten",bP,this),ue(this,"_fogTop",IP,this),ue(this,"_fogRange",PP,this),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this),this._resource.activate()},te(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=e,e&&(this._resource.type=this._type)))}},{key:"fogColor",get:function(){return this._fogColor},set:function(e){this._fogColor.set(e),this._resource&&(this._resource.fogColor=this._fogColor)}},{key:"type",get:function(){return this._type},set:function(e){this._type=e,this._resource&&(this._resource.type=e)}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(e){this._fogDensity=e,this._resource&&(this._resource.fogDensity=e)}},{key:"fogStart",get:function(){return this._fogStart},set:function(e){this._fogStart=e,this._resource&&(this._resource.fogStart=e)}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(e){this._fogEnd=e,this._resource&&(this._resource.fogEnd=e)}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(e){this._fogAtten=e,this._resource&&(this._resource.fogAtten=e)}},{key:"fogTop",get:function(){return this._fogTop},set:function(e){this._fogTop=e,this._resource&&(this._resource.fogTop=e)}},{key:"fogRange",get:function(){return this._fogRange},set:function(e){this._fogRange=e,this._resource&&(this._resource.fogRange=e)}}]),e}(),RP.FogType=fE,SP=he((xP=NP).prototype,"_type",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return fE.LINEAR}}),EP=he(xP.prototype,"_fogColor",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new In("#C8C8C8")}}),TP=he(xP.prototype,"_enabled",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),AP=he(xP.prototype,"_fogDensity",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),CP=he(xP.prototype,"_fogStart",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),wP=he(xP.prototype,"_fogEnd",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),bP=he(xP.prototype,"_fogAtten",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),IP=he(xP.prototype,"_fogTop",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),PP=he(xP.prototype,"_fogRange",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),he(xP.prototype,"enabled",[$_],Object.getOwnPropertyDescriptor(xP.prototype,"enabled"),xP.prototype),he(xP.prototype,"fogColor",[$_],Object.getOwnPropertyDescriptor(xP.prototype,"fogColor"),xP.prototype),he(xP.prototype,"type",[$_,qI],Object.getOwnPropertyDescriptor(xP.prototype,"type"),xP.prototype),he(xP.prototype,"fogDensity",[YI,XI,KI,QI,cf,ZI],Object.getOwnPropertyDescriptor(xP.prototype,"fogDensity"),xP.prototype),he(xP.prototype,"fogStart",[JI,$I,eP,tP],Object.getOwnPropertyDescriptor(xP.prototype,"fogStart"),xP.prototype),he(xP.prototype,"fogEnd",[nP,iP,oP,rP],Object.getOwnPropertyDescriptor(xP.prototype,"fogEnd"),xP.prototype),he(xP.prototype,"fogAtten",[aP,sP,cP,lP,uP],Object.getOwnPropertyDescriptor(xP.prototype,"fogAtten"),xP.prototype),he(xP.prototype,"fogTop",[hP,_P,fP,dP],Object.getOwnPropertyDescriptor(xP.prototype,"fogTop"),xP.prototype),he(xP.prototype,"fogRange",[pP,mP,vP,gP],Object.getOwnPropertyDescriptor(xP.prototype,"fogRange"),xP.prototype),yP=xP))||yP),YR=(OP=U_("cc.ShadowsInfo"),DP=pf(VS),MP=ef(),LP=pf(Ft),FP=ef(),zP=pf(WS),BP=ef(),UP=pf(Lt),HP=ef(),GP=pf(Ft),kP=ef(),VP=pf(zt),WP=ef(),jP=pf(zt),qP=ef(),YP=pf(zt),XP=ef(),KP=pf(Ft),QP=ef(),ZP=pf(zt),JP=ef(),$P=pf(Ft),eR=ef(),tR=pf(Ft),nR=ef(),iR=pf(Ft),oR=ef(),rR=ef(),aR=pf(Ft),sR=ef(),OP((IR=function(){function e(){ue(this,"_type",uR,this),ue(this,"_enabled",hR,this),ue(this,"_normal",_R,this),ue(this,"_distance",fR,this),ue(this,"_shadowColor",dR,this),ue(this,"_autoAdapt",pR,this),ue(this,"_pcf",mR,this),ue(this,"_bias",vR,this),ue(this,"_packing",gR,this),ue(this,"_linear",yR,this),ue(this,"_selfShadow",xR,this),ue(this,"_normalBias",SR,this),ue(this,"_near",ER,this),ue(this,"_far",TR,this),ue(this,"_aspect",AR,this),ue(this,"_orthoSize",CR,this),ue(this,"_maxReceived",wR,this),ue(this,"_size",bR,this),this._resource=null}var t=e.prototype;return t.setPlaneFromNode=function(e){e.getWorldRotation(VR),this.normal=Rn.transformQuat(kR,GR,VR),e.getWorldPosition(kR),this.distance=Rn.dot(this._normal,kR)},t.activate=function(e){this._resource=e,this._resource.initialize(this),this._resource.activate()},te(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=e,e&&(this._resource.type=this._type)))}},{key:"type",get:function(){return this._type},set:function(e){this._type=e,this._resource&&(this._resource.type=e)}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(e){this._shadowColor.set(e),this._resource&&(this._resource.shadowColor=e)}},{key:"normal",get:function(){return this._normal},set:function(e){Rn.copy(this._normal,e),this._resource&&(this._resource.normal=e)}},{key:"distance",get:function(){return this._distance},set:function(e){this._distance=e,this._resource&&(this._resource.distance=e)}},{key:"pcf",get:function(){return this._pcf},set:function(e){this._pcf=e,this._resource&&(this._resource.pcf=e)}},{key:"maxReceived",get:function(){return this._maxReceived},set:function(e){this._maxReceived=e,this._resource&&(this._resource.maxReceived=e)}},{key:"bias",get:function(){return this._bias},set:function(e){this._bias=e,this._resource&&(this._resource.bias=e)}},{key:"packing",get:function(){return this._packing},set:function(e){this._packing=e,e&&(this._linear=!this._linear&&this._linear,this._resource&&(this._resource.linear=this._linear)),this._resource&&(this._resource.packing=e,this._resource.shadowMapDirty=!0)}},{key:"linear",get:function(){return this._linear},set:function(e){this._linear=e,e&&(this._packing=!this._packing&&this._packing,this._resource&&(this._resource.packing=this._packing)),this._resource&&(this._resource.linear=e)}},{key:"selfShadow",get:function(){return this._selfShadow},set:function(e){this._selfShadow=e,this._resource&&(this._resource.selfShadow=e)}},{key:"normalBias",get:function(){return this._normalBias},set:function(e){this._normalBias=e,this._resource&&(this._resource.normalBias=e)}},{key:"autoAdapt",get:function(){return this._autoAdapt},set:function(e){this._autoAdapt=e,this._resource&&(this._resource.autoAdapt=e)}},{key:"near",get:function(){return this._near},set:function(e){this._near=e,this._resource&&(this._resource.near=e)}},{key:"far",get:function(){return this._far},set:function(e){this._far=e,this._resource&&(this._resource.far=e)}},{key:"orthoSize",get:function(){return this._orthoSize},set:function(e){this._orthoSize=e,this._resource&&(this._resource.orthoSize=e)}},{key:"shadowMapSize",get:function(){return this._size},set:function(e){this._size.set(e),this._resource&&(this._resource.size=e,this._resource.shadowMapDirty=!0)}},{key:"aspect",get:function(){return this._aspect},set:function(e){this._aspect=e,this._resource&&(this._resource.aspect=e)}}]),e}(),uR=he((lR=IR).prototype,"_type",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return VS.Planar}}),hR=he(lR.prototype,"_enabled",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_R=he(lR.prototype,"_normal",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Rn(0,1,0)}}),fR=he(lR.prototype,"_distance",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dR=he(lR.prototype,"_shadowColor",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new In(0,0,0,76)}}),pR=he(lR.prototype,"_autoAdapt",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),mR=he(lR.prototype,"_pcf",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return WS.HARD}}),vR=he(lR.prototype,"_bias",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e-5}}),gR=he(lR.prototype,"_packing",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),yR=he(lR.prototype,"_linear",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),xR=he(lR.prototype,"_selfShadow",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),SR=he(lR.prototype,"_normalBias",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ER=he(lR.prototype,"_near",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),TR=he(lR.prototype,"_far",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),AR=he(lR.prototype,"_aspect",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),CR=he(lR.prototype,"_orthoSize",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),wR=he(lR.prototype,"_maxReceived",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),bR=he(lR.prototype,"_size",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Kn(512,512)}}),he(lR.prototype,"enabled",[$_],Object.getOwnPropertyDescriptor(lR.prototype,"enabled"),lR.prototype),he(lR.prototype,"type",[$_,DP],Object.getOwnPropertyDescriptor(lR.prototype,"type"),lR.prototype),he(lR.prototype,"shadowColor",[$_],Object.getOwnPropertyDescriptor(lR.prototype,"shadowColor"),lR.prototype),he(lR.prototype,"normal",[MP],Object.getOwnPropertyDescriptor(lR.prototype,"normal"),lR.prototype),he(lR.prototype,"distance",[LP,FP],Object.getOwnPropertyDescriptor(lR.prototype,"distance"),lR.prototype),he(lR.prototype,"pcf",[zP,BP],Object.getOwnPropertyDescriptor(lR.prototype,"pcf"),lR.prototype),he(lR.prototype,"maxReceived",[UP,HP],Object.getOwnPropertyDescriptor(lR.prototype,"maxReceived"),lR.prototype),he(lR.prototype,"bias",[GP,kP],Object.getOwnPropertyDescriptor(lR.prototype,"bias"),lR.prototype),he(lR.prototype,"packing",[VP,WP],Object.getOwnPropertyDescriptor(lR.prototype,"packing"),lR.prototype),he(lR.prototype,"linear",[jP,qP],Object.getOwnPropertyDescriptor(lR.prototype,"linear"),lR.prototype),he(lR.prototype,"selfShadow",[YP,XP],Object.getOwnPropertyDescriptor(lR.prototype,"selfShadow"),lR.prototype),he(lR.prototype,"normalBias",[KP,QP],Object.getOwnPropertyDescriptor(lR.prototype,"normalBias"),lR.prototype),he(lR.prototype,"autoAdapt",[ZP,JP],Object.getOwnPropertyDescriptor(lR.prototype,"autoAdapt"),lR.prototype),he(lR.prototype,"near",[$P,eR],Object.getOwnPropertyDescriptor(lR.prototype,"near"),lR.prototype),he(lR.prototype,"far",[tR,nR],Object.getOwnPropertyDescriptor(lR.prototype,"far"),lR.prototype),he(lR.prototype,"orthoSize",[iR,oR],Object.getOwnPropertyDescriptor(lR.prototype,"orthoSize"),lR.prototype),he(lR.prototype,"shadowMapSize",[rR],Object.getOwnPropertyDescriptor(lR.prototype,"shadowMapSize"),lR.prototype),he(lR.prototype,"aspect",[aR,sR],Object.getOwnPropertyDescriptor(lR.prototype,"aspect"),lR.prototype),cR=lR))||cR);c.ShadowsInfo=YR;var XR,KR,QR,ZR,JR=(PR=U_("cc.SceneGlobals"),RR=pf(jR),PR((zR=function(){function e(){ue(this,"ambient",DR,this),ue(this,"shadows",MR,this),ue(this,"_skybox",LR,this),ue(this,"fog",FR,this)}return e.prototype.activate=function(){var e=c.director.root.pipeline.pipelineSceneData;this.ambient.activate(e.ambient),this.skybox.activate(e.skybox),this.shadows.activate(e.shadows),this.fog.activate(e.fog)},te(e,[{key:"skybox",get:function(){return this._skybox},set:function(e){this._skybox=e}}]),e}(),DR=he((OR=zR).prototype,"ambient",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new WR}}),MR=he(OR.prototype,"shadows",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new YR}}),LR=he(OR.prototype,"_skybox",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new jR}}),FR=he(OR.prototype,"fog",[$_,W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new qR}}),he(OR.prototype,"skybox",[$_,RR],Object.getOwnPropertyDescriptor(OR.prototype,"skybox"),OR.prototype),NR=OR))||NR);c.SceneGlobals=JR;var $R=e("dP",U_("cc.Scene")((he((KR=function(e){ie(n,e);var t=n.prototype;function n(t){var n;return ue(n=e.call(this,t)||this,"autoReleaseAssets",QR,se(n)),ue(n,"_globals",ZR,se(n)),n._renderScene=null,n.dependAssets=null,n._inited=void 0,n._prefabSyncedInLiveReload=!1,n._pos=Rn.ZERO,n._rot=zn.IDENTITY,n._scale=Rn.ONE,n._mat=jn.IDENTITY,n._dirtyFlags=0,n._activeInHierarchy=!1,c.director&&c.director.root&&(n._renderScene=c.director.root.createScene({})),n._inited=!c.game||!c.game._isCloning,n}return t._updateScene=function(){this._scene=this},t.destroy=function(){var e=fi.prototype.destroy.call(this);if(e)for(var t=this._children,n=0;n<t.length;++n)t[n].active=!1;return c.director.root.destroyScene(this._renderScene),this._active=!1,this._activeInHierarchy=!1,e},t.addComponent=function(){throw new Error(L(3822))},t._onHierarchyChanged=function(){},t._onBatchCreated=function(t){e.prototype._onBatchCreated.call(this,t);for(var n=this._children.length,i=0;i<n;++i)this.children[i]._siblingIndex=i,this._children[i]._onBatchCreated(t);cg(this)},t.getPosition=function(e){return Rn.copy(e||new Rn,Rn.ZERO)},t.getRotation=function(e){return zn.copy(e||new zn,zn.IDENTITY)},t.getScale=function(e){return Rn.copy(e||new Rn,Rn.ONE)},t.getWorldPosition=function(e){return Rn.copy(e||new Rn,Rn.ZERO)},t.getWorldRotation=function(e){return zn.copy(e||new zn,zn.IDENTITY)},t.getWorldScale=function(e){return Rn.copy(e||new Rn,Rn.ONE)},t.getWorldMatrix=function(e){return jn.copy(e||new jn,jn.IDENTITY)},t.getWorldRS=function(e){return jn.copy(e||new jn,jn.IDENTITY)},t.getWorldRT=function(e){return jn.copy(e||new jn,jn.IDENTITY)},t.updateWorldTransform=function(){},t._instantiate=function(){},t._load=function(){this._inited||(this._onBatchCreated(i),this._inited=!0),this.walk(yv._setScene)},t._activate=function(e){e=!1!==e,c.director._nodeActivator.activateNode(this,e),this._globals.activate()},te(n,[{key:"renderScene",get:function(){return this._renderScene}},{key:"globals",get:function(){return this._globals}},{key:"position",get:function(){return Rn.ZERO}},{key:"worldPosition",get:function(){return Rn.ZERO}},{key:"rotation",get:function(){return zn.IDENTITY}},{key:"worldRotation",get:function(){return zn.IDENTITY}},{key:"scale",get:function(){return Rn.ONE}},{key:"worldScale",get:function(){return Rn.ONE}},{key:"eulerAngles",get:function(){return Rn.ZERO}},{key:"worldMatrix",get:function(){return jn.IDENTITY}}]),n}(yv)).prototype,"globals",[$_],Object.getOwnPropertyDescriptor(KR.prototype,"globals"),KR.prototype),QR=he(KR.prototype,"autoReleaseAssets",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ZR=he(KR.prototype,"_globals",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new JR}}),XR=KR))||XR);function eN(e,t){if(!t){var n=c.director.getScene();if(!n)return null;t=n}return t.getChildByPath(e)}c.Scene=$R,c.find=eN;var tN=rt.fastRemoveAt,nN=fi.Flags.IsStartCalled,iN=fi.Flags.IsOnEnableCalled;function oN(e,t){for(var n=t.constructor._executionOrder,i=t._id,o=0,r=e.length-1,a=r>>>1;o<=r;a=o+r>>>1){var s=e[a],c=s.constructor._executionOrder;if(c>n)r=a-1;else if(c<n)o=a+1;else{var l=s._id;if(l>i)r=a-1;else{if(!(l<i))return a;o=a+1}}}return~o}function rN(e,t){for(var n=e.array,i=e.i+1;i<n.length;){var o=n[i];o.node._activeInHierarchy?++i:(e.removeAt(i),t&&(o._objFlags&=~t))}}fi.Flags.IsEditorOnEnableCalled;var aN=function(e){this._zero=void 0,this._neg=void 0,this._pos=void 0,this._invoke=void 0;var t=_e;this._zero=new t([]),this._neg=new t([]),this._pos=new t([]),this._invoke=e};function sN(e,t){return e.constructor._executionOrder-t.constructor._executionOrder}aN.stableRemoveInactive=rN;var cN=function(e){function t(){return e.apply(this,arguments)||this}ie(t,e);var n=t.prototype;return n.add=function(e){var t=e.constructor._executionOrder;(0===t?this._zero:t<0?this._neg:this._pos).array.push(e)},n.remove=function(e){var t=e.constructor._executionOrder;(0===t?this._zero:t<0?this._neg:this._pos).fastRemove(e)},n.cancelInactive=function(e){rN(this._zero,e),rN(this._neg,e),rN(this._pos,e)},n.invoke=function(){var e=this._neg;e.array.length>0&&(e.array.sort(sN),this._invoke(e),e.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var t=this._pos;t.array.length>0&&(t.array.sort(sN),this._invoke(t),t.array.length=0)},t}(aN),lN=function(e){function t(){return e.apply(this,arguments)||this}ie(t,e);var n=t.prototype;return n.add=function(e){var t=e.constructor._executionOrder;if(0===t)this._zero.array.push(e);else{var n=t<0?this._neg.array:this._pos.array,i=oN(n,e);i<0&&n.splice(~i,0,e)}},n.remove=function(e){var t=e.constructor._executionOrder;if(0===t)this._zero.fastRemove(e);else{var n=t<0?this._neg:this._pos,i=oN(n.array,e);i>=0&&n.removeAt(i)}},n.invoke=function(e){this._neg.array.length>0&&this._invoke(this._neg,e),this._invoke(this._zero,e),this._pos.array.length>0&&this._invoke(this._pos,e)},t}(aN);function uN(e,t,n){var i="var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];"+e+"}",o=t?Function("it","dt",i):Function("it",i);return function(e,t,n){return function(i,o){try{t(i,o)}catch(t){c._throw(t);var r=i.array;for(n&&(r[i.i]._objFlags|=n),++i.i;i.i<r.length;++i.i)try{e(r[i.i],o)}catch(e){c._throw(e),n&&(r[i.i]._objFlags|=n)}}}}(Function("c","dt",e),o,n)}var hN=uN("c.start();c._objFlags|="+nN,!1,nN),_N=uN("c.update(dt)",!0),fN=uN("c.lateUpdate(dt)",!0),dN=function(e){var t=c.director._compScheduler,n=e.array;for(e.i=0;e.i<n.length;++e.i){var i=n[e.i];i._enabled&&(i.onEnable(),!i.node._activeInHierarchy||t._onEnabled(i))}},pN=function(){function e(){this._deferredComps=[],this.unscheduleAll()}var t=e.prototype;return t.unscheduleAll=function(){this.startInvoker=new cN(hN),this.updateInvoker=new lN(_N),this.lateUpdateInvoker=new lN(fN),this._updating=!1},t._onEnabled=function(e){c.director.getScheduler().resumeTarget(e),e._objFlags|=iN,this._updating?this._deferredComps.push(e):this._scheduleImmediate(e)},t._onDisabled=function(e){c.director.getScheduler().pauseTarget(e),e._objFlags&=~iN;var t=this._deferredComps.indexOf(e);t>=0?tN(this._deferredComps,t):(!e.start||e._objFlags&nN||this.startInvoker.remove(e),e.update&&this.updateInvoker.remove(e),e.lateUpdate&&this.lateUpdateInvoker.remove(e))},t.enableComp=function(e,t){if(!(e._objFlags&iN)){if(e.onEnable){if(t)return void t.add(e);if(e.onEnable(),!e.node._activeInHierarchy)return}this._onEnabled(e)}},t.disableComp=function(e){e._objFlags&iN&&(e.onDisable&&e.onDisable(),this._onDisabled(e))},t.startPhase=function(){this._updating=!0,this.startInvoker.invoke(),this._startForNewComps()},t.updatePhase=function(e){this.updateInvoker.invoke(e)},t.lateUpdatePhase=function(e){this.lateUpdateInvoker.invoke(e),this._updating=!1,this._startForNewComps()},t._startForNewComps=function(){this._deferredComps.length>0&&(this._deferredSchedule(),this.startInvoker.invoke())},t._scheduleImmediate=function(e){"function"!=typeof e.start||e._objFlags&nN||this.startInvoker.add(e),"function"==typeof e.update&&this.updateInvoker.add(e),"function"==typeof e.lateUpdate&&this.lateUpdateInvoker.add(e)},t._deferredSchedule=function(){for(var e=this._deferredComps,t=0,n=e.length;t<n;t++)this._scheduleImmediate(e[t]);e.length=0},e}(),mN=fi.Flags.IsPreloadStarted,vN=fi.Flags.IsOnLoadStarted,gN=fi.Flags.IsOnLoadCalled,yN=fi.Flags.Deactivating,xN=function(e){function t(){return e.apply(this,arguments)||this}ie(t,e);var n=t.prototype;return n.add=function(e){this._zero.array.push(e)},n.remove=function(e){this._zero.fastRemove(e)},n.cancelInactive=function(e){aN.stableRemoveInactive(this._zero,e)},n.invoke=function(){this._invoke(this._zero),this._zero.array.length=0},t}(aN),SN=uN("c.__preload();"),EN=uN("c.onLoad();c._objFlags|="+gN,!1,gN),TN=new ot(4);function AN(e,t,n){t?e._removeComponent(t):rt.removeAt(e._components,n)}TN.get=function(){var e=this._get()||{preload:new xN(SN),onLoad:new cN(EN),onEnable:new cN(dN)};e.preload._zero.i=-1;var t=e.onLoad;return t._zero.i=-1,t._neg.i=-1,t._pos.i=-1,(t=e.onEnable)._zero.i=-1,t._neg.i=-1,t._pos.i=-1,e};var CN,wN,bN,IN,PN,RN,NN,ON,DN=e("fT",function(){function e(){this.resetComp=void 0,this.reset()}var t=e.prototype;return t.reset=function(){this._activatingStack=[]},t.activateNode=function(e,t){if(t){var n=TN.get();this._activatingStack.push(n),this._activateNodeRecursively(e,n.preload,n.onLoad,n.onEnable),n.preload.invoke(),n.onLoad.invoke(),n.onEnable.invoke(),this._activatingStack.pop(),TN.put(n)}else{this._deactivateNodeRecursively(e);for(var i,o=le(this._activatingStack);!(i=o()).done;){var r=i.value;r.preload.cancelInactive(mN),r.onLoad.cancelInactive(vN),r.onEnable.cancelInactive()}}e.emit("active-in-hierarchy-changed",e)},t.activateComp=function(e,t,n,i){if(pi(e,!0)&&(e._objFlags&mN||(e._objFlags|=mN,e.__preload&&(t?t.add(e):e.__preload())),e._objFlags&vN||(e._objFlags|=vN,e.onLoad?n?n.add(e):(e.onLoad(),e._objFlags|=gN):e._objFlags|=gN),e._enabled)){if(!e.node._activeInHierarchy)return;c.director._compScheduler.enableComp(e,i)}},t.destroyComp=function(e){c.director._compScheduler.disableComp(e),e.onDestroy&&e._objFlags&gN&&e.onDestroy()},t._activateNodeRecursively=function(e,t,n,i){if(e._objFlags&yN)N(3816,e.name);else{e._activeInHierarchy=!0;for(var o=e._components.length,r=0;r<o;++r){var a=e._components[r];a instanceof c.Component?this.activateComp(a,t,n,i):(AN(e,a,r),--r,--o)}e._childArrivalOrder=e._children.length;for(var s=0,l=e._children.length;s<l;++s){var u=e._children[s];u._active&&this._activateNodeRecursively(u,t,n,i)}e._onPostActivated(!0)}},t._deactivateNodeRecursively=function(e){e._objFlags|=yN,e._activeInHierarchy=!1;for(var t=e._components.length,n=0;n<t;++n){var i=e._components[n];if(i._enabled&&(c.director._compScheduler.disableComp(i),e._activeInHierarchy))return void(e._objFlags&=~yN)}for(var o=0,r=e._children.length;o<r;++o){var a=e._children[o];if(a._activeInHierarchy&&(this._deactivateNodeRecursively(a),e._activeInHierarchy))return void(e._objFlags&=~yN)}e._onPostActivated(!1),e._objFlags&=~yN},e}()),MN=e("fa",U_("cc.SceneAsset")((IN=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return ue(t=e.call.apply(e,[this].concat(i))||this,"scene",bN,se(t)),t}ie(t,e);var n=t.prototype;return n.initDefault=function(t){e.prototype.initDefault.call(this,t),this.scene=new $R("New Scene")},n.validate=function(){return!!this.scene},t}(Yf),bN=he((wN=IN).prototype,"scene",[$_,W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),CN=wN))||CN);c.SceneAsset=MN;var LN,FN,zN,BN,UN=e("ew",U_("cc.TextAsset")((ON=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return ue(t=e.call.apply(e,[this].concat(i))||this,"text",NN,se(t)),t}return ie(t,e),t.prototype.toString=function(){return this.text},t}(Yf),NN=he((RN=ON).prototype,"text",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),PN=RN))||PN);c.TextAsset=UN;var HN=e("fb",U_("cc.JsonAsset")((BN=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return ue(t=e.call.apply(e,[this].concat(i))||this,"json",zN,se(t)),t}return ie(t,e),t}(Yf),zN=he((FN=BN).prototype,"json",[W_,$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),LN=FN))||LN);c.JsonAsset=HN;var GN=e("c_",function(e){function t(){var t;return(t=e.call(this)||this)._compScheduler=void 0,t._nodeActivator=void 0,t._invalid=void 0,t._paused=void 0,t._purgeDirectorInNextLoop=void 0,t._root=void 0,t._loadingScene=void 0,t._scene=void 0,t._totalFrames=void 0,t._lastUpdate=void 0,t._deltaTime=void 0,t._startTime=void 0,t._scheduler=void 0,t._systems=void 0,t._invalid=!1,t._paused=!1,t._purgeDirectorInNextLoop=!1,t._root=null,t._loadingScene="",t._scene=null,t._totalFrames=0,t._lastUpdate=0,t._deltaTime=0,t._startTime=0,t._scheduler=new $b,t._compScheduler=new pN,t._nodeActivator=new DN,t._systems=[],c.game.once(Nw.EVENT_RENDERER_INITED,t._initOnRendererInitialized,se(t)),t}ie(t,e);var n=t.prototype;return n.calculateDeltaTime=function(e){e||(e=performance.now()),this._deltaTime=e>this._lastUpdate?(e-this._lastUpdate)/1e3:0,this._lastUpdate=e},n.convertToGL=function(e){var t=c.game.container,n=c.view,i=t.getBoundingClientRect(),o=i.left+window.pageXOffset-t.clientLeft,r=i.top+window.pageYOffset-t.clientTop,a=n._devicePixelRatio*(e.x-o),s=n._devicePixelRatio*(r+i.height-e.y);return n._isRotated?90==n._rotateAngle?Jn(n._viewportRect.width-s,a):Jn(s,n._viewportRect.height-a):Jn(a,s)},n.convertToUI=function(e){var t=c.game.container,n=c.view,i=t.getBoundingClientRect(),o=i.left+window.pageXOffset-t.clientLeft,r=i.top+window.pageYOffset-t.clientTop,a=Jn(0,0);return n._isRotated?90==n._rotateAngle?(a.x=o+e.y/n._devicePixelRatio,a.y=r+i.height-(n._viewportRect.width-e.x)/n._devicePixelRatio):(a.x=o+i.width-(n._viewportRect.height-e.y)/n._devicePixelRatio,a.y=r+e.x/n._devicePixelRatio):(a.x=o+e.x*n._devicePixelRatio,a.y=r+i.height-e.y*n._devicePixelRatio),a},n.end=function(){this._purgeDirectorInNextLoop=!0},n.getWinSize=function(){return ii(c.winSize)},n.getWinSizeInPixels=function(){return ii(c.winSize)},n.pause=function(){this._paused||(this._paused=!0)},n.purgeCachedData=function(){c.assetManager.releaseAll()},n.purgeDirector=function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),ov&&ov.setEnabled(!1),c.isValid(this._scene)&&this._scene.destroy(),this._scene=null,this.stopAnimation(),c.assetManager.releaseAll()},n.reset=function(){this.purgeDirector(),this.emit(t.EVENT_RESET),ov&&ov.setEnabled(!0),this.startAnimation()},n.runSceneImmediate=function(e,t,n){e instanceof MN&&(e=e.scene),M(e instanceof $R,1216),e._load();for(var i=Object.keys(c.game._persistRootNodes).map((function(e){return c.game._persistRootNodes[e]})),o=0;o<i.length;o++){var r=i[o];r.emit(c.Node.SCENE_CHANGED_FOR_PERSISTS,e.renderScene);var a=e.uuid===r._originalSceneId&&e.getChildByUuid(r.uuid);if(a){var s=a.getSiblingIndex();a._destroyImmediate(),e.insertChild(r,s)}else r.parent=e}var l=this._scene;c.isValid(l)&&l.destroy(),c.assetManager._releaseManager._autoRelease(l,e,c.game._persistRootNodes),this._scene=null,fi._deferredDestroy(),t&&t(),this.emit(c.Director.EVENT_BEFORE_SCENE_LAUNCH,e),this._scene=e,e._activate(),this._root&&this._root.resetCumulativeTime(),this.startAnimation(),n&&n(null,e),this.emit(c.Director.EVENT_AFTER_SCENE_LAUNCH,e)},n.runScene=function(e,t,n){var i=this;e instanceof MN&&(e=e.scene),M(e,1205),M(e instanceof $R,1216),e._load(),this.once(c.Director.EVENT_AFTER_DRAW,(function(){i.runSceneImmediate(e,t,n)}))},n.loadScene=function(e,t,n){var i=this;if(this._loadingScene)return P(1208,e,this._loadingScene),!1;var o=c.assetManager.bundles.find((function(t){return!!t.getSceneInfo(e)}));return o?(this.emit(c.Director.EVENT_BEFORE_SCENE_LOADING,e),this._loadingScene=e,console.time("LoadScene "+e),o.loadScene(e,(function(o,r){console.timeEnd("LoadScene "+e),i._loadingScene="",o?(x(o),t&&t(o)):i.runSceneImmediate(r,n,t)})),!0):(N(1209,e),!1)},n.preloadScene=function(e,t,n){var i=c.assetManager.bundles.find((function(t){return!!t.getSceneInfo(e)}));if(i)i.preloadScene(e,null,t,n);else{var o='Can not preload the scene "'+e+'" because it is not in the build settings.';n&&n(new Error(o)),x("preloadScene: "+o)}},n.resume=function(){this._paused&&(this._lastUpdate=performance.now(),this._lastUpdate||b(1200),this._paused=!1,this._deltaTime=0)},n.setDepthTest=function(e){c.Camera.main&&(c.Camera.main.depth=!!e)},n.setClearColor=function(e){c.Camera.main&&(c.Camera.main.backgroundColor=e)},n.getRunningScene=function(){return this._scene},n.getScene=function(){return this._scene},n.getAnimationInterval=function(){return 1e3/c.game.getFrameRate()},n.setAnimationInterval=function(e){c.game.setFrameRate(Math.round(1e3/e))},n.getDeltaTime=function(){return this._deltaTime},n.getTotalTime=function(){return performance.now()-this._startTime},n.getCurrentTime=function(){return this._lastUpdate},n.getTotalFrames=function(){return this._totalFrames},n.isPaused=function(){return this._paused},n.getScheduler=function(){return this._scheduler},n.setScheduler=function(e){this._scheduler!==e&&(this.unregisterSystem(this._scheduler),this._scheduler=e,this.registerSystem($b.ID,e,200))},n.registerSystem=function(e,t,n){t.id=e,t.priority=n,t.init(),this._systems.push(t),this._systems.sort(Yb.sortByPriority)},n.unregisterSystem=function(e){rt.fastRemove(this._systems,e),this._systems.sort(Yb.sortByPriority)},n.getSystem=function(e){return this._systems.find((function(t){return t.id===e}))},n.getAnimationManager=function(){return this.getSystem(c.AnimationManager.ID)},n.startAnimation=function(){this._invalid=!1,this._lastUpdate=performance.now()},n.stopAnimation=function(){this._invalid=!0},n.mainLoop=function(e){if(this._purgeDirectorInNextLoop)this._purgeDirectorInNextLoop=!1,this.purgeDirector();else if(!this._invalid){this.calculateDeltaTime(e);var n=this._deltaTime;if(!this._paused){this.emit(t.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(n);for(var i=0;i<this._systems.length;++i)this._systems[i].update(n);this._compScheduler.lateUpdatePhase(n),this.emit(t.EVENT_AFTER_UPDATE),fi._deferredDestroy();for(var o=0;o<this._systems.length;++o)this._systems[o].postUpdate(n)}this.emit(t.EVENT_BEFORE_DRAW),this._root.frameMove(this._deltaTime),this.emit(t.EVENT_AFTER_DRAW),ov.frameUpdateListeners(),My.resetHasChangedFlags(),My.clearNodeArray(),this._totalFrames++}},n._initOnRendererInitialized=function(){this._totalFrames=0,this._lastUpdate=performance.now(),this._startTime=this._lastUpdate,this._paused=!1,this._purgeDirectorInNextLoop=!1,ov&&ov.setEnabled(!0),this.registerSystem($b.ID,this._scheduler,200),this.emit(t.EVENT_INIT)},n._init=function(){return this._root=new tI(c.game._gfxDevice),this._root.initialize({}).catch((function(e){return N(1217),Promise.reject(e)}))},te(t,[{key:"root",get:function(){return this._root}}]),t}(Ni));GN.EVENT_INIT="director_init",GN.EVENT_RESET="director_reset",GN.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",GN.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",GN.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",GN.EVENT_BEFORE_UPDATE="director_before_update",GN.EVENT_AFTER_UPDATE="director_after_update",GN.EVENT_BEFORE_DRAW="director_before_draw",GN.EVENT_AFTER_DRAW="director_after_draw",GN.EVENT_BEFORE_COMMIT="director_before_commit",GN.EVENT_BEFORE_PHYSICS="director_before_physics",GN.EVENT_AFTER_PHYSICS="director_after_physics",GN.instance=void 0,c.Director=GN;var kN=e("cZ",GN.instance=c.director=new GN),VN=function(){function e(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new vf,this.scenes=new vf,this.paths=new vf}var t=e.prototype;return t.init=function(e){!function(e){var t=e.uuids,n=e.paths,i=e.types,o=e.deps,r=e.paths=Object.create(null);if(!1===e.debug){for(var a=0,s=t.length;a<s;a++)t[a]=Mf(t[a]);for(var c in n){var l=n[c],u=l[1];l[1]=i[u]}}else{for(var h=Object.create(null),_=0,f=t.length;_<f;_++){var d=t[_];t[_]=h[d]=Mf(d)}t=h}for(var p in n){var m=n[p];r[t[p]]=m}var v=e.scenes;for(var g in v){var y=v[g];v[g]=t[y]}var x=e.packs;for(var S in x)for(var E=x[S],T=0;T<E.length;++T)E[T]=t[E[T]];var A=e.versions;if(A)for(var C in A)for(var w=A[C],b=0;b<w.length;b+=2){var I=w[b];w[b]=t[I]||I}var P=e.redirect;if(P)for(var R=0;R<P.length;R+=2)P[R]=t[P[R]],P[R+1]=o[P[R+1]]}(e),this.importBase=e.importBase||"",this.nativeBase=e.nativeBase||"",this.base=e.base||"",this.name=e.name||"",this.deps=e.deps||[],this._initUuid(e.uuids),this._initPath(e.paths),this._initScene(e.scenes),this._initPackage(e.packs),this._initVersion(e.versions),this._initRedirect(e.redirect)},t.getInfoWithPath=function(e,t){if(!e)return null;e=Uf(e);var n=this.paths.get(e);if(n){if(!t)return n[0];for(var i=0,o=n.length;i<o;i++){var r=n[i];if(at.isChildClassOf(r.ctor,t))return r}}return null},t.getDirWithPath=function(e,t,n){"/"===(e=Uf(e))[e.length-1]&&(e=e.slice(0,-1));var i=n||[];return this.paths.forEach((function(n,o){if(o.startsWith(e)&&function(e,t){return!(e.length>t.length)||47===e.charCodeAt(t.length)}(o,e)||!e)for(var r=0,a=n.length;r<a;r++){var s=n[r];t&&!at.isChildClassOf(s.ctor,t)||i.push(s)}})),i},t.getAssetInfo=function(e){return this.assetInfos.get(e)||null},t.getSceneInfo=function(e){return e.endsWith(".scene")||(e+=".scene"),"/"===e[0]||e.startsWith("db://")||(e="/"+e),this.scenes.find((function(t,n){return n.endsWith(e)}))},t.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},t._initUuid=function(e){if(e){this.assetInfos.clear();for(var t=0,n=e.length;t<n;t++){var i=e[t];this.assetInfos.add(i,{uuid:i})}}},t._initPath=function(e){if(e){var t=this.paths;for(var n in t.clear(),e){var i=e[n],o=i[0],r=i[1],a=3===i.length,s=this.assetInfos.get(n);s.path=o,s.ctor=at._getClassById(r),t.has(o)?a?t.get(o).push(s):t.get(o).splice(0,0,s):t.add(o,[s])}}},t._initScene=function(e){if(e){var t=this.scenes;t.clear();var n=this.assetInfos;for(var i in e){var o=e[i],r=n.get(o);r.url=i,t.add(i,r)}}},t._initPackage=function(e){if(e){var t=this.assetInfos;for(var n in e){var i=e[n],o={uuid:n,packedUuids:i,ext:".json"};t.add(n,o);for(var r=0,a=i.length;r<a;r++){var s=i[r],c=t.get(s),l=c.packs;l?1===a?l.splice(0,0,o):l.push(o):c.packs=[o]}}}},t._initVersion=function(e){if(e){var t=this.assetInfos,n=e.import;if(n)for(var i=0,o=n.length;i<o;i+=2){var r=n[i];t.get(r).ver=n[i+1]}if(n=e.native)for(var a=0,s=n.length;a<s;a+=2){var c=n[a];t.get(c).nativeVer=n[a+1]}}},t._initRedirect=function(e){if(e)for(var t=this.assetInfos,n=0,i=e.length;n<i;n+=2){var o=e[n];t.get(o).redirect=e[n+1]}},e}();function WN(e,t){e._uuid&&t.push(e._uuid)}function jN(e,t){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i];if("node"!==o&&"__eventTargets"!==o){var r=e[o];if("object"==typeof r&&r)if(Array.isArray(r))for(var a=0;a<r.length;a++){var s=r[a];s instanceof Yf&&WN(s,t)}else if(r.constructor&&r.constructor!==Object)r instanceof Yf&&WN(r,t);else for(var c=Object.getOwnPropertyNames(r),l=0;l<c.length;l++){var u=r[c[l]];u instanceof Yf&&WN(u,t)}}}}function qN(e,t){for(var n=0;n<e._components.length;n++)jN(e._components[n],t);for(var i=0;i<e._children.length;i++)qN(e._children[i],t)}function YN(e,t,n,i){n.push(e._uuid);for(var o=gp.getDeps(e._uuid),r=0,a=o.length;r<a;r++){var s=xf.get(o[r]);if(s){var c=s._uuid;c in t?t[c]+=i:t[c]=s.refCount+i,n.includes(c)||YN(s,t,n,i)}}}var XN=[],KN=new(function(){function e(){this._persistNodeDeps=new vf,this._toDelete=new vf,this._eventListener=!1}var t=e.prototype;return t.init=function(){this._persistNodeDeps.clear(),this._toDelete.clear()},t._addPersistNodeRef=function(e){var t=[];qN(e,t);for(var n=0,i=t.length;n<i;n++){var o=xf.get(t[n]);o&&o.addRef()}this._persistNodeDeps.add(e.uuid,t)},t._removePersistNodeRef=function(e){if(this._persistNodeDeps.has(e.uuid)){for(var t=this._persistNodeDeps.get(e.uuid),n=0,i=t.length;n<i;n++){var o=xf.get(t[n]);o&&o.decRef()}this._persistNodeDeps.remove(e.uuid)}},t._autoRelease=function(e,t,n){if(e){for(var i=gp.getDeps(e.uuid),o=0,r=i.length;o<r;o++){var a=xf.get(i[o]);a&&a.decRef(e.autoReleaseAssets)}var s=gp._depends.get(e.uuid);if(s&&s.persistDeps)for(var c=s.persistDeps,l=0,u=c.length;l<u;l++){var h=xf.get(c[l]);h&&h.decRef(e.autoReleaseAssets)}e.uuid!==t.uuid&&gp.remove(e.uuid)}var _=gp._depends.get(t.uuid);for(var f in _&&(_.persistDeps=[]),n){for(var d,p,m=n[f],v=this._persistNodeDeps.get(m.uuid),g=le(v);!(p=g()).done;){var y=p.value,x=xf.get(y);x&&x.addRef()}_&&(d=_.persistDeps).push.apply(d,v)}},t.tryRelease=function(e,t){void 0===t&&(t=!1),e instanceof Yf&&(t?this._free(e,t):(this._toDelete.add(e._uuid,e),this._eventListener||(this._eventListener=!0,Tt(this._freeAssets.bind(this)))))},t._freeAssets=function(){var e=this;this._eventListener=!1,this._toDelete.forEach((function(t){e._free(t)})),this._toDelete.clear()},t._free=function(e,t){void 0===t&&(t=!1);var n=e._uuid;if(this._toDelete.remove(n),pi(e,!0)&&!(!t&&e.refCount>0&&function(e){var t=Object.create(null);if(t[e._uuid]=e.refCount,YN(e,t,XN,-1),XN.length=0,0!==t[e._uuid])return t[e._uuid];for(var n in t)0!==t[n]&&YN(xf.get(n),t,XN,1);return XN.length=0,t[e._uuid]}(e)>0)){xf.remove(n);for(var i=gp.getDeps(n),o=0,r=i.length;o<r;o++){var a=xf.get(i[o]);a&&(a.decRef(!1),this._free(a,!1))}e.destroy(),gp.remove(n)}},e}()),QN=null;function ZN(e,t){for(var n=0,i=e.input.length;n<i;n++){var o=e.input[n];t&&!o.isNative&&o.content instanceof Yf&&o.content.decRef(!1),o.recycle()}e.input=null}function JN(e,t){return t?/\?/.test(e)?e+"&_t="+Date.now():e+"?_t="+Date.now():e}function $N(e,t,n,i,o){void 0===o&&(o=0),e(o,(function(r,a){o++,!r||o>t?i&&i(r,a):setTimeout((function(){$N(e,t,n,i,o)}),n)}))}function eO(e,t,n,i,o){try{for(var r=gp.parse(e,t),a=0,s=r.deps.length;a<s;a++){var c=r.deps[a];c in n||(n[c]=!0,i.push({uuid:c,bundle:o&&o.name}))}r.nativeDep&&(o&&(r.nativeDep.bundle=o.name),i.push(ne({},r.nativeDep)))}catch(e){x(e.message,e.stack)}}function tO(e,t,n){t&&(n=void 0!==n?n:c.assetManager.cacheAsset,Bf(t)||!n||t.isDefault||xf.add(e,t))}function nO(e,t,n){var i=0,o=[],r=e.length;0===r&&n&&n(o);for(var a=function(e){e&&o.push(e),++i===r&&n&&n(o)},s=0;s<r;s++)t(e[s],a)}function iO(e,t,n){var i=e,o=t,r=n;if(void 0===n){var a="function"==typeof e;t?(r=t,a||(o=null)):void 0===t&&a&&(r=e,i=null,o=null),void 0!==t&&a&&(o=e,i=null)}return{options:i||Object.create(null),onProgress:o,onComplete:r}}function oO(e,t,n){var i=e,o=t,r=n;if(void 0===n){var a=at.isChildClassOf(e,Yf);t?(r=t,a&&(o=null)):void 0!==t||a||(r=e,o=null,i=null),void 0===t||a||(o=e,i=null)}return{type:i,onProgress:o||QN,onComplete:r}}function rO(e,t,n,i){if(void 0===i&&(i={}),!n[t]||i[t])return!1;i[t]=!0;var o=!1,r=gp.getDeps(t);if(r)for(var a=0,s=r.length;a<s;a++){var c=r[a];if(c===e||rO(e,c,n,i)){o=!0;break}}return o}function aO(e){return function(t,n){if(e){var i=[];Array.isArray(n)?n.forEach((function(e){return e instanceof Yf&&i.push(e.addRef())})):n instanceof Yf&&i.push(n.addRef()),Tt((function(){i.forEach((function(e){return e.decRef(!1)})),e(t,n)}))}}}var sO=function(){function e(){this._config=new VN}var t=e.prototype;return t.getInfoWithPath=function(e,t){return this._config.getInfoWithPath(e,t)},t.getDirWithPath=function(e,t,n){return this._config.getDirWithPath(e,t,n)},t.getAssetInfo=function(e){return this._config.getAssetInfo(e)},t.getSceneInfo=function(e){return this._config.getSceneInfo(e)},t.init=function(e){this._config.init(e),Tf.add(e.name,this)},t.load=function(e,t,n,i){var o=oO(t,n,i),r=o.type,a=o.onProgress,s=o.onComplete,l={__requestType__:yf.PATH,type:r,bundle:this.name,__outputAsArray__:Array.isArray(e)};c.assetManager.loadAny(e,l,a,s)},t.preload=function(e,t,n,i){var o=oO(t,n,i),r=o.type,a=o.onProgress,s=o.onComplete;c.assetManager.preloadAny(e,{__requestType__:yf.PATH,type:r,bundle:this.name},a,s)},t.loadDir=function(e,t,n,i){var o=oO(t,n,i),r=o.type,a=o.onProgress,s=o.onComplete;c.assetManager.loadAny(e,{__requestType__:yf.DIR,type:r,bundle:this.name,__outputAsArray__:!0},a,s)},t.preloadDir=function(e,t,n,i){var o=oO(t,n,i),r=o.type,a=o.onProgress,s=o.onComplete;c.assetManager.preloadAny(e,{__requestType__:yf.DIR,type:r,bundle:this.name},a,s)},t.loadScene=function(e,t,n,i){var o=iO(t,n,i),r=o.options,a=o.onProgress,s=o.onComplete;r.preset=r.preset||"scene",r.bundle=this.name,c.assetManager.loadAny({scene:e},r,a,(function(e,t){if(e)x(e.message,e.stack);else if(t instanceof MN&&t.scene){var n=t.scene;n._id=t._uuid,n.name=t.name}else e=new Error("The asset "+t._uuid+" is not a scene");s&&s(e,t)}))},t.preloadScene=function(e,t,n,i){var o=iO(t,n,i),r=o.options,a=o.onProgress,s=o.onComplete;r.bundle=this.name,c.assetManager.preloadAny({scene:e},r,a,(function(t){t&&N(1210,e,t.message),s&&s(t)}))},t.get=function(e,t){var n=this.getInfoWithPath(e,t);return n&&xf.get(n.uuid)||null},t.release=function(e,t){var n=this.get(e,t);n&&KN.tryRelease(n,!0)},t.releaseUnusedAssets=function(){var e=this;xf.forEach((function(t){var n=e.getAssetInfo(t._uuid);n&&!n.redirect&&KN.tryRelease(t)}))},t.releaseAll=function(){var e=this;xf.forEach((function(t){var n=e.getAssetInfo(t._uuid);n&&!n.redirect&&KN.tryRelease(t,!0)}))},t._destroy=function(){this._config.destroy()},te(e,[{key:"config",get:function(){return this._config}},{key:"name",get:function(){return this._config.name}},{key:"deps",get:function(){return this._config.deps}},{key:"base",get:function(){return this._config.base}}]),e}(),cO=e("fN",new sO);function lO(e,t,n){var i=new Image;function o(){i.removeEventListener("load",o),i.removeEventListener("error",r),n&&n(null,i)}function r(){i.removeEventListener("load",o),i.removeEventListener("error",r),n&&n(new Error(L(4930,e)))}return i.crossOrigin="anonymous",i.addEventListener("load",o),i.addEventListener("error",r),i.src=e,i}function uO(e,t,n,i){var o=new XMLHttpRequest,r="download failed: "+e+", status: ";if(o.open("GET",e,!0),void 0!==t.xhrResponseType&&(o.responseType=t.xhrResponseType),void 0!==t.xhrWithCredentials&&(o.withCredentials=t.xhrWithCredentials),void 0!==t.xhrMimeType&&o.overrideMimeType&&o.overrideMimeType(t.xhrMimeType),void 0!==t.xhrTimeout&&(o.timeout=t.xhrTimeout),t.xhrHeader)for(var a in t.xhrHeader)o.setRequestHeader(a,t.xhrHeader[a]);return o.onload=function(){200===o.status||0===o.status?i&&i(null,o.response):i&&i(new Error(""+r+o.status+"(no response)"))},n&&(o.onprogress=function(e){e.lengthComputable&&n(e.loaded,e.total)}),o.onerror=function(){i&&i(new Error(""+r+o.status+"(error)"))},o.ontimeout=function(){i&&i(new Error(""+r+o.status+"(time out)"))},o.onabort=function(){i&&i(new Error(""+r+o.status+"(abort)"))},o.send(null),o}c.resources=cO;var hO={};function _O(e,t,n){if(hO[e])return n&&n(null),null;var i=document.createElement("script");function o(){i.parentNode.removeChild(i),i.removeEventListener("load",o,!1),i.removeEventListener("error",r,!1),hO[e]=!0,n&&n(null)}function r(){i.parentNode.removeChild(i),i.removeEventListener("load",o,!1),i.removeEventListener("error",r,!1),n&&n(new Error(L(4928,e)))}return"file:"!==window.location.protocol&&(i.crossOrigin="anonymous"),i.async=t.scriptAsyncLoading||!1,i.src=e,i.addEventListener("load",o,!1),i.addEventListener("error",r,!1),document.body.appendChild(i),i}var fO=/^(?:\w+:\/\/|\.+\/).+/,dO=function(e,t,n){(jx.capabilities.imageBitmap&&c.assetManager.allowImageBitmap?pO:SO.downloadDomImage)(e,t,n)},pO=function(e,t,n){t.xhrResponseType="blob",SO.downloadFile(e,t,t.onFileProgress,n)},mO=function(e,t,n){t.xhrResponseType="json",SO.downloadFile(e,t,t.onFileProgress,n)},vO=function(e,t,n){t.xhrResponseType="arraybuffer",SO.downloadFile(e,t,t.onFileProgress,n)},gO=function(e,t,n){t.xhrResponseType="text",SO.downloadFile(e,t,t.onFileProgress,n)},yO=function(e,t,n){var i=Hi(e),o=e;fO.test(o)||(o=-1!==SO.remoteBundles.indexOf(i)?SO.remoteServerAddress+"remote/"+i:"assets/"+i);var r=t.version||SO.bundleVers[i],a=0,s=o+"/config."+(r?r+".":"")+"json",c=null,l=null;t.xhrResponseType="json",SO.downloadFile(s,t,t.onFileProgress,(function(e,t){l=e,(c=t)&&(c.base=o+"/"),2==++a&&n(l,c)}));var u=o+"/index."+(r?r+".":"")+"js";SO.downloadScript(u,t,(function(e){l=e,2==++a&&n(e,c)}))},xO=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(t=e.call.apply(e,[this].concat(o))||this).maxConcurrency=6,t.maxRequestsPerFrame=6,t.maxRetryCount=3,t.appendTimeStamp=!!i,t.limited=!i,t.retryInterval=2e3,t.bundleVers=null,t.remoteBundles=[],t.downloadDomImage=lO,t.downloadDomAudio=null,t.downloadAudio=void 0,t.downloadFile=uO,t.downloadScript=_O,t._downloaders={".png":dO,".jpg":dO,".bmp":dO,".jpeg":dO,".gif":dO,".ico":dO,".tiff":dO,".webp":dO,".image":dO,".pvr":vO,".pkm":vO,".astc":vO,".txt":gO,".xml":gO,".vsh":gO,".fsh":gO,".atlas":gO,".tmx":gO,".tsx":gO,".json":mO,".ExportJson":mO,".plist":gO,".fnt":gO,".binary":vO,".bin":vO,".dbbin":vO,".skel":vO,".js":t.downloadScript,bundle:yO,default:gO},t._downloading=new vf,t._queue=[],t._queueDirty=!1,t._totalNum=0,t._totalNumThisPeriod=0,t._lastDate=-1,t._checkNextPeriod=!1,t._remoteServerAddress="",t._maxInterval=1/30,t}ie(t,e);var n=t.prototype;return n.init=function(e,t,n){void 0===e&&(e=""),void 0===t&&(t={}),void 0===n&&(n=[]),this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=e,this.bundleVers=t,this.remoteBundles=n},n.register=function(e,t){"object"==typeof e?Ge(this._downloaders,e):this._downloaders[e]=t},n.download=function(e,t,n,i,o){var r=this,a=Sf.get(e);if(a)o(null,a);else{var s=this._downloading.get(e);if(s){s.push(o);var c=this._queue.find((function(t){return t.id===e}));if(!c)return;var l=i.priority||0;c.priority<l&&(c.priority=l,this._queueDirty=!0)}else{var u=void 0!==i.maxRetryCount?i.maxRetryCount:this.maxRetryCount,h=void 0!==i.maxConcurrency?i.maxConcurrency:this.maxConcurrency,_=void 0!==i.maxRequestsPerFrame?i.maxRequestsPerFrame:this.maxRequestsPerFrame,f=this._downloaders[n]||this._downloaders.default;$N((function(n,a){if(0===n&&r._downloading.add(e,[o]),r.limited){r._updateTime();var s=function(e,t){e&&r.emit("error",e),r._totalNum--,r._handleQueueInNextFrame(h,_),a(e,t)};r._totalNum<h&&r._totalNumThisPeriod<_?(f(JN(t,r.appendTimeStamp),i,s),r._totalNum++,r._totalNumThisPeriod++):(r._queue.push({id:e,priority:i.priority||0,url:t,options:i,done:s,handler:f}),r._queueDirty=!0,r._totalNum<h&&r._handleQueueInNextFrame(h,_))}else f(JN(t,r.appendTimeStamp),i,a)}),u,this.retryInterval,(function(t,n){t||Sf.add(e,n);for(var i=r._downloading.remove(e),o=0,a=i.length;o<a;o++)i[o](t,n)}))}}},n.loadSubpackage=function(e,t){c.assetManager.loadBundle(e,null,t)},n._updateTime=function(){var e=Date.now(),t=c.director.getDeltaTime(),n=t>this._maxInterval?this._maxInterval:t;e-this._lastDate>1e3*n&&(this._totalNumThisPeriod=0,this._lastDate=e)},n._handleQueue=function(e,t){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<e&&this._totalNumThisPeriod<t;){this._queueDirty&&(this._queue.sort((function(e,t){return e.priority-t.priority})),this._queueDirty=!1);var n=this._queue.pop();if(!n)break;this._totalNum++,this._totalNumThisPeriod++,n.handler(JN(n.url,this.appendTimeStamp),n.options,n.done)}this._handleQueueInNextFrame(e,t)},n._handleQueueInNextFrame=function(e,t){!this._checkNextPeriod&&this._queue.length>0&&(Tt(this._handleQueue.bind(this),e,t),this._checkNextPeriod=!0)},te(t,[{key:"remoteServerAddress",get:function(){return this._remoteServerAddress}}]),t}(Ni),SO=e("dB",new xO);function EO(e,t,n,i){var o=null,r=null;try{(o=new od)._nativeUrl=e,o._nativeAsset=t}catch(e){r=e}i(r,o)}function TO(e,t,n,i){var o=new HN;o.json=t,i(null,o)}function AO(e,t,n,i){var o=new UN;o.text=t,i(null,o)}function CO(e,t,n,i){var o=new aI;o._nativeUrl=e,o._nativeAsset=t,i(null,o)}function wO(e,t,n,i){var o=new Yf;o._nativeUrl=e,o._nativeAsset=t,i(null,o)}function bO(e,n,i,o){var r=Tf.get(n.name);r||(r=n.name===bf.RESOURCES?cO:new sO,n.base=n.base||e+"/",r.init(n)),t.import("virtual:///prerequisite-imports/"+r.name).then((function(){o(null,r)})).catch(o)}var IO=function(){function e(){this._creating=new vf,this._producers={".png":EO,".jpg":EO,".bmp":EO,".jpeg":EO,".gif":EO,".ico":EO,".tiff":EO,".webp":EO,".image":EO,".pvr":EO,".pkm":EO,".txt":AO,".xml":AO,".vsh":AO,".fsh":AO,".atlas":AO,".tmx":AO,".tsx":AO,".fnt":AO,".json":TO,".ExportJson":TO,".binary":CO,".bin":CO,".dbbin":CO,".skel":CO,bundle:bO,default:wO}}var t=e.prototype;return t.register=function(e,t){"object"==typeof e?at.mixin(this._producers,e):this._producers[e]=t},t.create=function(e,t,n,i,o){var r=this,a=this._producers[n]||this._producers.default,s=xf.get(e);if(i.reloadAsset||!s){var c=this._creating.get(e);c?c.push(o):(this._creating.add(e,[o]),a(e,t,i,(function(t,n){!t&&n instanceof Yf&&(n._uuid=e,tO(e,n,i.cacheAsset));for(var o=r._creating.remove(e),a=0,s=o.length;a<s;a++)o[a](t,n)})))}else o(null,s)},e}(),PO=e("dC",new IO),RO=new(function(){function e(){this._loading=new vf,this._unpackers={".json":this.unpackJson}}var t=e.prototype;return t.unpackJson=function(e,t,n,i){var o=at.createMap(!0),r=null;if(Array.isArray(t)){(t=function(e){if(e[0]<1)throw new Error(L(5304,e[0]));Ud(e,!0,void 0),Hd(e);for(var t=new jd(e[0]),n=e[1],i=e[2],o=e[3],r=e[4],a=e[5],s=0;s<a.length;++s)a[s].unshift(t,n,i,o,r);return a}(t)).length!==e.length&&N(4915);for(var a=0;a<e.length;a++)o[e[a]+"@import"]=t[a]}else{var s=at._getClassId(Mp),c=at._getClassId(od);if(t.type===s&&t.data){var l=t.data;l.length!==e.length&&N(4915);for(var u=0;u<e.length;u++)o[e[u]+"@import"]=qd(s,{base:l[u][0],mipmaps:l[u][1]})}else if(t.type===c&&t.data){var h=t.data;h.length!==e.length&&N(4915);for(var _=0;_<e.length;_++)o[e[_]+"@import"]=h[_]}else r=new Error("unmatched type pack!"),o=null}i(r,o)},t.init=function(){this._loading.clear()},t.register=function(e,t){"object"==typeof e?at.mixin(this._unpackers,e):this._unpackers[e]=t},t.unpack=function(e,t,n,i,o){t?(0,this._unpackers[n])(e,t,i,o):o(new Error("package data is wrong!"))},t.load=function(e,t,n){var i=this;if(!e.isNative&&e.info&&e.info.packs)if(Sf.has(e.id))n(null,Sf.get(e.id));else{var o=e.info.packs,r=o.find((function(e){return i._loading.has(e.uuid)}));if(r)this._loading.get(r.uuid).push({onComplete:n,id:e.id});else{r=o[0],this._loading.add(r.uuid,[{onComplete:n,id:e.id}]);var a=Hf(r.uuid,{ext:r.ext,bundle:e.config.name});SO.download(r.uuid,a,r.ext,e.options,(function(t,n){Sf.remove(r.uuid),t&&x(t.message,t.stack),i.unpack(r.packedUuids,n,r.ext,e.options,(function(e,n){if(!e)for(var o in n)Sf.add(o,n[o]);for(var a=i._loading.remove(r.uuid),s=0,c=a.length;s<c;s++){var l=a[s];if(t||e)l.onComplete(t||e);else{var u=n[l.id];u?l.onComplete(null,u):l.onComplete(new Error("can not retrieve data from package"))}}}))}))}}else SO.download(e.id,e.url,e.ext,e.options,n)},e}());function NO(e,t){var n=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},n=!0);var i=e.options,o=e.progress,r=[],a=o.total,s=i.__exclude__=i.__exclude__||Object.create(null);e.output=[],nO(e.input,(function(i,l){if(!i.isNative&&xf.has(i.uuid)){var u=xf.get(i.uuid);return i.content=u.addRef(),e.output.push(i),o.canInvoke&&e.dispatch("progress",++o.finish,o.total,i),void l()}RO.load(i,e.options,(function(u,h){u?e.isFinish||(!c.assetManager.force||n?(x(u.message,u.stack),o.canInvoke=!1,t(u)):(e.output.push(i),o.canInvoke&&e.dispatch("progress",++o.finish,o.total,i))):e.isFinish||(i.file=h,e.output.push(i),i.isNative||(s[i.uuid]=!0,eO(i.uuid,h,s,r,i.config),o.total=a+r.length),o.canInvoke&&e.dispatch("progress",++o.finish,o.total,i)),l()}))}),(function(){if(e.isFinish)return ZN(e,!0),void e.dispatch("error");if(r.length>0){var a=Pf.create({input:r,progress:o,options:i,onProgress:e.onProgress,onError:Pf.prototype.recycle,onComplete:function(i){var o;i||((o=e.output).push.apply(o,a.output),a.recycle()),n&&OO(e),t(i)}});Cf.async(a)}else n&&OO(e),t()}))}function OO(e){for(var t=e.output,n=0,i=t.length;n<i;n++)t[n].content&&t[n].content.decRef(!1)}var DO=new(function(e){function t(){return e.apply(this,arguments)||this}ie(t,e);var n=t.prototype;return n.parse=function(e){var t=this._parseXML(e).documentElement;if("plist"!==t.tagName)return P(5100),{};for(var n=null,i=0,o=t.childNodes.length;i<o&&1!==(n=t.childNodes[i]).nodeType;i++);return this._parseNode(n)},n._parseNode=function(e){var t=null,n=e.tagName;if("dict"===n)t=this._parseDict(e);else if("array"===n)t=this._parseArray(e);else if("string"===n)if(1===e.childNodes.length)t=e.firstChild.nodeValue;else{t="";for(var i=0;i<e.childNodes.length;i++)t+=e.childNodes[i].nodeValue}else"false"===n?t=!1:"true"===n?t=!0:"real"===n?t=parseFloat(e.firstChild.nodeValue):"integer"===n&&(t=parseInt(e.firstChild.nodeValue,10));return t},n._parseArray=function(e){for(var t=[],n=0,i=e.childNodes.length;n<i;n++){var o=e.childNodes[n];1===o.nodeType&&t.push(this._parseNode(o))}return t},n._parseDict=function(e){for(var t={},n="",i=0,o=e.childNodes.length;i<o;i++){var r=e.childNodes[i];1===r.nodeType&&("key"===r.tagName?n=r.firstChild.nodeValue:t[n]=this._parseNode(r))}return t},t}(e("eu",function(){function e(){this._parser=null,window.DOMParser&&(this._parser=new DOMParser)}var t=e.prototype;return t.parse=function(e){return this._parseXML(e)},t._parseXML=function(e){if(this._parser)return this._parser.parseFromString(e,"text/xml");throw new Error("Dom parser is not supported in this platform!")},e}())));function MO(e,t){return e[t]<<8|e[t+1]}var LO=new(function(){function e(){this._parsing=new vf,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".mp3":this.parseAudio,".ogg":this.parseAudio,".wav":this.parseAudio,".m4a":this.parseAudio,".plist":this.parsePlist,import:this.parseImport}}var t=e.prototype;return t.parseImage=function(e,t,n){e instanceof HTMLImageElement?n(null,e):createImageBitmap(e,{premultiplyAlpha:"none"}).then((function(e){n(null,e)}),(function(e){n(e,null)}))},t.parseAudio=function(e,t,n){e instanceof ArrayBuffer?jx.__audioSupport.context.decodeAudioData(e,(function(e){n(null,e)}),(function(e){n(new Error("Error with decoding audio data"+e.err),null)})):n(null,e)},t.parsePVRTex=function(e,t,n){var i=null,o=null;try{var r=e instanceof ArrayBuffer?e:e.buffer,a=new Int32Array(r,0,13);if(55727696===a[0]){var s=a[7],c=a[6],l=a[12]+52;o={_data:new Uint8Array(r,l),_compressed:!0,width:s,height:c,format:0}}else{if(559044176!==a[11])throw new Error("Invalid magic number in PVR header");var u=a[0],h=a[1],_=a[2];o={_data:new Uint8Array(r,u),_compressed:!0,width:_,height:h,format:0}}}catch(e){i=e}n(i,o)},t.parsePKMTex=function(e,t,n){var i=null,o=null;try{var r=e instanceof ArrayBuffer?e:e.buffer,a=new Uint8Array(r),s=MO(a,6);if(0!==s&&1!==s&&3!==s)throw new Error("Invalid magic number in ETC header");var c=MO(a,12),l=MO(a,14);MO(a,8),MO(a,10),o={_data:new Uint8Array(r,16),_compressed:!0,width:c,height:l,format:0}}catch(e){i=e}n(i,o)},t.parseASTCTex=function(e,t,n){var i=null,o=null;try{var r=e instanceof ArrayBuffer?e:e.buffer,a=new Uint8Array(r);if(1554098963!==a[0]+(a[1]<<8)+(a[2]<<16)+(a[3]<<24))throw new Error("Invalid magic number in ASTC header");var s=a[4],c=a[5],l=a[6];if((s<3||s>6||c<3||c>6||l<3||l>6)&&(s<4||7===s||9===s||11===s||s>12||c<4||7===c||9===c||11===c||c>12||1!==l))throw new Error("Invalid block number in ASTC header");var u=function(e,t){return 4===e?Xf.RGBA_ASTC_4x4:5===e?4===t?Xf.RGBA_ASTC_5x4:Xf.RGBA_ASTC_5x5:6===e?5===t?Xf.RGBA_ASTC_6x5:Xf.RGBA_ASTC_6x6:8===e?5===t?Xf.RGBA_ASTC_8x5:6===t?Xf.RGBA_ASTC_8x6:Xf.RGBA_ASTC_8x8:10===e?5===t?Xf.RGBA_ASTC_10x5:6===t?Xf.RGBA_ASTC_10x6:8===t?Xf.RGBA_ASTC_10x8:Xf.RGBA_ASTC_10x10:10===t?Xf.RGBA_ASTC_12x10:Xf.RGBA_ASTC_12x12}(s,c),h=a[7]+(a[8]<<8)+(a[9]<<16),_=a[10]+(a[11]<<8)+(a[12]<<16);a[13],a[14],a[15],o={_data:new Uint8Array(r,16),_compressed:!0,width:h,height:_,format:u}}catch(e){i=e}n(i,o)},t.parsePlist=function(e,t,n){var i=null,o=DO.parse(e);o||(i=new Error("parse failed")),n(i,o)},t.parseImport=function(e,t,n){if(e){var i=null,o=null;try{i=mp(e,t)}catch(e){o=e}n(o,i)}else n(new Error("The json file of asset "+t.__uuid__+" is empty or missing"))},t.init=function(){this._parsing.clear()},t.register=function(e,t){"object"==typeof e?Ge(this._parsers,e):this._parsers[e]=t},t.parse=function(e,t,n,i,o){var r=this,a=Ef.get(e);if(a)o(null,a);else{var s=this._parsing.get(e);if(s)s.push(o);else{var c=this._parsers[n];c?(this._parsing.add(e,[o]),c(t,i,(function(t,n){t?Sf.remove(e):Bf(n)||Ef.add(e,n);for(var i=r._parsing.remove(e),o=0,a=i.length;o<a;o++)i[o](t,n)}))):o(null,t)}}},e}());function FO(e,t){var n=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},n=!0);var i=e.options,o=e.progress;i.__exclude__=i.__exclude__||Object.create(null),e.output=[],nO(e.input,(function(r,a){var s=Pf.create({input:r,onProgress:e.onProgress,options:i,progress:o,onComplete:function(i,l){i&&!e.isFinish&&(!c.assetManager.force||n?(x(i.message,i.stack),o.canInvoke=!1,t(i)):o.canInvoke&&e.dispatch("progress",++o.finish,o.total,r)),e.output.push(l),s.recycle(),a(null)}});zO.async(s)}),(function(){if(i.__exclude__=null,e.isFinish)return ZN(e,!0),void e.dispatch("error");!function(e){var t=e.source;if(e.options.__outputAsArray__||1!==t.length)for(var n=e.output=[],i=0,o=t.length;i<o;i++)n.push(t[i].content);else e.output=t[0].content}(e),ZN(e,!0),t()}))}var zO=new gf("loadOneAsset",[function(e,t){var n=e.output=e.input,i=n.options,o=n.isNative,r=n.uuid,a=n.file,s=i.reloadAsset;a||!s&&!o&&xf.has(r)?t():RO.load(n,e.options,(function(e,i){n.file=i,t(e)}))},function(e,t){var n=e.output=e.input,i=e.progress,o=e.options.__exclude__,r=n.id,a=n.file,s=n.options;if(n.isNative)LO.parse(r,a,n.ext,s,(function(o,a){o?t(o):(n.content=a,i.canInvoke&&e.dispatch("progress",++i.finish,i.total,n),Sf.remove(r),Ef.remove(r),t())}));else{var c=n.uuid;if(c in o){var l=o[c],u=l.finish,h=l.content,_=l.err,f=l.callbacks;i.canInvoke&&e.dispatch("progress",++i.finish,i.total,n),u||rO(c,c,o)?(h&&h.addRef(),n.content=h,t(_)):f.push({done:t,item:n})}else if(!s.reloadAsset&&xf.has(c)){var d=xf.get(c);n.content=d.addRef(),i.canInvoke&&e.dispatch("progress",++i.finish,i.total,n),t()}else s.__uuid__=c,LO.parse(r,a,"import",s,(function(n,i){n?t(n):function(e,t,n){var i=e.input,o=e.progress,r=i,a=r.uuid,s=r.id,c=r.options,l=r.config,u=c.cacheAsset,h=[];t.addRef&&t.addRef(),eO(a,t,Object.create(null),h,l),o.canInvoke&&e.dispatch("progress",++o.finish,o.total+=h.length,i);var _=e.options.__exclude__[a]={content:t,finish:!1,callbacks:[{done:n,item:i}]},f=Pf.create({input:h,options:e.options,onProgress:e.onProgress,onError:Pf.prototype.recycle,progress:o,onComplete:function(e){if(t.decRef&&t.decRef(!1),_.finish=!0,_.err=e,!e){for(var n,i=Array.isArray(f.output)?f.output:[f.output],o=Object.create(null),r=le(i);!(n=r()).done;){var c=n.value;c&&(o[c instanceof Yf?c._uuid+"@import":a+"@native"]=c)}!function(e,t,n){var i=t.__depends__;if(i){for(var o=0,r=i.length;o<r;o++){var a=i[o],s=n[a.uuid+"@import"];if(s)a.owner[a.prop]=s.addRef();else{if(x("The asset "+a.uuid+" is missing!"),a.type&&a.type!==Yf){var c=new a.type;c.initDefault(a.uuid),a.owner[a.prop]=c}!0}}t.__depends__=null}t.__nativeDepend__&&(n[e+"@native"]?t._nativeAsset=n[e+"@native"]:(!0,console.error("the native asset of "+e+" is missing!")),t.__nativeDepend__=!1)}(a,t,o);try{"function"!=typeof t.onLoaded||t.__onLoadedInvoked__||t.__nativeDepend__||(t.onLoaded(),t.__onLoadedInvoked__=!0)}catch(e){x("The asset "+a+" is invalid for some reason, detail message: "+e.message+", stack: "+e.stack)}Sf.remove(s),Ef.remove(s),tO(a,t,u),f.recycle()}for(var l=_.callbacks,h=0,d=l.length;h<d;h++){var p=l[h];t.addRef&&t.addRef(),p.item.content=t,p.done(e)}l.length=0}});Af.async(f)}(e,i,t)}))}}]);function BO(e,t){var n=e.options,i=Object.create(null),o=Object.create(null);for(var r in n)switch(r){case yf.PATH:case yf.UUID:case yf.DIR:case yf.SCENE:case yf.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":i[r]=n[r];break;case"__exclude__":case"__outputAsArray__":o[r]=n[r];break;default:i[r]=n[r],o[r]=n[r]}e.options=o;var a=Pf.create({input:e.input,options:i}),s=null;try{e.output=e.source=wf.sync(a)}catch(e){s=e;for(var c=0,l=a.output.length;c<l;c++)a.output[c].recycle()}a.recycle(),t(s)}var UO=function(){function e(){this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}return e.create=function(){return 0!==e._deadPool.length?e._deadPool.pop():new e},e.prototype.recycle=function(){e._deadPool.length!==e.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),e._deadPool.push(this))},te(e,[{key:"id",get:function(){return this._id||(this._id=this.uuid+"@"+(this.isNative?"native":"import")),this._id}}]),e}();UO.MAX_DEAD_NUM=500,UO._deadPool=[];var HO=[];function GO(e){var t=e.options,n=Array.isArray(e.input)?e.input:[e.input];e.output=[];for(var i=function(i){var o=n[i],r=UO.create(),a=null,s=null;if("string"==typeof o&&((o=Object.create(null))[t.__requestType__||yf.UUID]=n[i]),"object"==typeof o)for(var c in He(o,t),o.preset&&He(o,If[o.preset]),o){switch(c){case yf.UUID:if("break"===function(){var e=r.uuid=Mf(o.uuid);if(!o.bundle){var t=Tf.find((function(t){return!!t.getAssetInfo(e)}));o.bundle=t&&t.name}if(Tf.has(o.bundle)){if(a=Tf.get(o.bundle).config,(s=a.getAssetInfo(e))&&s.redirect){if(!Tf.has(s.redirect))throw new Error("Please load bundle "+s.redirect+" first");a=Tf.get(s.redirect).config,s=a.getAssetInfo(e)}r.config=a,r.info=s}return r.ext=o.ext||".json","break"}())break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case yf.DIR:if(Tf.has(o.bundle)){Tf.get(o.bundle).config.getDirWithPath(o.dir,o.type,HO);for(var l,u=le(HO);!(l=u()).done;){var h=l.value;n.push({uuid:h.uuid,__isNative__:!1,ext:".json",bundle:o.bundle})}HO.length=0}r.recycle(),r=null;break;case yf.PATH:if(Tf.has(o.bundle)){if(a=Tf.get(o.bundle).config,(s=a.getInfoWithPath(o.path,o.type))&&s.redirect){if(!Tf.has(s.redirect))throw new Error("you need to load bundle "+s.redirect+" first");a=Tf.get(s.redirect).config,s=a.getAssetInfo(s.uuid)}if(!s)throw r.recycle(),new Error("Bundle "+o.bundle+" doesn't contain "+o.path);r.config=a,r.uuid=s.uuid,r.info=s}r.ext=o.ext||".json";break;case yf.SCENE:if(!o.bundle){var _=Tf.find((function(e){return!!e.getSceneInfo(o.scene)}));o.bundle=_&&_.name}if(Tf.has(o.bundle)){if(a=Tf.get(o.bundle).config,(s=a.getSceneInfo(o.scene))&&s.redirect){if(!Tf.has(s.redirect))throw new Error("you need to load bundle "+s.redirect+" first");a=Tf.get(s.redirect).config,s=a.getAssetInfo(s.uuid)}if(!s)throw r.recycle(),new Error("Bundle "+a.name+" doesn't contain scene "+o.scene);r.config=a,r.uuid=s.uuid,r.info=s}break;case"__isNative__":r.isNative=o.__isNative__;break;case yf.URL:r.url=o.url,r.uuid=o.uuid||o.url,r.ext=o.ext||Bi(o.url),r.isNative=void 0===o.__isNative__||o.__isNative__;break;default:r.options[c]=o[c]}if(!r)break}if(!r)return"continue";if(e.output.push(r),!r.uuid&&!r.url)throw new Error("Can not parse this input:"+JSON.stringify(o))},o=0;o<n.length;o++)i(o);return null}function kO(e){for(var t=e.output=e.input,n=0;n<t.length;n++){var i=t[n];if(!i.url){var o,r,a=i.config;r=i.isNative?a&&a.nativeBase?a.base+a.nativeBase:c.assetManager.generalNativeBase:a&&a.importBase?a.base+a.importBase:c.assetManager.generalImportBase;var s=i.uuid,l="";i.info&&(l=i.isNative?i.info.nativeVer?"."+i.info.nativeVer:"":i.info.ver?"."+i.info.ver:""),o=".ttf"===i.ext?r+"/"+s.slice(0,2)+"/"+s+l+"/"+i.options.__nativeName__:r+"/"+s.slice(0,2)+"/"+s+l+i.ext,i.url=o}}return null}var VO=e("fM",function(){function e(){this.pipeline=Af.append(BO).append(FO),this.fetchPipeline=Cf.append(BO).append(NO),this.transformPipeline=wf.append(GO).append(kO),this.bundles=Tf,this.assets=xf,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=gp,this.force=!1,this.allowImageBitmap=!jx.isMobile,this.utils=jf,this.downloader=SO,this.parser=LO,this.packManager=RO,this.cacheAsset=!0,this.cacheManager=null,this.presets=If,this.factory=PO,this.preprocessPipe=BO,this.fetchPipe=NO,this.loadPipe=FO,this.references=null,this._releaseManager=KN,this._files=Sf,this._parsed=Ef,this._parsePipeline=null}var t=e.prototype;return t.init=function(e){void 0===e&&(e={}),this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(e.server,e.bundleVers,e.remoteBundles),this.parser.init(),this.dependUtil.init();var t=e.importBase||"";t&&t.endsWith("/")&&(t=t.substr(0,t.length-1));var n=e.nativeBase||"";n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),this.generalImportBase=t,this.generalNativeBase=n},t.getBundle=function(e){return Tf.get(e)||null},t.removeBundle=function(e){e._destroy(),Tf.remove(e.name)},t.loadAny=function(e,t,n,i){var o=iO(t,n,i),r=o.options,a=o.onProgress,s=o.onComplete;r.preset=r.preset||"default",e=Array.isArray(e)?e.slice():e;var c=Pf.create({input:e,onProgress:a,onComplete:aO(s),options:r});Af.async(c)},t.preloadAny=function(e,t,n,i){var o=iO(t,n,i),r=o.options,a=o.onProgress,s=o.onComplete;r.preset=r.preset||"preload",e=Array.isArray(e)?e.slice():e;var c=Pf.create({input:e,onProgress:a,onComplete:aO(s),options:r});Cf.async(c)},t.postLoadNative=function(e,t,n){var i=iO(t,void 0,n),o=i.options,r=i.onComplete;if(e._native&&e.__nativeDepend__){var a=gp.getNativeDep(e._uuid);if(a){if(!Tf.has(a.bundle)){var s=Tf.find((function(t){return!!t.getAssetInfo(e._uuid)}));s&&(a.bundle=s.name)}this.loadAny(a,o,(function(t,n){t?x(t.message,t.stack):e.isValid&&e.__nativeDepend__&&(e._nativeAsset=n,e.__nativeDepend__=!1),r&&r(t)}))}}else aO(r)(null)},t.loadRemote=function(e,t,n){var i=iO(t,void 0,n),o=i.options,r=i.onComplete;o.reloadAsset||!this.assets.has(e)?(o.__isNative__=!0,o.preset=o.preset||"remote",this.loadAny({url:e},o,null,(function(t,n){t?(x(t.message,t.stack),r&&r(t,n)):PO.create(e,n,o.ext||Bi(e),o,(function(e,t){r&&r(e,t)}))}))):aO(r)(null,this.assets.get(e))},t.loadBundle=function(e,t,n){var i=iO(t,void 0,n),o=i.options,r=i.onComplete,a=Hi(e);this.bundles.has(a)?aO(r)(null,this.getBundle(a)):(o.preset=o.preset||"bundle",o.ext="bundle",o.__isNative__=!0,this.loadAny({url:e},o,null,(function(t,n){t?(x(t.message,t.stack),r&&r(t,n)):PO.create(e,n,"bundle",o,(function(e,t){r&&r(e,t)}))})))},t.releaseAsset=function(e){KN.tryRelease(e,!0)},t.releaseUnusedAssets=function(){xf.forEach((function(e){KN.tryRelease(e)}))},t.releaseAll=function(){xf.forEach((function(e){KN.tryRelease(e,!0)}))},t.loadWithJson=function(){throw new Error("Only valid in Editor")},te(e,[{key:"main",get:function(){return Tf.get(bf.MAIN)||null}},{key:"resources",get:function(){return Tf.get(bf.RESOURCES)||null}}]),e}());VO.Pipeline=gf,VO.Task=Pf,VO.Cache=vf,VO.RequestItem=UO,VO.Bundle=sO,VO.BuiltinBundleName=bf;var WO=e("dj",c.assetManager=new VO);c.AssetManager=VO;var jO=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm",".astc"],qO=[".mp3",".ogg",".wav",".m4a"];function YO(){return!0}var XO={transformURL:function(e){var t=Ff(e);if(!t)return e;var n=Tf.find((function(e){return!!e.getAssetInfo(t)}));if(!n)return e;var i,o=n.getAssetInfo(t);if(!(i=e.startsWith(n.base+n.config.nativeBase)?o.nativeVer||"":o.ver||"")||-1!==e.indexOf(i))return e;var r=!1;if(".ttf"===Bi(e)&&(r=!0),r){var a=Gi(e),s=Hi(e);e=a+"."+i+"/"+s}else e=e.replace(/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/,(function(e){return e+"."+i}));return e}},KO=e("fO",function(){function e(){this._autoReleaseSetting=Object.create(null),this._parseLoadResArgs=oO}var t=e.prototype;return t.load=function(e,t,n){void 0===n&&void 0!==t&&(n=t,t=null);for(var i=Array.isArray(e)?e:[e],o=0;o<i.length;o++){var r=i[o];"string"==typeof r?i[o]={url:r,__isNative__:!0}:(r.type&&(r.ext="."+r.type,r.type=void 0),r.url&&(r.__isNative__=!0))}var a=[],s=[];WO.loadAny(i,null,(function(e,n,i){i.content&&(jO.includes(i.ext)?a.push(i.content):qO.includes(i.ext)&&s.push(i.content)),t&&t(e,n,i)}),(function(e,t){var o=null;if(!e){t=Array.isArray(t)?t:[t];for(var r=function(e){var n=t[e];if(!(n instanceof Yf)){var o=n,r=i[e].url;a.includes(o)?PO.create(r,n,".png",{},(function(n,i){o=t[e]=i})):s.includes(o)&&PO.create(r,n,".mp3",{},(function(n,i){o=t[e]=i})),xf.add(r,o)}},c=0;c<t.length;c++)r(c);if(t.length>1){var l=Object.create(null);t.forEach((function(e){l[e._uuid]=e})),o={isCompleted:YO,_map:l}}else o=t[0]}n&&n(e,o)}))},t.getXMLHttpRequest=function(){return new XMLHttpRequest},t.getItem=function(e){return WO.assets.has(e)?{content:WO.assets.get(e)}:null},t.loadRes=function(e,t,n,i){var o=this._parseLoadResArgs(t,n,i),r=o.type,a=o.onProgress,s=o.onComplete,c=Bi(e);c&&!cO.getInfoWithPath(e,r)&&(e=e.slice(0,-c.length)),cO.load(e,r,a,s)},t.loadResArray=function(e,t,n,i){var o=this._parseLoadResArgs(t,n,i),r=o.type,a=o.onProgress,s=o.onComplete;e.forEach((function(t,n){var i=Bi(t);i&&!cO.getInfoWithPath(t,r)&&(e[n]=t.slice(0,-i.length))})),cO.load(e,r,a,s)},t.loadResDir=function(e,t,n,i){var o=this._parseLoadResArgs(t,n,i),r=o.type,a=o.onProgress,s=o.onComplete;cO.loadDir(e,r,a,(function(t,n){var i=[];t||(i=cO.getDirWithPath(e,r).map((function(e){return e.path}))),s&&s(t,n,i)}))},t.getRes=function(e,t){return xf.has(e)?xf.get(e):cO.get(e,t)},t.getResCount=function(){return xf.count},t.getDependsRecursively=function(e){if(!e)return[];var t="string"==typeof e?e:e._uuid;return gp.getDepsRecursively(t).concat([t])},t.addDownloadHandlers=function(e){var t=Object.create(null),n=function(n){var i=e[n];t["."+n]=function(e,t,n){i({url:e},n)}};for(var i in e)n(i);SO.register(t)},t.addLoadHandlers=function(e){var t=Object.create(null),n=function(n){var i=e[n];t["."+n]=function(e,t,n){i({content:e},n)}};for(var i in e)n(i);LO.register(t)},t.release=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var n=e[t];"string"==typeof n&&(n=xf.get(n)),WO.releaseAsset(n)}else e&&("string"==typeof e&&(e=xf.get(e)),WO.releaseAsset(e))},t.releaseAsset=function(e){WO.releaseAsset(e)},t.releaseRes=function(e,t){cO.release(e,t)},t.releaseAll=function(){WO.releaseAll(),xf.clear()},t.removeItem=function(e){return!!xf.remove(e)},t.setAutoRelease=function(e,t){"object"==typeof e&&(e=e._uuid),this._autoReleaseSetting[e]=!!t},t.setAutoReleaseRecursively=function(e,t){"object"==typeof e&&(e=e._uuid),t=!!t,this._autoReleaseSetting[e]=t;for(var n=gp.getDepsRecursively(e),i=0;i<n.length;i++)this._autoReleaseSetting[n[i]]=t},t.isAutoRelease=function(e){return"object"==typeof e&&(e=e._uuid),!!this._autoReleaseSetting[e]},te(e,[{key:"onProgress",set:function(e){QN=e}},{key:"_cache",get:function(){return xf._map}},{key:"md5Pipe",get:function(){return XO}},{key:"downloader",get:function(){return SO}},{key:"loader",get:function(){return WO.parser}}]),e}()),QO=e("fP",new KO),ZO=e("fQ",{init:function(e){e.importBase=e.libraryPath,e.nativeBase=e.rawAssetsBase,WO.init(e),e.rawAssets&&cO.init({base:"",deps:[],scenes:{},redirect:[],debug:!0,packs:{},types:[],versions:{import:[],native:[]},name:bf.RESOURCES,importBase:e.importBase,nativeBase:e.nativeBase,paths:e.rawAssets.assets,uuids:Object.keys(e.rawAssets.assets)})},loadAsset:function(e,t){WO.loadAny(e,t)}}),JO=e("fR",{});q(JO,"url",[{name:"normalize",target:WO.utils,targetName:"assetManager.utils",newName:"normalize"},{name:"raw",targetName:"Asset.prototype",newName:"nativeUrl",customFunction:function(e){return e.startsWith("resources/")?Hf({path:ki(e.substr(10)),bundle:bf.RESOURCES,__isNative__:!0,ext:Bi(e)}):""}}]),Y(ZO,"AssetLibrary",[{name:"getLibUrlNoExt",suggest:"AssetLibrary.getLibUrlNoExt was removed, if you want to transform url, please use cc.assetManager.utils.getUrlWithUuid instead"},{name:"queryAssetInfo",suggest:"AssetLibrary.queryAssetInfo was removed"}]),Y(QO,"loader",[{name:"releaseResDir",suggest:"loader.releaseResDir was removed, please use assetManager.releaseAsset instead"},{name:"flowInDeps",suggest:"loader.flowInDeps was removed"},{name:"assetLoader",suggest:"cc.loader.assetLoader was removed, assetLoader and md5Pipe were merged into cc.assetManager.transformPipeline"}]),q(c,"cc",[{name:"loader",newName:"assetManager",logTimes:1,customGetter:function(){return QO}},{name:"AssetLibrary",newName:"assetManager",logTimes:1,customGetter:function(){return ZO}},{name:"Pipeline",target:VO,targetName:"AssetManager",newName:"Pipeline",logTimes:1},{name:"url",targetName:"assetManager",newName:"utils",logTimes:1,customGetter:function(){return JO}}]),Y(c,"cc",[{name:"LoadingItems",suggest:L(1400,"cc.LoadingItems","cc.AssetManager.Task")}]),q(ft,"macro",[{name:"DOWNLOAD_MAX_CONCURRENT",target:SO,targetName:"assetManager.downloader",newName:"maxConcurrency"}]),q(kN,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:function(e){var t;return WO.main?null===(t=WO.main.getSceneInfo(e))||void 0===t?void 0:t.uuid:""}}]),q(Ow,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:function(){var e=[];return WO.main&&WO.main.config.scenes.forEach((function(t){e.push(t)})),e}}]);var $O,eD,tD,nD,iD,oD,rD,aD,sD,cD,lD,uD,hD,_D,fD=KN._autoRelease;KN._autoRelease=function(e,t,n){fD.call(KN,e,t,n);for(var i=QO._autoReleaseSetting,o=Object.keys(i),r=0;r<o.length;r++){var a=o[r];if(!0===i[a]){var s=xf.get(a);s&&KN.tryRelease(s)}}};var dD,pD,mD,vD,gD,yD,xD,SD,ED,TD,AD,CD,wD,bD,ID,PD,RD,ND,OD,DD,MD,LD,FD,zD,BD,UD,HD,GD,kD,VD,WD,jD,qD,YD,XD,KD,QD,ZD,JD,$D,eM,tM,nM,iM,oM,rM,aM,sM,cM,lM,uM,hM,_M,fM,dM,pM,mM,vM,gM,yM,xM,SM,EM,TM,AM,CM,wM,bM=e("dD",($O=U_("cc.ClickEvent"),eD=pf(c.Node),tD=nf(),nD=nf(),iD=nf(),oD=nf(),$O((_D=function(){function e(){ue(this,"target",sD,this),ue(this,"component",cD,this),ue(this,"_componentId",lD,this),ue(this,"handler",uD,this),ue(this,"customEventData",hD,this)}e.emitEvents=function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];for(var r=0,a=t.length;r<a;r++){var s=t[r];s instanceof e&&s.emit(i)}};var t=e.prototype;return t.emit=function(e){var t=this.target;if(c.isValid(t)){this._genCompIdIfNeeded();var n=c.js._getClassById(this._componentId),i=t.getComponent(n);if(c.isValid(i)){var o=i[this.handler];"function"==typeof o&&(null!=this.customEventData&&""!==this.customEventData&&(e=e.slice()).push(this.customEventData),o.apply(i,e))}}},t._compName2Id=function(e){var t=c.js.getClassByName(e);return c.js._getClassId(t)},t._compId2Name=function(e){var t=c.js._getClassById(e);return c.js.getClassName(t)},t._genCompIdIfNeeded=function(){this._componentId||(this._componentName=this.component,this.component="")},te(e,[{key:"_componentName",get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(e){this._componentId=this._compName2Id(e)}}]),e}(),sD=he((aD=_D).prototype,"target",[W_,eD,tD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cD=he(aD.prototype,"component",[W_,$_,nD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),lD=he(aD.prototype,"_componentId",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),uD=he(aD.prototype,"handler",[W_,$_,iD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),hD=he(aD.prototype,"customEventData",[W_,$_,oD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),rD=aD))||rD));c.Component.EventHandler=bM;var IM,PM,RM,NM,OM,DM,MM,LM,FM,zM,BM=new Rn,UM=ct(h_),HM=ct(u_),GM=ct(__),kM=ct(d_),VM=ct(f_),WM=ct({SKYBOX:b_|_s.DEPTH_STENCIL,SOLID_COLOR:_s.ALL,DEPTH_ONLY:_s.DEPTH_STENCIL,DONT_CLEAR:_s.NONE}),jM=e("de",(dD=U_("cc.Camera"),pD=J_(),mD=X_(),vD=lf(),gD=nf(),yD=pf(qu.BitMask),xD=lf(),SD=nf(),ED=pf(WM),TD=lf(),AD=nf(),CD=lf(),wD=nf(),bD=lf(),ID=nf(),PD=lf(),RD=nf(),ND=pf(UM),OD=lf(),DD=nf(),MD=pf(HM),LD=lf(),FD=nf(),zD=lf(),BD=nf(),UD=lf(),HD=nf(),GD=lf(),kD=nf(),VD=lf(),WD=nf(),jD=pf(GM),qD=lf(),YD=nf(),XD=pf(kM),KD=lf(),QD=nf(),ZD=pf(VM),JD=lf(),$D=nf(),eM=lf(),tM=nf(),nM=pf(GS),iM=lf(),oM=nf(),dD(rM=pD(rM=mD(rM=Y_((wM=CM=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return ue(t=e.call.apply(e,[this].concat(i))||this,"_projection",sM,se(t)),ue(t,"_priority",cM,se(t)),ue(t,"_fov",lM,se(t)),ue(t,"_fovAxis",uM,se(t)),ue(t,"_orthoHeight",hM,se(t)),ue(t,"_near",_M,se(t)),ue(t,"_far",fM,se(t)),ue(t,"_color",dM,se(t)),ue(t,"_depth",pM,se(t)),ue(t,"_stencil",mM,se(t)),ue(t,"_clearFlags",vM,se(t)),ue(t,"_rect",gM,se(t)),ue(t,"_aperture",yM,se(t)),ue(t,"_shutter",xM,se(t)),ue(t,"_iso",SM,se(t)),ue(t,"_screenScale",EM,se(t)),ue(t,"_visibility",TM,se(t)),ue(t,"_targetTexture",AM,se(t)),t._camera=null,t._inEditorMode=!1,t._flows=void 0,t}ie(t,e);var n=t.prototype;return n.onLoad=function(){this._createCamera()},n.onEnable=function(){this.node.hasChangedFlags|=x_.POSITION,this._camera&&this._attachToScene()},n.onDisable=function(){this._camera&&this._detachFromScene()},n.onDestroy=function(){this._camera&&(this._camera.destroy(),this._camera=null),this._targetTexture&&this._targetTexture.off("resize")},n.screenPointToRay=function(e,t,n){return n||(n=Ta.create()),this._camera&&this._camera.screenPointToRay(n,e,t),n},n.worldToScreen=function(e,t){return t||(t=new Rn),this._camera&&this._camera.worldToScreen(t,e),t},n.screenToWorld=function(e,t){return t||(t=this.node.getWorldPosition()),this._camera&&this._camera.screenToWorld(t,e),t},n.convertToUINode=function(e,t,n){if(n||(n=new Rn),!this._camera)return n;this.worldToScreen(e,BM);var i=t.getComponent("cc.UITransform"),o=Uw.getVisibleSize(),r=BM.x-.5*this._camera.width,a=BM.y-.5*this._camera.height;return BM.x=r/c.view.getScaleX()+.5*o.width,BM.y=a/c.view.getScaleY()+.5*o.height,i&&i.convertToNodeSpaceAR(BM,n),n},n._createCamera=function(){this._camera||(this._camera=c.director.root.createCamera(),this._camera.initialize({name:this.node.name,node:this.node,projection:this._projection,window:this._inEditorMode?c.director.root&&c.director.root.mainWindow:c.director.root&&c.director.root.tempWindow,priority:this._priority}),this._camera.viewport=this._rect,this._camera.fovAxis=this._fovAxis,this._camera.fov=fn(this._fov),this._camera.orthoHeight=this._orthoHeight,this._camera.nearClip=this._near,this._camera.farClip=this._far,this._camera.clearColor=this._color,this._camera.clearDepth=this._depth,this._camera.clearStencil=this._stencil,this._camera.clearFlag=this._clearFlags,this._camera.visibility=this._visibility,this._camera.aperture=this._aperture,this._camera.shutter=this._shutter,this._camera.iso=this._iso),this._updateTargetTexture()},n._attachToScene=function(){this.node.scene&&this._camera&&(this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera),this._getRenderScene().addCamera(this._camera))},n._detachFromScene=function(){this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera)},n._chechTargetTextureEvent=function(e){var t=this;e&&e.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(function(e){t._camera&&t._camera.setFixedSize(e.width,e.height)}),this)},n._updateTargetTexture=function(){if(this._camera&&this._targetTexture){var e=this._targetTexture.window;this._camera.changeTargetWindow(e),this._camera.setFixedSize(e.width,e.height)}},te(t,[{key:"camera",get:function(){return this._camera}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e,this._camera&&(this._camera.priority=e)}},{key:"visibility",get:function(){return this._visibility},set:function(e){this._visibility=e,this._camera&&(this._camera.visibility=e)}},{key:"clearFlags",get:function(){return this._clearFlags},set:function(e){this._clearFlags=e,this._camera&&(this._camera.clearFlag=e)}},{key:"clearColor",get:function(){return this._color},set:function(e){this._color.set(e),this._camera&&(this._camera.clearColor=this._color)}},{key:"clearDepth",get:function(){return this._depth},set:function(e){this._depth=e,this._camera&&(this._camera.clearDepth=e)}},{key:"clearStencil",get:function(){return this._stencil},set:function(e){this._stencil=e,this._camera&&(this._camera.clearStencil=e)}},{key:"projection",get:function(){return this._projection},set:function(e){this._projection=e,this._camera&&(this._camera.projectionType=e)}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(e){e!==this._fovAxis&&(this._fovAxis=e,this._camera&&(this._camera.fovAxis=e,e===u_.VERTICAL?this.fov=this._fov*this._camera.aspect:this.fov=this._fov/this._camera.aspect))}},{key:"fov",get:function(){return this._fov},set:function(e){this._fov=e,this._camera&&(this._camera.fov=fn(e))}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(e){this._orthoHeight=e,this._camera&&(this._camera.orthoHeight=e)}},{key:"near",get:function(){return this._near},set:function(e){this._near=e,this._camera&&(this._camera.nearClip=e)}},{key:"far",get:function(){return this._far},set:function(e){this._far=e,this._camera&&(this._camera.farClip=e)}},{key:"aperture",get:function(){return this._aperture},set:function(e){this._aperture=e,this._camera&&(this._camera.aperture=e)}},{key:"shutter",get:function(){return this._shutter},set:function(e){this._shutter=e,this._camera&&(this._camera.shutter=e)}},{key:"iso",get:function(){return this._iso},set:function(e){this._iso=e,this._camera&&(this._camera.iso=e)}},{key:"rect",get:function(){return this._rect},set:function(e){this._rect=e,this._camera&&(this._camera.viewport=e)}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(e){if(this._targetTexture!==e){var t=this._targetTexture;this._targetTexture=e,this._chechTargetTextureEvent(t),this._updateTargetTexture(),!e&&this._camera&&(this._camera.changeTargetWindow(null),this._camera.isWindowSize=!0)}}},{key:"screenScale",get:function(){return this._screenScale},set:function(e){this._screenScale=e,this._camera&&(this._camera.screenScale=e)}},{key:"inEditorMode",get:function(){return this._inEditorMode},set:function(e){this._inEditorMode=e,this._camera&&this._camera.changeTargetWindow(e?c.director.root&&c.director.root.mainWindow:c.director.root&&c.director.root.tempWindow)}}]),t}(fp),CM.ProjectionType=UM,CM.FOVAxis=HM,CM.ClearFlag=WM,CM.Aperture=GM,CM.Shutter=kM,CM.ISO=VM,sM=he((aM=wM).prototype,"_projection",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return UM.PERSPECTIVE}}),cM=he(aM.prototype,"_priority",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),lM=he(aM.prototype,"_fov",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),uM=he(aM.prototype,"_fovAxis",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return HM.VERTICAL}}),hM=he(aM.prototype,"_orthoHeight",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),_M=he(aM.prototype,"_near",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),fM=he(aM.prototype,"_far",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),dM=he(aM.prototype,"_color",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new In("#333333")}}),pM=he(aM.prototype,"_depth",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),mM=he(aM.prototype,"_stencil",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),vM=he(aM.prototype,"_clearFlags",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return WM.SOLID_COLOR}}),gM=he(aM.prototype,"_rect",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new oi(0,0,1,1)}}),yM=he(aM.prototype,"_aperture",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return GM.F16_0}}),xM=he(aM.prototype,"_shutter",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return kM.D125}}),SM=he(aM.prototype,"_iso",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return VM.ISO100}}),EM=he(aM.prototype,"_screenScale",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),TM=he(aM.prototype,"_visibility",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return p_}}),AM=he(aM.prototype,"_targetTexture",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),he(aM.prototype,"priority",[vD,gD],Object.getOwnPropertyDescriptor(aM.prototype,"priority"),aM.prototype),he(aM.prototype,"visibility",[yD,xD,SD],Object.getOwnPropertyDescriptor(aM.prototype,"visibility"),aM.prototype),he(aM.prototype,"clearFlags",[ED,TD,AD],Object.getOwnPropertyDescriptor(aM.prototype,"clearFlags"),aM.prototype),he(aM.prototype,"clearColor",[CD,wD],Object.getOwnPropertyDescriptor(aM.prototype,"clearColor"),aM.prototype),he(aM.prototype,"clearDepth",[bD,ID],Object.getOwnPropertyDescriptor(aM.prototype,"clearDepth"),aM.prototype),he(aM.prototype,"clearStencil",[PD,RD],Object.getOwnPropertyDescriptor(aM.prototype,"clearStencil"),aM.prototype),he(aM.prototype,"projection",[ND,OD,DD],Object.getOwnPropertyDescriptor(aM.prototype,"projection"),aM.prototype),he(aM.prototype,"fovAxis",[MD,LD,FD],Object.getOwnPropertyDescriptor(aM.prototype,"fovAxis"),aM.prototype),he(aM.prototype,"fov",[zD,BD],Object.getOwnPropertyDescriptor(aM.prototype,"fov"),aM.prototype),he(aM.prototype,"orthoHeight",[UD,HD],Object.getOwnPropertyDescriptor(aM.prototype,"orthoHeight"),aM.prototype),he(aM.prototype,"near",[GD,kD],Object.getOwnPropertyDescriptor(aM.prototype,"near"),aM.prototype),he(aM.prototype,"far",[VD,WD],Object.getOwnPropertyDescriptor(aM.prototype,"far"),aM.prototype),he(aM.prototype,"aperture",[jD,qD,YD],Object.getOwnPropertyDescriptor(aM.prototype,"aperture"),aM.prototype),he(aM.prototype,"shutter",[XD,KD,QD],Object.getOwnPropertyDescriptor(aM.prototype,"shutter"),aM.prototype),he(aM.prototype,"iso",[ZD,JD,$D],Object.getOwnPropertyDescriptor(aM.prototype,"iso"),aM.prototype),he(aM.prototype,"rect",[eM,tM],Object.getOwnPropertyDescriptor(aM.prototype,"rect"),aM.prototype),he(aM.prototype,"targetTexture",[nM,iM,oM],Object.getOwnPropertyDescriptor(aM.prototype,"targetTexture"),aM.prototype),rM=aM))||rM)||rM)||rM)||rM));c.Camera=jM;var qM,YM,XM,KM,QM,ZM,JM,$M,eL={parent:null,owner:null,subModelIdx:0},tL=e("cc",(IM=U_("cc.RenderableComponent"),PM=pf([kS]),RM=pf(kS),NM=lf(),OM=tf(),IM((zM=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return ue(t=e.call.apply(e,[this].concat(i))||this,"_materials",LM,se(t)),ue(t,"_visFlags",FM,se(t)),t._materialInstances=[],t._models=[],t}ie(t,e);var n=t.prototype;return n.getMaterial=function(e){return e<0||e>=this._materials.length?null:this._materials[e]},n.setMaterial=function(e,t){e&&e instanceof vE&&console.error("Can't set a material instance to a sharedMaterial slot"),this._materials[t]=e;var n=this._materialInstances[t];n?n.parent!==this._materials[t]&&(n.destroy(),this._materialInstances[t]=null,this._onMaterialModified(t,this._materials[t])):this._onMaterialModified(t,this._materials[t])},n.getMaterialInstance=function(e){if(!this._materials[e])return null;if(!this._materialInstances[e]){eL.parent=this._materials[e],eL.owner=this,eL.subModelIdx=e;var t=new vE(eL);this.setMaterialInstance(e,t)}return this._materialInstances[e]},n.setMaterialInstance=function(e,t){t&&t.parent?t!==this._materialInstances[e]&&(this._materialInstances[e]=t,this._onMaterialModified(e,t)):t!==this._materials[e]&&this.setMaterial(t,e)},n.getRenderMaterial=function(e){return this._materialInstances[e]||this._materials[e]},n._collectModels=function(){return this._models},n._attachToScene=function(){},n._detachFromScene=function(){},n._onMaterialModified=function(){},n._onRebuildPSO=function(){},n._clearMaterials=function(){},n._onVisibilityChange=function(){},te(t,[{key:"visibility",get:function(){return this._visFlags},set:function(e){this._visFlags=e,this._onVisibilityChange(e)}},{key:"sharedMaterials",get:function(){return this._materials},set:function(e){for(var t=0;t<e.length;t++)e[t]!==this._materials[t]&&this.setMaterial(e[t],t);if(e.length<this._materials.length){for(var n=e.length;n<this._materials.length;n++)this.setMaterial(null,n);this._materials.splice(e.length)}}},{key:"materials",get:function(){for(var e=0;e<this._materials.length;e++)this._materialInstances[e]=this.getMaterialInstance(e);return this._materialInstances},set:function(e){var t=e.length-this._materials.length;if(t>0)this._materials.length=e.length,this._materialInstances.length=e.length;else if(t<0)for(var n=this._materials.length-t;n<this._materials.length;++n)this.setMaterialInstance(n,null);for(var i=0;i<this._materialInstances.length;i++)this._materialInstances[i]!=e[i]&&this.setMaterialInstance(i,e[i])}},{key:"sharedMaterial",get:function(){return this.getMaterial(0)}},{key:"material",get:function(){return this.getMaterialInstance(0)},set:function(e){1===this._materials.length&&this._materials[0]===e||this.setMaterialInstance(0,e)}}]),t}(fp),LM=he((MM=zM).prototype,"_materials",[PM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),FM=he(MM.prototype,"_visFlags",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return qu.Enum.NONE}}),he(MM.prototype,"sharedMaterials",[RM,NM,OM],Object.getOwnPropertyDescriptor(MM.prototype,"sharedMaterials"),MM.prototype),DM=MM))||DM));function nL(e){return"string"==typeof e||"number"==typeof e}function iL(e,t){return e instanceof t}c.RenderableComponent=tL,q(jM,"Camera",[{name:"CameraClearFlag",newName:"ClearFlag"}]),q(jM.prototype,"Camera.prototype",[{name:"color",newName:"clearColor"},{name:"depth",newName:"clearDepth"},{name:"stencil",newName:"clearStencil"}]),c.CameraComponent=jM,at.setClassAlias(jM,"cc.CameraComponent");var oL,rL,aL,sL,cL,lL,uL=e("bd",U_("cc.animation.HierarchyPath")((KM=function(){function e(e){ue(this,"path",XM,this),this.path=e||""}return e.prototype.get=function(e){return e instanceof My?e.getChildByPath(this.path)||(y('Node "'+e.name+'" has no path "'+this.path+'"'),null):(y("Target of hierarchy path should be of type Node."),null)},e}(),XM=he((YM=KM).prototype,"path",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),qM=YM))||qM),hL=e("be",U_("cc.animation.ComponentPath")(($M=function(){function e(e){ue(this,"component",JM,this),this.component=e||""}return e.prototype.get=function(e){return e instanceof My?e.getComponent(this.component)||(y('Node "'+e.name+'" has no component "'+this.component+'"'),null):(y("Target of component path should be of type Node."),null)},e}(),JM=he((ZM=$M).prototype,"component",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),QM=ZM))||QM);function _L(e){for(var t=e,n=0;n<(arguments.length<=1?0:arguments.length-1);++n){var i=n+1<1||arguments.length<=n+1?void 0:arguments[n+1];if(nL(i)){if(!(i in t))return y('Target object has no property "'+i+'"'),null;t=t[i]}else t=i.get(t);if(null===t)break}return t}var fL,dL,pL,mL,vL,gL,yL,xL,SL,EL,TL,AL=e("b8",U_("cc.animation.UniformProxyFactory")((lL=function(){function e(e,t){ue(this,"passIndex",aL,this),ue(this,"uniformName",sL,this),ue(this,"channelIndex",cL,this),this.passIndex=t||0,this.uniformName=e||""}return e.prototype.forTarget=function(e){var t=e.passes[this.passIndex],n=t.getHandle(this.uniformName);if(!n)throw new Error('Material "'+e.name+'" has no uniform "'+this.uniformName+'"');var i=xm.getPropertyTypeFromHandle(n);if(i===Up.BUFFER){var o=void 0===this.channelIndex?n:t.getHandle(this.uniformName,this.channelIndex,Fa.FLOAT);if(!o)throw new Error('Uniform "'+this.uniformName+" (in material "+e.name+") has no channel "+this.channelIndex+'"');return function(e,t){for(var n,i=le(e.shaderInfo.blocks);!(n=i()).done;)for(var o,r=le(n.value.members);!(o=r()).done;){var a=o.value;if(a.name===t)return a.count>1}return!1}(t,this.uniformName)?{set:function(e){t.setUniformArray(o,e)}}:{set:function(e){t.setUniform(o,e)}}}if(i===Up.TEXTURE){var r=xm.getBindingFromHandle(n),a=t.properties[this.uniformName],s=a&&a.value?a.value+"-texture":em(a.type),l=pm.get(s);return l||(y("Illegal texture default value: "+s+"."),l=pm.get("default-texture")),{set:function(e){e||(e=l);var n=e.getGFXTexture();n&&n.width&&n.height&&(t.bindTexture(r,n),e instanceof Cd&&t.bindSampler(r,Td.getSampler(c.game._gfxDevice,e.getSamplerHash())))}}}throw new Error("Animations are not available for uniforms with property type "+i+".")},e}(),aL=he((rL=lL).prototype,"passIndex",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),sL=he(rL.prototype,"uniformName",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),cL=he(rL.prototype,"channelIndex",[_f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),oL=rL))||oL);function CL(e,t,n,i){var o,r,a,s,c,l,u=new t,h=new t,_=new t,f=U_(e)((l=function(){function e(e,n,i){ue(this,"dataPoint",a,this),ue(this,"inTangent",s,this),ue(this,"outTangent",c,this),this.dataPoint=e||new t,this.inTangent=n||new t,this.outTangent=i||new t}var o=e.prototype;return o.lerp=function(e,t,o){var r=this.dataPoint,a=e.dataPoint;h=n(h,this.inTangent,o),_=n(_,e.outTangent,o);var s=t*t*t,c=t*t,l=s-2*c+t,f=-2*s+3*c,d=s-c;return u=n(u,r,2*s-3*c+1),u=i(u,u,h,l),u=i(u,u,a,f),u=i(u,u,_,d)},o.getNoLerp=function(){return this.dataPoint},e}(),a=he((r=l).prototype,"dataPoint",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),s=he(r.prototype,"inTangent",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),c=he(r.prototype,"outTangent",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),o=r))||o;if(t===zn){var d=f.prototype.lerp;f.prototype.lerp=function(e,t,n){var i=d.call(this,e,t,n);return zn.normalize(i,i),i}}return f}e("b9",U_("cc.animation.MorphWeightsValueProxy")((mL=function(){function e(){ue(this,"subMeshIndex",pL,this)}return e.prototype.forTarget=function(e){var t=this;return{set:function(n){e.setWeights(n,t.subMeshIndex)}}},e}(),pL=he((dL=mL).prototype,"subMeshIndex",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),fL=dL))||fL),e("ba",U_("cc.animation.MorphWeightsAllValueProxy")(vL=function(){function e(){}return e.prototype.forTarget=function(e){return{set:function(t){for(var n,i,o=null!==(n=null===(i=e.mesh)||void 0===i?void 0:i.struct.primitives.length)&&void 0!==n?n:0,r=0;r<o;++r)e.setWeights(t,r)}}},e}())||vL);var wL=e("bg",CL("cc.CubicSplineVec2Value",Kn,Kn.multiplyScalar,Kn.scaleAndAdd));c.CubicSplineVec2Value=wL;var bL=e("bh",CL("cc.CubicSplineVec3Value",Rn,Rn.multiplyScalar,Rn.scaleAndAdd));c.CubicSplineVec3Value=bL;var IL=e("bi",CL("cc.CubicSplineVec4Value",$n,$n.multiplyScalar,$n.scaleAndAdd));c.CubicSplineVec4Value=IL;var PL=e("bj",CL("cc.CubicSplineQuatValue",zn,zn.multiplyScalar,zn.scaleAndAdd));c.CubicSplineQuatValue=PL;var RL=e("bk",U_("cc.CubicSplineNumberValue")((TL=function(){function e(e,t,n){ue(this,"dataPoint",xL,this),ue(this,"inTangent",SL,this),ue(this,"outTangent",EL,this),this.dataPoint=e,this.inTangent=t,this.outTangent=n}var t=e.prototype;return t.lerp=function(e,t,n){var i=this.dataPoint,o=e.dataPoint,r=t*t*t,a=t*t;return i*(2*r-3*a+1)+this.outTangent*n*(r-2*a+t)+o*(-2*r+3*a)+e.inTangent*n*(r-a)},t.getNoLerp=function(){return this.dataPoint},e}(),xL=he((yL=TL).prototype,"dataPoint",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),SL=he(yL.prototype,"inTangent",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),EL=he(yL.prototype,"outTangent",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),gL=yL))||gL);function NL(e,t,n){void 0===n&&(n=1e-6);for(var i=0,o=e.length-1,r=o>>>1;i<=o;r=i+o>>>1){var a=e[r];if(a>t+n)o=r-1;else{if(!(a<t-n))return r;i=r+1}}return~i}function OL(e,t,n,i,o){var r=1-o;return r*(r*(e+(3*t-e)*o)+3*n*o*o)+i*o*o*o}c.CubicSplineNumberValue=RL,c.bezier=OL;var DL=Math.cos,ML=Math.acos,LL=Math.max,FL=2*Math.PI,zL=Math.sqrt;function BL(e){return e<0?-Math.pow(-e,1/3):Math.pow(e,1/3)}function UL(e,t){var n=function(e,t){var n,i,o,r,a=t-0,s=t-e[0],c=3*a,l=3*s,u=3*(t-e[2]),h=1/(-a+l-u+(t-1)),_=1/3,f=(c-6*s+u)*h,d=f*_,p=(-c+l)*h,m=(3*p-f*f)*_,v=m*_,g=(2*f*f*f-9*f*p+a*h*27)/27,y=g/2,x=y*y+v*v*v;if(x<0){var S=-m*_,E=zL(S*S*S),T=-g/(2*E),A=ML(T<-1?-1:T>1?1:T),C=2*BL(E);return i=C*DL(A*_)-d,o=C*DL((A+FL)*_)-d,r=C*DL((A+2*FL)*_)-d,i>=0&&i<=1?o>=0&&o<=1?r>=0&&r<=1?LL(i,o,r):LL(i,o):r>=0&&r<=1?LL(i,r):i:o>=0&&o<=1?r>=0&&r<=1?LL(o,r):o:r}if(0===x)return o=-(n=y<0?BL(-y):-BL(y))-d,(i=2*n-d)>=0&&i<=1?o>=0&&o<=1?LL(i,o):i:o;var w=zL(x);return(n=BL(-y+w))-BL(y+w)-d}(e,t),i=e[1];return((1-n)*(i+(e[3]-i)*n)*3+n*n)*n}c.bezierByTime=UL;var HL=e("g4",function(){function e(e){var t,n;this.ratios=void 0,this._findRatio=void 0,this.ratios=e;for(var i=!0,o=1,r=e.length;o<r;o++)if(t=e[o]-e[o-1],1===o)n=t;else if(Math.abs(t-n)>1e-6){i=!1;break}this._findRatio=i?WL:NL}return e.prototype.sample=function(e){return this._findRatio(this.ratios,e)},e}());c.RatioSampler=HL;var GL=e("g5",function(){function e(t,n){this.types=void 0,this.type=null,this._values=[],this._lerp=void 0,this._duration=void 0,this._array=void 0,this._duration=n,this._values=t.values;var i=function(t){return"string"==typeof t?t:Array.isArray(t)?t[0]===t[1]&&t[2]===t[3]?e.Linear:e.Bezier(t):e.Linear};if(void 0!==t.easingMethod)this.type=i(t.easingMethod);else if(Array.isArray(t.easingMethods))this.types=t.easingMethods.map(i);else if(void 0!==t.easingMethods){this.types=new Array(this._values.length).fill(null);for(var o=0,r=Object.keys(t.easingMethods);o<r.length;o++){var a=r[o];this.types[a]=i(t.easingMethods[a])}}else this.type=null;var s=t.values[0];(void 0===t.interpolate||t.interpolate)&&(this._lerp=aF(s)),void 0!==t._arrayLength&&(this._array=new Array(t._arrayLength))}e.Bezier=function(e){return e};var t=e.prototype;return t.hasLerp=function(){return!!this._lerp},t.valueAt=function(e){if(void 0===this._array){var t=this._values[e];return t&&t.getNoLerp?t.getNoLerp():t}for(var n=0;n<this._array.length;++n)this._array[n]=this._values[this._array.length*e+n];return this._array},t.valueBetween=function(e,t,n,i,o){if(this._lerp){var r=this.types?this.types[t]:this.type,a=o-n,s=(e-n)/a;if(r&&(s=VL(s,r)),void 0===this._array){var c=this._values[t],l=this._values[i];return this._lerp(c,l,s,a*this._duration)}for(var u=0;u<this._array.length;++u){var h=this._values[this._array.length*t+u],_=this._values[this._array.length*i+u];this._array[u]=this._lerp(h,_,s,a*this._duration)}return this._array}if(void 0===this._array)return this.valueAt(t);for(var f=0;f<this._array.length;++f)this._array[f]=this._values[this._array.length*t+f];return this._array},t.empty=function(){return 0===this._values.length},t.constant=function(){return 1===this._values.length},e}());function kL(e,t,n){var i=t.sample(n);if(i<0)if((i=~i)<=0)i=0;else{if(!(i>=t.ratios.length))return e.valueBetween(n,i-1,t.ratios[i-1],i,t.ratios[i]);i=t.ratios.length-1}return e.valueAt(i)}function VL(e,t){if("string"==typeof t){var n=Wb[t];n?e=n(e):N(3906,t)}else Array.isArray(t)&&(e=UL(t,e));return e}function WL(e,t){var n=e.length-1;if(0===n)return 0;var i=e[0];if(t<i)return 0;var o=e[n];if(t>o)return n;var r=(t=(t-i)/(o-i))/(1/n),a=0|r,s=1e-6;return r-a<s?a:a+1-r<s?a+1:~(a+1)}GL.Linear=null,c.AnimCurve=GL,e("g6",function(){function e(){this.events=[]}return e.prototype.add=function(e,t){this.events.push({func:e||"",params:t||[]})},e}()),c.sampleAnimationCurve=kL;var jL,qL,YL,XL,KL,QL,ZL,JL,$L,eF,tF,nF,iF,oF,rF,aF=function(){function e(e,t,n,i){return e.lerp(t,n,i)}return function(t){if(null!==t){if("number"==typeof t)return _n;if("object"==typeof t&&t.constructor){if(t instanceof zn)return n=new zn,function(e,t,i){return zn.slerp(n,e,t,i)};if(t instanceof _t)return function(e){var t=new e;return function(n,i,o){return e.lerp(t,n,i,o),t}}(t.constructor);if(t.constructor===Number)return _n;if("function"==typeof t.lerp)return e}var n}}}(),sF=e("cw",function(){function e(){}return e.getOrExtract=function(t){var n=e.pool.get(t);return n&&n.info.sample===t.sample||(n&&c.director.root.dataPoolManager.releaseAnimationClip(t),n=function(e){var t={};e.curves.forEach((function(e){if(!e.valueAdapter&&iL(e.modifiers[0],uL)&&nL(e.modifiers[1])){var n=e.modifiers[0].path,i=t[n];i||(i=t[n]={}),i[e.modifiers[1]]={values:e.data.values,keys:e.data.keys}}}));for(var n=Math.ceil(e.sample*e.duration)+1,i=function(){var i=r[o],a=t[i];if(!a)return"continue";Object.defineProperty(a,"worldMatrix",{get:function(){if(!a._worldMatrix){var o=a.position,r=a.rotation,s=a.scale;cF(e,o,n),cF(e,r,n),cF(e,s,n),function(e,t,n){var i=n.position.values,o=n.rotation.values,r=n.scale.values,a=i.map((function(){return new jn})),s=t.lastIndexOf("/"),c=null;if(s>0){var l=e[t.substring(0,s)];if(!l)return void console.warn("no data for parent bone?");c=l.worldMatrix.values}for(var u=0;u<i.length;u++){var h=i[u],_=o[u],f=r[u],d=a[u];jn.fromRTS(d,_,h,f),c&&jn.multiply(d,c[u],d)}Object.keys(n).forEach((function(e){return delete n[e]})),n._worldMatrix={keys:0,interpolate:!1,values:a}}(t,i,a)}return a._worldMatrix}})},o=0,r=Object.keys(t);o<r.length;o++)i();return{info:{frames:n,sample:e.sample},data:t}}(t),e.pool.set(t,n)),n},e.destroy=function(t){e.pool.delete(t)},e}());function cF(e,t,n){var i=e.keys[t.keys],o=[];if(i&&1!==i.length)for(var r=t.values[0]instanceof zn,a=0,s=0;a<n;a++){for(var c=a/e.sample;i[s]<=c;)s++;s>i.length-1?c=i[s=i.length-1]:0===s&&(s=1);var l=t.values[s-1].clone(),u=i[s]-i[s-1],h=u?hn((c-i[s-1])/u):1;r?l.slerp(t.values[s],h):l.lerp(t.values[s],h),o[a]=l}else for(var _=0;_<n;_++)o[_]=t.values[0].clone();t.values=o}sF.pool=new Map;var lF=e("g9",U_("cc.AnimationClip")((rF=oF=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return ue(t=e.call.apply(e,[this].concat(i))||this,"sample",YL,se(t)),ue(t,"speed",XL,se(t)),ue(t,"wrapMode",KL,se(t)),ue(t,"events",QL,se(t)),ue(t,"enableTrsBlending",ZL,se(t)),ue(t,"_duration",JL,se(t)),ue(t,"_keys",$L,se(t)),ue(t,"_stepness",eF,se(t)),ue(t,"_curves",tF,se(t)),ue(t,"_commonTargets",nF,se(t)),ue(t,"_hash",iF,se(t)),t.frameRate=0,t._ratioSamplers=[],t._runtimeCurves=void 0,t._runtimeEvents=void 0,t._data=null,t}ie(t,e),t.createWithSpriteFrames=function(e,n){if(!Array.isArray(e))return N(3905),null;var i=new t;i.sample=n||i.sample,i.duration=e.length/i.sample;for(var o=1/i.sample,r=new Array(e.length),a=new Array(r.length),s=0;s<e.length;s++)r[s]=s*o,a[s]=e[s];return i.keys=[r],i.curves=[{modifiers:[new hL("cc.Sprite"),"spriteFrame"],data:{keys:0,values:a}}],i};var n=t.prototype;return n.onLoaded=function(){this.frameRate=this.sample,this._decodeCVTAs()},n.getPropertyCurves=function(){return this._runtimeCurves||this._createPropertyCurves(),this._runtimeCurves},n.updateEventDatas=function(){delete this._runtimeEvents},n.getEventGroupIndexAtRatio=function(e){return this._runtimeEvents||this._createRuntimeEvents(),NL(this._runtimeEvents.ratios,e)},n.hasEvents=function(){return 0!==this.events.length},n.destroy=function(){return c.director.root.dataPoolManager&&c.director.root.dataPoolManager.releaseAnimationClip(this),sF.destroy(this),e.prototype.destroy.call(this)},n._createPropertyCurves=function(){var e=this;this._ratioSamplers=this._keys.map((function(t){return new HL(t.map((function(t){return t/e._duration})))})),this._runtimeCurves=this._curves.map((function(t){return{curve:new GL(t.data,e._duration),modifiers:t.modifiers,valueAdapter:t.valueAdapter,sampler:e._ratioSamplers[t.data.keys],commonTarget:t.commonTarget}})),this._applyStepness()},n._createRuntimeEvents=function(){for(var e,t=this,n=[],i=[],o=function(){var o=e.value,r=o.frame/t._duration,a=n.findIndex((function(e){return e===r}));a<0&&(a=n.length,n.push(r),i.push({events:[]})),i[a].events.push({functionName:o.func,parameters:o.params})},r=le(this.events.sort((function(e,t){return e.frame-t.frame})));!(e=r()).done;)o();this._runtimeEvents={ratios:n,eventGroups:i}},n._applyStepness=function(){},n._decodeCVTAs=function(){var e=ArrayBuffer.isView(this._nativeAsset)?this._nativeAsset.buffer:this._nativeAsset;if(e){for(var t=this._keys,n=0;n<t.length;++n){var i=t[n];i instanceof Hv&&(t[n]=i.decompress(e))}for(var o=0;o<this._curves.length;++o){var r=this._curves[o];r.data.values instanceof Hv&&(r.data.values=r.data.values.decompress(e))}}},n.validate=function(){return this.keys.length>0&&this.curves.length>0},te(t,[{key:"duration",get:function(){return this._duration},set:function(e){this._duration=e}},{key:"keys",get:function(){return this._keys},set:function(e){this._keys=e}},{key:"eventGroups",get:function(){return this._runtimeEvents||this._createRuntimeEvents(),this._runtimeEvents.eventGroups}},{key:"stepness",get:function(){return this._stepness},set:function(e){this._stepness=e,this._applyStepness()}},{key:"hash",get:function(){if(this._hash)return this._hash;var e=this._nativeAsset,t=new Uint8Array(ArrayBuffer.isView(e)?e.buffer:e);return this._hash=Mc(t,666)}},{key:"curves",get:function(){return this._curves},set:function(e){this._curves=e,delete this._runtimeCurves}},{key:"data",get:function(){return this._data}},{key:"commonTargets",get:function(){return this._commonTargets},set:function(e){this._commonTargets=e}}]),t}(Yf),oF.WrapMode=wu,YL=he((qL=rF).prototype,"sample",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),XL=he(qL.prototype,"speed",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),KL=he(qL.prototype,"wrapMode",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return wu.Normal}}),QL=he(qL.prototype,"events",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ZL=he(qL.prototype,"enableTrsBlending",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),JL=he(qL.prototype,"_duration",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$L=he(qL.prototype,"_keys",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),eF=he(qL.prototype,"_stepness",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tF=he(qL.prototype,"_curves",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),nF=he(qL.prototype,"_commonTargets",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),iF=he(qL.prototype,"_hash",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jL=qL))||jL);c.AnimationClip=lF;var uF,hF,_F=((uF=new Map).set(Kn,{createBuffer:function(){return new Kn},copy:Kn.copy}),uF.set(Rn,{createBuffer:function(){return new Rn},copy:Rn.copy}),uF.set($n,{createBuffer:function(){return new $n},copy:$n.copy}),uF.set(In,{createBuffer:function(){return new In},copy:In.copy}),uF.set(ni,{createBuffer:function(){return new ni},copy:function(e,t){return e.set(t)}}),function(e){return uF.get(null==e?void 0:e.constructor)}),fF=function(){function e(e,t){this._object=void 0,this._propertyName=void 0,this._object=e,this._propertyName=t}var t=e.prototype;return t.setValue=function(e){this._object[this._propertyName]=e},t.getValue=function(){return this._object[this._propertyName]},e}(),dF=function(){function e(e){this._proxy=void 0,this._proxy=e}var t=e.prototype;return t.setValue=function(e){this._proxy.set(e)},t.getValue=function(){var e=this._proxy;return e.get?e.get():(x("Target doesn't provide a get method."),null)},e}(),pF=function(){function e(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var t=e.prototype;return t.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError(L(3912)):(this._isPlaying=!0,this.onPlay())},t.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)},t.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())},t.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())},t.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},t.update=function(){},t.onPlay=function(){},t.onPause=function(){},t.onResume=function(){},t.onStop=function(){},t.onError=function(){},te(e,[{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"isMotionless",get:function(){return!this.isPlaying||this.isPaused}}]),e}();!function(e){e.PLAY="play",e.STOP="stop",e.PAUSE="pause",e.RESUME="resume",e.LASTFRAME="lastframe",e.FINISHED="finished"}(hF||(hF={})),ht(hF);var mF=function(){function e(e,t,n){this.commonTargetIndex=-1,this._curve=void 0,this._boundTarget=void 0,this._curveDetail=void 0,this._curve=e.curve,this._curveDetail=e,this._boundTarget=n,this._shouldLerp=e.curve.hasLerp()}var t=e.prototype;return t.applySample=function(e,t,n,i,o){var r;r=this._shouldLerp&&n?this._curve.valueBetween(e,i.from,i.fromRatio,i.to,i.toRatio):this._curve.valueAt(t),this._setValue(r,o)},t._setValue=function(e){this._boundTarget.setValue(e)},te(e,[{key:"propertyName",get:function(){return""}},{key:"curveDetail",get:function(){return this._curveDetail}}]),e}(),vF=e("cP",function(e){function t(t,n){var i;return void 0===n&&(n=""),(i=e.call(this)||this).duration=1,i.speed=1,i.time=0,i.frameRate=0,i._targetNode=null,i._curveLoaded=!1,i._clip=void 0,i._useSimpleProcess=!1,i._samplerSharedGroups=[],i._target=null,i._ignoreIndex=-1,i._commonTargetStatuses=[],i._wrapMode=wu.Normal,i._repeatCount=1,i._delay=0,i._delayTime=0,i._currentFramePlayed=!1,i._lastIterations=NaN,i._lastWrapInfo=null,i._lastWrapInfoEvent=null,i._wrappedInfo=new Pu,i._blendStateBuffer=null,i._blendStateWriters=[],i._allowLastFrame=!1,i._blendStateWriterHost={weight:0},i._playbackDuration=0,i._invDuration=1,i._weight=0,i._clipHasEvent=!1,i._clip=t,i._name=n||t&&t.name,i._playbackRange={min:0,max:t.duration},i._playbackDuration=t.duration,t.duration||E("Clip "+t.name+" has zero duration."),i}ie(t,e);var n=t.prototype;return n.initialize=function(e,t){var n,i,o=this;if(!this._curveLoaded){this._curveLoaded=!0,this._destroyBlendStateWriters(),this._samplerSharedGroups.length=0,this._blendStateBuffer=null!==(n=null===(i=c.director.getAnimationManager())||void 0===i?void 0:i.blendState)&&void 0!==n?n:null,this._targetNode=e;var r=this._clip;this.duration=r.duration,this._invDuration=1/this.duration,this.speed=r.speed,this.wrapMode=r.wrapMode,this.frameRate=r.sample,this._playbackRange.min=0,this._playbackRange.max=r.duration,this._playbackDuration=r.duration,this._clipHasEvent=r.hasEvents(),(this.wrapMode&Cu.Loop)===Cu.Loop?this.repeatCount=1/0:this.repeatCount=1;var a=function(e,t,n,i){if(!(r.enableTrsBlending&&function(e){var t;if(1===e.length&&"string"==typeof e[0])t=e[0];else if(e.length>1){for(var n=0;n<e.length-1;++n)if(!(e[n]instanceof uL))return!1;t=e[e.length-1]}switch(t){case"position":case"scale":case"rotation":case"eulerAngles":return!0;default:return!1}}(t)&&o._blendStateBuffer))return function(e,t,n){var i=t[t.length-1];if(0!==t.length&&nL(i)&&!n){var o=_L.apply(void 0,[e].concat(t.slice(0,t.length-1)));return null===o?null:new fF(o,i)}if(n){var r=_L.apply(void 0,[e].concat(t));if(null===r)return null;var a=n.forTarget(r);return new dF(a)}return x("Empty animation curve."),null}(e,t,n);var a=_L.apply(void 0,[e].concat(t.slice(0,t.length-1)));if(null!==a&&a instanceof My){var s=t[t.length-1],c=o._blendStateBuffer.createWriter(a,s,o._blendStateWriterHost,i);return o._blendStateWriters.push(c),c}return null};this._commonTargetStatuses=r.commonTargets.map((function(t){var n=a(e,t.modifiers,t.valueAdapter,!1);if(!n)return null;var i=function(e){if(null===e)return null;var t=e.getValue(),n=_F(t);if(!n)return x("Value is not copyable!"),null;var i=n.createBuffer(),o=n.copy;return Object.assign(e,{peek:function(){return i},pull:function(){var t=e.getValue();o(i,t)},push:function(){e.setValue(i)}})}(n);return null===i?null:{target:i,changed:!1}})),t||(t=r.getPropertyCurves());for(var s=function(n){var i=t[n];if(i.curve.empty())return"continue";var r=o._samplerSharedGroups.find((function(e){return e.sampler===i.sampler}));r||(r={sampler:i.sampler,curves:[],samplerResultCache:{from:0,fromRatio:0,to:0,toRatio:0}},o._samplerSharedGroups.push(r));var s=void 0;if(void 0===i.commonTarget)s=e;else{var c=o._commonTargetStatuses[i.commonTarget];if(!c)return"continue";s=c.target.peek()}var l=a(s,i.modifiers,i.valueAdapter,i.curve.constant());if(null===l);else{var u,h=new mF(i,s,l);h.commonTargetIndex=null!==(u=i.commonTarget)&&void 0!==u?u:-1,r.curves.push(h)}},l=0;l<t.length;++l)s(l)}},n.destroy=function(){this._destroyBlendStateWriters()},n.emit=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];c.director.getAnimationManager().pushDelayEvent(this._emit,this,t)},n.on=function(e,t,n){return this._target&&this._target.isValid?this._target.on(e,t,n):null},n.once=function(e,t,n){return this._target&&this._target.isValid?this._target.once(e,t,n):null},n.off=function(e,t,n){this._target&&this._target.isValid&&this._target.off(e,t,n)},n.allowLastFrameEvent=function(e){this._allowLastFrame=e},n._setEventTarget=function(e){this._target=e},n.setTime=function(e){this._currentFramePlayed=!1,this.time=e||0,this._lastWrapInfoEvent=null,this._ignoreIndex=-1;var t=this.getWrappedInfo(e,this._wrappedInfo),n=t.direction,i=this._clip.getEventGroupIndexAtRatio(t.ratio);i<0&&(i=~i-1,n<0&&(i+=1),this._ignoreIndex=i)},n.update=function(e){this._delayTime>0&&(this._delayTime-=e,this._delayTime>0)||(this._currentFramePlayed?this.time+=e*this.speed:this._currentFramePlayed=!0,this._process())},n.sample=function(){var e=this.getWrappedInfo(this.time,this._wrappedInfo);return this._sampleCurves(e.ratio),this._sampleEvents(e),e},n.onPlay=function(){this.setTime(0),this._delayTime=this._delay,this._onReplayOrResume(),this.emit(hF.PLAY,this)},n.onStop=function(){this.isPaused||this._onPauseOrStop(),this.emit(hF.STOP,this)},n.onResume=function(){this._onReplayOrResume(),this.emit(hF.RESUME,this)},n.onPause=function(){this._onPauseOrStop(),this.emit(hF.PAUSE,this)},n._sampleCurves=function(e){for(var t=this.weight,n=this._commonTargetStatuses,i=0,o=n.length;i<o;++i){var r=n[i];r&&(r.target.pull(),r.changed=!1)}this._samplerSharedGroups.forEach((function(i){var o=i.sampler,r=i.samplerResultCache,a=0,s=!1;o?(a=o.sample(e))<0&&((a=~a)<=0?a=0:a>=o.ratios.length?a=o.ratios.length-1:(s=!0,r.from=a-1,r.fromRatio=o.ratios[r.from],r.to=a,r.toRatio=o.ratios[r.to],a=r.from)):a=0;for(var c=i.curves,l=0,u=c.length;l<u;++l){var h=c[l];if(h.applySample(e,a,s,r,t),h.commonTargetIndex>=0){var _=n[h.commonTargetIndex];_&&(_.changed=!0)}}}));for(var a=0,s=n.length;a<s;++a){var c=n[a];c&&c.changed&&c.target.push()}},n._process=function(){this._useSimpleProcess?this.simpleProcess():this.process()},n.process=function(){var e,t=this.sample();this._allowLastFrame&&(e=this._lastWrapInfo?this._lastWrapInfo:this._lastWrapInfo=new Pu(t),this.repeatCount>1&&(0|t.iterations)>(0|e.iterations)&&this.emit(hF.LASTFRAME,this),e.set(t)),t.stopped&&(this.stop(),this.emit(hF.FINISHED,this))},n.simpleProcess=function(){var e=this._playbackRange.min,t=this._playbackDuration,n=this.time%t;n<0&&(n+=t);var i=(e+n)*this._invDuration;this._sampleCurves(i),this._clipHasEvent&&this._sampleEvents(this.getWrappedInfo(this.time,this._wrappedInfo)),this._allowLastFrame&&(Number.isNaN(this._lastIterations)&&(this._lastIterations=i),(this.time>0&&this._lastIterations>i||this.time<0&&this._lastIterations<i)&&this.emit(hF.LASTFRAME,this),this._lastIterations=i)},n.cache=function(){},n._needReverse=function(e){var t=this.wrapMode,n=!1;return(t&Cu.PingPong)===Cu.PingPong&&(e-(0|e)==0&&e>0&&(e-=1),1&e&&(n=!n)),(t&Cu.Reverse)===Cu.Reverse&&(n=!n),n},n.getWrappedInfo=function(e,t){t=t||new Pu;var n=this._getPlaybackStart(),i=this._getPlaybackEnd()-n,o=!1,r=this.repeatCount,a=e>0?e/i:-e/i;if(a>=r){a=r,o=!0;var s=r-(0|r);0===s&&(s=1),e=s*i*(e>0?1:-1)}if(e>i){var c=e%i;e=0===c?i:c}else e<0&&0!=(e%=i)&&(e+=i);var l=!1,u=this._wrapMode&Cu.ShouldWrap;u&&(l=this._needReverse(a));var h=l?-1:1;return this.speed<0&&(h*=-1),u&&l&&(e=i-e),t.time=n+e,t.ratio=t.time/this.duration,t.direction=h,t.stopped=o,t.iterations=a,t},n._getPlaybackStart=function(){return this._playbackRange.min},n._getPlaybackEnd=function(){return this._playbackRange.max},n._sampleEvents=function(e){var t=this._clip.eventGroups.length,n=e.direction,i=this._clip.getEventGroupIndexAtRatio(e.ratio);if(i<0&&(i=~i-1,n<0&&(i+=1)),this._ignoreIndex!==i&&(this._ignoreIndex=-1),e.frameIndex=i,!this._lastWrapInfoEvent)return this._fireEvent(i),void(this._lastWrapInfoEvent=new Pu(e));var o=this.wrapMode,r=gF(e.iterations),a=this._lastWrapInfoEvent,s=gF(a.iterations),l=a.frameIndex,u=a.direction,h=-1!==s&&r!==s;if(l===i&&h&&1===t)this._fireEvent(0);else if(l!==i||h){n=u;do{if(l!==i){if(-1===n&&0===l&&i>0?((o&Cu.PingPong)===Cu.PingPong?n*=-1:l=t,s++):1===n&&l===t-1&&i<t-1&&((o&Cu.PingPong)===Cu.PingPong?n*=-1:l=-1,s++),l===i)break;if(s>r)break}l+=n,c.director.getAnimationManager().pushDelayEvent(this._fireEvent,this,[l])}while(l!==i&&l>-1&&l<t)}this._lastWrapInfoEvent.set(e)},n._emit=function(e,t){this._target&&this._target.isValid&&this._target.emit(e,e,t)},n._fireEvent=function(e){if(this._targetNode&&this._targetNode.isValid){var t=this._clip.eventGroups;if(!(e<0||e>=t.length||this._ignoreIndex===e))for(var n,i=t[e],o=this._targetNode.components,r=le(i.events);!(n=r()).done;)for(var a,s=n.value,c=s.functionName,l=le(o);!(a=l()).done;){var u=a.value,h=u[c];"function"==typeof h&&h.apply(u,s.parameters)}}},n._onReplayOrResume=function(){c.director.getAnimationManager().addAnimation(this)},n._onPauseOrStop=function(){c.director.getAnimationManager().removeAnimation(this)},n._destroyBlendStateWriters=function(){this._blendStateWriters.length&&this._blendStateBuffer;for(var e=0;e<this._blendStateWriters.length;++e)this._blendStateBuffer.destroyWriter(this._blendStateWriters[e]);this._blendStateWriters.length=0,this._blendStateBuffer&&(this._blendStateBuffer=null)},te(t,[{key:"clip",get:function(){return this._clip}},{key:"name",get:function(){return this._name}},{key:"length",get:function(){return this.duration}},{key:"wrapMode",get:function(){return this._wrapMode},set:function(e){this._wrapMode=e,this.time=0,e&Cu.Loop?this.repeatCount=1/0:this.repeatCount=1}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(e){this._repeatCount=e;var t=this._wrapMode&Cu.ShouldWrap,n=(this.wrapMode&Cu.Reverse)===Cu.Reverse;this._useSimpleProcess=e===1/0&&!t&&!n}},{key:"delay",get:function(){return this._delay},set:function(e){this._delayTime=this._delay=e}},{key:"playbackRange",get:function(){return this._playbackRange},set:function(e){e.max,e.min,this._playbackRange.min=Math.max(e.min,0),this._playbackRange.max=Math.min(e.max,this.duration),this._playbackDuration=this._playbackRange.max-this._playbackRange.min,this.setTime(0)}},{key:"current",get:function(){return this.getWrappedInfo(this.time).time}},{key:"ratio",get:function(){return this.current/this.duration}},{key:"weight",get:function(){return this._weight},set:function(e){this._weight=e,this._blendStateWriterHost.weight=e}},{key:"curveLoaded",get:function(){return this._curveLoaded}}]),t}(pF));function gF(e){return e-(0|e)==0&&(e-=1),0|e}c.AnimationState=vF;var yF,xF,SF,EF,TF,AF,CF,wF,bF,IF,PF,RF,NF,OF,DF,MF,LF,FF=function(e){function t(t){var n;return(n=e.call(this)||this)._managedStates=[],n._fadings=[],n._scheduled=!1,n._scheduler=null!=t?t:c.director.getAnimationManager(),n}ie(t,e);var n=t.prototype;return n.update=function(e){if(!this.isMotionless){var t=this._managedStates,n=this._fadings;if(1===t.length&&1===n.length){var i=t[0].state;i&&(i.weight=1)}else this._calculateWeights(e);1===t.length&&1===n.length&&this._unscheduleThis()}},n.crossFade=function(e,t){var n;0===this._managedStates.length&&(t=0),0===t&&this.clear();var i=this._managedStates.find((function(t){return t.state===e}));i?(null===(n=i.state)||void 0===n?void 0:n.isMotionless)&&i.state.play():(i={state:e,reference:0},e&&e.play(),this._managedStates.push(i)),++i.reference,this._fadings.unshift({easeDuration:t,easeTime:0,target:i}),this.isMotionless||this._scheduleThis()},n.clear=function(){for(var e=0;e<this._managedStates.length;++e){var t=this._managedStates[e].state;t&&t.stop()}this._managedStates.length=0,this._fadings.length=0},n.onPlay=function(){e.prototype.onPlay.call(this),this._scheduleThis()},n.onPause=function(){e.prototype.onPause.call(this);for(var t=0;t<this._managedStates.length;++t){var n=this._managedStates[t].state;n&&n.pause()}this._unscheduleThis()},n.onResume=function(){e.prototype.onResume.call(this);for(var t=0;t<this._managedStates.length;++t){var n=this._managedStates[t].state;n&&n.resume()}this._scheduleThis()},n.onStop=function(){e.prototype.onStop.call(this),this.clear()},n._calculateWeights=function(e){for(var t=this._managedStates,n=this._fadings,i=0;i<t.length;++i){var o=t[i].state;o&&(o.weight=0)}for(var r=1,a=n.length,s=0;s<n.length;++s){var c=n[s];c.easeTime+=e;var l=0===c.easeDuration?1:hn(c.easeTime/c.easeDuration),u=l*r;if(r*=1-l,c.target.state&&(c.target.state.weight+=u),c.easeTime>=c.easeDuration){a=s+1,c.easeTime=c.easeDuration;break}}if(a!==n.length){for(var h=a;h<n.length;++h){var _=n[h];--_.target.reference,_.target.reference<=0&&(_.target.state&&_.target.state.stop(),pe(this._managedStates,_.target))}n.splice(a)}},n._scheduleThis=function(){this._scheduled||(this._scheduler.addCrossFade(this),this._scheduled=!0)},n._unscheduleThis=function(){this._scheduled&&(this._scheduler.removeCrossFade(this),this._scheduled=!1)},t}(pF),zF=e("cQ",(yF=U_("cc.Animation"),xF=J_(),SF=G_(99),EF=X_(),TF=pf([lF]),AF=nf(),CF=pf(lF),wF=nf(),bF=nf(),IF=pf([lF]),yF(PF=xF(PF=SF(PF=Y_(PF=EF((LF=MF=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return ue(t=e.call.apply(e,[this].concat(i))||this,"playOnLoad",NF,se(t)),t._crossFade=new FF,t._nameToState=Re(!0),ue(t,"_clips",OF,se(t)),ue(t,"_defaultClip",DF,se(t)),t._hasBeenPlayed=!1,t}ie(t,e);var n=t.prototype;return n.onLoad=function(){for(var e in this.clips=this._clips,this._nameToState)this._nameToState[e].initialize(this.node)},n.start=function(){this.playOnLoad&&!this._hasBeenPlayed&&this._defaultClip&&this.crossFade(this._defaultClip.name,0)},n.onEnable=function(){this._crossFade.resume()},n.onDisable=function(){this._crossFade.pause()},n.onDestroy=function(){for(var e in this._crossFade.stop(),this._nameToState)this._nameToState[e].destroy();this._nameToState=Re(!0)},n.play=function(e){if(this._hasBeenPlayed=!0,!e){if(!this._defaultClip)return;e=this._defaultClip.name}this.crossFade(e,0)},n.crossFade=function(e,t){void 0===t&&(t=.3),this._hasBeenPlayed=!0;var n=this._nameToState[e];n&&(this._crossFade.play(),this._crossFade.crossFade(n,t))},n.pause=function(){this._crossFade.pause()},n.resume=function(){this._crossFade.resume()},n.stop=function(){this._crossFade.stop()},n.getAnimationState=function(e){return this.getState(e)},n.getState=function(e){var t=this._nameToState[e];return t&&!t.curveLoaded&&t.initialize(this.node),t||null},n.createState=function(e,t){return t=t||e.name,this.removeState(t),this._doCreateState(e,t)},n.removeState=function(e){var t=this._nameToState[e];t&&(t.allowLastFrameEvent(!1),t.stop(),delete this._nameToState[e])},n.addClip=function(e,t){return me(this._clips,e)||this._clips.push(e),this.createState(e,t)},n.removeClip=function(e,t){var n;for(var i in this._nameToState){var o=this._nameToState[i];if(o.clip===e){n=o;break}}if(e===this._defaultClip){if(!t)return void P(3902);this._defaultClip=null}if(n&&n.isPlaying){if(!t)return void P(3903);n.stop()}this._clips=this._clips.filter((function(t){return t!==e})),n&&delete this._nameToState[n.name]},n.on=function(t,n,i,o){var r=e.prototype.on.call(this,t,n,i,o);return t===hF.LASTFRAME&&this._syncAllowLastFrameEvent(),r},n.once=function(t,n,i){var o=e.prototype.once.call(this,t,n,i);return t===hF.LASTFRAME&&this._syncAllowLastFrameEvent(),o},n.off=function(t,n,i){e.prototype.off.call(this,t,n,i),t===hF.LASTFRAME&&this._syncDisallowLastFrameEvent()},n._createState=function(e,t){return new vF(e,t)},n._doCreateState=function(e,t){var n=this._createState(e,t);return n._setEventTarget(this),n.allowLastFrameEvent(this.hasEventListener(hF.LASTFRAME)),this.node&&n.initialize(this.node),this._nameToState[n.name]=n,n},n._getStateByNameOrDefaultClip=function(e){if(!e){if(!this._defaultClip)return null;e=this._defaultClip.name}return this._nameToState[e]||null},n._removeStateOfAutomaticClip=function(e){for(var t in this._nameToState){var n=this._nameToState[t];BF(e,n.clip)&&(n.stop(),delete this._nameToState[t])}},n._syncAllowLastFrameEvent=function(){if(this.hasEventListener(hF.LASTFRAME))for(var e in this._nameToState)this._nameToState[e].allowLastFrameEvent(!0)},n._syncDisallowLastFrameEvent=function(){if(!this.hasEventListener(hF.LASTFRAME))for(var e in this._nameToState)this._nameToState[e].allowLastFrameEvent(!1)},te(t,[{key:"clips",get:function(){return this._clips},set:function(e){var t=this;this._crossFade&&this._crossFade.clear();for(var n,i=le(this._clips);!(n=i()).done;){var o=n.value;o&&this._removeStateOfAutomaticClip(o)}for(var r,a=le(e);!(r=a()).done;){var s=r.value;s&&this.createState(s)}var c=e.find((function(e){return BF(e,t._defaultClip)}));this._defaultClip=c||null,this._clips=e}},{key:"defaultClip",get:function(){return this._defaultClip},set:function(e){this._defaultClip=e,e&&(this._clips.findIndex((function(t){return BF(t,e)}))>=0||(this._clips.push(e),this.createState(e)))}}]),t}(Ti(fp)),MF.EventType=hF,he((RF=LF).prototype,"clips",[TF,AF],Object.getOwnPropertyDescriptor(RF.prototype,"clips"),RF.prototype),he(RF.prototype,"defaultClip",[CF,wF],Object.getOwnPropertyDescriptor(RF.prototype,"defaultClip"),RF.prototype),NF=he(RF.prototype,"playOnLoad",[W_,bF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),OF=he(RF.prototype,"_clips",[IF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),DF=he(RF.prototype,"_defaultClip",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),PF=RF))||PF)||PF)||PF)||PF)||PF));function BF(e,t){return e===t||!!e&&!!t&&e._uuid===t._uuid&&e._uuid}q(zF.prototype,"Animation",[{name:"getAnimationState",newName:"getState"},{name:"addClip",newName:"createState"},{name:"removeClip",newName:"removeState",customFunction:function(){var e=arguments.length<=0?void 0:arguments[0];return zF.prototype.removeState.call(this,e.name)}}]),c.AnimationComponent=zF,at.setClassAlias(zF,"cc.AnimationComponent");var UF,HF,GF,kF=function(){function e(){this._nodeBlendStates=new Map}var t=e.prototype;return t.createWriter=function(e,t,n,i){var o=this.ref(e,t);return new VF(e,t,o,n,i)},t.destroyWriter=function(e){var t=e;this.deRef(t.node,t.property)},t.ref=function(e,t){var n=this._nodeBlendStates.get(e);return n||(n=new YF,this._nodeBlendStates.set(e,n)),n.refProperty(t)},t.deRef=function(e,t){var n=this._nodeBlendStates.get(e);n&&(n.deRefProperty(t),n.empty&&this._nodeBlendStates.delete(e))},t.apply=function(){this._nodeBlendStates.forEach((function(e,t){e.apply(t)}))},e}(),VF=function(){function e(e,t,n,i,o){this._node=e,this._property=t,this._propertyBlendState=n,this._host=i,this._constants=o}var t=e.prototype;return t.getValue=function(){return this._node[this._property]},t.setValue=function(e){var t=this._propertyBlendState,n=this._host.weight;t.blend(e,n)},te(e,[{key:"node",get:function(){return this._node}},{key:"property",get:function(){return this._property}}]),e}(),WF=function(e){this.blendedWeight=0,this.blendedValue=void 0,this.refCount=0,this.blendedValue=e},jF=function(e){function t(){return e.call(this,new Rn)||this}ie(t,e);var n=t.prototype;return n.blend=function(e,t){var n=this.blendedValue;1===t?Rn.copy(n,e):Rn.scaleAndAdd(n,n,e,t),this.blendedWeight+=t},n.reset=function(){this.blendedWeight=0,Rn.zero(this.blendedValue)},t}(WF),qF=function(e){function t(){return e.call(this,new zn)||this}ie(t,e);var n=t.prototype;return n.blend=function(e,t){if(0!==t){var n=this.blendedValue,i=this.blendedWeight;if(1===t)zn.copy(n,e);else{var o=t/(i+t);zn.slerp(n,n,e,o)}this.blendedWeight+=t}},n.reset=function(){this.blendedWeight=0,zn.identity(this.blendedValue)},t}(WF),YF=function(){function e(){this._properties={}}var t=e.prototype;return t.refProperty=function(e){var t,n,i,o=this._properties;switch(e){default:case"position":case"scale":case"eulerAngles":i=null!==(t=o[e])&&void 0!==t?t:o[e]=new jF;break;case"rotation":i=null!==(n=o[e])&&void 0!==n?n:o[e]=new qF}return++i.refCount,i},t.deRefProperty=function(e){var t=this._properties,n=t[e];n&&(--n.refCount,n.refCount>0||delete t[e])},t.apply=function(e){var t,n,i,o=this._properties,r=o.position,a=o.scale,s=o.rotation,c=o.eulerAngles,l=!1,u=!1,h=!1,_=!1;r&&r.blendedWeight&&(l=!0,r.blendedWeight<1&&r.blend(e.position,1-r.blendedWeight),t=r.blendedValue),a&&a.blendedWeight&&(u=!0,a.blendedWeight<1&&a.blend(e.scale,1-a.blendedWeight),n=a.blendedValue),c&&c.blendedWeight&&(_=!0,c.blendedWeight<1&&c.blend(e.eulerAngles,1-c.blendedWeight),i=c.blendedValue),s&&s.blendedWeight&&(h=!0,s.blendedWeight<1&&s.blend(e.rotation,1-s.blendedWeight),i=s.blendedValue),(i||t||n)&&e.setRTS(i,t,n),l&&r.reset(),u&&a.reset(),h&&s.reset(),_&&c.reset()},te(e,[{key:"empty",get:function(){var e=this._properties;return!(e.position||e.rotation||e.eulerAngles||e.scale)}}]),e}(),XF=[],KF=new Map;function QF(e,t){for(var n=0,i=jn.IDENTITY;e;){if(e.stamp===t||e.stamp+1===t&&!e.node.hasChangedFlags){i=e.world,e.stamp=t;break}e.stamp=t,XF[n++]=e,e=e.parent}for(;n>0;){var o=(e=XF[--n]).node;jn.fromRTS(e.local,o.rotation,o.position,o.scale),i=jn.multiply(e.world,i,e.local)}return i}function ZF(e,t){for(var n,i=null,o=0;e!==t;){var r=e.uuid;if(KF.has(r)){i=KF.get(r);break}i={node:e,local:new jn,world:new jn,stamp:-1,parent:null},KF.set(r,i),XF[o++]=i,e=e.parent,i=null}for(;o>0;)(n=XF[--o]).parent=i,i=n;return i}function JF(e){for(var t=KF.get(e.uuid)||null;t;)KF.delete(t.node.uuid),t=t.parent}var $F=e("ga",U_((GF=HF=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this)._anims=new _e([]),t._crossFades=new _e([]),t._delayEvents=[],t._blendStateBuffer=new kF,t._sockets=[],t}ie(t,e);var n=t.prototype;return n.addCrossFade=function(e){-1===this._crossFades.array.indexOf(e)&&this._crossFades.push(e)},n.removeCrossFade=function(e){var t=this._crossFades.array.indexOf(e);t>=0?this._crossFades.fastRemoveAt(t):N(3907)},n.update=function(e){var t=this._delayEvents,n=this._crossFades,i=this._sockets,o=n.array;for(n.i=0;n.i<o.length;++n.i)o[n.i].update(e);var r=this._anims,a=r.array;for(r.i=0;r.i<a.length;++r.i){var s=a[r.i];s.isMotionless||s.update(e)}this._blendStateBuffer.apply();for(var l=c.director.getTotalFrames(),u=0,h=i.length;u<h;u++){var _=i[u],f=_.target,d=_.transform;f.matrix=QF(d,l)}for(var p=0,m=t.length;p<m;p++){var v=t[p];v.fn.apply(v.thisArg,v.args)}t.length=0},n.destruct=function(){},n.addAnimation=function(e){-1===this._anims.array.indexOf(e)&&this._anims.push(e)},n.removeAnimation=function(e){var t=this._anims.array.indexOf(e);t>=0?this._anims.fastRemoveAt(t):N(3907)},n.pushDelayEvent=function(e,t,n){this._delayEvents.push({fn:e,thisArg:t,args:n})},n.addSockets=function(e,t){for(var n=this,i=function(i){var o=t[i];if(n._sockets.find((function(e){return e.target===o.target})))return"continue";var r=e.getChildByPath(o.path),a=o.target&&r&&ZF(r,e);a&&n._sockets.push({target:o.target,transform:a})},o=0;o<t.length;++o)i(o)},n.removeSockets=function(e,t){for(var n=0;n<t.length;++n)for(var i=t[n],o=0;o<this._sockets.length;++o){var r=this._sockets[o];if(r.target===i.target){JF(r.transform.node),this._sockets[o]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}},te(t,[{key:"blendState",get:function(){return this._blendStateBuffer}}]),t}(Yb),HF.ID="animation",UF=GF))||UF);kN.on(GN.EVENT_INIT,(function(){var e=new $F;kN.registerSystem($F.ID,e,$b.PRIORITY_SYSTEM)})),c.AnimationManager=$F;var ez,tz,nz,iz,oz=new jn;c.easing=Wb;var rz=e("fX",U_("cc.HierachyModifier")(ez=function(e){function t(){return e.apply(this,arguments)||this}return ie(t,e),t}(uL))||ez);c.HierachyModifier=rz;var az=e("fY",U_("cc.ComponentModifier")(tz=function(e){function t(){return e.apply(this,arguments)||this}return ie(t,e),t}(hL))||tz);c.ComponentModifier=az;var sz=e("fZ",U_("cc.CurveValueAdapter")(nz=function(){function e(){}return e.prototype.forTarget=function(){return{set:function(){}}},e}())||nz);c.CurveValueAdapter=sz;var cz=e("f_",U_("cc.UniformCurveValueAdapter")(iz=function(e){function t(){return e.apply(this,arguments)||this}return ie(t,e),t}(AL))||iz);function lz(e){return"string"==typeof e}function uz(e){return"number"==typeof e}function hz(e,t){return e instanceof t}c.UniformCurveValueAdapter=cz,c.isPropertyModifier=lz,c.isElementModifier=uz,c.isCustomTargetModifier=hz,c.math=ai,c.geometry=Wu;var _z=e("gc",function(){function e(e){this.poolHandlerComp=void 0,this._pool=void 0,this.poolHandlerComp=e,this._pool=[]}var t=e.prototype;return t.size=function(){return this._pool.length},t.clear=function(){for(var e=this._pool.length,t=0;t<e;++t)this._pool[t].destroy();this._pool.length=0},t.put=function(e){if(e&&-1===this._pool.indexOf(e)){e.removeFromParent();var t=this.poolHandlerComp?e.getComponent(this.poolHandlerComp):null;t&&t.unuse&&t.unuse(),this._pool.push(e)}},t.get=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=this._pool.length-1;if(i<0)return null;var o=this._pool[i];this._pool.length=i;var r=this.poolHandlerComp?o.getComponent(this.poolHandlerComp):null;return r&&r.reuse&&r.reuse(arguments),o},e}());c.NodePool=_z,c.renderer=_b;var fz=new URL("assets/ammo.wasm-2f572f72.wasm",t.meta.url).href;let dz,pz=!1;"undefined"==typeof WebAssembly?dz=await t.import("./ammo-4c80c050.js"):(dz=await t.import("./ammo.wasm-96176c8b.js"),pz=!0);var mz,vz=dz.default,gz=e("e5",{});function yz(e){var t={};return void 0!==e&&(gz.wasmBinary=e),new Promise((function(e){vz.call(t,gz).then((function(){e()}))}))}(mz=yz||(yz=e("gd",{}))).isWasm=pz,mz.wasmBinaryURL=fz}}}));
